;/*FB_PKG_DELIM*/

__d("ACSCipherSuiteModule",[],(function(a,b,c,d,e,f){"use strict";b={hash:"SHA-512",name:"HMAC"};c={curveName:"RISTRETTO",macAlgorithm:b,value:1};var g=new Map([[c.value,c]]);function a(a){return g.has(a)?g.get(a):null}f.VOPRF_RISTRETTO_HMACSHA512=c;f.getACSCipherSuiteByValue=a}),66);
__d("ACSTokenHmacUtil",["XPlatReactCrypto"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){return h(a,b).then(function(a){return j(a,c)})}function h(a,b){return d("XPlatReactCrypto").subtleImportKey("raw",b,a,!1,["sign"]).then(function(b){return{algo:a,key:b}})}function i(a){return typeof a.hash==="string"?a.hash:a.hash.name}function j(a,b){var c=a.algo;a=a.key;c={hash:i(c),name:"HMAC"};return d("XPlatReactCrypto").subtleSign(c,a,b).then(function(a){return new Uint8Array(a)})}g.hmac=a}),98);
__d("EBDBMetricsConsistencyOperationEnum",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({Upload:0});f.EBConsistencyOperation=a}),66);
__d("EBEnableUnifiedAttachment",[],(function(a,b,c,d,e,f){"use strict";var g=!1;function a(a){g=a}function b(){return g}f.setEbEnableUnifiedAttachment=a;f.getEbEnableUnifiedAttachment=b}),66);
__d("EBReenrollmentTriggerHandler",["EBLogger","LSIntEnum","MWEBUseLocalStorage","MWEncryptedBackupsLocalStorageEntryEnum"],(function(a,b,c,d,e,f,g){"use strict";var h,i=d("EBLogger").EBLogger.tags(["DefaultEBReenrollmentTriggerHandler"]);a=function(){function a(){}var b=a.prototype;b.handle=function(a){i.debug("Running default reenrollment trigger handler for reason: "+(h||(h=d("LSIntEnum"))).toNumber(a.deviceReenrollmentReason));for(a of c("MWEncryptedBackupsLocalStorageEntryEnum").members())i.debug("Clearing local storage key: "+a),a!==c("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_OPTED_OUT_OF_AUTO_RESTORE&&d("MWEBUseLocalStorage").mwEBDeleteLocalStorageEntry(a)};return a}();g.DefaultEBReenrollmentTriggerHandler=a}),98);
__d("EBReenrollmentTriggerListener",["EBReenrollmentTriggerHandler","LSIntEnum","MWEBODSCategory","MWEBODSEntityName.enum","ODS","ReQL","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=function(){function a(a){this.$1=new Map(),this.$4=new(d("EBReenrollmentTriggerHandler").DefaultEBReenrollmentTriggerHandler)(),this.$2=a,this.$5()}var b=a.prototype;b.$5=function(){var a=this;this.$3==null&&(this.$3=d("ReQL").fromTableAscending(this.$2.tables.encrypted_backups_reenrollment_trigger).take(1).subscribe(function(b,e){if(e.operation==="add"||e.operation==="put"){(h||(h=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_COUNTERS,"reenrollment_trigger");b=a.getDefaultHandler();if(e.value.deviceReenrollmentReason!=null){var g;b=(g=a.$1.get((i||(i=d("LSIntEnum"))).unwrapIntEnum(e.value.deviceReenrollmentReason)))!=null?g:b}b.handle(e.value);c("promiseDone")(a.$2.runInTransaction(function(a){return a.encrypted_backups_reenrollment_trigger["delete"](e.value.pk)},"readwrite",void 0,void 0,f.id+":77"))}}));return this.$3};b.attachHandler=function(a,b){this.$1.set(a,b)};b.getDefaultHandler=function(){return this.$4};return a}(),k;function l(a){if(k!=null)return k;k=new j(a);return k}function a(a){k==null&&l(a);return k}g.initEBReenrollmentTriggerListener=l;g.getEBReenrollmentTriggerListener_TESTING_ONLY=a}),98);
__d("EBSMAPI",["Promise","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(a=c("requireDeferred"))("EBAddDeviceWithKeys").__setRef("EBSMAPI"),j=a("EBAddDeviceWithRecoveryCode").__setRef("EBSMAPI"),k=a("EBDeleteMailbox").__setRef("EBSMAPI"),l=a("EBFetchBackupIds").__setRef("EBSMAPI"),m=a("EBGetEBState").__setRef("EBSMAPI"),n=a("EBGetLSVirtualDevices").__setRef("EBSMAPI"),o=a("EBInitializeBackup").__setRef("EBSMAPI"),p=a("EBIsEbEnabled").__setRef("EBSMAPI");d={addDeviceWithEBKeys:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return i.load().then(function(a){return a.addDeviceWithEBKeys.apply(a,b)})},addDeviceWithRecoveryCode:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return j.load().then(function(a){return a.addDeviceWithRecoveryCode.apply(a,b)})},deleteMailbox:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return k.load().then(function(a){return a.deleteMailbox.apply(a,b)})},fetchBackupIds:function(a,b){return l.load().then(function(c){return c.fetchBackupIds(a,b)})},getEBState:function(){return m.load().then(function(a){return a.GetEbState()})},getLSVirtualDevices:function(a){return n.load().then(function(b){return b.getLSVirtualDevices(a)})},initializeBackup:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return o.load().then(function(a){return a.initializeBackup.apply(a,b)})},isEbEnabled:function(){return p.load().then(function(a){return a.isEbEnabledEbSwitch()})},optOutOfBackup:function(){return(h||(h=b("Promise"))).resolve()}};e=d;g["default"]=e}),98);
__d("EBUnifyLegacyMediaUpload",[],(function(a,b,c,d,e,f){"use strict";var g=!1;function a(a){g=a}function b(){return g}f.setEnableUnifyLegacyMediaUpload=a;f.getEnableUnifyLegacyMediaUpload=b}),66);
__d("WADbSignal",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}function b(a,b,c){return a+"_"+b+"_"+c}c={abProps:"abProps",authKeyPair:"authKeyPair",cat:"cat",certificateChain:"certificateChain",clockSkew:"clockSkew",deviceId:"deviceId",deviceUUID:"deviceUUID",edgeInfo:"edgeInfo",fbid:"fbid",identityKeyPair:"identityKeyPair",lastPrekeyGenerationId:"lastPrekeyGenerationId",lastPrekeyId:"lastPrekeyId",lastSessionDeviceWasLinkedTo:"lastSessionDeviceWasLinkedTo",lastSignedPrekeyId:"lastSignedPrekeyId",regId:"regId",registrationVersion:"registrationVersion",deviceRegUnixTime:"deviceRegUnixTime"};({msgrDeviceId:"msgrDeviceId"});d={registrationHistory:"registrationHistory"};f.unsafeCoerceToSenderKeySessionId=a;f.buildSenderKeySessionId=b;f.MetaKeysEnum=c;f.PlainTextMetaKeysEnum=d}),66);
__d("WAHandleFailureUtils",["WABridge","WAGlobals"],(function(a,b,c,d,e,f,g){"use strict";c={GENERIC_FAILURE:"400",NOT_AUTHORIZED:"401",TEMP_BANNED:"402",BANNED:"403",CAT_EXPIRED:"413",CAT_INVALID:"414",NOT_FOUND:"415",CAT_SESSION_INVALID:"418",INTERNAL_ERROR:"500",SERVER_UNAVAILABLE:"503"};function h(){return d("WAGlobals").getDependencies().clearSignalAndTempStores()}function a(){return h().then(function(){d("WABridge").getBridge().fireAndForget("event","logout",{})})}function b(){return h().then(function(){d("WABridge").getBridge().fireAndForget("event","reregisterDevice",{})})}g.FAILURE_CODES=c;g.clearRegistrationAndTempData=h;g.deregisterPhone=a;g.reregisterPhone=b}),98);
__d("WASignalDB",["BrowserLockManager","QPLFlow","WADexieToWormMigration","WAHandleFailureUtils","WAHex","WAIDBTypes","WALogger","WAResolvable","Worm","WormEAR","WormIDbDriver","WormIDbUtils","err","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[WORM] Error performing initDb: ",""]);h=function(){return a};return a}var i={identity:{primaryKey:"deviceJid",indexes:{userJid:{fields:["userJid"],unique:!1}}},contacts:{primaryKey:"contactJid"},session:{primaryKey:"id"},senderKeySessions:{primaryKey:"id",indexes:{groupJid:{fields:["groupJid"],unique:!1},userJid:{fields:["userJid"],unique:!1}}},prekey:{primaryKey:"keyId"},prekeyGeneration:{primaryKey:"generationId"},signedPrekey:{primaryKey:"keyId"},meta:{primaryKey:"key"},plaintextMeta:{primaryKey:"key",secure:!1},migration:{secure:!1,primaryKey:"key"},icdcFails:{primaryKey:"contactJid"},personalSenderKeyStatuses:{primaryKey:"groupJid"}},j,k=new(d("WAResolvable").Resolvable)();async function a(a,b,e,f,g,m){var n=m!=null?d("QPLFlow").startQPLFlow(m,{timeoutInMs:c("justknobx")._("3415"),annotations:{string:{operationType:"initDb"}}}):null;try{await l(async function(){var c=d("WAHex").parseHex(b),h="signalDb";c=new(d("WormEAR").WormEAR)(i,h,c);h=new(d("Worm").WormDatabase)(new(d("WormIDbDriver").WormIDbDriver)(a,h,i,c,g,{blockingErrorThreshold:e,onBlockingError:f,safeToDeleteStores:new Set(["stanzaQueue","danglingQueue"]),onTransactionError:function(b){if(b instanceof d("WormEAR").DecryptionError){b=b;if(b.store==="icdcFails")return;void d("WormIDbUtils").promisifyIDbRequest(d("WAIDBTypes").idb().deleteDatabase(a)).then(function(){return d("WAHandleFailureUtils").reregisterPhone()})}}}),m);j=h;await h.init({eventFlow:n});await d("WADexieToWormMigration").runMigration(h,n);k.resolve(h);n==null?void 0:n.endSuccess()})}catch(a){n==null?void 0:n.endFail("error");d("WALogger").ERROR(h(),a);throw a}}function b(){if(j==null)throw c("err")("Signal Db v3 is not initialized");return j}function e(){return k.promise}function f(a){return"Signal - "+a}function l(a){return c("BrowserLockManager")!=null?c("BrowserLockManager").request("wajs_make_signal_v3_db",a):a()}g.makeSignalDb=a;g.getDb=b;g.getDbPromise=e;g.signalOp=f}),98);
__d("WACryptoPrimitives",["tweetnacl"],(function(a,b,c,d,e,f,g){"use strict";b={scalarbase:(a=d("tweetnacl")).lowlevel.scalarbase,crypto_hash:a.lowlevel.crypto_hash,modL:a.lowlevel.modL,pack25519:a.lowlevel.pack25519,S:a.lowlevel.S,M:a.lowlevel.M,A:a.lowlevel.A,Z:a.lowlevel.Z,D:a.lowlevel.D,unpack25519:a.lowlevel.unpack25519,pow2523:a.lowlevel.pow2523,crypto_verify_32:a.lowlevel.crypto_verify_32,set25519:a.lowlevel.set25519,add:a.lowlevel.add,scalarmult:a.lowlevel.scalarmult};g.hash=a.hash;g.scalarMult=a.scalarMult;g.verify=a.verify;g.lowlevel=b;g.keypairFromSecretKey=a.box.keyPair.fromSecretKey;g.keyPair=a.box.keyPair;g.signDetachedVerify=a.sign.detached.verify}),98);
__d("WASignalLocalStorageProtocol.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};e={};f={};var h={},i={},j={},k={},l={},m={},n={},o={},p={},q={};a.internalSpec={sessionVersion:[1,(d=d("WAProtoConst")).TYPES.UINT32],localIdentityPublic:[2,d.TYPES.BYTES],remoteIdentityPublic:[3,d.TYPES.BYTES],rootKey:[4,d.TYPES.BYTES],previousCounter:[5,d.TYPES.UINT32],senderChain:[6,d.TYPES.MESSAGE,e],receiverChains:[7,d.FLAGS.REPEATED|d.TYPES.MESSAGE,e],pendingKeyExchange:[8,d.TYPES.MESSAGE,c],pendingPreKey:[9,d.TYPES.MESSAGE,b],remoteRegistrationId:[10,d.TYPES.UINT32],localRegistrationId:[11,d.TYPES.UINT32],needsRefresh:[12,d.TYPES.BOOL],aliceBaseKey:[13,d.TYPES.BYTES]};b.internalSpec={preKeyId:[1,d.TYPES.UINT32],signedPreKeyId:[3,d.TYPES.INT32],baseKey:[2,d.TYPES.BYTES]};c.internalSpec={sequence:[1,d.TYPES.UINT32],localBaseKey:[2,d.TYPES.BYTES],localBaseKeyPrivate:[3,d.TYPES.BYTES],localRatchetKey:[4,d.TYPES.BYTES],localRatchetKeyPrivate:[5,d.TYPES.BYTES],localIdentityKey:[7,d.TYPES.BYTES],localIdentityKeyPrivate:[8,d.TYPES.BYTES]};e.internalSpec={senderRatchetKey:[1,d.TYPES.BYTES],senderRatchetKeyPrivate:[2,d.TYPES.BYTES],chainKey:[3,d.TYPES.MESSAGE,h],messageKeys:[4,d.FLAGS.REPEATED|d.TYPES.MESSAGE,f]};f.internalSpec={index:[1,d.TYPES.UINT32],cipherKey:[2,d.TYPES.BYTES],macKey:[3,d.TYPES.BYTES],iv:[4,d.TYPES.BYTES]};h.internalSpec={index:[1,d.TYPES.UINT32],key:[2,d.TYPES.BYTES]};i.internalSpec={currentSession:[1,d.TYPES.MESSAGE,a],previousSessions:[2,d.FLAGS.REPEATED|d.TYPES.MESSAGE,a]};j.internalSpec={id:[1,d.TYPES.UINT32],publicKey:[2,d.TYPES.BYTES],privateKey:[3,d.TYPES.BYTES]};k.internalSpec={id:[1,d.TYPES.UINT32],publicKey:[2,d.TYPES.BYTES],privateKey:[3,d.TYPES.BYTES],signature:[4,d.TYPES.BYTES],timestamp:[5,d.TYPES.FIXED64]};l.internalSpec={publicKey:[1,d.TYPES.BYTES],privateKey:[2,d.TYPES.BYTES]};m.internalSpec={senderKeyId:[1,d.TYPES.UINT32],senderChainKey:[2,d.TYPES.MESSAGE,p],senderSigningKey:[3,d.TYPES.MESSAGE,n],senderMessageKeys:[4,d.FLAGS.REPEATED|d.TYPES.MESSAGE,o]};n.internalSpec={"public":[1,d.TYPES.BYTES],"private":[2,d.TYPES.BYTES]};o.internalSpec={iteration:[1,d.TYPES.UINT32],seed:[2,d.TYPES.BYTES]};p.internalSpec={iteration:[1,d.TYPES.UINT32],seed:[2,d.TYPES.BYTES]};q.internalSpec={senderKeyStates:[1,d.FLAGS.REPEATED|d.TYPES.MESSAGE,m]};g.SessionStructureSpec=a;g.SessionStructure$PendingPreKeySpec=b;g.SessionStructure$PendingKeyExchangeSpec=c;g.SessionStructure$ChainSpec=e;g.SessionStructure$Chain$MessageKeySpec=f;g.SessionStructure$Chain$ChainKeySpec=h;g.RecordStructureSpec=i;g.PreKeyRecordStructureSpec=j;g.SignedPreKeyRecordStructureSpec=k;g.IdentityKeyPairStructureSpec=l;g.SenderKeyStateStructureSpec=m;g.SenderKeyStateStructure$SenderSigningKeySpec=n;g.SenderKeyStateStructure$SenderMessageKeySpec=o;g.SenderKeyStateStructure$SenderChainKeySpec=p;g.SenderKeyRecordStructureSpec=q}),98);
__d("WATypedArraysCast",["WABase64"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(b instanceof a)return b;return typeof b==="string"?new a(d("WABase64").decodeB64(b)):new a(b)}g.castTypedArrays=a}),98);
__d("WACryptoHmac",["WACryptoDependencies","WATypedArraysCast"],(function(a,b,c,d,e,f,g){"use strict";var h=32,i=new Uint8Array(h),j={name:"HMAC",hash:"SHA-256"},k={name:"HMAC",hash:"SHA-512"},l={name:"HMAC",hash:"SHA-1"};function m(a,b){b=d("WATypedArraysCast").castTypedArrays(Uint8Array,b);return d("WACryptoDependencies").getCrypto().subtle.importKey("raw",b,a,!1,["sign"]).then(function(b){return{key:b,algo:a}})}function a(a){return m(j,a)}function n(a,b,c){var e=a.key;a=a.algo;return d("WACryptoDependencies").getCrypto().subtle.sign(a,e,b).then(function(a){return c!=null&&c!==0?a.slice(0,c):a})}function b(a,b){return m(j,a!=null?a:i).then(function(a){return n(a,b)})}function c(a,b,c){return m(j,a).then(function(a){return n(a,b,c)})}function e(a,b,c){return m(k,a).then(function(a){return n(a,b,c)})}function f(a,b,c){return m(l,a).then(function(a){return n(a,b,c)})}g.SHA256_BYTE_LENGTH=h;g.DEFAULT_SALT=i;g.encodeKeySha256=a;g.sign=n;g.extractSha256=b;g.hmacSha256=c;g.hmacSha512=e;g.hmacSha1=f}),98);
__d("WACryptoHkdf",["Promise","WABinary","WACryptoHmac","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i=255*d("WACryptoHmac").SHA256_BYTE_LENGTH;function j(a,e,f){if(f<0||f>i)return(h||(h=b("Promise"))).reject(c("err")("HKDF::expand given bad length "+f));var g,j=Math.ceil(f/d("WACryptoHmac").SHA256_BYTE_LENGTH),k=d("WABinary").Binary.build(e).readByteArrayView(),l=new(d("WABinary").Binary)(),m=d("WACryptoHmac").encodeKeySha256(a).then(function(a){g=a;return new Uint8Array(0)});e=function(a){m=m.then(function(b){return d("WACryptoHmac").sign(g,d("WABinary").Binary.build(b,k,a).readByteArrayView())}).then(function(a){a=new Uint8Array(a);l.writeByteArray(a);return a})};for(a=1;a<=j;a++)e(a);return m.then(function(){return l.readBuffer(f)})}function a(a,b,c){return d("WACryptoHmac").extractSha256(null,a).then(function(a){return j(new Uint8Array(a),b,c)})}function e(a,b,c,e){return d("WACryptoHmac").extractSha256(b,a).then(function(a){return j(new Uint8Array(a),c,e)})}g.expand=j;g.extractAndExpand=a;g.extractWithSaltAndExpand=e}),98);
__d("WACryptoUtils",["WACryptoDependencies","WACryptoPrimitives","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return h(new Uint8Array(a),new Uint8Array(b))}function h(a,b){return a.length===0&&b.length===0||d("WACryptoPrimitives").verify(a,b)}function b(a,b){return a.length===0&&b.length===0||d("WACryptoPrimitives").verify(a,b)}function e(a,b){return a.length===0&&b.length===0||d("WACryptoPrimitives").verify(a,b)}function f(a){if(a!==(a|0))throw c("err")("bound must be int32");if(a<=0)throw c("err")("bound must not be positive");var b=new Int32Array(1),e=-1>>>1;e=a*Math.floor(e/a);var f=-1;while(f===-1){d("WACryptoDependencies").getCrypto().getRandomValues(b);var g=b[0]>>>1;g<e&&(f=g%a)}return f}g.arrayBuffersEqual=a;g.uint8ArraysEqual=h;g.rawKeysEqual=b;g.serializedPubKeysEqual=e;g.randomNumberLessThan=f}),98);
__d("WAXmlParsingFailure",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a,b){this.parser=a,this.reason=b}var b=a.prototype;b.toString=function(){return"XmlParsingFailure: "+this.parser+": "+this.reason};return a}();f.XmlParsingFailure=a}),66);
__d("WAParsableXmlNode",["WAHasProperty","WAXmlParsingFailure","err"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,b){var c=this;this.$1=a;this.$2=b;this.$3=Array.isArray(b.content)?b.content.map(function(b){return new c.constructor(a,b)}):null}var b=a.prototype;b.name=function(){return this.$1};b.node=function(){return this.$2};b.hasAttr=function(a){return c("WAHasProperty")(this.$2.attrs,a)};b.assertTag=function(a){this.$2.tag!==a&&this["throw"]("to be <"+a+">")};b.tag=function(){return this.$2.tag};b.maybeChild=function(a){var b=this.$3;if(!b)return null;for(var c=0;c<b.length;c++)if(b[c].tag()===a)return b[c];return null};b.hasChild=function(a){return!!this.maybeChild(a)};b.child=function(a){var b=this.maybeChild(a);return!b?this["throw"]("to have child <"+a+">"):b};b.assertAttr=function(a,b){var c=this.attrString(a);c!==b&&this["throw"]('to have "'+a+'"="'+b+'", but instead has "'+c+'"')};b.attrString=function(a){return!c("WAHasProperty")(this.$2.attrs,a)?this["throw"]('to have attribute "'+a+'"'):this.decodeAsString(this.$2.attrs[a])};b.forEachAttributeKey=function(a){var b=this.$2.attrs;Object.keys(b).forEach(function(b){return a(b)})};b.maybeAttrString=function(a){return this.hasAttr(a)?this.decodeAsString(this.$2.attrs[a]):null};b.maybeAttrInt=function(a,b,c){return this.hasAttr(a)?this.attrInt(a,b,c):null};b.attrEnumValues=function(a,b,c){b=new Set(b);var d=this.attrString(a);if(!b.has(d)){if(c!=null)return c;c=Array.from(b).join("|");return this["throw"]('to have "'+a+'"={'+c+'} but has value "'+d+'"')}return d};b.attrEnum=function(a,b){var d=this.attrString(a);if(!c("WAHasProperty")(b,d)){var e=Object.keys(b).join("|");return this["throw"]('to have "'+a+'"={'+e+'} but has value "'+d+'"')}return b[d]};b.attrEnumOrNullIfUnknown=function(a,b){a=this.attrString(a);return!c("WAHasProperty")(b,a)?null:b[a]};b.attrEnumOrDefault=function(a,b,c){return this.hasAttr(a)?this.attrEnum(a,b):c};b.attrInt=function(a,b,c){var d=this.attrString(a);return this.$4(d,a,b,c)};b.$4=function(a,b,c,d){var e=parseInt(a,10);if(Number.isNaN(e))return this["throw"]('to have "'+b+'"={integer} but has value "'+a+'"');else if(c!==void 0&&e<c)return this["throw"]('to have "'+b+'"={at least '+c+"} but has value "+e);else if(d!==void 0&&e>=d)return this["throw"]('to have "'+b+'"={below '+d+"} but has value "+e);return e};b.forEachChild=function(a){var b=this.$3;if(b)b.forEach(function(b){return a(b)});else if(this.$2.content!=null)return this["throw"]("to have children")};b.forEachChildWithTag=function(a,b){this.forEachChild(function(c){c.tag()===a&&b(c)})};b.mapChildren=function(a){var b=this.$3;return!b&&this.$2.content!=null?this["throw"]("to have children"):b?b.map(function(b){return a(b)}):[]};b.mapChildrenWithTag=function(a,b){var c=this.$3;return!c&&this.$2.content!=null?this["throw"]("to have children"):c?c.filter(function(b){return b.tag()===a}).map(function(a){return b(a)}):[]};b.mapFirstChild=function(a){var b=this.$3;return!b||b.length===0?this["throw"]("to have children"):a(b[0])};b.hasContent=function(){return!this.$3&&!!this.$2.content};b.hasChildren=function(){return this.$3!=null};b.getChildren=function(){return this.$3};b.mapAttrKeys=function(a){var b=this.getAttrKeys();return b&&b.length?b.map(a):[]};b.getAttrKeys=function(){return Object.keys(this.$2.attrs)};b.hasAttrs=function(){var a=this.$2.attrs?Object.keys(this.$2.attrs):[];return a.length>0};b.getNode=function(){return this.$2};b.unsafeSetChildren=function(a){this.$3=a};b.unsafeSetNodeContent=function(a){this.$2.content=a};b.contentUint=function(a){var b=this.contentBytes(a);return h(b,a)};b.contentBytes=function(a){a===void 0&&(a=-1);if(this.$3)return this["throw"]("to have binary content, but has children instead");else if(this.$2.content!=null){var b=this.$2.content;return a!==-1&&b.length!==a?this["throw"]("to be "+a+" bytes, but got "+b.length+" instead"):b}else return this["throw"]("to have content")};b.contentString=function(){if(this.$3)return this["throw"]("to have string content, but has children instead");else if(this.$2.content!=null)return this.$2.content;else return this["throw"]("to have content")};b.contentInt=function(a,b){var c=this.contentString();return this.$4(c,"content",a,b)};b.contentEnum=function(a){var b=this.contentString();if(!c("WAHasProperty")(a,b)){var d=Object.keys(a).join("|");return this["throw"]("to have content {"+d+'} but has value "'+b+'"')}return a[b]};b.decodeAsString=function(a){if(typeof a!=="string")throw c("err")("decodeAsString: attribute is "+typeof a+" not a string: "+a);return a};b["throw"]=function(a){throw new(d("WAXmlParsingFailure").XmlParsingFailure)(this.$1,"expected <"+this.$2.tag+"> "+a)};b.toString=function(){return this.$2.toString()};return a}();function h(a,b){var c=0;for(var d=0;d<b;d++)c=c*256+a[d];return c}g.ParsableXmlNode=a;g.convertBytesToUint=h}),98);
__d("WASignalOther",["WACryptoDependencies","WACryptoHkdf","WACryptoUtils","WAParsableXmlNode","decodeProtobuf","encodeProtobuf","err"],(function(a,b,c,d,e,f,g){"use strict";var h={name:"AES-CBC"},i={name:"HMAC",hash:"SHA-256"};function j(a,b){if(a.length!==b)throw c("err")("Signal expected "+b+" bytes, given "+a.length);return a}function a(a,b){return j(new Uint8Array(a),b)}function b(a){var b=a.buffer,c=a.byteOffset;a=a.length;return c===0&&a===b.byteLength?b:b.slice(c,c+a)}function e(a,b){return a.readByteArrayView(b)}function f(a){return new Uint8Array(a)}function k(a,b,d){if(a.length-b<d)throw c("err")("Can not split off "+d+" bytes from index "+b+" of "+a.length+" bytes");return a.slice(b,b+d)}function l(a){a=a==="extendedRange"?(-1>>>1)-1:16380;return d("WACryptoUtils").randomNumberLessThan(a)+1}function m(a){return q(a)}function n(a){return d("WAParsableXmlNode").convertBytesToUint(a,4)}function o(){var a=-1>>>1;return d("WACryptoUtils").randomNumberLessThan(a)+1}function p(a){return q(a)}function q(a,b,d){b===void 0&&(b=0);d===void 0&&(d=4294967296);if(typeof a==="number"&&b<=a&&a<d&&Math.floor(a)===a)return a;else throw c("err")("Expected integer in range ["+b+", "+d+"), given "+String(a))}function r(a,b){return d("encodeProtobuf").encodeProtobuf(a,b).readByteArrayView()}function s(a,b,c){return c(d("decodeProtobuf").decodeProtobuf(a,b))}function t(a,b,c,e){return d("WACryptoHkdf").extractWithSaltAndExpand(a,b,c,e).then(function(a){return new Uint8Array(a)})}function u(a,b){var c,e;b==="hmac-sha256"?(c=i,e=["sign"]):(b,c=h,e=["encrypt","decrypt"]);return d("WACryptoDependencies").getCrypto().subtle.importKey("raw",a,c,!1,e)}function v(a){return a}function w(a){return a}function x(a,b){return d("WACryptoUtils").arrayBuffersEqual(a,b)}g.AES_CBC=h;g.HMAC_SHA256=i;g.ensureSize=j;g.toBytes=a;g.toBuffer=b;g.readBytes=e;g.makeBytes=f;g.sliceBytes=k;g.makeRegistrationId=l;g.castRegistrationId=m;g.castRegistrationIdFromBytes=n;g.makeSenderKeyId=o;g.castSenderKeyId=p;g.ensureIntInRange=q;g.encodeSignalProto=r;g.decodeSignalProto=s;g.hkdf=t;g.makeCryptoKey=u;g.castToByteEncoded=v;g.castToSessionHash=w;g.areSessionHashesEqual=x}),98);
__d("WASignalKeys",["WACryptoDependencies","WACryptoPrimitives","WALogger","WASignalLocalStorageProtocol.pb","WASignalOther","decodeProtobuf","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["deserializePreKey error ",""]);h=function(){return a};return a}var i=5,j=16777215;function k(a,b){return{publicKey:a,privateKey:b}}function a(a){a=d("WACryptoPrimitives").keypairFromSecretKey(a);var b=a.publicKey;a=a.secretKey;return k(d("WASignalOther").ensureSize(b,32),d("WASignalOther").ensureSize(a,32))}function b(a,b){return{publicKey:d("WASignalOther").toBytes(a,32),privateKey:d("WASignalOther").toBytes(b,32)}}function l(){var a=d("WACryptoPrimitives").keyPair(),b=a.publicKey;a=a.secretKey;a[0]&=248;a[31]=64|a[31]&63;return k(d("WASignalOther").ensureSize(b,32),d("WASignalOther").ensureSize(a,32))}function m(a,b){return k(d("WASignalOther").sliceBytes(b,1,32),a)}function n(a,b){return{serializedPubKey:b,privateKey:a}}function e(){var a=l();return n(a.privateKey,o(a))}function o(a){var b=d("WASignalOther").makeBytes(33);b[0]=i;b.set(a.publicKey,1);return b}function f(a){var b=d("WASignalOther").makeBytes(33);b[0]=i;b.set(d("WASignalOther").ensureSize(a,32),1);return b}function p(a){return n(a.privateKey,o(a))}function q(a,b){a=(a-1)%j;a<=0&&(a+=j);var c=[];for(var e=0;e<b;e++){var f=a===j?1:a+1,g=l(),h=d("WASignalOther").encodeSignalProto(d("WASignalLocalStorageProtocol.pb").PreKeyRecordStructureSpec,{id:f,publicKey:o(g),privateKey:g.privateKey});c.push({plainObject:{id:f,keyPair:g},record:h});a=f}return c}function r(a){try{a=d("decodeProtobuf").decodeProtobuf(d("WASignalLocalStorageProtocol.pb").PreKeyRecordStructureSpec,a);var b=a.id,c=a.publicKey;a=a.privateKey;return b==null||c==null||a==null?null:{id:s(b),keyPair:m(d("WASignalOther").toBytes(a,32),u(new Uint8Array(c)))}}catch(a){d("WALogger").DEV(h(),a);return null}}function s(a){return d("WASignalOther").ensureIntInRange(a,1,j)}function t(a){return d("WASignalOther").ensureIntInRange(a,0,j)}function u(a){if(a.length===0||a[0]!==i)throw c("err")("Unrecognized public key type");return d("WASignalOther").ensureSize(a,33)}function v(){var a=d("WASignalOther").makeBytes(32);d("WACryptoDependencies").getCrypto().getRandomValues(a);return a}function w(a,b){return d("WACryptoPrimitives").scalarMult(a,b.subarray(1)).buffer}g.KEY_TYPE=i;g.makeKeyPairFrom=a;g.makeKeyPairFromArrayBuffers=b;g.makeKeyPair=l;g.makeKeyPairFromSerialized=m;g.makeSerializedKeyPairFrom=n;g.makeSerializedKeyPair=e;g.serializePubKey=o;g.serializeIdentity=f;g.toSerializedKeyPair=p;g.makePreKeys=q;g.deserializePreKey=r;g.castToPreKeyId=s;g.castToSignedPreKeyId=t;g.castToSerializedPubKey=u;g.makeRawSenderKey=v;g.ecdh=w}),98);
__d("WAGetLocalPublicPrivateIdentityKeyApiV2",["WADbSignal","WALogger","WASignalDB","WASignalKeys","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);h=function(){return a};return a}a=function(){return d("WASignalDB").getDb().runInTransaction(["meta"],"readonly",async function(a){var b;a=await a.stores.meta.get(d("WADbSignal").MetaKeysEnum.identityKeyPair);if((a==null?void 0:(b=a.value)==null?void 0:b.identityKeyPair)==null){b="[Remote Presence Error] Identity key pair was null";d("WALogger").ERROR(h(),b);throw c("err")(b)}return d("WASignalKeys").toSerializedKeyPair(a.value.identityKeyPair)},d("WASignalDB").signalOp("getLocalPublicPrivateIdentityKey"))};g.getLocalPublicPrivateIdentityKey=a}),98);
__d("EBWorkerAddDeviceUtils",["EBDB","EBDBEbsmApi","EBSMProperties","I64","LSAuthorityLevel","LSIntEnum","LSJSEBInMemoryStorage","LSMetadata","LSReStoreWrapper","MAWLSVaultingHooks","ReQL","WAGetLocalPublicPrivateIdentityKeyApiV2","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i;async function a(){var a=await d("WAGetLocalPublicPrivateIdentityKeyApiV2").getLocalPublicPrivateIdentityKey(),b=a.privateKey;a=a.serializedPubKey;return{identityPrivateKey:b,identityPublicKey:a}}async function b(a,b){var e=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(b.tables.secure_encrypted_backups_client_state));if(e!=null)return"dest_table_not_empty";e={clearEbStores:d("EBDB").clearEbStores,flushEBSMtoEBDB:d("EBDBEbsmApi").flushEBSMtoEBDB,rehydrateEBSMFromEBDB:d("EBDBEbsmApi").rehydrateEBSMFromEBDB,updateEBSM:function(){return Promise.resolve()}};e=await d("LSJSEBInMemoryStorage").makeReStorePersistence(e);if(e==null)throw c("err")("persistence is null");e=d("LSReStoreWrapper").createLSReStore(e,d("LSMetadata").schema,[c("MAWLSVaultingHooks")],void 0);var g=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(e.tables.secure_encrypted_backups_epochs));return g.filter(function(a){return(h||(h=d("I64"))).equal(a.authorityLevel,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))}).length===0?"source_epoch_not_authoritative":e.runInTransaction(function(c){return b.runInTransaction(async function(b){var d=await Promise.all(a.map(async function(a){var d=c[a];d=d.entries(new WeakMap());var e=await d.next();if(e.done)return"source_table_empty";a=b[a];while(!e.done){var f=e.value,g=f[0];f=f[1];await a.upsert(g,f);e=await d.next()}return"success"}));d=new Set(d);if(d.has("source_table_empty"))return"source_table_empty";else if(d.has("success")&&d.size===1)return"success";return"fail"},"readwrite",void 0,void 0,f.id+":111")},"readonly",void 0,void 0,f.id+":109")}async function e(a){await a.runInTransaction(function(a){return Promise.all(c("EBSMProperties").persistedTablesArray.map(async function(b){b=a[b];var c=b.entries(new WeakMap()),d=await c.next();while(!d.done)await b.delete.apply(b,d.value[0]),d=await c.next()}))},"readwrite",void 0,void 0,f.id+":152")}g.getIdentityKeysInWorker=a;g.copyEBStateTablesFromMainthreadToWorker=b;g.clearLSEBSMTables=e}),98);
__d("EBWorkerEBDBApiDeferred",["requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("EBWorkerEBDBApi").__setRef("EBWorkerEBDBApiDeferred");function a(){return h.load().then(function(a){return a.startListeningEBDeviceRegistrations()})}function b(a){return h.load().then(function(b){return b.addNewDevice(a)})}function d(a){return h.load().then(function(b){return b.trackConsistency(a)})}g.startListeningEBDeviceRegistrations=a;g.addNewDevice=b;g.trackConsistency=d}),98);
__d("EBWorkerODSEntityName.enum",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({MW_EBSM_HYDRATION:"mw_ebsm_hydration",MW_EBSM_IDB:"mw_eb_ebsm_idb",MW_EBSM_CORRUPTION:"mw_ebsm_corruption",MW_EBSM_RESTORE_PERSISTENCE_ERROR:"mw_ebsm_restore_persistence",MW_EBSM_IDB_TABLE_DELETION:"mw_ebsm_idb_table_deletion",MW_EB_AUTO_RESTORE_MAIN_THREAD:"mw_eb_auto_restore_main_thread",MW_EB_AUTO_RESTORE_WORKER:"mw_eb_auto_restore_worker",MW_EB_DEVICE_MIGRATION_WORKER:"mw_eb_device_migration_worker",MW_EB_OTC_MAIN_THREAD:"mw_eb_otc_main_thread",EB_WORKER_ADD_DEVICE_WITH_KEYS:"eb_worker_add_device_with_keys",EB_WORKER_ADD_DEVICE_WITH_RC:"eb_worker_add_device_with_rc",EB_WORKER_OPT_OUT:"eb_worker_opt_out"});c=a;f["default"]=c}),66);
__d("GetBlobFromInt64BE",["I64","LSResult","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a){var e=new Uint8Array(8);e.reduceRight(function(a,b,c){b=(i||(i=d("I64"))).to_int32(i.mod_(a,i.of_string("256")));e[c]=b;return i.div(a,i.of_string("256"))},a);return(h||(h=b("Promise"))).resolve(c("LSResult")(e.buffer))}g.GetBlobFromInt64BE=a}),98);
__d("PakeCpaceUtils",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a.buffer.slice(a.byteOffset,a.byteLength+a.byteOffset)}function b(a,b){var c=new a.VectorInt();b.forEach(function(a){c.push_back(a)});return c}f.typedArrayToBuffer=a;f.uint8ArrayToVectorInt=b}),66);
__d("Hmac_v2",["CryptoLogger","LSResult","PakeCpaceUtils","Promise","WACryptoSha256HmacBuilder"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,e){try{a=new(d("WACryptoSha256HmacBuilder").Sha256HMacBuilder)(new Uint8Array(a)).update(new Uint8Array(e)).finish();return(h||(h=b("Promise"))).resolve(c("LSResult")(d("PakeCpaceUtils").typedArrayToBuffer(a)))}catch(a){d("CryptoLogger").captureError(d("CryptoLogger").CryptoLogger("hmac_v2"),a).mustfix("Crypto signing failed: data length: %s, was_timeout: %s",e==null?void 0:e.byteLength,!1);throw a}};g["default"]=a}),98);
__d("LSACSExperimentCapability",[],(function(a,b,c,d,e,f){a=Object.freeze({RETRY_AFTER_TASK_SERIALIZATION_FAILURE_EXPONENTIAL_BACKOFF:0,BUMP_TOKEN_SYNC_TASK_AT_TASK_SERIALIZATION:1,INSERT_PENDING_TASK_PARENT_ROW_WHEN_NO_ACS_TOKENS_AT_TASK_INSERTION:2});f["default"]=a}),66);
__d("LSBeginHandlingFireForgetTasksForQueue",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(e){return b.sequence([function(d){return c[0]=b.createArray(),b.forEach(b.filter(b.db.table(5).fetch(),function(b){return b.queueName===a[0]}),function(a){a=a.item;return c[3]=new b.Map(),c[3].set("label",a.context),c[3].set("payload",a.taskValue),c[3].set("queue_name",a.queueName),c[3].set("task_id",a.taskId),c[3].set("failure_count",b.i64.eq(b.i64.cast([0,0]),b.i64.cast([0,0]))?void 0:b.i64.cast([0,0])),c[4]=(c[0].push(c[3]),c[0])})},function(e){return c[1]=new b.Map(),c[1].set("tasks",c[0]),c[1].set("epoch_id",void 0),c[2]=new b.Map(),c[2].set("queue_name",a[0]),c[2].set("next_sync_ms",void 0),c[2].set("work_item_type",b.i64.cast([0,5])),c[2].set("network_payload",c[1]),c[2].set("http_url_override",void 0),c[2].set("skip_realtime_gateway",!1),d[0]=c[2]}])},function(a){return b.resolve(d)}])}a.__sproc_name__="LSCoreBeginHandlingFireForgetTasksForQueueStoredProcedure";a.__tables__=["pending_fire_and_forget_tasks"];e.exports=a}),null);
__d("LSBeginHandlingFireForgetTasksForQueueStoredProcedure",["LSBeginHandlingFireForgetTasksForQueue","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSBeginHandlingFireForgetTasksForQueue"),e.queueName);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSForceTaskExecutionImmediately",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(d){return b.db.table(2).fetch([[[a[0]]]]).next().then(function(d,e){var f=d.done;d=d.value;return f?0:(e=d.item,c[1]=b.i64.of_float(Date.now()),b.i64.lt(c[1],e.minTimeToSyncTimestampMs)?b.forEach(b.db.table(2).fetch([[[a[0]]]]),function(a){var c=a.update;a=a.item;return c({minTimeToSyncTimestampMs:b.i64.cast([0,0]),failureCount:b.i64.add(a.failureCount,b.i64.cast([0,1]))})}):b.resolve())})},function(a){return b.resolve(d)}])}a.__sproc_name__="LSCoreForceTaskExecutionImmediatelyStoredProcedure";a.__tables__=["pending_tasks"];e.exports=a}),null);
__d("LSRemoveUsedTokens",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(a){return b.forEach(b.filter(b.db.table(309).fetch(),function(a){return b.i64.le(a.redeemLimit,b.i64.cast([0,0]))}),function(a){return a["delete"]()})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSAnonymousCredentialsRemoveUsedTokensStoredProcedure";a.__tables__=["secure_acs_tokens"];e.exports=a}),null);
__d("LSGetCurrentTokenPoolState",["LSArrayGetObjectAt","LSRemoveBlindedTokens","LSRemoveUsedTokens"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){return d[0]=c.i64.of_float(Date.now()),d[1]=c.createArray(),c.count(c.filter(c.db.table(307).fetch(),function(b){return b.projectName===a[0]})).then(function(a){return d[2]=a})},function(b){return c.forEach(c.filter(c.db.table(307).fetch(),function(b){return b.projectName===a[0]}),function(a){a=a.item;return d[7]=a.configId,c.i64.gt(d[0],a.expirationTimestampMs)?c.forEach(c.db.table(307).fetch([[[d[7]]]]),function(a){return a["delete"]()}):c.resolve(d[8]=(d[1].push(d[7]),d[1]))})},function(a){return c.storedProcedure(b("LSRemoveUsedTokens"))},function(a){return d[3]=c.i64.cast([0,0]),d[4]=c.i64.of_int32(d[1].length),c.i64.gt(d[4],c.i64.cast([0,0]))?c.loopAsync(d[4],function(a){return d[7]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[1],d[7]).then(function(a){return a=a,d[8]=a[0],d[9]=a[1],a})},function(a){return c.count(c.filter(c.db.table(309).fetch(),function(a){return a.configId===d[8]})).then(function(a){return d[10]=a})},function(a){return d[3]=c.i64.add(d[10],d[3]),c.storedProcedure(b("LSRemoveBlindedTokens"),d[8])}])}):c.resolve()},function(a){return c.i64.gt(d[2],c.i64.cast([0,0]))?(d[7]=c.i64.of_int32(d[1].length),d[5]=c.i64.ge(d[7],c.i64.cast([0,1]))):d[5]=void 0,d[5]!==void 0?(d[5]?(c.i64.gt(d[3],c.i64.cast([0,0]))?d[8]=c.i64.cast([0,3]):d[8]=c.i64.cast([0,2]),d[7]=d[8]):d[7]=c.i64.cast([0,1]),d[6]=d[7]):d[6]=c.i64.cast([0,0]),a=[d[6],d[3]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSAnonymousCredentialsGetCurrentTokenPoolStateStoredProcedure";a.__tables__=["secure_acs_configurations","secure_acs_tokens"];e.exports=a}),null);
__d("LSVoprfBlind.nop",["XPlatReactVoprf"],(function(a,b,c,d,e,f,g){"use strict";a=async function(a,b,c){a=await d("XPlatReactVoprf").loadXPlatReactVoprf();b=a.voprfInstance;a=b.voprfInfo;var e=b.voprfWasm;try{e=e.blind(a,new Uint8Array(c));return[e.blindedElement.buffer,e.blindingFactor.buffer]}catch(a){throw a}finally{d("XPlatReactVoprf").freeVoprfInstance(b)}};a.__nop_name__="LSVoprfBlind";g.default=a}),98);
__d("LSVoprfCreateNonce.nop",["LSSynchronousPromise","XPlatReactCrypto"],(function(a,b,c,d,e,f,g){"use strict";var h=32;a=function(a,b){a=h;b=new Uint8Array(a);d("XPlatReactCrypto").getRandomValues(b);return d("LSSynchronousPromise").makeSynchronousPromise([b.buffer])};a.__nop_name__="LSVoprfCreateNonce";g["default"]=a}),98);
__d("LSTaskSerializerAcsIssueNextSync",["LSBase64Encode.nop","LSGetCurrentTokenPoolState","LSIssueNextSync","LSVoprfBlind.nop","LSVoprfCreateNonce.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return c.db.table(310).fetch([[[a[0]]]]).next().then(function(a,e){var f=a.done;a=a.value;return f?(function(a){c.logger(a).mustfix(a)}("Request context for the passed task_id was not found"),f=[void 0,void 0,void 0],d[0]=f[0],d[1]=f[1],d[2]=f[2],f):(e=a.item,c.sequence([function(a){return d[9]=e.projectName,d[10]=e.maxClientTokenPoolSize,c.storedProcedure(b("LSGetCurrentTokenPoolState"),d[9]).then(function(a){return a=a,d[4]=a[0],d[5]=a[1],a})},function(a){return c.i64.eq(d[4],c.i64.cast([0,0]))||c.i64.eq(d[4],c.i64.cast([0,1]))?c.resolve((d[11]=new c.Map(),d[11].set("project_name",d[9]),d[12]=c.toJSON(d[11]),a=[d[12],c.i64.cast([0,351]),void 0],d[6]=a[0],d[7]=a[1],d[8]=a[2],a)):c.sequence([function(a){return d[11]=c.i64.of_float(Date.now()),c.islc(c.sortBy(c.filter(c.db.table(307).fetch(),function(a){return a.projectName===d[9]&&c.i64.gt(a.expirationTimestampMs,d[11])}),[["expirationTimestampMs","DESC"]]),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(e,f){var a=e.done;e=e.value;return a?(function(a){c.logger(a).mustfix(a)}("A config for the passed project name was not found"),d[16]=new c.Map(),d[16].set("project_name",d[9]),d[16].set("max_client_token_pool_size",d[10]),d[17]=c.toJSON(d[16]),a=[d[17],c.i64.cast([0,362]),void 0],d[12]=a[0],d[13]=a[1],d[14]=a[2],a):(f=e.item,c.sequence([function(a){return d[24]=f.configId,d[16]=f.maxEvals,d[26]=f.tokenPollFrequencyMs,d[25]=f.maxClientTokenPoolSize,d[17]=c.i64.sub(d[10],d[5]),d[23]=c.i64.lt(d[16],d[17])?d[16]:d[17],d[18]=c.createArray(),c.i64.gt(d[23],c.i64.cast([0,0]))?c.loopAsync(d[23],function(a){return d[27]=a,c.sequence([function(a){return c.nativeOperation(b("LSVoprfCreateNonce.nop")).then(function(a){return a=a,d[28]=a[0],a})},function(a){return c.blobs.neq(d[28],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSVoprfBlind.nop"),d[28]).then(function(a){return a=a,d[29]=a[0],d[30]=a[1],a})},function(a){return c.blobs.neq(d[29],void 0)?c.blobs.neq(d[30],void 0)?c.sequence([function(a){return d[31]=c.i64.cast([-1,4294967295]),c.db.table(308).peekNextAutoIncrementId().then(function(a){return d[31]=a})},function(a){return c.db.table(308).add({tokenId:void 0,blindedNonce:d[29],blindingFactor:d[30],nonce:d[28],configId:d[24]})},function(a){return c.db.table(308).fetch([[[d[31]]]]).next().then(function(b,e){var a=b.done;b=b.value;return a?d[32]=c.i64.cast([-1,4294967295]):(e=b.item,d[32]=e.tokenId)})},function(a){return c.i64.eq(d[32],c.i64.cast([-1,4294967295]))?c.sequence([function(a){return c.islc(c.db.table(308).fetchDesc([[[{gt:c.i64.cast([0,0])}]]]),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,e){var a=b.done;b=b.value;return a?d[37]=c.i64.cast([-1,4294967295]):(e=b.item,d[37]=e.tokenId)})},function(a){return d[34]=d[37]}]):c.resolve(d[34]=d[32])},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[29]).then(function(a){return a=a,d[35]=a[0],a})},function(a){return d[36]=new c.Map(),d[36].set("id",d[34]),d[36].set("data",d[35]==null?"":d[35]),d[37]=(d[18].push(d[36]),d[18])}]):c.resolve():c.resolve()}]):c.resolve()}])}):c.resolve()},function(a){return d[19]=c.i64.of_int32(d[18].length),c.i64.gt(d[19],c.i64.cast([0,0]))?c.resolve((d[27]=new c.Map(),d[27].set("project_name",d[9]),d[27].set("config_id",d[24]),d[27].set("blinded_nonces",d[18]),d[28]=c.toJSON(d[27]),a=[d[28],c.i64.cast([0,354]),void 0],d[20]=a[0],d[21]=a[1],d[22]=a[2],a)):c.sequence([function(a){return c.i64.neq(d[26],void 0)?c.sequence([function(a){return c.i64.neq(d[25],void 0)?c.sequence([function(a){return function(a){c.logger(a).info(a)}(["Already have the max number of tokens. Scheduling next ACS token sync locally for project: ",d[9]].join("")),c.storedProcedure(b("LSIssueNextSync"),d[25],d[9],d[26],!1)},function(a){return a=[void 0,void 0,void 0],d[30]=a[0],d[31]=a[1],d[32]=a[2],a}]):c.resolve((function(a){c.logger(a).info(a)}(["token_poll_frequency is nonnull but max_client_token_pool_size is null. Already have the max number of tokens. Scheduling the next ACS token sync for project: ",d[9]].join("")),d[33]=new c.Map(),d[33].set("project_name",d[9]),d[33].set("max_client_token_pool_size",d[10]),d[34]=c.toJSON(d[33]),a=[d[34],c.i64.cast([0,362]),void 0],d[30]=a[0],d[31]=a[1],d[32]=a[2],a))},function(a){return a=[d[30],d[31],d[32]],d[27]=a[0],d[28]=a[1],d[29]=a[2],a}]):c.resolve((function(a){c.logger(a).info(a)}(["Already have the max number of tokens. Scheduling the next ACS token sync for project: ",d[9]].join("")),d[30]=new c.Map(),d[30].set("project_name",d[9]),d[30].set("max_client_token_pool_size",d[10]),d[31]=c.toJSON(d[30]),a=[d[31],c.i64.cast([0,362]),void 0],d[27]=a[0],d[28]=a[1],d[29]=a[2],a))},function(a){return a=[d[27],d[28],d[29]],d[20]=a[0],d[21]=a[1],d[22]=a[2],a}])},function(a){return a=[d[20],d[21],d[22]],d[12]=a[0],d[13]=a[1],d[14]=a[2],a}]))})},function(a){return a=[d[12],d[13],d[14]],d[6]=a[0],d[7]=a[1],d[8]=a[2],a}])},function(a){return a=[d[6],d[7],d[8]],d[0]=a[0],d[1]=a[1],d[2]=a[2],a}]))})},function(a){return a=[d[0],d[1],d[2]],e[0]=a[0],e[1]=a[1],e[2]=a[2],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSAnonymousCredentialsTaskSerializerAcsIssueNextSyncStoredProcedure";a.__tables__=["acs_request_context","secure_acs_configurations","secure_acs_blinded_tokens"];e.exports=a}),null);
__d("LSTaskSerializerDeleteChatHistory",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(e){return b.sequence([function(d){return b.db.table(32).fetch([[[a[0]]]]).next().then(function(d,e){var f=d.done;d=d.value;return f?(c[4]=b.createArray(),c[5]=(c[4].push("taskSerializerDeleteChatHistory: Task ID not found"),c[4]),c[6]=(c[4].push(a[0]),c[4]),c[7]=b.toJSON(c[4]),function(a){b.logger(a).mustfix(a)}(c[7]),f=[void 0,void 0,void 0],c[0]=f[0],c[1]=f[1],c[2]=f[2],f):(e=d.item,b.sequence([function(a){return c[8]=e.threadKey,b.db.table(9).fetch([[[c[8]]]]).next().then(function(a,d){d=a.done;a=a.value;return d?(c[9]=b.createArray(),c[10]=(c[9].push("taskSerializerDeleteChatHistory: Thread not found"),c[9]),c[11]=(c[9].push(c[8]),c[9]),c[12]=b.toJSON(c[9]),function(a){b.logger(a).mustfix(a)}(c[12]),d=[void 0,void 0,void 0],c[4]=d[0],c[5]=d[1],c[6]=d[2],d):(a.item,b.sequence([function(a){return b.db.table(9).fetch([[[c[8]]]]).next().then(function(d,e){var a=d.done;d=d.value;return a?c[9]=b.i64.cast([0,1]):(e=d.item,c[14]=e.syncGroup,b.i64.neq(c[14],void 0)?c[13]=c[14]:c[13]=b.i64.cast([0,1]),c[9]=c[13])})},function(a){return c[11]=new b.Map(),c[11].set("thread_key",c[8]),c[11].set("sync_group",c[9]),c[12]=b.toJSON(c[11]),a=[c[12],b.i64.cast([0,903]),void 0],c[4]=a[0],c[5]=a[1],c[6]=a[2],a}]))})},function(a){return a=[c[4],c[5],c[6]],c[0]=a[0],c[1]=a[1],c[2]=a[2],a}]))})},function(a){return a=[c[0],c[1],c[2]],d[0]=a[0],d[1]=a[1],d[2]=a[2],a}])},function(a){return b.resolve(d)}])}a.__sproc_name__="LSMailboxTaskSerializerDeleteChatHistoryStoredProcedure";a.__tables__=["threads_optimistic_context","threads"];e.exports=a}),null);
__d("LSTaskSerializerE2eeMessageIntegrityCheckV2",[],(function(a,b,c,d,e,f){function a(){var a,b=arguments,c=b[b.length-1],d=[];return a=[void 0,c.i64.cast([0,705]),void 0],d[0]=a[0],d[1]=a[1],d[2]=a[2],a,c.resolve(d)}a.__sproc_name__="LSEncryptedBackupsTaskSerializerE2eeMessageIntegrityCheckV2StoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSTaskSerializerE2eeMetadataThreadIntegrityCheck",[],(function(a,b,c,d,e,f){function a(){var a,b=arguments,c=b[b.length-1],d=[];return a=[void 0,c.i64.cast([0,700]),void 0],d[0]=a[0],d[1]=a[1],d[2]=a[2],a,c.resolve(d)}a.__sproc_name__="LSE2EEMessagingMetadataMailboxTaskSerializerE2eeMetadataThreadIntegrityCheckStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSTaskSerializerEncryptedBackupAction",[],(function(a,b,c,d,e,f){function a(){var a,b=arguments,c=b[b.length-1],d=[];return a=[void 0,c.i64.cast([0,319]),void 0],d[0]=a[0],d[1]=a[1],d[2]=a[2],a,c.resolve(d)}a.__sproc_name__="LSEncryptedBackupsTaskSerializerEncryptedBackupActionStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSTaskSerializerEncryptedBackupsLoopingUpload",["LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(a){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][taskSerializerEncryptedBackupsLoopingUpload] Beginning execution."),d[1]=c.i64.of_float(Date.now()),function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupsLoopingUploadStoredProcedure] LSEncryptedBackupsLoopingUploadPayloadsTable table not found"),d[3]="LSEncryptedBackupsLoopingUploadPayloadsTable table not found",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupsLoopingUploadStoredProcedure] ","",d[3]].join("")),d[2]=c.createArray(),void 0!==void 0?d[10]=(d[2].push(void 0),d[2]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsTaskSerializerEncryptedBackupsLoopingUploadStoredProcedure",d[3],d[2],c.i64.cast([0,3]))},function(a){return d[4]=c.i64.of_float(Date.now()),d[5]=c.i64.random(),d[7]="Finishing execution. Execution time: ",d[8]=c.i64.to_string(c.i64.sub(d[4],d[0])),d[9]=" ms",d[6]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][taskSerializerEncryptedBackupsLoopingUpload] ",d[6],d[7],d[6],d[8],d[6],d[9]].join("")),c.i64.eq(c.i64.mod_(d[5],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[10]=",",d[11]=c.createArray(),void 0!==void 0?d[12]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"taskSerializerEncryptedBackupsLoopingUpload",[d[7],d[10],d[8],d[10],d[9]].join(""),d[11],c.i64.cast([0,4]))):c.resolve()},function(a){return a=['{"request_id":"unknown","upload_type":"FBN","payload":{"error_code":2,"operation":"","error_message":"","__typename":"MPSUploadFailurePayload"}}',c.i64.cast([0,50043]),void 0],e[0]=a[0],e[1]=a[1],e[2]=a[2],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsTaskSerializerEncryptedBackupsLoopingUploadStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSQueryLocalPersistenceStoreForBackup.nop",["ReQL"],(function(a,b,c,d,e,f,g){"use strict";a=async function(a,b,c,e){b=await d("ReQL").toArrayAsync(d("ReQL").fromTableDescending(a.local_message_persistence_store).filter(function(a){var b=a.offlineThreadingId;a=a.threadId;return a===c&&e===b}));if(b.length===0)return Promise.resolve([void 0,void 0,!1]);a=b[0];return Promise.resolve([a.messagePayload,a.messageTimestampMs,!1])};a.__nop_name__="LSQueryLocalPersistenceStoreForBackup";g.default=a}),98);
__d("LSQueryLocalPersistenceStoreSupplementalForBackup.nop",["ReQL"],(function(a,b,c,d,e,f,g){"use strict";a=async function(a,b,c,e,f){b=await d("ReQL").firstAsync(d("ReQL").fromTableDescending(a.local_message_persistence_store_supplemental).filter(function(a){var b=a.supplementalKey,d=a.threadId;a=a.toplevelOfflineThreadingId;return d===c&&a===e&&b===f}));return b==null?Promise.resolve([void 0,void 0]):Promise.resolve([b.messagePayload,b.messageTimestampMs])};a.__nop_name__="LSQueryLocalPersistenceStoreSupplementalForBackup";g.default=a}),98);
__d("LSQueryLocalPersistenceStoreTagsForBackup.nop",["LSVec","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h=":";a=async function(a,b,e,f){b=await d("ReQL").firstAsync(d("ReQL").fromTableDescending(a.local_message_persistence_store_tag_index.index("offlineThreadingId")).getKeyRange(f,e));if(b==null)return Promise.resolve([c("LSVec").ofArray([])]);a=b.tag;return Promise.resolve([c("LSVec").ofArray(a.split(h))])};a.__nop_name__="LSQueryLocalPersistenceStoreTagsForBackup";g.default=a}),98);
__d("LSLoadUnencryptedProtobufWithInputs",["LSBase64Encode.nop","LSGetBlobFromString.nop","LSLogMebClientEvent.nop","LSQueryLocalPersistenceStoreForBackup.nop","LSQueryLocalPersistenceStoreSupplementalForBackup.nop","LSQueryLocalPersistenceStoreTagsForBackup.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][loadUnencryptedProtobufWithInputs] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.i64.eq(a[0],c.i64.cast([0,1]))?c.sequence([function(e){return c.nativeOperation(b("LSQueryLocalPersistenceStoreForBackup.nop"),a[1],a[2]).then(function(a){return a=a,d[10]=a[0],d[11]=a[1],d[12]=a[2],a})},function(e){return c.nativeOperation(b("LSQueryLocalPersistenceStoreTagsForBackup.nop"),a[1],a[2]).then(function(a){return a=a,d[13]=a[0],a})},function(e){return c.blobs.neq(d[10],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[10]).then(function(a){return a=a,d[16]=a[0],a})},function(b){return d[16]!==void 0?(d[13]!==void 0?(d[21]=new c.Map(),d[21].set("message_tags",d[13]),d[22]=new c.Map(),d[26]="message_tags",d[23]=d[21].get(d[26]),d[23]?d[24]=!1:d[24]=!0,d[24]?0:d[22].set(d[26],d[23]),d[25]=c.toJSON(d[22]),d[19]=d[25]):d[19]=void 0,d[20]=new c.Map(),d[20].set("backup_action",a[0]),d[20].set("protobuf_encrypted",d[16]),d[20].set("supplemental_data_encrypted",void 0),d[20].set("timestamp_ms",a[4]),d[20].set("message_tags",d[19]),b=[d[20],void 0],d[17]=b[0],d[18]=b[1],b):(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error PROTOBUF_FORMATTING_FAILED"),d[19]=new c.Map(),d[19].set("error_code",c.i64.cast([0,68])),d[19].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),d[19].set("error_message",""),b=[void 0,d[19]],d[17]=b[0],d[18]=b[1],b),b=[d[17],d[18]],d[14]=b[0],d[15]=b[1],b}]):c.resolve((d[12]?(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error PROTOBUF_ALREADY_DELETED"),d[18]=new c.Map(),d[18].set("error_code",c.i64.cast([0,70])),d[18].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),d[18].set("error_message",""),e=[void 0,d[18]],d[16]=e[0],d[17]=e[1],e):(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error PROTOBUF_NOT_FOUND_IN_TOPLEVEL_TABLE"),d[18]=new c.Map(),d[18].set("error_code",c.i64.cast([0,63])),d[18].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),d[18].set("error_message",""),e=[void 0,d[18]],d[16]=e[0],d[17]=e[1],e),e=[d[16],d[17]],d[14]=e[0],d[15]=e[1],e))},function(a){return a=[d[14],d[15]],d[2]=a[0],d[3]=a[1],a}]):c.sequence([function(e){return c.i64.eq(a[0],c.i64.cast([0,2]))?c.sequence([function(e){return a[3]!==void 0?c.sequence([function(e){return c.nativeOperation(b("LSQueryLocalPersistenceStoreSupplementalForBackup.nop"),a[1],a[2],a[3]).then(function(a){return a=a,d[14]=a[0],d[15]=a[1],a})},function(e){return c.nativeOperation(b("LSQueryLocalPersistenceStoreTagsForBackup.nop"),a[1],a[2]).then(function(a){return a=a,d[16]=a[0],a})},function(e){return c.blobs.neq(d[14],void 0)?c.sequence([function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),a[3]).then(function(a){return a=a,d[19]=a[0],a})},function(e){return c.blobs.neq(d[19],void 0)?c.sequence([function(a){return d[22]=new c.Map(),d[22].set("sk_ciphertext",d[19]),d[22].set("sk_hash",d[19]),c.nativeOperation(b("LSBase64Encode.nop"),d[14]).then(function(a){return a=a,d[23]=a[0],a})},function(b){return d[23]!==void 0?(d[16]!==void 0?(d[28]=new c.Map(),d[28].set("message_tags",d[16]),d[29]=new c.Map(),d[33]="message_tags",d[30]=d[28].get(d[33]),d[30]?d[31]=!1:d[31]=!0,d[31]?0:d[29].set(d[33],d[30]),d[32]=c.toJSON(d[29]),d[26]=d[32]):d[26]=void 0,d[27]=new c.Map(),d[27].set("backup_action",a[0]),d[27].set("protobuf_encrypted",d[23]),d[27].set("supplemental_data_encrypted",d[22]),d[27].set("timestamp_ms",a[4]),d[27].set("message_tags",d[26]),b=[d[27],void 0],d[24]=b[0],d[25]=b[1],b):(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error PROTOBUF_FORMATTING_FAILED"),d[26]=new c.Map(),d[26].set("error_code",c.i64.cast([0,68])),d[26].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),d[26].set("error_message",""),b=[void 0,d[26]],d[24]=b[0],d[25]=b[1],b),b=[d[24],d[25]],d[20]=b[0],d[21]=b[1],b}]):c.resolve((function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error SUPPLEMENTAL_FORMATTING_FAILED"),d[22]=new c.Map(),d[22].set("error_code",c.i64.cast([0,69])),d[22].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),d[22].set("error_message",""),e=[void 0,d[22]],d[20]=e[0],d[21]=e[1],e))},function(a){return a=[d[20],d[21]],d[17]=a[0],d[18]=a[1],a}]):c.resolve((function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error PROTOBUF_NOT_FOUND_IN_SUPPLEMENTAL_TABLE"),d[19]=new c.Map(),d[19].set("error_code",c.i64.cast([0,64])),d[19].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),d[19].set("error_message",""),e=[void 0,d[19]],d[17]=e[0],d[18]=e[1],e))},function(a){return a=[d[17],d[18]],d[12]=a[0],d[13]=a[1],a}]):c.resolve((function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error SUPPLEMENTAL_KEY_NOT_SET_IN_CONTEXT_TABLE"),d[14]=new c.Map(),d[14].set("error_code",c.i64.cast([0,65])),d[14].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),d[14].set("error_message",""),e=[void 0,d[14]],d[12]=e[0],d[13]=e[1],e))},function(a){return a=[d[12],d[13]],d[10]=a[0],d[11]=a[1],a}]):c.resolve((c.i64.eq(a[0],c.i64.cast([0,3]))?(d[14]=new c.Map(),d[14].set("backup_action",a[0]),d[14].set("protobuf_encrypted",void 0),d[14].set("supplemental_data_encrypted",void 0),d[14].set("timestamp_ms",a[4]),d[14].set("message_tags",void 0),e=[d[14],void 0],d[12]=e[0],d[13]=e[1],e):(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error INVALID_BACKUP_OPERATION"),d[14]=new c.Map(),d[14].set("error_code",c.i64.cast([-1,4294967289])),d[14].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),d[14].set("error_message",""),e=[void 0,d[14]],d[12]=e[0],d[13]=e[1],e),e=[d[12],d[13]],d[10]=e[0],d[11]=e[1],e))},function(a){return a=[d[10],d[11]],d[2]=a[0],d[3]=a[1],a}])},function(a){return d[4]=c.i64.of_float(Date.now()),d[5]=c.i64.random(),d[7]="Finishing execution. Execution time: ",d[8]=c.i64.to_string(c.i64.sub(d[4],d[0])),d[9]=" ms",d[6]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][loadUnencryptedProtobufWithInputs] ",d[6],d[7],d[6],d[8],d[6],d[9]].join("")),c.i64.eq(c.i64.mod_(d[5],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[10]=",",d[11]=c.createArray(),void 0!==void 0?d[12]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"loadUnencryptedProtobufWithInputs",[d[7],d[10],d[8],d[10],d[9]].join(""),d[11],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[2],d[3]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSLoadUnencryptedProtobufBackupSerializedPayloadData",["LSLoadUnencryptedProtobufWithInputs","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){var e;return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][loadUnencryptedProtobufBackupSerializedPayloadData] Beginning execution."),d[1]=c.i64.of_float(Date.now()),d[18]=c.i64.mul(d[1],c.i64.cast([0,1e6])),c.sequence([function(b){return c.db.table(2).fetch([[[a[0]]]]).next().then(function(b,e){var f=b.done;b=b.value;return f?(d[30]=c.i64.of_float(Date.now()),f=[a[0],void 0,void 0,void 0,void 0,c.i64.sub(c.i64.mul(d[30],c.i64.cast([0,1e6])),d[18]),void 0],d[22]=f[0],d[23]=f[1],d[24]=f[2],d[25]=f[3],d[26]=f[4],d[27]=f[5],d[28]=f[6],f):(e=b.item,d[30]=c.i64.of_float(Date.now()),f=[a[0],e.queueName,e.enqueueTimestampMs,e.priority,e.firstExecutedTimestampMs,c.i64.sub(c.i64.mul(d[30],c.i64.cast([0,1e6])),d[18]),void 0],d[22]=f[0],d[23]=f[1],d[24]=f[2],d[25]=f[3],d[26]=f[4],d[27]=f[5],d[28]=f[6],f)})},function(a){return a=[d[22],d[23],d[24],d[25],d[26],d[27],d[28]],d[2]=a[0],d[3]=a[1],d[4]=a[2],d[5]=a[3],d[6]=a[4],d[7]=a[5],d[8]=a[6],a}])},function(e){return d[9]=new c.Map(),d[9].set("task_id",d[2]),d[9].set("queue_name",d[3]),d[9].set("enqueue_timestamp_ms",d[4]),d[9].set("priority",d[5]),d[9].set("first_executed_timestamp_ms",d[6]),d[9].set("execution_time_ns",d[7]),d[9].set("echo_encoding_execution_time_ns",d[8]),d[10]=new c.Map(),d[10].set("task_metadata",d[9]),d[10].set("action_type",void 0),d[10].set("content_type",void 0),d[10].set("identifiers",void 0),d[10].set("identifiers_v2",void 0),d[10].set("task_creation_source",void 0),d[10].set("message_payload_source",c.i64.cast([0,2])),c.filter(c.db.table(305).fetch(),function(b){return c.i64.eq(b.pendingBackupTaskId,a[0])}).next().then(function(e,f){var g=e.done;e=e.value;return g?(d[22]=new c.Map(),d[22].set("error_code",c.i64.cast([0,5])),d[22].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufBackupSerializedPayloadDataStoredProcedure"),d[22].set("error_message",""),g=[void 0,d[22],d[10]],d[11]=g[0],d[12]=g[1],d[13]=g[2],g):(f=e.item,c.sequence([function(b){var e;return d[39]=f.actThreadId,d[40]=f.toplevelOfflineThreadingId,d[23]=f.messageTimestampMs,d[22]=new c.Map(),d[22].set("backup_id","openEbUploadGenericBackupId"),d[22].set("act_thread_id",d[39]),d[22].set("server_thread_id",d[39]),d[22].set("timestamp",c.i64.to_string(d[23])),d[22].set("otid",d[40]),d[24]=new c.Map(),d[24].set("backup_id","openEbUploadGenericBackupId"),d[24].set("act_thread_id",d[39]),d[24].set("timestamp",c.i64.to_string(d[23])),d[24].set("otid",d[40]),c.sequence([function(b){return c.db.table(2).fetch([[[a[0]]]]).next().then(function(e,f){var b=e.done;e=e.value;return b?(d[49]=c.i64.of_float(Date.now()),b=[a[0],void 0,void 0,void 0,void 0,c.i64.sub(c.i64.mul(d[49],c.i64.cast([0,1e6])),d[18]),void 0],d[41]=b[0],d[42]=b[1],d[43]=b[2],d[44]=b[3],d[45]=b[4],d[46]=b[5],d[47]=b[6],b):(f=e.item,d[49]=c.i64.of_float(Date.now()),b=[a[0],f.queueName,f.enqueueTimestampMs,f.priority,f.firstExecutedTimestampMs,c.i64.sub(c.i64.mul(d[49],c.i64.cast([0,1e6])),d[18]),void 0],d[41]=b[0],d[42]=b[1],d[43]=b[2],d[44]=b[3],d[45]=b[4],d[46]=b[5],d[47]=b[6],b)})},function(a){return a=[d[41],d[42],d[43],d[44],d[45],d[46],d[47]],d[25]=a[0],d[26]=a[1],d[27]=a[2],d[28]=a[3],d[29]=a[4],d[30]=a[5],d[31]=a[6],a}])},function(a){return d[32]=new c.Map(),d[32].set("task_id",d[25]),d[32].set("queue_name",d[26]),d[32].set("enqueue_timestamp_ms",d[27]),d[32].set("priority",d[28]),d[32].set("first_executed_timestamp_ms",d[29]),d[32].set("execution_time_ns",d[30]),d[32].set("echo_encoding_execution_time_ns",d[31]),d[33]=new c.Map(),d[33].set("task_metadata",d[32]),d[33].set("action_type",void 0),d[33].set("content_type",void 0),d[33].set("identifiers",void 0),d[33].set("identifiers_v2",d[24]),d[33].set("task_creation_source",void 0),d[33].set("message_payload_source",c.i64.cast([0,2])),c.storedProcedure(b("LSLoadUnencryptedProtobufWithInputs"),f.backupAction,d[39],d[40],f.supplementalKey,d[23],d[22]).then(function(a){return a=a,d[34]=a[0],d[35]=a[1],a})},function(a){return d[34]!==void 0?(d[41]=new c.Map(),d[41].set("unencrypted_protobuf_backup_payload",d[34]),d[41].set("message_identifiers",d[22]),d[41].set("attachment_backup_payload",f.attachmentPayload),d[41].set("sender_id",f.senderId),d[41].set("extra_data_for_eb_upload",void 0),a=[d[41],void 0,d[33]],d[36]=a[0],d[37]=a[1],d[38]=a[2],a):(a=[void 0,d[35],d[33]],d[36]=a[0],d[37]=a[1],d[38]=a[2],a),a=[d[36],d[37],d[38]],d[11]=a[0],d[12]=a[1],d[13]=a[2],a}]))})},function(a){return d[15]=c.i64.of_float(Date.now()),d[16]=c.i64.random(),d[19]="Finishing execution. Execution time: ",d[20]=c.i64.to_string(c.i64.sub(d[15],d[0])),d[21]=" ms",d[17]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][loadUnencryptedProtobufBackupSerializedPayloadData] ",d[17],d[19],d[17],d[20],d[17],d[21]].join("")),c.i64.eq(c.i64.mod_(d[16],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[22]=",",d[23]=c.createArray(),void 0!==void 0?d[24]=(d[23].push(void 0),d[23]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"loadUnencryptedProtobufBackupSerializedPayloadData",[d[19],d[22],d[20],d[22],d[21]].join(""),d[23],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[11],d[12],d[13]],e[0]=a[0],e[1]=a[1],e[2]=a[2],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsLoadUnencryptedProtobufBackupSerializedPayloadDataStoredProcedure";a.__tables__=["pending_tasks","pending_protobuf_backups_context"];e.exports=a}),null);
__d("LSTaskSerializerEncryptedBackupsOpenUpload",["LSArrayGetObjectAt","LSBase64Encode.nop","LSDeserializeFromJsonIntoDictionaryV2.nop","LSLoadUnencryptedProtobufBackupSerializedPayloadData","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][taskSerializerEncryptedBackupsOpenUpload] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.storedProcedure(b("LSLoadUnencryptedProtobufBackupSerializedPayloadData"),a[0]).then(function(a){return a=a,d[2]=a[0],d[3]=a[1],d[4]=a[2],a})},function(a){return d[2]!==void 0?c.sequence([function(a){return d[15]=d[2].get("message_identifiers"),d[16]=d[2].get("unencrypted_protobuf_backup_payload"),d[17]=d[15].get("server_thread_id"),d[18]=d[15].get("timestamp"),d[19]=d[15].get("otid"),d[20]=d[15].get("act_thread_id"),d[21]=new c.Map(),d[21].set("server_thread_key",d[17]),d[21].set("timestamp",d[18]),d[21].set("otid",d[19]),d[21].set("wa_thread_id",c.i64.from_string(d[20])),d[22]=new c.Map(),d[22].set("message_identifiers",d[21]),d[23]=d[2].get("extra_data_for_eb_upload"),d[23]!==void 0?c.sequence([function(a){return c.nativeOperation(b("LSDeserializeFromJsonIntoDictionaryV2.nop"),d[23]).then(function(a){return a=a,d[32]=a[0],a})},function(a){return d[33]=new c.Map(),d[39]="ttd",d[34]=d[32].get(d[39]),d[34]?d[35]=!1:d[35]=!0,d[35]?c.resolve():c.sequence([function(a){return d[34]?d[42]=!1:d[42]=!0,d[42]?c.resolve(d[43]=void 0):c.sequence([function(a){return d[44]=new c.Map(),d[47]="message_tags",d[45]=d[34].get(d[47]),d[45]?d[46]=!1:d[46]=!0,d[46]?c.resolve():c.sequence([function(a){return d[48]=c.createArray(),d[49]=c.i64.of_int32(d[45].length),c.i64.gt(d[49],c.i64.cast([0,0]))?c.loopAsync(d[49],function(a){return d[50]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[45],d[50]).then(function(a){return a=a,d[51]=a[0],d[52]=a[1],a})},function(a){return d[53]=(d[48].push(d[51]),d[48])}])}):c.resolve()},function(a){return d[44].set(d[47],d[48])}])},function(a){return d[43]=d[44]}])},function(a){return d[33].set(d[39],d[43])}])},function(a){return d[40]="mt",d[36]=d[32].get(d[40]),d[36]?d[37]=!1:d[37]=!0,d[37]?c.resolve():c.sequence([function(a){return d[36]?d[42]=!1:d[42]=!0,d[42]?c.resolve(d[43]=void 0):c.sequence([function(a){return d[44]=new c.Map(),d[47]="message_tags",d[45]=d[36].get(d[47]),d[45]?d[46]=!1:d[46]=!0,d[46]?c.resolve():c.sequence([function(a){return d[48]=c.createArray(),d[49]=c.i64.of_int32(d[45].length),c.i64.gt(d[49],c.i64.cast([0,0]))?c.loopAsync(d[49],function(a){return d[50]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[45],d[50]).then(function(a){return a=a,d[51]=a[0],d[52]=a[1],a})},function(a){return d[53]=(d[48].push(d[51]),d[48])}])}):c.resolve()},function(a){return d[44].set(d[47],d[48])}])},function(a){return d[43]=d[44]}])},function(a){return d[33].set(d[40],d[43])}])},function(a){return d[41]="mooos",d[38]=d[32].get(d[41]),d[38]!==void 0?d[33].set(d[41],d[38]):0,d[24]=d[33]}]):c.resolve(d[24]=void 0)},function(a){return d[24]!==void 0?(d[32]=d[24].get("mt"),d[32]!==void 0?(d[34]=new c.Map(),d[38]="message_tags",d[35]=d[32].get(d[38]),d[35]?d[36]=!1:d[36]=!0,d[36]?0:d[34].set(d[38],d[35]),d[37]=c.toJSON(d[34]),d[33]=d[37]):d[33]=void 0,d[25]=d[33]):d[25]=void 0,d[26]=d[16].get("supplemental_data_encrypted"),d[26]!==void 0?c.sequence([function(a){return d[32]=d[16].get("protobuf_encrypted"),d[33]=d[16].get("backup_action"),d[34]=d[16].get("timestamp_ms"),d[35]=d[26].get("sk_ciphertext"),c.nativeOperation(b("LSBase64Encode.nop"),d[35]).then(function(a){return a=a,d[36]=a[0],a})},function(a){return d[37]=d[26].get("sk_hash"),c.nativeOperation(b("LSBase64Encode.nop"),d[37]).then(function(a){return a=a,d[38]=a[0],a})},function(a){return d[39]=new c.Map(),d[39].set("supplementary_data_key",void 0),d[39].set("encrypted_protobuf",d[32]),d[39].set("key_value_backup_action",d[33]),d[39].set("protobuf_ts_ms",d[34]),d[39].set("supplemental_key_ciphertext",d[36]),d[39].set("supplemental_key_hash",d[38]),d[39].set("message_tags",d[25]),d[27]=d[39]}]):c.resolve((d[32]=d[16].get("protobuf_encrypted"),d[33]=d[16].get("backup_action"),d[34]=d[16].get("timestamp_ms"),d[35]=new c.Map(),d[35].set("supplementary_data_key",void 0),d[35].set("encrypted_protobuf",d[32]),d[35].set("key_value_backup_action",d[33]),d[35].set("protobuf_ts_ms",d[34]),d[35].set("message_tags",d[25]),d[27]=d[35]))},function(a){return d[22].set("key_value_backup_unencrypted_payload",d[27]),d[28]=d[2].get("sender_id"),d[22].set("sender_id",d[28]),d[29]=d[2].get("attachment_backup_payload"),d[29]!==void 0?d[22].set("attachment_backup_payload",d[29]):0,d[24]!==void 0?(d[32]=d[24].get("ttd"),d[32]!==void 0?(d[34]=new c.Map(),d[38]="message_tags",d[35]=d[32].get(d[38]),d[35]?d[36]=!1:d[36]=!0,d[36]?0:d[34].set(d[38],d[35]),d[37]=c.toJSON(d[34]),d[33]=d[37]):d[33]=void 0,d[30]=d[33]):d[30]=void 0,d[30]!==void 0?d[22].set("tags_to_delete",d[30]):0,d[31]=c.toJSON(d[22]),a=[d[31],void 0,d[4]],d[5]=a[0],d[6]=a[1],d[7]=a[2],a}]):c.resolve((d[3]?d[15]=!1:d[15]=!0,d[15]?(a=[void 0,void 0,d[4]],d[16]=a[0],d[17]=a[1],d[18]=a[2],a):(a=[void 0,d[3],d[4]],d[16]=a[0],d[17]=a[1],d[18]=a[2],a),a=[d[16],d[17],d[18]],d[5]=a[0],d[6]=a[1],d[7]=a[2],a))},function(a){return d[15]=new c.Map(),d[16]=d[15].set("success",d[5]),d[17]=d[15].set("failure",d[6]),d[18]=d[15].set("context",d[7]),d[19]=c.toJSON(d[15]),d[8]=d[19],d[9]=c.i64.of_float(Date.now()),d[10]=c.i64.random(),d[12]="Finishing execution. Execution time: ",d[13]=c.i64.to_string(c.i64.sub(d[9],d[0])),d[14]=" ms",d[11]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][taskSerializerEncryptedBackupsOpenUpload] ",d[11],d[12],d[11],d[13],d[11],d[14]].join("")),c.i64.eq(c.i64.mod_(d[10],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[15]=",",d[16]=c.createArray(),void 0!==void 0?d[17]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"taskSerializerEncryptedBackupsOpenUpload",[d[12],d[15],d[13],d[15],d[14]].join(""),d[16],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[8],c.i64.cast([0,50048])],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsTaskSerializerEncryptedBackupsOpenUploadStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSTaskSerializerEncryptedBackupsRestoreWithSerializer",[],(function(a,b,c,d,e,f){function a(){var a,b=arguments,c=b[b.length-1],d=[];return a=[void 0,void 0,void 0],d[0]=a[0],d[1]=a[1],d[2]=a[2],a,c.resolve(d)}a.__sproc_name__="LSEncryptedBackupsTaskSerializerEncryptedBackupsRestoreWithSerializerStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSDeriveValueSecretRefV2",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSGetBlobFromString.nop","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][deriveValueSecretRefV2] Beginning execution."),d[1]=c.i64.of_float(Date.now()),d[2]=a[2].get("message_payload_encryption_keys"),d[3]=d[2].get("encryption_version"),d[4]=d[2].get("epoch_anon_id"),d[5]=d[2].get("epoch_root_key"),d[6]=d[2].get("payload_key"),d[7]=c.createArray(),d[41]=(d[7].push(c.i64.cast([0,6])),d[7]),c.nativeOperation(b("LSGetBlobFromString.nop"),"epoch_anon_id_debug").then(function(a){return a=a,d[8]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[8],void 0,d[4],d[7]).then(function(a){return a=a,d[9]=a[0],a})},function(a){return d[9]?d[10]=!1:d[10]=!0,d[10]?c.resolve(d[11]=""):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[9],c.i64.cast([0,0])).then(function(a){return a=a,d[41]=a[0],d[42]=a[1],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[41]).then(function(a){return a=a,d[43]=a[0],a})},function(a){return d[11]=d[43]==null?"":d[43]}])},function(a){return d[12]=c.createArray(),d[41]=(d[12].push(c.i64.cast([0,6])),d[12]),c.nativeOperation(b("LSGetBlobFromString.nop"),"epoch_root_key_debug").then(function(a){return a=a,d[13]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[13],void 0,d[5],d[12]).then(function(a){return a=a,d[14]=a[0],a})},function(a){return d[14]?d[15]=!1:d[15]=!0,d[15]?c.resolve(d[16]=""):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[14],c.i64.cast([0,0])).then(function(a){return a=a,d[41]=a[0],d[42]=a[1],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[41]).then(function(a){return a=a,d[43]=a[0],a})},function(a){return d[16]=d[43]==null?"":d[43]}])},function(a){return d[17]=c.createArray(),d[41]=(d[17].push(c.i64.cast([0,6])),d[17]),c.nativeOperation(b("LSGetBlobFromString.nop"),"message_key_debug").then(function(a){return a=a,d[18]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[18],void 0,d[6],d[17]).then(function(a){return a=a,d[19]=a[0],a})},function(a){return d[19]?d[20]=!1:d[20]=!0,d[20]?c.resolve(d[21]=""):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[19],c.i64.cast([0,0])).then(function(a){return a=a,d[41]=a[0],d[42]=a[1],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[41]).then(function(a){return a=a,d[43]=a[0],a})},function(a){return d[21]=d[43]==null?"":d[43]}])},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[5]).then(function(a){return a=a,d[22]=a[0],a})},function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),[d[22]==null?"":d[22],a[0]].join("")).then(function(a){return a=a,d[23]=a[0],a})},function(a){return d[24]=c.createArray(),d[41]=(d[24].push(c.i64.cast([0,6])),d[24]),c.nativeOperation(b("LSGetBlobFromString.nop"),"epoch_root_key_thread_id_debug").then(function(a){return a=a,d[25]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[25],void 0,d[23],d[24]).then(function(a){return a=a,d[26]=a[0],a})},function(a){return d[26]?d[27]=!1:d[27]=!0,d[27]?c.resolve(d[28]=""):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[26],c.i64.cast([0,0])).then(function(a){return a=a,d[41]=a[0],d[42]=a[1],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[41]).then(function(a){return a=a,d[43]=a[0],a})},function(a){return d[28]=d[43]==null?"":d[43]}])},function(a){return d[29]=":",c.blobs.neq(d[5],void 0)?c.sequence([function(a){return d[41]=c.createArray(),d[47]=(d[41].push(c.i64.cast([0,18])),d[41]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,d[5],d[41]).then(function(a){return a=a,d[42]=a[0],a})},function(a){return d[42]!==void 0?c.sequence([function(a){return d[47]=c.i64.of_int32(d[42].length),c.i64.ge(d[47],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[42],c.i64.cast([0,0])).then(function(a){return a=a,d[49]=a[0],d[50]=a[1],a})},function(a){return d[48]=d[49]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[50]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[50]].join("")),d[49]=c.createArray(),void 0!==void 0?d[51]=(d[49].push(void 0),d[49]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[50],d[49],c.i64.cast([0,3]))},function(a){return d[48]=void 0}])},function(a){return d[43]=d[48]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[48]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[48]].join("")),d[47]=c.createArray(),void 0!==void 0?d[49]=(d[47].push(void 0),d[47]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[48],d[47],c.i64.cast([0,3]))},function(a){return d[43]=void 0}])},function(a){return c.blobs.neq(d[43],void 0)?d[44]=!0:d[44]=!1,d[44]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.nativeOperation(b("LSBase64Encode.nop"),d[43]).then(function(a){return a=a,d[45]=a[0],a})},function(a){return d[45]!==void 0?d[46]=d[45]:d[46]="encodingfailed",d[30]=d[46]}]):c.resolve(d[30]="null")},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[4]).then(function(a){return a=a,d[31]=a[0],a})},function(e){return d[32]=new c.Map(),d[32].set("encryption_version",d[3]),d[32].set("epoch_anon_id",d[31]==null?"":d[31]),d[32].set("message_encryption_values",[d[11],d[29],d[16],d[29],d[21],d[29],d[28]].join("")),d[32].set("root_key_fingerprint",d[30]),d[32].set("backup_id",a[1]),d[33]=c.toJSON(d[32]),d[34]=new c.Map(),d[34].set("value_secret_ref",d[33]),d[35]=c.i64.of_float(Date.now()),d[36]=c.i64.random(),d[38]="Finishing execution. Execution time: ",d[39]=c.i64.to_string(c.i64.sub(d[35],d[0])),d[40]=" ms",d[37]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][deriveValueSecretRefV2] ",d[37],d[38],d[37],d[39],d[37],d[40]].join("")),c.i64.eq(c.i64.mod_(d[36],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[41]=",",d[42]=c.createArray(),void 0!==void 0?d[43]=(d[42].push(void 0),d[42]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"deriveValueSecretRefV2",[d[38],d[41],d[39],d[41],d[40]].join(""),d[42],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[34],void 0],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsDeriveValueSecretRefV2StoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSBinaryToHex.nop",["LSResult","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,d,e){a=Array.from(new Uint8Array(e));d=a.map(function(a){return a.toString(16).padStart(2,"0")});e=d.join("").toUpperCase();return(h||(h=b("Promise"))).resolve(c("LSResult")(e))};a.__nop_name__="LSBinaryToHex";g["default"]=a}),98);
__d("LSGetBlobFromInt64BE.nop",["GetBlobFromInt64BE"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b,c){return d("GetBlobFromInt64BE").GetBlobFromInt64BE(c)};a.__nop_name__="LSGetBlobFromInt64BE";g["default"]=a}),98);
__d("LSHmac_v2.nop",["Hmac_v2"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b,d,e){return c("Hmac_v2")(d,e)};a.__nop_name__="LSHmac_v2";g["default"]=a}),98);
__d("OcmfClientMap",["CryptoLogger","LSCryptoUtils","Promise","requireDeferred","tweetnacl"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("ristretto255").__setRef("OcmfClientMap");a=function(a,c){c=d("tweetnacl").hash(d("LSCryptoUtils").bufToUint8(c));return(h||(h=b("Promise"))).all([c,i.load()]).then(function(b){var c=b[0];b=b[1];c=b.fromHash(new Uint8Array(c));b=b.scalarMult(new Uint8Array(a),c);return b.buffer})["catch"](function(a){d("CryptoLogger").captureError(d("CryptoLogger").CryptoLogger("ocmf_client_map"),a).mustfix("Failed OcmfClientMap.");throw a})};g["default"]=a}),98);
__d("LSOcmfClientMap.nop",["LSResult","OcmfClientMap"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b,d,e){return c("OcmfClientMap")(d,e).then(function(a){return c("LSResult")(a)})};a.__nop_name__="LSOcmfClientMap";g["default"]=a}),98);
__d("OrderPreservingEncryption",["FBLogger","LSCryptoUtils","LSSynchronousPromise","Promise","UInt8Array","WACryptoHkdfSync","XPlatReactCrypto","gkx","isPromise"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(){return d("XPlatReactCrypto").getRandomValues(new Uint8Array(32)).buffer}function j(a){var b=a.length;return b%2!==0?"0"+a:a}function k(a){a=BigInt(a);var b=j(a.toString(16));a=b.length;a=a/2;var c=[];for(var d=0;d<a;++d)c.push(d*2);return new Uint8Array(c.map(function(a){var c=a+2;return b.slice(a,c)}).map(function(a){return parseInt(a,16)}))}function l(a){a=a.map(function(a){return a._0});return{_0:d("UInt8Array").concatBytes(a)}}function m(a){return"OPE key has length "+String(a)+", expected  "+String(32)}function n(a,b,e){var f=new ArrayBuffer(0);if(c("gkx")("13860"))try{var g=d("WACryptoHkdfSync").hkdf(a,d("LSCryptoUtils").bufToUint8(f),d("LSCryptoUtils").bufToUint8(b.buffer),e);return d("LSSynchronousPromise").makeSynchronousPromise({_0:g})}catch(a){c("FBLogger")("labyrinth_web").mustfix("hkdf failed at OrderPreservingEncryption");throw a}return d("XPlatReactCrypto").subtleImportKey("raw",a.buffer,"HKDF",!1,["deriveKey","deriveBits"]).then(function(a){return d("XPlatReactCrypto").subtleDeriveBits({hash:"SHA-256",info:b.buffer,name:"HKDF",salt:f},a,e*8)}).then(function(a){return{_0:d("LSCryptoUtils").bufToUint8(a)}})}function o(a,b){return{_0:d("LSCryptoUtils").modAddBytes(a._0,b)}}function p(a,e,f,g){var j=f.byteLength;if(j!==32)throw c("FBLogger")("labyrinth_web").mustfixThrow(m(j));var k=g.byteLength,p=function(a,b){var c=new Uint8Array(1+k),d=new Uint8Array(k-b).fill(0);c.set([b]);c.set(a.subarray(0,b),1);c.set(d,b+1);return c};if(k>=255)throw c("FBLogger")("labyrinth_web").mustfixThrow("Input is too large");j=Array.from(g).map(function(b,c){c=p(g,c);var e=new Uint8Array(a);e[a-1]=b;b=d("LSCryptoUtils").bufToUint8(f);return n(b,c,a).then(function(a){return o(a,e)})}).map(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise);j=(i||(i=c("isPromise")))(j[0])?(h||(h=b("Promise"))).all(j):d("LSSynchronousPromise").makeSynchronousPromise(j);return j.then(function(a){return d("UInt8Array").concatBytes([new Uint8Array([e]),l(a)._0])})}function e(a,b,c,d){d=k(d);return p(a,b,c,d)}g.keyGen=a;g.intStringToBEBytes=k;g.buildKeyLengthErrorMsg=m;g.encryptBigEndianBytes=p;g.encryptIntString=e}),98);
__d("OpeEncrypt",["CryptoLogger","I64","LSResult","OrderPreservingEncryption"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,e){var f=d("CryptoLogger").CryptoLogger("ope_encrypt");return d("OrderPreservingEncryption").encryptBigEndianBytes((h||(h=d("I64"))).to_int32(e),1,a,new Uint8Array(b)).then(function(a){return c("LSResult")(a.buffer)},function(a){d("CryptoLogger").captureError(f,a).mustfix("OpeEncrypt_impl failed");throw a})}g.OpeEncrypt=a}),98);
__d("LSOpeEncrypt.nop",["OpeEncrypt"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b,c,e,f){return d("OpeEncrypt").OpeEncrypt(c,e,f)};a.__nop_name__="LSOpeEncrypt";g["default"]=a}),98);
__d("TruncateSortKey",["CryptoLogger","LSResult","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h,i=d("CryptoLogger").CryptoLogger("truncate_sort_key");function a(a){if(a.byteLength!==8)throw i.mustfixThrow("Bad length on sort key for truncation");var d=new Uint8Array(a);d=d.subarray(0,2);if(d.some(function(a){return a!==0}))throw i.mustfixThrow("Bad prefix on sort key for truncation");return(h||(h=b("Promise"))).resolve(c("LSResult")(a.slice(2)))}g.TruncateSortKey=a}),98);
__d("LSTruncateSortKey.nop",["TruncateSortKey"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b,c){return d("TruncateSortKey").TruncateSortKey(c)};a.__nop_name__="LSTruncateSortKey";g["default"]=a}),98);
__d("LSEncryptIdentifiersV2",["LSBase64Encode.nop","LSBinaryToHex.nop","LSGetBlobFromInt64BE.nop","LSGetBlobFromString.nop","LSHmac_v2.nop","LSLogMebClientEvent.nop","LSOcmfClientMap.nop","LSOpeEncrypt.nop","LSTruncateSortKey.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][encryptIdentifiersV2] Beginning execution."),d[1]=c.i64.of_float(Date.now()),d[2]=a[6].get("ocmf_shared_key"),c.nativeOperation(b("LSGetBlobFromString.nop"),a[2]).then(function(a){return a=a,d[3]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("bWFpbGJveF9pZF9zY29wZQ=="),d[3]).then(function(a){return a=a,d[4]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[2],d[4]).then(function(a){return a=a,d[5]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[5]).then(function(a){return a=a,d[6]=a[0],a})},function(e){return c.i64.eq(a[0],c.i64.cast([0,2]))&&c.i64.eq(a[1],c.i64.cast([0,2]))?d[7]=a[5]:d[7]=a[3],d[8]=a[6].get("ocmf_shared_key"),c.nativeOperation(b("LSGetBlobFromString.nop"),d[7]).then(function(a){return a=a,d[9]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("dGhyZWFkX2lkX3Njb3Bl"),d[9]).then(function(a){return a=a,d[10]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[8],d[10]).then(function(a){return a=a,d[11]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[11]).then(function(a){return a=a,d[12]=a[0],a})},function(e){return d[13]=a[6].get("ope_key"),c.nativeOperation(b("LSGetBlobFromInt64BE.nop"),a[4]).then(function(a){return a=a,d[14]=a[0],a})},function(a){return c.nativeOperation(b("LSTruncateSortKey.nop"),d[14]).then(function(a){return a=a,d[15]=a[0],a})},function(a){return c.nativeOperation(b("LSOpeEncrypt.nop"),d[13],d[15],c.i64.cast([0,16])).then(function(a){return a=a,d[16]=a[0],a})},function(a){return c.nativeOperation(b("LSBinaryToHex.nop"),d[16]).then(function(a){return a=a,d[17]=a[0],a})},function(e){return d[18]=a[6].get("ocmf_shared_key"),c.nativeOperation(b("LSGetBlobFromString.nop"),a[5]).then(function(a){return a=a,d[19]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("bWVzc2FnZV9pZF9zY29wZQ=="),d[19]).then(function(a){return a=a,d[20]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[18],d[20]).then(function(a){return a=a,d[21]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[21]).then(function(a){return a=a,d[22]=a[0],a})},function(a){return d[23]=new c.Map(),d[23].set("backup_id_ocmf_partial",d[6]==null?"":d[6]),d[23].set("act_thread_id_ocmf_partial",d[12]==null?"":d[12]),d[23].set("timestamp_encrypted",d[17]==null?"":d[17]),d[23].set("otid_ocmf_partial",d[22]==null?"":d[22]),d[24]=c.i64.of_float(Date.now()),d[25]=c.i64.random(),d[27]="Finishing execution. Execution time: ",d[28]=c.i64.to_string(c.i64.sub(d[24],d[0])),d[29]=" ms",d[26]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][encryptIdentifiersV2] ",d[26],d[27],d[26],d[28],d[26],d[29]].join("")),c.i64.eq(c.i64.mod_(d[25],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[30]=",",d[31]=c.createArray(),void 0!==void 0?d[32]=(d[31].push(void 0),d[31]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"encryptIdentifiersV2",[d[27],d[30],d[28],d[30],d[29]].join(""),d[31],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[23],void 0],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsEncryptIdentifiersV2StoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("SymmetricEncryptionCreateEncryptedData",["CryptoLogger","EncryptedBackupsSymmetricEncryptionUtils","HChaCha20","Promise","RetUtil","SymmetricEncryptionPaddingUtils","XPlatReactCrypto"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,c,e){var f=d("CryptoLogger").CryptoLogger("symmetric_encryption_create_encrypted_data"),g=d("SymmetricEncryptionPaddingUtils").padData(e),i=d("XPlatReactCrypto").getRandomValues(new Uint8Array(d("EncryptedBackupsSymmetricEncryptionUtils").totalNonceLengthInBytes));e=new(d("HChaCha20").HChaCha20)();e=e.hChaCha20Bytes(i.slice(0,d("EncryptedBackupsSymmetricEncryptionUtils").hChaCha20SubKeyNonceLengthInBytes).buffer,a);return d("XPlatReactCrypto").subtleImportKey("raw",e,"AES-GCM",!1,["encrypt"]).then(function(a){return d("XPlatReactCrypto").subtleEncrypt({additionalData:c,iv:new Uint8Array(i.slice(d("EncryptedBackupsSymmetricEncryptionUtils").hChaCha20SubKeyNonceLengthInBytes).buffer),name:"AES-GCM",tagLength:d("EncryptedBackupsSymmetricEncryptionUtils").aesGcmTagLength},a,g)}).then(function(a){var c=i.byteLength+a.byteLength;c=new Uint8Array(c);c.set(i);c.set(new Uint8Array(a),d("EncryptedBackupsSymmetricEncryptionUtils").totalNonceLengthInBytes);return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult(c.buffer))})["catch"](function(a){d("CryptoLogger").captureError(f,a).mustfix("symmetric data encryption failed");return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult())})};g["default"]=a}),98);
__d("LSSymmetricEncryptionCreateEncryptedData.nop",["EBEncryptMessageTypes","LSSymmetricEncryptionCreateDecryptedData.nop","MWEBODSEntityName.enum","MWFBLogger","ODS","QPLUserFlow","Random","SymmetricEncryptionCreateEncryptedData","WAArrayBufferUtils","WAErrorMessage","WAGetSafeQPLError","WAResultOrError","cr:20303","getErrorSafe","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["MISMATCH - Decrypted content is not equal"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["MISMATCH - Either JS Decrypted or Rust Decrypted is null"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["MISMATCH - ciphertextFromJS is null"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["MISMATCH - ciphertextFromWasm failed with error: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["'EB symmetric encryption comparison failed with error: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["EB symmetric encryption in JS failed with error: ",""]);n=function(){return a};return a}var o=c("qpl")._(521471468,"2968"),p=d("MWFBLogger").MWLogger.tags(["LSEncryption"]);function q(a,b,e){var f=d("Random").uint32();c("QPLUserFlow").start(o,{annotations:{string:{implementation:"js",native_op_name:"LSSymmetricEncryptionCreateEncryptedData"}},instanceKey:f});return c("SymmetricEncryptionCreateEncryptedData")(a,b,e).then(function(a){c("QPLUserFlow").endSuccess(o,{instanceKey:f});return d("WAResultOrError").makeResult(a[0])}).catch(function(a){var b=c("getErrorSafe")(a);c("QPLUserFlow").endFailure(o,"runtime-exception",{annotations:{string:{error:d("WAGetSafeQPLError").getSafeQPLErrorMessage(a)}},instanceKey:f});return d("WAResultOrError").makeError({error:b,type:"runtime-exception"})})}function r(a,e,f){if(b("cr:20303")==null)return Promise.resolve(d("WAResultOrError").makeError("skipped"));var g=d("Random").uint32();c("QPLUserFlow").start(o,{annotations:{string:{implementation:"rust",native_op_name:"LSSymmetricEncryptionCreateEncryptedData"}},instanceKey:g});return b("cr:20303").encryptMessage(d("EBEncryptMessageTypes").unsafeCastToSecretKey(a),d("EBEncryptMessageTypes").unsafeCastToAAD(e),d("EBEncryptMessageTypes").unsafeCastToPlaintext(f)).then(function(a){a.success===!1?c("QPLUserFlow").endFailure(o,a.error,{instanceKey:g}):c("QPLUserFlow").endSuccess(o,{instanceKey:g});return a}).catch(function(a){c("QPLUserFlow").endFailure(o,"runtime-exception",{annotations:{string:{error:d("WAGetSafeQPLError").getSafeQPLErrorMessage(a)}},instanceKey:g});return d("WAResultOrError").makeError("runtime-exception")})}a=function(a,b,d,e,f){return q(d,e,f).then(function(g){if(g.success===!1){p.MUSTFIX(n(),String(g.error));return[void 0]}c("promiseDone")(s(d,e,f,g,a,b));return[g.value]})};async function s(a,b,c,e,f,g){c=await r(a,b,c);try{await t(f,g,a,b,e,c)}catch(a){p.MUSTFIX(m(),d("WAErrorMessage").maybeGetMessageFromError(a))}}async function t(a,b,e,f,g,m){if(m.success===!1&&m.error==="skipped")return;if(m.success===!1){(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").EB_SYMMETRIC_ENCRYPTION_JS_RUST_SHADOW_TEST,"mismatch");p.MUSTFIX(l(),m.error);return}g=g.value;m=m.value;if(g==null){(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").EB_SYMMETRIC_ENCRYPTION_JS_RUST_SHADOW_TEST,"mismatch");p.MUSTFIX(k());return}g=await c("LSSymmetricEncryptionCreateDecryptedData.nop")(a,b,e,f,g);a=await c("LSSymmetricEncryptionCreateDecryptedData.nop")(a,b,e,f,m);b=g[0];e=a[0];if(b==null||e==null){(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").EB_SYMMETRIC_ENCRYPTION_JS_RUST_SHADOW_TEST,"mismatch");p.MUSTFIX(j());return}if(d("WAArrayBufferUtils").arrayBuffersEqualUNSAFE(b,e)===!1){(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").EB_SYMMETRIC_ENCRYPTION_JS_RUST_SHADOW_TEST,"mismatch");p.MUSTFIX(i());return}(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").EB_SYMMETRIC_ENCRYPTION_JS_RUST_SHADOW_TEST,"match")}a.__nop_name__="LSSymmetricEncryptionCreateEncryptedData";g.default=a}),98);
__d("LSSymmetricEncryptionCreateEncryptedString.nop",["Base64Utils","CryptoLogger","LSCryptoUtils","LSSymmetricEncryptionCreateEncryptedData.nop","Promise","RetUtil"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,e,f,g,i){var j=d("CryptoLogger").CryptoLogger("symmetric_encryption_create_encrypted_string");return c("LSSymmetricEncryptionCreateEncryptedData.nop")(a,e,f,g,d("LSCryptoUtils").strToBuf(i)).then(function(a){return a[0]}).then(function(a){return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult(a?d("Base64Utils").fromArrayBuffer(a):void 0))})["catch"](function(a){d("CryptoLogger").captureError(j,a).mustfix("symmetric string encryption failed");return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult())})};a.__nop_name__="LSSymmetricEncryptionCreateEncryptedString";g["default"]=a}),98);
__d("LSEncryptMessagePayloadV2",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSGetBlobFromString.nop","LSLogMebClientEvent.nop","LSSymmetricEncryptionCreateEncryptedString.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][encryptMessagePayloadV2] Beginning execution."),d[1]=c.i64.of_float(Date.now()),d[2]=a[2].get("message_payload_encryption_keys"),d[3]=d[2].get("payload_key"),c.nativeOperation(b("LSSymmetricEncryptionCreateEncryptedString.nop"),d[3],c.blobs.of_string(["message_thread","_",a[1]].join("")),a[3]).then(function(a){return a=a,d[4]=a[0],a})},function(e){return d[4]!==void 0?c.sequence([function(a){return d[13]=d[2].get("encryption_version"),d[14]=d[2].get("epoch_anon_id"),d[15]=d[2].get("epoch_root_key"),d[16]=d[2].get("payload_key"),d[17]=c.createArray(),d[45]=(d[17].push(c.i64.cast([0,6])),d[17]),c.nativeOperation(b("LSGetBlobFromString.nop"),"epoch_anon_id_debug").then(function(a){return a=a,d[18]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[18],void 0,d[14],d[17]).then(function(a){return a=a,d[19]=a[0],a})},function(a){return d[19]?d[20]=!1:d[20]=!0,d[20]?c.resolve(d[21]=""):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[19],c.i64.cast([0,0])).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[45]).then(function(a){return a=a,d[47]=a[0],a})},function(a){return d[21]=d[47]==null?"":d[47]}])},function(a){return d[22]=c.createArray(),d[45]=(d[22].push(c.i64.cast([0,6])),d[22]),c.nativeOperation(b("LSGetBlobFromString.nop"),"epoch_root_key_debug").then(function(a){return a=a,d[23]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[23],void 0,d[15],d[22]).then(function(a){return a=a,d[24]=a[0],a})},function(a){return d[24]?d[25]=!1:d[25]=!0,d[25]?c.resolve(d[26]=""):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[24],c.i64.cast([0,0])).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[45]).then(function(a){return a=a,d[47]=a[0],a})},function(a){return d[26]=d[47]==null?"":d[47]}])},function(a){return d[27]=c.createArray(),d[45]=(d[27].push(c.i64.cast([0,6])),d[27]),c.nativeOperation(b("LSGetBlobFromString.nop"),"message_key_debug").then(function(a){return a=a,d[28]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[28],void 0,d[16],d[27]).then(function(a){return a=a,d[29]=a[0],a})},function(a){return d[29]?d[30]=!1:d[30]=!0,d[30]?c.resolve(d[31]=""):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[29],c.i64.cast([0,0])).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[45]).then(function(a){return a=a,d[47]=a[0],a})},function(a){return d[31]=d[47]==null?"":d[47]}])},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[15]).then(function(a){return a=a,d[32]=a[0],a})},function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),[d[32]==null?"":d[32],a[1]].join("")).then(function(a){return a=a,d[33]=a[0],a})},function(a){return d[34]=c.createArray(),d[45]=(d[34].push(c.i64.cast([0,6])),d[34]),c.nativeOperation(b("LSGetBlobFromString.nop"),"epoch_root_key_thread_id_debug").then(function(a){return a=a,d[35]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[35],void 0,d[33],d[34]).then(function(a){return a=a,d[36]=a[0],a})},function(a){return d[36]?d[37]=!1:d[37]=!0,d[37]?c.resolve(d[38]=""):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[36],c.i64.cast([0,0])).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[45]).then(function(a){return a=a,d[47]=a[0],a})},function(a){return d[38]=d[47]==null?"":d[47]}])},function(a){return d[39]=":",c.blobs.neq(d[15],void 0)?c.sequence([function(a){return d[45]=c.createArray(),d[51]=(d[45].push(c.i64.cast([0,18])),d[45]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,d[15],d[45]).then(function(a){return a=a,d[46]=a[0],a})},function(a){return d[46]!==void 0?c.sequence([function(a){return d[51]=c.i64.of_int32(d[46].length),c.i64.ge(d[51],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[46],c.i64.cast([0,0])).then(function(a){return a=a,d[53]=a[0],d[54]=a[1],a})},function(a){return d[52]=d[53]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[54]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[54]].join("")),d[53]=c.createArray(),void 0!==void 0?d[55]=(d[53].push(void 0),d[53]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[54],d[53],c.i64.cast([0,3]))},function(a){return d[52]=void 0}])},function(a){return d[47]=d[52]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[52]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[52]].join("")),d[51]=c.createArray(),void 0!==void 0?d[53]=(d[51].push(void 0),d[51]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[52],d[51],c.i64.cast([0,3]))},function(a){return d[47]=void 0}])},function(a){return c.blobs.neq(d[47],void 0)?d[48]=!0:d[48]=!1,d[48]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.nativeOperation(b("LSBase64Encode.nop"),d[47]).then(function(a){return a=a,d[49]=a[0],a})},function(a){return d[49]!==void 0?d[50]=d[49]:d[50]="encodingfailed",d[40]=d[50]}]):c.resolve(d[40]="null")},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[14]).then(function(a){return a=a,d[41]=a[0],a})},function(b){return d[42]=new c.Map(),d[42].set("encryption_version",d[13]),d[42].set("epoch_anon_id",d[41]==null?"":d[41]),d[42].set("message_encryption_values",[d[21],d[39],d[26],d[39],d[31],d[39],d[38]].join("")),d[42].set("root_key_fingerprint",d[40]),d[42].set("backup_id",a[0]),d[43]=c.toJSON(d[42]),d[44]=new c.Map(),d[44].set("encrypted_message_payload",d[4]),d[44].set("value_secret_ref",d[43]),b=[d[44],void 0],d[5]=b[0],d[6]=b[1],b}]):c.resolve((d[13]=new c.Map(),d[13].set("error_code",c.i64.cast([0,40])),d[13].set("stored_procedure","LSEncryptedBackupsEncryptMessagePayloadV2StoredProcedure"),d[13].set("error_message",""),e=[void 0,d[13]],d[5]=e[0],d[6]=e[1],e))},function(a){return d[7]=c.i64.of_float(Date.now()),d[8]=c.i64.random(),d[10]="Finishing execution. Execution time: ",d[11]=c.i64.to_string(c.i64.sub(d[7],d[0])),d[12]=" ms",d[9]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][encryptMessagePayloadV2] ",d[9],d[10],d[9],d[11],d[9],d[12]].join("")),c.i64.eq(c.i64.mod_(d[8],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[13]=",",d[14]=c.createArray(),void 0!==void 0?d[15]=(d[14].push(void 0),d[14]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"encryptMessagePayloadV2",[d[10],d[13],d[11],d[13],d[12]].join(""),d[14],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[5],d[6]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsEncryptMessagePayloadV2StoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSGetLatestEpochKeys",["LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][getLatestEpochKeys] Beginning execution."),d[1]=c.i64.of_float(Date.now()),d[2]="",d[3]=void 0,d[4]=void 0,d[5]=void 0,a[0]?c.resolve(0):(d[15]=void 0,c.i64.neq(d[15],void 0)?c.sequence([function(a){return c.count(c.db.table(169).fetch([[[d[15]]]])).then(function(a){return d[16]=a})},function(a){return c.i64.le(d[16],c.i64.cast([0,1]))?c.sequence([function(a){return c.db.table(169).fetch([[[d[15]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[26]=new c.Map(),d[26].set("error_msg","Expected a nonempty query result"),d[26].set("code",c.i64.cast([0,3])),d[26].set("src_line","MEBEpochClientUtils.php:313 MEBEpochClientUtils::requireEpochReturnShapeFromPersistentEpochsTableDirectly()"),d[27]=c.createArray(),d[28]=(d[27].push(d[26]),d[27]),e=[void 0,d[27]],d[22]=e[0],d[23]=e[1],e):(b=a.item,d[26]=new c.Map(),d[26].set("epoch_id",b.epochId),d[26].set("backup_id",b.backupId),d[26].set("epoch_anon_id_blob",b.epochAnonIdBlob),d[26].set("epoch_root_key_blob",b.epochRootKeyBlob),d[26].set("epoch_status",b.epochStatus),d[26].set("epoch_head",b.epochHead),d[26].set("authority_level",b.authorityLevel),e=[d[26],void 0],d[22]=e[0],d[23]=e[1],e)})},function(a){return d[25]=new c.Map(),d[25].set("value",d[22]),d[25].set("errors",d[23]),d[17]=d[25]}]):c.resolve((d[22]=new c.Map(),d[22].set("error_msg","Expected at most one result"),d[22].set("code",c.i64.cast([0,4])),d[22].set("src_line","MEBEpochClientUtils.php:313 MEBEpochClientUtils::requireEpochReturnShapeFromPersistentEpochsTableDirectly()"),d[23]=c.createArray(),d[25]=(d[23].push(d[22]),d[23]),d[24]=new c.Map(),d[24].set("value",void 0),d[24].set("errors",d[23]),d[17]=d[24]))},function(a){return d[18]=d[17].get("value"),d[18]!==void 0?(d[22]=d[18].get("epoch_id"),d[23]=d[18].get("backup_id"),d[24]=d[18].get("epoch_anon_id_blob"),d[25]=d[18].get("epoch_root_key_blob"),d[26]=d[18].get("epoch_status"),d[27]=d[18].get("epoch_head"),d[28]=d[18].get("authority_level"),d[29]=d[17],d[19]=d[29]):(d[22]=d[17].get("errors"),d[23]=d[17].get("errors"),d[24]=new c.Map(),d[24].set("value",void 0),d[24].set("errors",d[22]),d[19]=d[24]),d[20]=d[19].get("value"),d[20]!==void 0?(d[22]=d[20].get("epoch_id"),d[23]=d[20].get("backup_id"),d[24]=d[20].get("epoch_anon_id_blob"),d[25]=d[20].get("epoch_root_key_blob"),d[26]=d[20].get("epoch_status"),d[27]=d[20].get("epoch_head"),d[28]=d[20].get("authority_level"),d[2]=c.blobs.to_string(d[24]),d[3]=d[22],d[4]=d[25],c.blobs.neq(d[27],void 0)?d[5]=d[27]:0,d[21]=!0):(d[22]=d[19].get("errors"),d[23]=d[19].get("errors"),d[21]=!1)}]):c.resolve())},function(b){return c.i64.neq(d[3],void 0)?c.resolve(0):c.sequence([function(b){return d[15]=void 0,d[16]="",d[17]=void 0,d[18]=void 0,c.forEach(c.filter(c.db.table(169).fetch(),function(b){return a[0]||c.i64.eq(b.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[20]=c.blobs.to_string(a.epochAnonIdBlob),c.i64.eq([0,d[20].length],[0,d[16].length])?d[19]=d[20]>d[16]:d[19]=c.i64.gt([0,d[20].length],[0,d[16].length]),d[19]?(d[15]=a.epochId,d[16]=d[20],d[17]=a.epochRootKeyBlob,d[18]=a.epochHead):0})},function(a){return c.i64.neq(d[15],void 0)?(d[2]=d[16],d[3]=d[15],d[4]=d[17],c.blobs.neq(d[18],void 0)?d[5]=d[18]:0,d[19]=c.i64.of_float(Date.now()),0):0}])},function(a){return d[11]=c.blobs.of_string(d[2]),c.i64.neq(d[3],void 0)?(c.blobs.neq(d[11],void 0)?(c.blobs.neq(d[4],void 0)?(d[19]=new c.Map(),d[19].set("epoch_id",d[3]),d[19].set("epoch_root_key",d[4]),d[19].set("epoch_anon_id",d[11]),d[19].set("epoch_head",d[5]),d[20]=new c.Map(),d[20].set("epoch_keys",d[19]),a=[d[20],void 0],d[17]=a[0],d[18]=a[1],a):(d[19]=new c.Map(),d[19].set("error_code",c.i64.cast([0,402])),d[19].set("error_message","failed to query latest epoch"),d[19].set("stored_procedure","LSEncryptedBackupsGetLatestEpochKeysStoredProcedure"),a=[void 0,d[19]],d[17]=a[0],d[18]=a[1],a),a=[d[17],d[18]],d[15]=a[0],d[16]=a[1],a):(d[17]=new c.Map(),d[17].set("error_code",c.i64.cast([0,403])),d[17].set("error_message","failed to query latest epoch"),d[17].set("stored_procedure","LSEncryptedBackupsGetLatestEpochKeysStoredProcedure"),a=[void 0,d[17]],d[15]=a[0],d[16]=a[1],a),a=[d[15],d[16]],d[6]=a[0],d[7]=a[1],a):(d[15]=new c.Map(),d[15].set("error_code",c.i64.cast([0,400])),d[15].set("error_message","failed to query latest epoch"),d[15].set("stored_procedure","LSEncryptedBackupsGetLatestEpochKeysStoredProcedure"),a=[void 0,d[15]],d[6]=a[0],d[7]=a[1],a),d[8]=c.i64.of_float(Date.now()),d[9]=c.i64.random(),d[12]="Finishing execution. Execution time: ",d[13]=c.i64.to_string(c.i64.sub(d[8],d[0])),d[14]=" ms",d[10]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][getLatestEpochKeys] ",d[10],d[12],d[10],d[13],d[10],d[14]].join("")),c.i64.eq(c.i64.mod_(d[9],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[15]=",",d[16]=c.createArray(),void 0!==void 0?d[17]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"getLatestEpochKeys",[d[12],d[15],d[13],d[15],d[14]].join(""),d[16],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[6],d[7]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsGetLatestEpochKeysStoredProcedure";a.__tables__=["secure_encrypted_backups_epochs"];e.exports=a}),null);
__d("LSLoadAndEncryptProtobufWithInputsV2",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSGetBlobFromString.nop","LSHmac_v2.nop","LSLogMebClientEvent.nop","LSQueryLocalPersistenceStoreForBackup.nop","LSQueryLocalPersistenceStoreSupplementalForBackup.nop","LSQueryLocalPersistenceStoreTagsForBackup.nop","LSSymmetricEncryptionCreateEncryptedData.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][loadAndEncryptProtobufWithInputsV2] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.i64.eq(a[0],c.i64.cast([0,1]))?c.sequence([function(e){return c.nativeOperation(b("LSQueryLocalPersistenceStoreForBackup.nop"),a[1],a[2]).then(function(a){return a=a,d[10]=a[0],d[11]=a[1],d[12]=a[2],a})},function(e){return c.nativeOperation(b("LSQueryLocalPersistenceStoreTagsForBackup.nop"),a[1],a[2]).then(function(a){return a=a,d[13]=a[0],a})},function(e){return d[14]=new c.Map(),d[14].set("message_tags",d[13]),d[15]=new c.Map(),d[15].set("mt",d[14]),c.blobs.neq(d[10],void 0)?c.sequence([function(e){return d[18]=a[5].get("message_payload_encryption_keys"),d[19]=d[18].get("payload_key"),c.nativeOperation(b("LSSymmetricEncryptionCreateEncryptedData.nop"),d[19],c.blobs.of_string(["message_thread","_",a[1]].join("")),d[10]).then(function(a){return a=a,d[20]=a[0],a})},function(a){return c.blobs.neq(d[20],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[20]).then(function(a){return a=a,d[24]=a[0],a})},function(a){return d[21]=d[24]}]):c.resolve(d[21]=void 0)},function(b){return d[21]!==void 0?(d[15]!==void 0?(d[27]=d[15].get("mt"),d[27]!==void 0?(d[29]=new c.Map(),d[33]="message_tags",d[30]=d[27].get(d[33]),d[30]?d[31]=!1:d[31]=!0,d[31]?0:d[29].set(d[33],d[30]),d[32]=c.toJSON(d[29]),d[28]=d[32]):d[28]=void 0,d[24]=d[28]):d[24]=void 0,d[15]!==void 0?(d[27]=d[15].get("mooos"),d[25]=d[27]):d[25]=void 0,d[26]=new c.Map(),d[26].set("backup_action",a[0]),d[26].set("protobuf_encrypted",d[21]),d[26].set("supplemental_data_encrypted",void 0),d[26].set("timestamp_ms",a[4]),d[26].set("message_tags",d[24]),d[26].set("serialized_attachment_backup_payload",void 0),d[26].set("maybe_ooo_supplemental_upload",d[25]),b=[d[26],void 0],d[22]=b[0],d[23]=b[1],b):(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_ENCRYPTION_FAILED"),d[24]=new c.Map(),d[24].set("error_code",c.i64.cast([0,62])),d[24].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[24].set("error_message",""),b=[void 0,d[24]],d[22]=b[0],d[23]=b[1],b),b=[d[22],d[23]],d[16]=b[0],d[17]=b[1],b}]):c.resolve((d[12]?(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_ALREADY_DELETED"),d[20]=new c.Map(),d[20].set("error_code",c.i64.cast([0,70])),d[20].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[20].set("error_message",""),e=[void 0,d[20]],d[18]=e[0],d[19]=e[1],e):(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_NOT_FOUND_IN_TOPLEVEL_TABLE"),d[20]=new c.Map(),d[20].set("error_code",c.i64.cast([0,63])),d[20].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[20].set("error_message",""),e=[void 0,d[20]],d[18]=e[0],d[19]=e[1],e),e=[d[18],d[19]],d[16]=e[0],d[17]=e[1],e))},function(a){return a=[d[16],d[17]],d[2]=a[0],d[3]=a[1],a}]):c.sequence([function(e){return c.i64.eq(a[0],c.i64.cast([0,2]))?c.sequence([function(e){return a[3]!==void 0?c.sequence([function(e){return c.nativeOperation(b("LSQueryLocalPersistenceStoreSupplementalForBackup.nop"),a[1],a[2],a[3]).then(function(a){return a=a,d[14]=a[0],d[15]=a[1],a})},function(e){return c.nativeOperation(b("LSQueryLocalPersistenceStoreTagsForBackup.nop"),a[1],a[2]).then(function(a){return a=a,d[16]=a[0],a})},function(e){return d[17]=new c.Map(),d[17].set("message_tags",d[16]),d[18]=new c.Map(),d[18].set("mt",d[17]),c.blobs.neq(d[14],void 0)?c.sequence([function(e){return a[3]!==void 0?c.sequence([function(e){return d[23]=a[5].get("mailbox_root_key_v2"),c.blobs.neq(d[23],void 0)?c.sequence([function(e){return d[26]=a[5].get("message_payload_encryption_keys"),d[27]=d[26].get("epoch_root_key"),d[28]=c.createArray(),d[41]=(d[28].push(c.i64.cast([0,32])),d[28]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleV92Mj5zdXBwbGVtZW50YWxfcHJmX2tleQ=="),void 0,d[23],d[28]).then(function(a){return a=a,d[29]=a[0],a})},function(a){return d[29]!==void 0?c.sequence([function(a){return d[41]=c.i64.of_int32(d[29].length),c.i64.ge(d[41],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[29],c.i64.cast([0,0])).then(function(a){return a=a,d[43]=a[0],d[44]=a[1],a})},function(a){return d[42]=d[43]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[44]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",d[44]].join("")),d[43]=c.createArray(),void 0!==void 0?d[45]=(d[43].push(void 0),d[43]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",d[44],d[43],c.i64.cast([0,3]))},function(a){return d[42]=void 0}])},function(a){return d[30]=d[42]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[42]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",d[42]].join("")),d[41]=c.createArray(),void 0!==void 0?d[43]=(d[41].push(void 0),d[41]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",d[42],d[41],c.i64.cast([0,3]))},function(a){return d[30]=void 0}])},function(a){return c.blobs.neq(d[30],void 0)?d[31]=!0:d[31]=!1,d[31]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),d[32]=c.createArray(),d[41]=(d[32].push(c.i64.cast([0,32])),d[32]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleV92Mj5zdXBwbGVtZW50YWxfZW5jX2tleQ=="),void 0,d[27],d[32]).then(function(a){return a=a,d[33]=a[0],a})},function(a){return d[33]!==void 0?c.sequence([function(a){return d[41]=c.i64.of_int32(d[33].length),c.i64.ge(d[41],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[33],c.i64.cast([0,0])).then(function(a){return a=a,d[43]=a[0],d[44]=a[1],a})},function(a){return d[42]=d[43]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[44]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",d[44]].join("")),d[43]=c.createArray(),void 0!==void 0?d[45]=(d[43].push(void 0),d[43]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",d[44],d[43],c.i64.cast([0,3]))},function(a){return d[42]=void 0}])},function(a){return d[34]=d[42]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[42]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",d[42]].join("")),d[41]=c.createArray(),void 0!==void 0?d[43]=(d[41].push(void 0),d[41]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",d[42],d[41],c.i64.cast([0,3]))},function(a){return d[34]=void 0}])},function(e){return c.blobs.neq(d[34],void 0)?d[35]=!0:d[35]=!1,d[35]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.nativeOperation(b("LSGetBlobFromString.nop"),a[3]).then(function(a){return a=a,d[36]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),d[30],d[36]).then(function(a){return a=a,d[37]=a[0],a})},function(a){return c.nativeOperation(b("LSSymmetricEncryptionCreateEncryptedData.nop"),d[34],c.blob("c3VwcGxlbWVudGFsX2VuY19hYWQ="),d[36]).then(function(a){return a=a,d[38]=a[0],a})},function(e){return c.blobs.neq(d[38],void 0)?c.sequence([function(e){return d[41]=new c.Map(),d[41].set("sk_ciphertext",d[38]),d[41].set("sk_hash",d[37]),d[42]=a[5].get("message_payload_encryption_keys"),d[43]=d[42].get("payload_key"),c.nativeOperation(b("LSSymmetricEncryptionCreateEncryptedData.nop"),d[43],c.blobs.of_string(["message_thread","_",a[1]].join("")),d[14]).then(function(a){return a=a,d[44]=a[0],a})},function(a){return c.blobs.neq(d[44],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[44]).then(function(a){return a=a,d[48]=a[0],a})},function(a){return d[45]=d[48]}]):c.resolve(d[45]=void 0)},function(b){return d[45]!==void 0?(d[18]!==void 0?(d[51]=d[18].get("mt"),d[51]!==void 0?(d[53]=new c.Map(),d[57]="message_tags",d[54]=d[51].get(d[57]),d[54]?d[55]=!1:d[55]=!0,d[55]?0:d[53].set(d[57],d[54]),d[56]=c.toJSON(d[53]),d[52]=d[56]):d[52]=void 0,d[48]=d[52]):d[48]=void 0,d[18]!==void 0?(d[51]=d[18].get("mooos"),d[49]=d[51]):d[49]=void 0,d[50]=new c.Map(),d[50].set("backup_action",a[0]),d[50].set("protobuf_encrypted",d[45]),d[50].set("supplemental_data_encrypted",d[41]),d[50].set("timestamp_ms",a[4]),d[50].set("message_tags",d[48]),d[50].set("serialized_attachment_backup_payload",void 0),d[50].set("maybe_ooo_supplemental_upload",d[49]),b=[d[50],void 0],d[46]=b[0],d[47]=b[1],b):(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_ENCRYPTION_FAILED"),d[48]=new c.Map(),d[48].set("error_code",c.i64.cast([0,62])),d[48].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[48].set("error_message",""),b=[void 0,d[48]],d[46]=b[0],d[47]=b[1],b),b=[d[46],d[47]],d[39]=b[0],d[40]=b[1],b}]):c.resolve((function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error SUPPLEMENTAL_ENCRYPTION_FAILED"),d[41]=new c.Map(),d[41].set("error_code",c.i64.cast([0,66])),d[41].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[41].set("error_message",""),e=[void 0,d[41]],d[39]=e[0],d[40]=e[1],e))},function(a){return a=[d[39],d[40]],d[24]=a[0],d[25]=a[1],a}]):c.resolve((function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error NULL_MAILBOX_ROOT_KEY_V2"),d[26]=new c.Map(),d[26].set("error_code",c.i64.cast([0,27])),d[26].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[26].set("error_message",""),e=[void 0,d[26]],d[24]=e[0],d[25]=e[1],e))},function(a){return a=[d[24],d[25]],d[21]=a[0],d[22]=a[1],a}]):c.resolve((function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error SUPPLEMENTAL_KEY_NOT_SET_IN_CONTEXT_TABLE"),d[23]=new c.Map(),d[23].set("error_code",c.i64.cast([0,65])),d[23].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[23].set("error_message",""),e=[void 0,d[23]],d[21]=e[0],d[22]=e[1],e))},function(a){return a=[d[21],d[22]],d[19]=a[0],d[20]=a[1],a}]):c.resolve((function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_NOT_FOUND_IN_SUPPLEMENTAL_TABLE"),d[21]=new c.Map(),d[21].set("error_code",c.i64.cast([0,64])),d[21].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[21].set("error_message",""),e=[void 0,d[21]],d[19]=e[0],d[20]=e[1],e))},function(a){return a=[d[19],d[20]],d[12]=a[0],d[13]=a[1],a}]):c.resolve((function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error SUPPLEMENTAL_KEY_NOT_SET_IN_CONTEXT_TABLE"),d[14]=new c.Map(),d[14].set("error_code",c.i64.cast([0,65])),d[14].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[14].set("error_message",""),e=[void 0,d[14]],d[12]=e[0],d[13]=e[1],e))},function(a){return a=[d[12],d[13]],d[10]=a[0],d[11]=a[1],a}]):c.sequence([function(e){return c.i64.eq(a[0],c.i64.cast([0,4]))?c.sequence([function(e){return c.nativeOperation(b("LSQueryLocalPersistenceStoreForBackup.nop"),a[1],a[2]).then(function(a){return a=a,d[14]=a[0],d[15]=a[1],d[16]=a[2],a})},function(e){return c.nativeOperation(b("LSQueryLocalPersistenceStoreTagsForBackup.nop"),a[1],a[2]).then(function(a){return a=a,d[17]=a[0],a})},function(e){return d[18]=new c.Map(),d[18].set("message_tags",d[17]),d[19]=new c.Map(),d[19].set("mt",d[18]),c.blobs.neq(d[14],void 0)?c.sequence([function(e){return d[22]=a[5].get("message_payload_encryption_keys"),d[23]=d[22].get("payload_key"),c.nativeOperation(b("LSSymmetricEncryptionCreateEncryptedData.nop"),d[23],c.blobs.of_string(["message_thread","_",a[1]].join("")),d[14]).then(function(a){return a=a,d[24]=a[0],a})},function(a){return c.blobs.neq(d[24],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[24]).then(function(a){return a=a,d[28]=a[0],a})},function(a){return d[25]=d[28]}]):c.resolve(d[25]=void 0)},function(b){return d[25]!==void 0?(d[19]!==void 0?(d[31]=d[19].get("mt"),d[31]!==void 0?(d[33]=new c.Map(),d[37]="message_tags",d[34]=d[31].get(d[37]),d[34]?d[35]=!1:d[35]=!0,d[35]?0:d[33].set(d[37],d[34]),d[36]=c.toJSON(d[33]),d[32]=d[36]):d[32]=void 0,d[28]=d[32]):d[28]=void 0,d[19]!==void 0?(d[31]=d[19].get("mooos"),d[29]=d[31]):d[29]=void 0,d[30]=new c.Map(),d[30].set("backup_action",a[0]),d[30].set("protobuf_encrypted",d[25]),d[30].set("supplemental_data_encrypted",void 0),d[30].set("timestamp_ms",a[4]),d[30].set("message_tags",d[28]),d[30].set("serialized_attachment_backup_payload",void 0),d[30].set("maybe_ooo_supplemental_upload",d[29]),b=[d[30],void 0],d[26]=b[0],d[27]=b[1],b):(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_ENCRYPTION_FAILED"),d[28]=new c.Map(),d[28].set("error_code",c.i64.cast([0,62])),d[28].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[28].set("error_message",""),b=[void 0,d[28]],d[26]=b[0],d[27]=b[1],b),b=[d[26],d[27]],d[20]=b[0],d[21]=b[1],b}]):c.resolve((d[16]?(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_ALREADY_DELETED"),d[24]=new c.Map(),d[24].set("error_code",c.i64.cast([0,70])),d[24].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[24].set("error_message",""),e=[void 0,d[24]],d[22]=e[0],d[23]=e[1],e):(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_NOT_FOUND_IN_TOPLEVEL_TABLE"),d[24]=new c.Map(),d[24].set("error_code",c.i64.cast([0,63])),d[24].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[24].set("error_message",""),e=[void 0,d[24]],d[22]=e[0],d[23]=e[1],e),e=[d[22],d[23]],d[20]=e[0],d[21]=e[1],e))},function(a){return a=[d[20],d[21]],d[12]=a[0],d[13]=a[1],a}]):c.resolve((c.i64.eq(a[0],c.i64.cast([0,3]))?(void 0!==void 0?(d[19]=(void 0).get("mt"),d[19]!==void 0?(d[21]=new c.Map(),d[25]="message_tags",d[22]=d[19].get(d[25]),d[22]?d[23]=!1:d[23]=!0,d[23]?0:d[21].set(d[25],d[22]),d[24]=c.toJSON(d[21]),d[20]=d[24]):d[20]=void 0,d[16]=d[20]):d[16]=void 0,void 0!==void 0?(d[19]=(void 0).get("mooos"),d[17]=d[19]):d[17]=void 0,d[18]=new c.Map(),d[18].set("backup_action",a[0]),d[18].set("protobuf_encrypted",void 0),d[18].set("supplemental_data_encrypted",void 0),d[18].set("timestamp_ms",a[4]),d[18].set("message_tags",d[16]),d[18].set("serialized_attachment_backup_payload",void 0),d[18].set("maybe_ooo_supplemental_upload",d[17]),e=[d[18],void 0],d[14]=e[0],d[15]=e[1],e):(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error UNKNOWN_PROTOBUF_TYPE"),d[16]=new c.Map(),d[16].set("error_code",c.i64.cast([0,60])),d[16].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[16].set("error_message",""),e=[void 0,d[16]],d[14]=e[0],d[15]=e[1],e),e=[d[14],d[15]],d[12]=e[0],d[13]=e[1],e))},function(a){return a=[d[12],d[13]],d[10]=a[0],d[11]=a[1],a}])},function(a){return a=[d[10],d[11]],d[2]=a[0],d[3]=a[1],a}])},function(a){return d[4]=c.i64.of_float(Date.now()),d[5]=c.i64.random(),d[7]="Finishing execution. Execution time: ",d[8]=c.i64.to_string(c.i64.sub(d[4],d[0])),d[9]=" ms",d[6]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][loadAndEncryptProtobufWithInputsV2] ",d[6],d[7],d[6],d[8],d[6],d[9]].join("")),c.i64.eq(c.i64.mod_(d[5],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[10]=",",d[11]=c.createArray(),void 0!==void 0?d[12]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"loadAndEncryptProtobufWithInputsV2",[d[7],d[10],d[8],d[10],d[9]].join(""),d[11],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[2],d[3]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSLoadAndEncryptProtobufV2",["LSLoadAndEncryptProtobufWithInputsV2","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][loadAndEncryptProtobufV2] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.filter(c.db.table(305).fetch(),function(b){return c.i64.eq(b.pendingBackupTaskId,a[0])}).next().then(function(e,f){var g=e.done;e=e.value;return g?(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufV2StoredProcedure] Returning error PROTOBUF_CONTEXT_ROW_NOT_FOUND"),d[11]=new c.Map(),d[11].set("error_code",c.i64.cast([0,67])),d[11].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufV2StoredProcedure"),d[11].set("error_message",""),g=[void 0,d[11]],d[2]=g[0],d[3]=g[1],g):(f=e.item,c.sequence([function(e){return c.storedProcedure(b("LSLoadAndEncryptProtobufWithInputsV2"),f.backupAction,a[2],f.toplevelOfflineThreadingId,f.supplementalKey,f.messageTimestampMs,a[1]).then(function(a){return a=a,d[11]=a[0],d[12]=a[1],a})},function(a){return a=[d[11],d[12]],d[2]=a[0],d[3]=a[1],a}]))})},function(a){return d[5]=c.i64.of_float(Date.now()),d[6]=c.i64.random(),d[8]="Finishing execution. Execution time: ",d[9]=c.i64.to_string(c.i64.sub(d[5],d[0])),d[10]=" ms",d[7]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][loadAndEncryptProtobufV2] ",d[7],d[8],d[7],d[9],d[7],d[10]].join("")),c.i64.eq(c.i64.mod_(d[6],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[11]=",",d[12]=c.createArray(),void 0!==void 0?d[13]=(d[12].push(void 0),d[12]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"loadAndEncryptProtobufV2",[d[8],d[11],d[9],d[11],d[10]].join(""),d[12],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[2],d[3]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsLoadAndEncryptProtobufV2StoredProcedure";a.__tables__=["pending_protobuf_backups_context"];e.exports=a}),null);
__d("LSSerializeBackupPayloadV2",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSDeriveValueSecretRefV2","LSEncryptIdentifiersV2","LSEncryptMessagePayloadV2","LSGetBlobFromString.nop","LSGetLatestEpochKeys","LSIsEncryptionVersionSecure","LSLoadAndEncryptProtobufV2","LSLogMebClientEvent.nop","LSLogWebQpl.nop","LSQplAnnotateBool.nop","LSQplAnnotateString.nop","LSQplMarkEnd.nop","LSQplMarkPoint.nop","LSQplStartTrace.nop","gkx"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,d=a[a.length-1],e=[],f=[];return d.sequence([function(g){return d.sequence([function(b){return e[0]=d.i64.of_float(Date.now()),function(a){d.logger(a).info(a)}("[EncryptedBackups][serializeBackupPayloadV2] Beginning execution."),e[1]=d.i64.of_float(Date.now()),e[19]=d.i64.mul(e[1],d.i64.cast([0,1e6])),e[2]=d.i64.random(),e[6]=d.i64.to_string(e[2]),d.db.table(2).fetch([[[a[0]]]]).next().then(function(a,b){var c=a.done;a=a.value;return c?e[3]=void 0:(b=a.item,e[3]=b.dataTraceId)})},function(a){return e[3]!==void 0?e[5]=e[3]:e[5]=void 0,e[6]!==void 0?d.nativeOperation(b("LSQplStartTrace.nop"),d.i64.cast([0,637746317]),e[6],!0,e[5]):d.resolve()},function(a){return e[6]!==void 0?d.nativeOperation(b("LSQplMarkPoint.nop"),d.i64.cast([0,637746317]),e[6],"LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure_start"):d.resolve()},function(a){return d.islc(d.filter(d.db.table(168).fetch(),function(a){return d.i64.eq(a.authorityLevel,d.i64.cast([0,80]))||!1}),0,d.i64.to_float(d.i64.cast([0,1]))).next().then(function(a,b){var c=a.done;a=a.value;return c?(e[23]=new d.Map(),e[23].set("error_msg","Expected a nonempty query result"),e[23].set("code",d.i64.cast([0,3])),e[23].set("src_line","MEBClientStateUtils.php:247 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),e[24]=d.createArray(),e[25]=(e[24].push(e[23]),e[24]),c=[void 0,e[24]],e[7]=c[0],e[8]=c[1],c):(b=a.item,e[23]=new d.Map(),e[23].set("backup_id",b.backupId),e[23].set("device_public_key_blob",b.devicePublicKeyBlob),e[23].set("device_private_key_blob",b.devicePrivateKeyBlob),e[23].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),e[23].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),e[23].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),e[23].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),e[23].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),e[23].set("ocmf_client_state_blob",b.ocmfClientStateBlob),e[23].set("orf_client_state_v2_blob",void 0),e[23].set("orf_v2_authority_level",void 0),e[23].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),e[23].set("device_id",b.deviceId),e[23].set("backup_tenancy",b.backupTenancy),e[23].set("encryption_version",b.encryptionVersion),e[23].set("revision_version",b.revisionVersion),e[23].set("initialize_restore_result",void 0),e[23].set("device_creation_timestamp_sec",void 0),e[23].set("authority_level",b.authorityLevel),c=[e[23],void 0],e[7]=c[0],e[8]=c[1],c)})},function(f){return e[10]=new d.Map(),e[10].set("value",e[7]),e[10].set("errors",e[8]),e[11]=e[10].get("value"),e[11]!==void 0?d.sequence([function(f){return e[23]=e[11].get("backup_id"),e[24]=e[11].get("device_public_key_blob"),e[25]=e[11].get("device_private_key_blob"),e[26]=e[11].get("epoch_storage_public_key_blob"),e[27]=e[11].get("epoch_storage_private_key_blob"),e[28]=e[11].get("epoch_auth_public_key_blob"),e[29]=e[11].get("epoch_auth_private_key_blob"),e[30]=e[11].get("mailbox_root_key_blob"),e[31]=e[11].get("ocmf_client_state_blob"),e[32]=e[11].get("orf_client_state_v2_blob"),e[33]=e[11].get("orf_v2_authority_level"),e[34]=e[11].get("oblivious_validation_token_blob"),e[35]=e[11].get("device_id"),e[36]=e[11].get("backup_tenancy"),e[37]=e[11].get("encryption_version"),e[38]=e[11].get("revision_version"),e[39]=e[11].get("initialize_restore_result"),e[40]=e[11].get("device_creation_timestamp_sec"),e[41]=e[11].get("authority_level"),d.i64.neq(e[35],void 0)?d.sequence([function(a){return e[46]=void 0,d.i64.neq(e[46],void 0)?d.resolve(e[47]=e[46]):d.sequence([function(a){return e[55]=d.createArray(),d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,0])).then(function(a){return a=a,e[56]=a[0],a})},function(a){return e[56]?e[65]=(e[55].push(d.i64.cast([0,0])),e[55]):0,d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,2])).then(function(a){return a=a,e[57]=a[0],a})},function(a){return e[57]?e[65]=(e[55].push(d.i64.cast([0,2])),e[55]):0,d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,3])).then(function(a){return a=a,e[58]=a[0],a})},function(a){return e[58]?e[65]=(e[55].push(d.i64.cast([0,3])),e[55]):0,d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,4])).then(function(a){return a=a,e[59]=a[0],a})},function(a){return e[59]?e[65]=(e[55].push(d.i64.cast([0,4])),e[55]):0,e[60]=d.createArray(),e[61]=d.i64.of_int32(e[55].length),d.i64.gt(e[61],d.i64.cast([0,0]))?d.loopAsync(e[61],function(a){return e[65]=a,d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[55],e[65]).then(function(a){return a=a,e[66]=a[0],e[67]=a[1],a})},function(a){return e[68]=(e[60].push(e[66]),e[60])}])}):d.resolve()},function(a){return d.sequence([function(a){return e[65]=d.createArray(),e[66]=d.i64.of_int32(e[60].length),d.i64.gt(e[66],d.i64.cast([0,0]))?d.loopAsync(e[66],function(a){return e[68]=a,d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[60],e[68]).then(function(a){return a=a,e[69]=a[0],e[70]=a[1],a})},function(a){return e[71]=(e[65].push(d.i64.to_string(e[69])),e[65])}])}):d.resolve()},function(a){return e[67]=e[65].join(","),e[62]=e[67]}])},function(a){return e[60].some(function(a){return d.i64.eq(e[37],a)})?e[63]=e[37]:e[63]=void 0,d.i64.neq(e[63],void 0)?e[64]=e[63]:e[64]=void 0,e[47]=e[64]}])},function(f){return d.i64.neq(e[47],void 0)?e[48]=e[47]:e[48]=d.i64.cast([0,0]),d.i64.neq(e[36],void 0)?e[49]=e[36]:e[49]=d.i64.cast([0,1]),d.db.table(177).fetch([[[a[0]]],"fk_pending_tasks"]).next().then(function(f,g){var h=f.done;f=f.value;return h?d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[67]=d.i64.of_float(Date.now()),b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[67],d.i64.cast([0,1e6])),e[19]),void 0],e[55]=b[0],e[56]=b[1],e[57]=b[2],e[58]=b[3],e[59]=b[4],e[60]=b[5],e[61]=b[6],b):(f=c.item,e[67]=d.i64.of_float(Date.now()),b=[a[0],f.queueName,f.enqueueTimestampMs,void 0,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[67],d.i64.cast([0,1e6])),e[19]),void 0],e[55]=b[0],e[56]=b[1],e[57]=b[2],e[58]=b[3],e[59]=b[4],e[60]=b[5],e[61]=b[6],b)})},function(a){return e[63]=new d.Map(),e[63].set("task_id",e[55]),e[63].set("queue_name",e[56]),e[63].set("enqueue_timestamp_ms",e[57]),e[63].set("priority",e[58]),e[63].set("first_executed_timestamp_ms",e[59]),e[63].set("execution_time_ns",e[60]),e[63].set("echo_encoding_execution_time_ns",e[61]),e[64]=new d.Map(),e[64].set("task_metadata",e[63]),e[64].set("action_type",void 0),e[64].set("content_type",void 0),e[64].set("identifiers",void 0),e[64].set("identifiers_v2",void 0),e[64].set("task_creation_source",void 0),e[64].set("message_payload_source",d.i64.cast([0,2])),e[65]=new d.Map(),e[65].set("error_code",d.i64.cast([0,5])),e[65].set("stored_procedure","LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure"),e[65].set("error_message","Pending backup context row not found"),e[65]!==void 0?(e[67]=e[65].get("stored_procedure"),e[68]=e[65].get("error_code"),e[69]=e[65].get("error_message"),e[70]=".",e[71]=[e[67],e[70],d.i64.to_string(e[68]),e[70],e[69]].join(""),e[6]!==void 0?e[71]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[71]):d.resolve():d.resolve()):d.resolve()},function(a){return void 0!==void 0?(e[67]=(void 0).get("stored_procedure"),e[68]=(void 0).get("error_code"),e[69]=(void 0).get("error_message"),e[70]=".",e[71]=[e[67],e[70],d.i64.to_string(e[68]),e[70],e[69]].join(""),e[6]!==void 0?e[71]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[71]):d.resolve():d.resolve()):d.resolve()},function(a){return e[6]!==void 0?d.nativeOperation(b("LSQplMarkEnd.nop"),d.i64.cast([0,637746317]),e[6],!1):d.resolve()},function(a){return e[66]=d.createArray(),a=[void 0,e[65],e[64],e[66]],e[50]=a[0],e[51]=a[1],e[52]=a[2],e[53]=a[3],a}]):(g=f.item,d.sequence([function(b){return e[62]=g.actionType,e[63]=g.contentType,e[67]=g.echoContent,e[68]=g.lsTraceId,e[66]=g.echoEncodingLatencyNs,e[65]=g.attachmentPayload,e[69]=g.tamThreadSubtype,e[70]=g.isInstamadillo,e[55]=new d.Map(),e[55].set("backup_id",d.i64.to_string(e[23])),e[55].set("act_thread_id",g.listKey),e[55].set("timestamp",g.sortKey),e[55].set("otid",g.uniqueKey),d.filter(d.db.table(305).fetch(),function(b){return d.i64.eq(b.pendingBackupTaskId,a[0])}).next().then(function(a,b){b=a.done;a=a.value;return b?e[56]=!1:(a.item,e[56]=!0)})},function(f){return e[71]=d.i64.eq(void 0,e[40]),e[64]=g.error==null?d.i64.cast([0,0]):g.error,[d.i64.cast([0,0]),d.i64.cast([0,32])].some(function(a){return d.i64.eq(e[64],a)})?d.sequence([function(a){return e[72]=e[55].get("act_thread_id"),e[73]=e[55].get("otid"),d.storedProcedure(b("LSGetLatestEpochKeys"),!1).then(function(a){return a=a,e[74]=a[0],e[75]=a[1],a})},function(a){return e[74]!==void 0?d.sequence([function(a){return d.i64.eq(e[63],d.i64.cast([0,1]))?d.sequence([function(a){return e[85]=d.createArray(),e[90]=(e[85].push(d.i64.cast([0,32])),e[85]),d.nativeOperation(b("LSGetBlobFromString.nop"),["thread_ope_key","_",e[72]].join("")).then(function(a){return a=a,e[86]=a[0],a})},function(a){return d.nativeOperation(b("LSCreateDerivedKeys.nop"),e[86],void 0,e[30],e[85]).then(function(a){return a=a,e[87]=a[0],a})},function(a){return e[87]?e[88]=!1:e[88]=!0,e[88]?d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] Got null keys while deriving message list OPE key. Returning null blobish"),e[91]="Got null keys while deriving message list OPE key. Returning null blobish",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",e[91]].join("")),e[90]=d.createArray(),void 0!==void 0?e[92]=(e[90].push(void 0),e[90]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",e[91],e[90],d.i64.cast([0,3]))},function(a){return e[89]=void 0}]):d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[87],d.i64.cast([0,0])).then(function(a){return a=a,e[90]=a[0],e[91]=a[1],a})},function(a){return e[89]=e[90]}])},function(a){return e[82]=e[89]}]):d.sequence([function(a){return d.i64.eq(e[62],d.i64.cast([0,2]))?d.sequence([function(a){return e[86]=d.createArray(),e[91]=(e[86].push(d.i64.cast([0,32])),e[86]),d.nativeOperation(b("LSGetBlobFromString.nop"),["thread_ope_key","_",e[73]].join("")).then(function(a){return a=a,e[87]=a[0],a})},function(a){return d.nativeOperation(b("LSCreateDerivedKeys.nop"),e[87],void 0,e[30],e[86]).then(function(a){return a=a,e[88]=a[0],a})},function(a){return e[88]?e[89]=!1:e[89]=!0,e[89]?d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] Got null keys while deriving message list OPE key. Returning null blobish"),e[92]="Got null keys while deriving message list OPE key. Returning null blobish",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",e[92]].join("")),e[91]=d.createArray(),void 0!==void 0?e[93]=(e[91].push(void 0),e[91]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",e[92],e[91],d.i64.cast([0,3]))},function(a){return e[90]=void 0}]):d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[88],d.i64.cast([0,0])).then(function(a){return a=a,e[91]=a[0],e[92]=a[1],a})},function(a){return e[90]=e[91]}])},function(a){return e[85]=e[90]}]):d.resolve(e[85]=void 0)},function(a){return e[82]=e[85]}])},function(a){return d.blobs.neq(e[82],void 0)?d.sequence([function(a){return e[85]=e[74].get("epoch_keys"),e[86]=e[85].get("epoch_anon_id"),e[87]=e[85].get("epoch_root_key"),e[88]=d.createArray(),e[103]=(e[88].push(d.i64.cast([0,32])),e[88]),d.i64.ge(e[48],d.i64.cast([0,3]))?d.resolve(e[89]=void 0):d.sequence([function(a){return d.nativeOperation(b("LSGetBlobFromString.nop"),e[72]).then(function(a){return a=a,e[103]=a[0],a})},function(a){return e[89]=e[103]}])},function(a){return d.i64.ge(e[48],d.i64.cast([0,4]))?(e[103]="_",e[90]=["message_key_in_epoch",e[103],d.blobs.to_string(e[86]),e[103],"cipher_version",e[103],d.i64.to_string(e[48]),e[103],"thread",e[103],e[72]==null?"":e[72]].join("")):(d.i64.ge(e[48],d.i64.cast([0,3]))?(e[104]="_",e[103]=["message_key_in_epoch",e[104],d.blobs.to_string(e[86]),e[104],"cipher_version",e[104],d.i64.to_string(e[48]),e[104],"thread",e[104],e[72]==null?"":e[72]].join("")):(d.i64.ge(e[48],d.i64.cast([0,2]))?(e[105]="_",e[104]=["message_key_in_epoch",e[105],d.blobs.to_string(e[86]),e[105],"cipher_version",e[105],d.i64.to_string(e[48])].join("")):e[104]=["message_key_in_epoch","_",d.blobs.to_string(e[86])].join(""),e[103]=e[104]),e[90]=e[103]),d.nativeOperation(b("LSGetBlobFromString.nop"),e[90]).then(function(a){return a=a,e[91]=a[0],a})},function(a){return d.nativeOperation(b("LSCreateDerivedKeys.nop"),e[91],e[89],e[87],e[88]).then(function(a){return a=a,e[92]=a[0],a})},function(a){return e[92]?e[93]=!1:e[93]=!0,e[93]?d.resolve(e[94]=void 0):d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[92],d.i64.cast([0,0])).then(function(a){return a=a,e[103]=a[0],e[104]=a[1],a})},function(a){return e[94]=e[103]}])},function(a){return d.filter(d.db.table(169).fetch(),function(a){return d.blobs.eq(a.epochAnonIdBlob,d.blob("MA=="))}).next().then(function(b,c){var a=b.done;b=b.value;return a?(e[103]=new d.Map(),e[103].set("error_msg","Expected a nonempty query result"),e[103].set("code",d.i64.cast([0,3])),e[103].set("src_line","MEBEpochClientUtils.php:556 MEBEpochClientUtils::maybeEpochWithAnonIDFromPersistentEpochsTableDirectly()"),e[104]=d.createArray(),e[105]=(e[104].push(e[103]),e[104]),a=[void 0,e[104]],e[95]=a[0],e[96]=a[1],a):(c=b.item,e[103]=new d.Map(),e[103].set("epoch_id",c.epochId),e[103].set("backup_id",c.backupId),e[103].set("epoch_anon_id_blob",c.epochAnonIdBlob),e[103].set("epoch_root_key_blob",c.epochRootKeyBlob),e[103].set("epoch_status",c.epochStatus),e[103].set("epoch_head",c.epochHead),e[103].set("authority_level",c.authorityLevel),a=[e[103],void 0],e[95]=a[0],e[96]=a[1],a)})},function(a){return e[98]=new d.Map(),e[98].set("value",e[95]),e[98].set("errors",e[96]),e[99]=e[98].get("value"),e[99]!==void 0?d.sequence([function(a){return e[103]=e[99].get("epoch_id"),e[104]=e[99].get("backup_id"),e[105]=e[99].get("epoch_anon_id_blob"),e[106]=e[99].get("epoch_root_key_blob"),e[107]=e[99].get("epoch_status"),e[108]=e[99].get("epoch_head"),e[109]=e[99].get("authority_level"),e[110]=d.createArray(),e[118]=(e[110].push(d.i64.cast([0,32])),e[110]),d.nativeOperation(b("LSCreateDerivedKeys.nop"),d.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleT5zYWx0X21haWxib3hfcm9vdF9rZXlfdjI="),void 0,e[30],e[110]).then(function(a){return a=a,e[111]=a[0],a})},function(a){return e[111]!==void 0?d.sequence([function(a){return e[118]=d.i64.of_int32(e[111].length),d.i64.ge(e[118],d.i64.cast([0,1]))?d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[111],d.i64.cast([0,0])).then(function(a){return a=a,e[120]=a[0],e[121]=a[1],a})},function(a){return e[119]=e[120]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),e[121]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",e[121]].join("")),e[120]=d.createArray(),void 0!==void 0?e[122]=(e[120].push(void 0),e[120]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",e[121],e[120],d.i64.cast([0,3]))},function(a){return e[119]=void 0}])},function(a){return e[112]=e[119]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),e[119]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",e[119]].join("")),e[118]=d.createArray(),void 0!==void 0?e[120]=(e[118].push(void 0),e[118]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",e[119],e[118],d.i64.cast([0,3]))},function(a){return e[112]=void 0}])},function(a){return d.blobs.neq(e[112],void 0)?e[113]=!0:e[113]=!1,e[113]?0:(function(a){d.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),d["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),e[114]=d.createArray(),e[118]=(e[114].push(d.i64.cast([0,32])),e[114]),d.nativeOperation(b("LSCreateDerivedKeys.nop"),d.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleT5tYWlsYm94X3Jvb3Rfa2V5X3Yy"),e[112],e[106],e[114]).then(function(a){return a=a,e[115]=a[0],a})},function(a){return e[115]!==void 0?d.sequence([function(a){return e[118]=d.i64.of_int32(e[115].length),d.i64.ge(e[118],d.i64.cast([0,1]))?d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[115],d.i64.cast([0,0])).then(function(a){return a=a,e[120]=a[0],e[121]=a[1],a})},function(a){return e[119]=e[120]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),e[121]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",e[121]].join("")),e[120]=d.createArray(),void 0!==void 0?e[122]=(e[120].push(void 0),e[120]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",e[121],e[120],d.i64.cast([0,3]))},function(a){return e[119]=void 0}])},function(a){return e[116]=e[119]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),e[119]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",e[119]].join("")),e[118]=d.createArray(),void 0!==void 0?e[120]=(e[118].push(void 0),e[118]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",e[119],e[118],d.i64.cast([0,3]))},function(a){return e[116]=void 0}])},function(a){return d.blobs.neq(e[116],void 0)?e[117]=!0:e[117]=!1,e[117]?0:(function(a){d.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),d["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),e[100]=e[116]}]):d.sequence([function(a){return e[103]=e[98].get("errors"),e[104]=e[98].get("errors"),function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBEpochClientUtils] Failed to get mailbox_root_key_v2: epoch 0 is not available."),e[106]="Failed to get mailbox_root_key_v2: epoch 0 is not available.",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBEpochClientUtils] ","",e[106]].join("")),e[105]=d.createArray(),void 0!==void 0?e[107]=(e[105].push(void 0),e[105]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBEpochClientUtils",e[106],e[105],d.i64.cast([0,3]))},function(a){return e[100]=void 0}])},function(a){return d.blobs.neq(e[94],void 0)?d.sequence([function(a){return d.blobs.neq(e[100],void 0)?d.sequence([function(a){return e[109]=d.createArray(),e[113]=(e[109].push(d.i64.cast([0,32])),e[109]),d.nativeOperation(b("LSCreateDerivedKeys.nop"),d.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleV92Mj5mYWxsYmFja19rZXk="),void 0,e[100],e[109]).then(function(a){return a=a,e[110]=a[0],a})},function(a){return e[110]!==void 0?d.sequence([function(a){return e[113]=d.i64.of_int32(e[110].length),d.i64.ge(e[113],d.i64.cast([0,1]))?d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[110],d.i64.cast([0,0])).then(function(a){return a=a,e[115]=a[0],e[116]=a[1],a})},function(a){return e[114]=e[115]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),e[116]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",e[116]].join("")),e[115]=d.createArray(),void 0!==void 0?e[117]=(e[115].push(void 0),e[115]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",e[116],e[115],d.i64.cast([0,3]))},function(a){return e[114]=void 0}])},function(a){return e[111]=e[114]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),e[114]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",e[114]].join("")),e[113]=d.createArray(),void 0!==void 0?e[115]=(e[113].push(void 0),e[113]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",e[114],e[113],d.i64.cast([0,3]))},function(a){return e[111]=void 0}])},function(a){return d.blobs.neq(e[111],void 0)?e[112]=!0:e[112]=!1,e[112]?0:(function(a){d.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),d["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),e[103]=e[111]}]):d.resolve(e[103]=void 0)},function(a){return e[104]=e[85].get("epoch_root_key"),e[105]=e[85].get("epoch_anon_id"),e[106]=e[85].get("epoch_id"),e[107]=new d.Map(),e[107].set("payload_key",e[94]),e[107].set("payload_fallback_key",e[103]),e[107].set("encryption_version",e[48]),e[107].set("epoch_root_key",e[104]),e[107].set("epoch_anon_id",e[105]),e[107].set("epoch_id",e[106]),e[108]=new d.Map(),e[108].set("ope_key",e[82]),e[108].set("message_payload_encryption_keys",e[107]),e[108].set("ocmf_shared_key",e[31]),e[108].set("mailbox_base_salt",e[30]),e[108].set("mailbox_root_key_v2",e[100]),a=[e[108],void 0],e[101]=a[0],e[102]=a[1],a}]):d.resolve((e[103]=new d.Map(),e[103].set("error_code",d.i64.cast([0,26])),e[103].set("stored_procedure","MEBKeyDeriver"),e[103].set("error_message",""),a=[void 0,e[103]],e[101]=a[0],e[102]=a[1],a))},function(a){return a=[e[101],e[102]],e[83]=a[0],e[84]=a[1],a}]):d.resolve((e[85]=new d.Map(),e[85].set("error_code",d.i64.cast([0,25])),e[85].set("stored_procedure","MEBKeyDeriver"),e[85].set("error_message",""),a=[void 0,e[85]],e[83]=a[0],e[84]=a[1],a))},function(a){return a=[e[83],e[84]],e[76]=a[0],e[77]=a[1],a}]):d.resolve((a=[void 0,e[75]],e[76]=a[0],e[77]=a[1],a))},function(f){return e[76]!==void 0?d.sequence([function(a){return e[82]=e[55].get("backup_id"),e[83]=e[55].get("act_thread_id"),e[84]=e[55].get("timestamp"),e[85]=e[55].get("otid"),d.storedProcedure(b("LSEncryptIdentifiersV2"),e[62],e[63],e[82],e[83],d.i64.from_string(e[84]),e[85],e[76]).then(function(a){return a=a,e[86]=a[0],e[87]=a[1],a})},function(f){return e[86]!==void 0?d.sequence([function(c){return e[92]=e[55].get("act_thread_id"),d.storedProcedure(b("LSLoadAndEncryptProtobufV2"),a[0],e[76],e[92]).then(function(a){return a=a,e[93]=a[0],e[94]=a[1],a})},function(f){return e[99]=d.i64.eq(e[64],d.i64.cast([0,32]))||!1||c("gkx")("12541")||!1,e[100]=e[93]!==void 0,e[99]&&e[100]?d.sequence([function(a){return e[101]=e[55].get("act_thread_id"),e[102]=e[55].get("backup_id"),d.storedProcedure(b("LSDeriveValueSecretRefV2"),e[101],e[102],e[76]).then(function(a){return a=a,e[103]=a[0],e[104]=a[1],a})},function(c){return e[93]!==void 0?d.sequence([function(c){return e[103]!==void 0?d.sequence([function(a){return e[113]=e[103].get("value_secret_ref"),e[114]=e[86].get("act_thread_id_ocmf_partial"),e[115]=e[86].get("otid_ocmf_partial"),e[116]=e[86].get("timestamp_encrypted"),e[117]=new d.Map(),e[117].set("list_key",e[114]),e[117].set("unique_key",e[115]),e[117].set("sort_key",e[116]),void 0!==void 0?(e[151]=(void 0).get("encrypted_message_payload"),e[152]=(void 0).get("value_secret_ref"),e[153]=new d.Map(),e[153].set("value",e[151]),e[153].set("value_secret_ref",e[152]),e[118]=e[153]):e[118]=void 0,e[119]=new d.Map(),e[119].set("list_item_id",e[117]),e[119].set("list_item",e[118]),e[119].set("action_type",e[62]),e[120]=e[55].get("timestamp"),e[121]=e[55].get("otid"),e[122]=e[55].get("act_thread_id"),e[123]=e[55].get("supplemental_otid"),e[124]=e[55].get("deletion_otid"),e[125]=new d.Map(),e[125].set("timestamp",e[120]),e[125].set("otid",e[121]),e[125].set("wa_thread_id",d.i64.from_string(e[122])),e[125].set("supplemental_otid",e[123]),e[125].set("deletion_otid",e[124]),e[126]=e[76].get("mailbox_base_salt"),d.nativeOperation(b("LSBase64Encode.nop"),e[126]).then(function(a){return a=a,e[127]=a[0],a})},function(a){return e[128]=e[76].get("ocmf_shared_key"),d.nativeOperation(b("LSBase64Encode.nop"),e[128]).then(function(a){return a=a,e[129]=a[0],a})},function(a){return e[130]=new d.Map(),e[130].set("mailbox_root_key",e[127]==null?"":e[127]),e[130].set("ocmf_client_state_blob",e[129]==null?"":e[129]),e[131]=e[86].get("backup_id_ocmf_partial"),e[132]=e[76].get("message_payload_encryption_keys"),e[133]=e[132].get("epoch_id"),e[134]=e[76].get("message_payload_encryption_keys"),e[135]=e[134].get("encryption_version"),e[150]=e[68]==null?"":e[68],e[136]=new d.Map(),e[136].set("mailbox_partial_id",e[131]),e[136].set("action",e[119]),e[136].set("device_id",e[35]),e[136].set("echo_version",d.i64.cast([0,0])),e[136].set("epoch_id",e[133]),e[136].set("trace_id",void 0),e[136].set("encryption_version",e[135]),e[136].set("is_thread",d.i64.eq(e[63],d.i64.cast([0,2]))),e[136].set("raw_identifiers",e[125]),e[136].set("raw_tokens",e[130]),e[136].set("request_id",e[150]),e[136].set("tam_thread_subtype",e[69]==null?d.i64.cast([0,0]):e[69]),e[136].set("is_instamadillo",e[70]==null?!1:e[70]),e[136].set("should_run_device_creation_timestamp_sync",e[71]),e[136].set("empty_echo_payload_reason",d.i64.cast([0,1])),e[136].set("value_secret_ref",e[113]),e[93]!==void 0?d.sequence([function(a){return e[151]=e[93].get("supplemental_data_encrypted"),e[151]!==void 0?d.sequence([function(a){return e[153]=e[93].get("protobuf_encrypted"),e[154]=e[93].get("backup_action"),e[155]=e[93].get("timestamp_ms"),e[156]=e[151].get("sk_ciphertext"),d.nativeOperation(b("LSBase64Encode.nop"),e[156]).then(function(a){return a=a,e[157]=a[0],a})},function(a){return e[158]=e[151].get("sk_hash"),d.nativeOperation(b("LSBase64Encode.nop"),e[158]).then(function(a){return a=a,e[159]=a[0],a})},function(a){return e[160]=e[93].get("message_tags"),e[161]=e[93].get("maybe_ooo_supplemental_upload"),e[162]=new d.Map(),e[162].set("supplementary_data_key",void 0),e[162].set("encrypted_protobuf",e[153]),e[162].set("key_value_backup_action",e[154]),e[162].set("protobuf_ts_ms",e[155]),e[162].set("supplemental_key_ciphertext",e[157]),e[162].set("supplemental_key_hash",e[159]),e[162].set("message_tags",e[160]),e[162].set("maybe_ooo_supplemental_upload",e[161]),e[152]=e[162]}]):d.resolve((e[153]=e[93].get("protobuf_encrypted"),e[154]=e[93].get("backup_action"),e[155]=e[93].get("timestamp_ms"),e[156]=e[93].get("message_tags"),e[157]=new d.Map(),e[157].set("supplementary_data_key",void 0),e[157].set("encrypted_protobuf",e[153]),e[157].set("key_value_backup_action",e[154]),e[157].set("protobuf_ts_ms",e[155]),e[157].set("message_tags",e[156]),e[152]=e[157]))},function(a){return e[136].set("key_value_backup_payload",e[152])}]):d.resolve()},function(a){return e[65]!==void 0?d.resolve(e[136].set("attachment_backup_payload",e[65])):(function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure] attachment_payload is null."),e[151]="payload_null",e[6]!==void 0?e[151]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"attachment_info",e[151]):d.resolve():d.resolve())},function(a){return e[6]!==void 0?d.nativeOperation(b("LSQplAnnotateBool.nop"),d.i64.cast([0,637746317]),e[6],"process_attachments_via_message_upload",!0):d.resolve()},function(a){return e[150]!==void 0?d.nativeOperation(b("LSLogWebQpl.nop"),e[150],d.i64.cast([0,521481602]),"upload_start",d.i64.cast([0,0]),void 0,void 0):d.resolve()},function(b){return e[137]=d.toJSON(e[136]),d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[151]=d.i64.of_float(Date.now()),d.i64.eq(e[66],d.i64.cast([0,0]))||d.i64.eq(e[66],void 0)?e[152]=void 0:e[152]=e[66],b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[151],d.i64.cast([0,1e6])),e[19]),e[152]],e[138]=b[0],e[139]=b[1],e[140]=b[2],e[141]=b[3],e[142]=b[4],e[143]=b[5],e[144]=b[6],b):(f=c.item,e[151]=d.i64.of_float(Date.now()),d.i64.eq(e[66],d.i64.cast([0,0]))||d.i64.eq(e[66],void 0)?e[152]=void 0:e[152]=e[66],b=[a[0],f.queueName,f.enqueueTimestampMs,void 0,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[151],d.i64.cast([0,1e6])),e[19]),e[152]],e[138]=b[0],e[139]=b[1],e[140]=b[2],e[141]=b[3],e[142]=b[4],e[143]=b[5],e[144]=b[6],b)})},function(a){return e[146]=new d.Map(),e[146].set("task_id",e[138]),e[146].set("queue_name",e[139]),e[146].set("enqueue_timestamp_ms",e[140]),e[146].set("priority",e[141]),e[146].set("first_executed_timestamp_ms",e[142]),e[146].set("execution_time_ns",e[143]),e[146].set("echo_encoding_execution_time_ns",e[144]),e[147]=new d.Map(),e[147].set("task_metadata",e[146]),e[147].set("action_type",e[62]),e[147].set("content_type",e[63]),e[147].set("identifiers",void 0),e[147].set("identifiers_v2",e[55]),e[147].set("task_creation_source",void 0),e[147].set("message_payload_source",d.i64.cast([0,2])),void 0!==void 0?(e[151]=(void 0).get("stored_procedure"),e[152]=(void 0).get("error_code"),e[153]=(void 0).get("error_message"),e[154]=".",e[155]=[e[151],e[154],d.i64.to_string(e[152]),e[154],e[153]].join(""),e[6]!==void 0?e[155]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[155]):d.resolve():d.resolve()):d.resolve()},function(a){return void 0!==void 0?(e[151]=(void 0).get("stored_procedure"),e[152]=(void 0).get("error_code"),e[153]=(void 0).get("error_message"),e[154]=".",e[155]=[e[151],e[154],d.i64.to_string(e[152]),e[154],e[153]].join(""),e[6]!==void 0?e[155]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[155]):d.resolve():d.resolve()):d.resolve()},function(a){return e[6]!==void 0?d.nativeOperation(b("LSQplMarkEnd.nop"),d.i64.cast([0,637746317]),e[6],!0):d.resolve()},function(a){return e[148]=new d.Map(),e[148].set("payload",e[137]),e[149]=d.createArray(),e[151]=(e[149].push(void 0),e[149]),a=[e[148],void 0,e[147],e[149]],e[109]=a[0],e[110]=a[1],e[111]=a[2],e[112]=a[3],a}]):d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[124]=d.i64.of_float(Date.now()),d.i64.eq(e[66],d.i64.cast([0,0]))||d.i64.eq(e[66],void 0)?e[125]=void 0:e[125]=e[66],b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[124],d.i64.cast([0,1e6])),e[19]),e[125]],e[113]=b[0],e[114]=b[1],e[115]=b[2],e[116]=b[3],e[117]=b[4],e[118]=b[5],e[119]=b[6],b):(f=c.item,e[124]=d.i64.of_float(Date.now()),d.i64.eq(e[66],d.i64.cast([0,0]))||d.i64.eq(e[66],void 0)?e[125]=void 0:e[125]=e[66],b=[a[0],f.queueName,f.enqueueTimestampMs,void 0,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[124],d.i64.cast([0,1e6])),e[19]),e[125]],e[113]=b[0],e[114]=b[1],e[115]=b[2],e[116]=b[3],e[117]=b[4],e[118]=b[5],e[119]=b[6],b)})},function(a){return e[121]=new d.Map(),e[121].set("task_id",e[113]),e[121].set("queue_name",e[114]),e[121].set("enqueue_timestamp_ms",e[115]),e[121].set("priority",e[116]),e[121].set("first_executed_timestamp_ms",e[117]),e[121].set("execution_time_ns",e[118]),e[121].set("echo_encoding_execution_time_ns",e[119]),e[122]=new d.Map(),e[122].set("task_metadata",e[121]),e[122].set("action_type",e[62]),e[122].set("content_type",e[63]),e[122].set("identifiers",void 0),e[122].set("identifiers_v2",e[55]),e[122].set("task_creation_source",void 0),e[122].set("message_payload_source",d.i64.cast([0,2])),e[104]!==void 0?(e[124]=e[104].get("stored_procedure"),e[125]=e[104].get("error_code"),e[126]=e[104].get("error_message"),e[127]=".",e[128]=[e[124],e[127],d.i64.to_string(e[125]),e[127],e[126]].join(""),e[6]!==void 0?e[128]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[128]):d.resolve():d.resolve()):d.resolve()},function(a){return void 0!==void 0?(e[124]=(void 0).get("stored_procedure"),e[125]=(void 0).get("error_code"),e[126]=(void 0).get("error_message"),e[127]=".",e[128]=[e[124],e[127],d.i64.to_string(e[125]),e[127],e[126]].join(""),e[6]!==void 0?e[128]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[128]):d.resolve():d.resolve()):d.resolve()},function(a){return e[6]!==void 0?d.nativeOperation(b("LSQplMarkEnd.nop"),d.i64.cast([0,637746317]),e[6],!1):d.resolve()},function(a){return e[123]=d.createArray(),e[124]=(e[123].push(void 0),e[123]),a=[void 0,e[104],e[122],e[123]],e[109]=a[0],e[110]=a[1],e[111]=a[2],e[112]=a[3],a}])},function(a){return a=[e[109],e[110],e[111],e[112]],e[105]=a[0],e[106]=a[1],e[107]=a[2],e[108]=a[3],a}]):d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[120]=d.i64.of_float(Date.now()),d.i64.eq(e[66],d.i64.cast([0,0]))||d.i64.eq(e[66],void 0)?e[121]=void 0:e[121]=e[66],b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[120],d.i64.cast([0,1e6])),e[19]),e[121]],e[109]=b[0],e[110]=b[1],e[111]=b[2],e[112]=b[3],e[113]=b[4],e[114]=b[5],e[115]=b[6],b):(f=c.item,e[120]=d.i64.of_float(Date.now()),d.i64.eq(e[66],d.i64.cast([0,0]))||d.i64.eq(e[66],void 0)?e[121]=void 0:e[121]=e[66],b=[a[0],f.queueName,f.enqueueTimestampMs,void 0,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[120],d.i64.cast([0,1e6])),e[19]),e[121]],e[109]=b[0],e[110]=b[1],e[111]=b[2],e[112]=b[3],e[113]=b[4],e[114]=b[5],e[115]=b[6],b)})},function(a){return e[117]=new d.Map(),e[117].set("task_id",e[109]),e[117].set("queue_name",e[110]),e[117].set("enqueue_timestamp_ms",e[111]),e[117].set("priority",e[112]),e[117].set("first_executed_timestamp_ms",e[113]),e[117].set("execution_time_ns",e[114]),e[117].set("echo_encoding_execution_time_ns",e[115]),e[118]=new d.Map(),e[118].set("task_metadata",e[117]),e[118].set("action_type",e[62]),e[118].set("content_type",e[63]),e[118].set("identifiers",void 0),e[118].set("identifiers_v2",e[55]),e[118].set("task_creation_source",void 0),e[118].set("message_payload_source",d.i64.cast([0,2])),void 0!==void 0?(e[120]=(void 0).get("stored_procedure"),e[121]=(void 0).get("error_code"),e[122]=(void 0).get("error_message"),e[123]=".",e[124]=[e[120],e[123],d.i64.to_string(e[121]),e[123],e[122]].join(""),e[6]!==void 0?e[124]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[124]):d.resolve():d.resolve()):d.resolve()},function(a){return e[94]!==void 0?(e[120]=e[94].get("stored_procedure"),e[121]=e[94].get("error_code"),e[122]=e[94].get("error_message"),e[123]=".",e[124]=[e[120],e[123],d.i64.to_string(e[121]),e[123],e[122]].join(""),e[6]!==void 0?e[124]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[124]):d.resolve():d.resolve()):d.resolve()},function(a){return e[6]!==void 0?d.nativeOperation(b("LSQplMarkEnd.nop"),d.i64.cast([0,637746317]),e[6],!1):d.resolve()},function(a){return e[119]=d.createArray(),e[120]=(e[119].push(e[94]),e[119]),a=[void 0,void 0,e[118],e[119]],e[105]=a[0],e[106]=a[1],e[107]=a[2],e[108]=a[3],a}])},function(a){return a=[e[105],e[106],e[107],e[108]],e[95]=a[0],e[96]=a[1],e[97]=a[2],e[98]=a[3],a}]):d.sequence([function(c){return e[99]===!0&&e[100]===!1?d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[116]=d.i64.of_float(Date.now()),d.i64.eq(e[66],d.i64.cast([0,0]))||d.i64.eq(e[66],void 0)?e[117]=void 0:e[117]=e[66],b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[116],d.i64.cast([0,1e6])),e[19]),e[117]],e[105]=b[0],e[106]=b[1],e[107]=b[2],e[108]=b[3],e[109]=b[4],e[110]=b[5],e[111]=b[6],b):(f=c.item,e[116]=d.i64.of_float(Date.now()),d.i64.eq(e[66],d.i64.cast([0,0]))||d.i64.eq(e[66],void 0)?e[117]=void 0:e[117]=e[66],b=[a[0],f.queueName,f.enqueueTimestampMs,void 0,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[116],d.i64.cast([0,1e6])),e[19]),e[117]],e[105]=b[0],e[106]=b[1],e[107]=b[2],e[108]=b[3],e[109]=b[4],e[110]=b[5],e[111]=b[6],b)})},function(a){return e[113]=new d.Map(),e[113].set("task_id",e[105]),e[113].set("queue_name",e[106]),e[113].set("enqueue_timestamp_ms",e[107]),e[113].set("priority",e[108]),e[113].set("first_executed_timestamp_ms",e[109]),e[113].set("execution_time_ns",e[110]),e[113].set("echo_encoding_execution_time_ns",e[111]),e[114]=new d.Map(),e[114].set("task_metadata",e[113]),e[114].set("action_type",e[62]),e[114].set("content_type",e[63]),e[114].set("identifiers",void 0),e[114].set("identifiers_v2",e[55]),e[114].set("task_creation_source",void 0),e[114].set("message_payload_source",d.i64.cast([0,2])),void 0!==void 0?(e[116]=(void 0).get("stored_procedure"),e[117]=(void 0).get("error_code"),e[118]=(void 0).get("error_message"),e[119]=".",e[120]=[e[116],e[119],d.i64.to_string(e[117]),e[119],e[118]].join(""),e[6]!==void 0?e[120]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[120]):d.resolve():d.resolve()):d.resolve()},function(a){return e[94]!==void 0?(e[116]=e[94].get("stored_procedure"),e[117]=e[94].get("error_code"),e[118]=e[94].get("error_message"),e[119]=".",e[120]=[e[116],e[119],d.i64.to_string(e[117]),e[119],e[118]].join(""),e[6]!==void 0?e[120]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[120]):d.resolve():d.resolve()):d.resolve()},function(a){return e[6]!==void 0?d.nativeOperation(b("LSQplMarkEnd.nop"),d.i64.cast([0,637746317]),e[6],!1):d.resolve()},function(a){return e[115]=d.createArray(),e[116]=(e[115].push(e[94]),e[115]),a=[void 0,void 0,e[114],e[115]],e[101]=a[0],e[102]=a[1],e[103]=a[2],e[104]=a[3],a}]):d.sequence([function(c){return d.i64.eq(e[62],d.i64.cast([0,1]))?(e[113]=e[67]===""?void 0:e[67],e[113]!==void 0?(c=[e[113],void 0],e[111]=c[0],e[112]=c[1],c):(e[114]=new d.Map(),e[114].set("error_code",d.i64.cast([0,30])),e[114].set("stored_procedure","LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure"),e[114].set("error_message",""),c=[void 0,e[114]],e[111]=c[0],e[112]=c[1],c),c=[e[111],e[112]],e[105]=c[0],e[106]=c[1],c):(c=["",void 0],e[105]=c[0],e[106]=c[1],c),e[105]!==void 0?d.sequence([function(a){return d.i64.eq(e[62],d.i64.cast([0,1]))?d.sequence([function(a){return e[117]=e[55].get("backup_id"),e[118]=e[55].get("act_thread_id"),d.storedProcedure(b("LSEncryptMessagePayloadV2"),e[117],e[118],e[76],e[105]).then(function(a){return a=a,e[119]=a[0],e[120]=a[1],a})},function(a){return a=[e[119],e[120]],e[111]=a[0],e[112]=a[1],a}]):d.resolve((e[117]=new d.Map(),e[117].set("encrypted_message_payload",""),e[117].set("value_secret_ref",""),a=[e[117],void 0],e[111]=a[0],e[112]=a[1],a))},function(c){return e[111]!==void 0?d.sequence([function(a){return e[117]=e[86].get("act_thread_id_ocmf_partial"),e[118]=e[86].get("otid_ocmf_partial"),e[119]=e[86].get("timestamp_encrypted"),e[120]=new d.Map(),e[120].set("list_key",e[117]),e[120].set("unique_key",e[118]),e[120].set("sort_key",e[119]),e[111]!==void 0?(e[154]=e[111].get("encrypted_message_payload"),e[155]=e[111].get("value_secret_ref"),e[156]=new d.Map(),e[156].set("value",e[154]),e[156].set("value_secret_ref",e[155]),e[121]=e[156]):e[121]=void 0,e[122]=new d.Map(),e[122].set("list_item_id",e[120]),e[122].set("list_item",e[121]),e[122].set("action_type",e[62]),e[123]=e[55].get("timestamp"),e[124]=e[55].get("otid"),e[125]=e[55].get("act_thread_id"),e[126]=e[55].get("supplemental_otid"),e[127]=e[55].get("deletion_otid"),e[128]=new d.Map(),e[128].set("timestamp",e[123]),e[128].set("otid",e[124]),e[128].set("wa_thread_id",d.i64.from_string(e[125])),e[128].set("supplemental_otid",e[126]),e[128].set("deletion_otid",e[127]),e[129]=e[76].get("mailbox_base_salt"),d.nativeOperation(b("LSBase64Encode.nop"),e[129]).then(function(a){return a=a,e[130]=a[0],a})},function(a){return e[131]=e[76].get("ocmf_shared_key"),d.nativeOperation(b("LSBase64Encode.nop"),e[131]).then(function(a){return a=a,e[132]=a[0],a})},function(a){return e[133]=new d.Map(),e[133].set("mailbox_root_key",e[130]==null?"":e[130]),e[133].set("ocmf_client_state_blob",e[132]==null?"":e[132]),e[134]=e[86].get("backup_id_ocmf_partial"),e[135]=e[76].get("message_payload_encryption_keys"),e[136]=e[135].get("epoch_id"),e[137]=e[76].get("message_payload_encryption_keys"),e[138]=e[137].get("encryption_version"),e[153]=e[68]==null?"":e[68],e[139]=new d.Map(),e[139].set("mailbox_partial_id",e[134]),e[139].set("action",e[122]),e[139].set("device_id",e[35]),e[139].set("echo_version",d.i64.cast([0,0])),e[139].set("epoch_id",e[136]),e[139].set("trace_id",void 0),e[139].set("encryption_version",e[138]),e[139].set("is_thread",d.i64.eq(e[63],d.i64.cast([0,2]))),e[139].set("raw_identifiers",e[128]),e[139].set("raw_tokens",e[133]),e[139].set("request_id",e[153]),e[139].set("tam_thread_subtype",e[69]==null?d.i64.cast([0,0]):e[69]),e[139].set("is_instamadillo",e[70]==null?!1:e[70]),e[139].set("should_run_device_creation_timestamp_sync",e[71]),e[93]!==void 0?d.sequence([function(a){return e[154]=e[93].get("supplemental_data_encrypted"),e[154]!==void 0?d.sequence([function(a){return e[156]=e[93].get("protobuf_encrypted"),e[157]=e[93].get("backup_action"),e[158]=e[93].get("timestamp_ms"),e[159]=e[154].get("sk_ciphertext"),d.nativeOperation(b("LSBase64Encode.nop"),e[159]).then(function(a){return a=a,e[160]=a[0],a})},function(a){return e[161]=e[154].get("sk_hash"),d.nativeOperation(b("LSBase64Encode.nop"),e[161]).then(function(a){return a=a,e[162]=a[0],a})},function(a){return e[163]=e[93].get("message_tags"),e[164]=e[93].get("maybe_ooo_supplemental_upload"),e[165]=new d.Map(),e[165].set("supplementary_data_key",void 0),e[165].set("encrypted_protobuf",e[156]),e[165].set("key_value_backup_action",e[157]),e[165].set("protobuf_ts_ms",e[158]),e[165].set("supplemental_key_ciphertext",e[160]),e[165].set("supplemental_key_hash",e[162]),e[165].set("message_tags",e[163]),e[165].set("maybe_ooo_supplemental_upload",e[164]),e[155]=e[165]}]):d.resolve((e[156]=e[93].get("protobuf_encrypted"),e[157]=e[93].get("backup_action"),e[158]=e[93].get("timestamp_ms"),e[159]=e[93].get("message_tags"),e[160]=new d.Map(),e[160].set("supplementary_data_key",void 0),e[160].set("encrypted_protobuf",e[156]),e[160].set("key_value_backup_action",e[157]),e[160].set("protobuf_ts_ms",e[158]),e[160].set("message_tags",e[159]),e[155]=e[160]))},function(a){return e[139].set("key_value_backup_payload",e[155])}]):d.resolve()},function(a){return e[65]!==void 0?d.resolve(e[139].set("attachment_backup_payload",e[65])):(function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure] attachment_payload is null."),e[154]="payload_null",e[6]!==void 0?e[154]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"attachment_info",e[154]):d.resolve():d.resolve())},function(a){return e[6]!==void 0?d.nativeOperation(b("LSQplAnnotateBool.nop"),d.i64.cast([0,637746317]),e[6],"process_attachments_via_message_upload",!0):d.resolve()},function(a){return e[153]!==void 0?d.nativeOperation(b("LSLogWebQpl.nop"),e[153],d.i64.cast([0,521481602]),"upload_start",d.i64.cast([0,0]),void 0,void 0):d.resolve()},function(b){return e[140]=d.toJSON(e[139]),d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[154]=d.i64.of_float(Date.now()),d.i64.eq(e[66],d.i64.cast([0,0]))||d.i64.eq(e[66],void 0)?e[155]=void 0:e[155]=e[66],b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[154],d.i64.cast([0,1e6])),e[19]),e[155]],e[141]=b[0],e[142]=b[1],e[143]=b[2],e[144]=b[3],e[145]=b[4],e[146]=b[5],e[147]=b[6],b):(f=c.item,e[154]=d.i64.of_float(Date.now()),d.i64.eq(e[66],d.i64.cast([0,0]))||d.i64.eq(e[66],void 0)?e[155]=void 0:e[155]=e[66],b=[a[0],f.queueName,f.enqueueTimestampMs,void 0,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[154],d.i64.cast([0,1e6])),e[19]),e[155]],e[141]=b[0],e[142]=b[1],e[143]=b[2],e[144]=b[3],e[145]=b[4],e[146]=b[5],e[147]=b[6],b)})},function(a){return e[149]=new d.Map(),e[149].set("task_id",e[141]),e[149].set("queue_name",e[142]),e[149].set("enqueue_timestamp_ms",e[143]),e[149].set("priority",e[144]),e[149].set("first_executed_timestamp_ms",e[145]),e[149].set("execution_time_ns",e[146]),e[149].set("echo_encoding_execution_time_ns",e[147]),e[150]=new d.Map(),e[150].set("task_metadata",e[149]),e[150].set("action_type",e[62]),e[150].set("content_type",e[63]),e[150].set("identifiers",void 0),e[150].set("identifiers_v2",e[55]),e[150].set("task_creation_source",void 0),e[150].set("message_payload_source",d.i64.cast([0,2])),void 0!==void 0?(e[154]=(void 0).get("stored_procedure"),e[155]=(void 0).get("error_code"),e[156]=(void 0).get("error_message"),e[157]=".",e[158]=[e[154],e[157],d.i64.to_string(e[155]),e[157],e[156]].join(""),e[6]!==void 0?e[158]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[158]):d.resolve():d.resolve()):d.resolve()},function(a){return e[94]!==void 0?(e[154]=e[94].get("stored_procedure"),e[155]=e[94].get("error_code"),e[156]=e[94].get("error_message"),e[157]=".",e[158]=[e[154],e[157],d.i64.to_string(e[155]),e[157],e[156]].join(""),e[6]!==void 0?e[158]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[158]):d.resolve():d.resolve()):d.resolve()},function(a){return e[6]!==void 0?d.nativeOperation(b("LSQplMarkEnd.nop"),d.i64.cast([0,637746317]),e[6],!0):d.resolve()},function(a){return e[151]=new d.Map(),e[151].set("payload",e[140]),e[152]=d.createArray(),e[154]=(e[152].push(e[94]),e[152]),a=[e[151],void 0,e[150],e[152]],e[113]=a[0],e[114]=a[1],e[115]=a[2],e[116]=a[3],a}]):d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[128]=d.i64.of_float(Date.now()),d.i64.eq(e[66],d.i64.cast([0,0]))||d.i64.eq(e[66],void 0)?e[129]=void 0:e[129]=e[66],b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[128],d.i64.cast([0,1e6])),e[19]),e[129]],e[117]=b[0],e[118]=b[1],e[119]=b[2],e[120]=b[3],e[121]=b[4],e[122]=b[5],e[123]=b[6],b):(f=c.item,e[128]=d.i64.of_float(Date.now()),d.i64.eq(e[66],d.i64.cast([0,0]))||d.i64.eq(e[66],void 0)?e[129]=void 0:e[129]=e[66],b=[a[0],f.queueName,f.enqueueTimestampMs,void 0,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[128],d.i64.cast([0,1e6])),e[19]),e[129]],e[117]=b[0],e[118]=b[1],e[119]=b[2],e[120]=b[3],e[121]=b[4],e[122]=b[5],e[123]=b[6],b)})},function(a){return e[125]=new d.Map(),e[125].set("task_id",e[117]),e[125].set("queue_name",e[118]),e[125].set("enqueue_timestamp_ms",e[119]),e[125].set("priority",e[120]),e[125].set("first_executed_timestamp_ms",e[121]),e[125].set("execution_time_ns",e[122]),e[125].set("echo_encoding_execution_time_ns",e[123]),e[126]=new d.Map(),e[126].set("task_metadata",e[125]),e[126].set("action_type",e[62]),e[126].set("content_type",e[63]),e[126].set("identifiers",void 0),e[126].set("identifiers_v2",e[55]),e[126].set("task_creation_source",void 0),e[126].set("message_payload_source",d.i64.cast([0,2])),e[112]!==void 0?(e[128]=e[112].get("stored_procedure"),e[129]=e[112].get("error_code"),e[130]=e[112].get("error_message"),e[131]=".",e[132]=[e[128],e[131],d.i64.to_string(e[129]),e[131],e[130]].join(""),e[6]!==void 0?e[132]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[132]):d.resolve():d.resolve()):d.resolve()},function(a){return e[94]!==void 0?(e[128]=e[94].get("stored_procedure"),e[129]=e[94].get("error_code"),e[130]=e[94].get("error_message"),e[131]=".",e[132]=[e[128],e[131],d.i64.to_string(e[129]),e[131],e[130]].join(""),e[6]!==void 0?e[132]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[132]):d.resolve():d.resolve()):d.resolve()},function(a){return e[6]!==void 0?d.nativeOperation(b("LSQplMarkEnd.nop"),d.i64.cast([0,637746317]),e[6],!1):d.resolve()},function(a){return e[127]=d.createArray(),e[128]=(e[127].push(e[94]),e[127]),a=[void 0,e[112],e[126],e[127]],e[113]=a[0],e[114]=a[1],e[115]=a[2],e[116]=a[3],a}])},function(a){return a=[e[113],e[114],e[115],e[116]],e[107]=a[0],e[108]=a[1],e[109]=a[2],e[110]=a[3],a}]):d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[122]=d.i64.of_float(Date.now()),d.i64.eq(e[66],d.i64.cast([0,0]))||d.i64.eq(e[66],void 0)?e[123]=void 0:e[123]=e[66],b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[122],d.i64.cast([0,1e6])),e[19]),e[123]],e[111]=b[0],e[112]=b[1],e[113]=b[2],e[114]=b[3],e[115]=b[4],e[116]=b[5],e[117]=b[6],b):(f=c.item,e[122]=d.i64.of_float(Date.now()),d.i64.eq(e[66],d.i64.cast([0,0]))||d.i64.eq(e[66],void 0)?e[123]=void 0:e[123]=e[66],b=[a[0],f.queueName,f.enqueueTimestampMs,void 0,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[122],d.i64.cast([0,1e6])),e[19]),e[123]],e[111]=b[0],e[112]=b[1],e[113]=b[2],e[114]=b[3],e[115]=b[4],e[116]=b[5],e[117]=b[6],b)})},function(a){return e[119]=new d.Map(),e[119].set("task_id",e[111]),e[119].set("queue_name",e[112]),e[119].set("enqueue_timestamp_ms",e[113]),e[119].set("priority",e[114]),e[119].set("first_executed_timestamp_ms",e[115]),e[119].set("execution_time_ns",e[116]),e[119].set("echo_encoding_execution_time_ns",e[117]),e[120]=new d.Map(),e[120].set("task_metadata",e[119]),e[120].set("action_type",e[62]),e[120].set("content_type",e[63]),e[120].set("identifiers",void 0),e[120].set("identifiers_v2",e[55]),e[120].set("task_creation_source",void 0),e[120].set("message_payload_source",d.i64.cast([0,2])),e[106]!==void 0?(e[122]=e[106].get("stored_procedure"),e[123]=e[106].get("error_code"),e[124]=e[106].get("error_message"),e[125]=".",e[126]=[e[122],e[125],d.i64.to_string(e[123]),e[125],e[124]].join(""),e[6]!==void 0?e[126]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[126]):d.resolve():d.resolve()):d.resolve()},function(a){return e[94]!==void 0?(e[122]=e[94].get("stored_procedure"),e[123]=e[94].get("error_code"),e[124]=e[94].get("error_message"),e[125]=".",e[126]=[e[122],e[125],d.i64.to_string(e[123]),e[125],e[124]].join(""),e[6]!==void 0?e[126]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[126]):d.resolve():d.resolve()):d.resolve()},function(a){return e[6]!==void 0?d.nativeOperation(b("LSQplMarkEnd.nop"),d.i64.cast([0,637746317]),e[6],!1):d.resolve()},function(a){return e[121]=d.createArray(),e[122]=(e[121].push(e[94]),e[121]),a=[void 0,e[106],e[120],e[121]],e[107]=a[0],e[108]=a[1],e[109]=a[2],e[110]=a[3],a}])},function(a){return a=[e[107],e[108],e[109],e[110]],e[101]=a[0],e[102]=a[1],e[103]=a[2],e[104]=a[3],a}])},function(a){return a=[e[101],e[102],e[103],e[104]],e[95]=a[0],e[96]=a[1],e[97]=a[2],e[98]=a[3],a}])},function(a){return a=[e[95],e[96],e[97],e[98]],e[88]=a[0],e[89]=a[1],e[90]=a[2],e[91]=a[3],a}]):d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[103]=d.i64.of_float(Date.now()),d.i64.eq(e[66],d.i64.cast([0,0]))||d.i64.eq(e[66],void 0)?e[104]=void 0:e[104]=e[66],b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[103],d.i64.cast([0,1e6])),e[19]),e[104]],e[92]=b[0],e[93]=b[1],e[94]=b[2],e[95]=b[3],e[96]=b[4],e[97]=b[5],e[98]=b[6],b):(f=c.item,e[103]=d.i64.of_float(Date.now()),d.i64.eq(e[66],d.i64.cast([0,0]))||d.i64.eq(e[66],void 0)?e[104]=void 0:e[104]=e[66],b=[a[0],f.queueName,f.enqueueTimestampMs,void 0,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[103],d.i64.cast([0,1e6])),e[19]),e[104]],e[92]=b[0],e[93]=b[1],e[94]=b[2],e[95]=b[3],e[96]=b[4],e[97]=b[5],e[98]=b[6],b)})},function(a){return e[100]=new d.Map(),e[100].set("task_id",e[92]),e[100].set("queue_name",e[93]),e[100].set("enqueue_timestamp_ms",e[94]),e[100].set("priority",e[95]),e[100].set("first_executed_timestamp_ms",e[96]),e[100].set("execution_time_ns",e[97]),e[100].set("echo_encoding_execution_time_ns",e[98]),e[101]=new d.Map(),e[101].set("task_metadata",e[100]),e[101].set("action_type",e[62]),e[101].set("content_type",e[63]),e[101].set("identifiers",void 0),e[101].set("identifiers_v2",e[55]),e[101].set("task_creation_source",void 0),e[101].set("message_payload_source",d.i64.cast([0,2])),e[87]!==void 0?(e[103]=e[87].get("stored_procedure"),e[104]=e[87].get("error_code"),e[105]=e[87].get("error_message"),e[106]=".",e[107]=[e[103],e[106],d.i64.to_string(e[104]),e[106],e[105]].join(""),e[6]!==void 0?e[107]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[107]):d.resolve():d.resolve()):d.resolve()},function(a){return void 0!==void 0?(e[103]=(void 0).get("stored_procedure"),e[104]=(void 0).get("error_code"),e[105]=(void 0).get("error_message"),e[106]=".",e[107]=[e[103],e[106],d.i64.to_string(e[104]),e[106],e[105]].join(""),e[6]!==void 0?e[107]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[107]):d.resolve():d.resolve()):d.resolve()},function(a){return e[6]!==void 0?d.nativeOperation(b("LSQplMarkEnd.nop"),d.i64.cast([0,637746317]),e[6],!1):d.resolve()},function(a){return e[102]=d.createArray(),e[103]=(e[102].push(void 0),e[102]),a=[void 0,e[87],e[101],e[102]],e[88]=a[0],e[89]=a[1],e[90]=a[2],e[91]=a[3],a}])},function(a){return a=[e[88],e[89],e[90],e[91]],e[78]=a[0],e[79]=a[1],e[80]=a[2],e[81]=a[3],a}]):d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[93]=d.i64.of_float(Date.now()),d.i64.eq(e[66],d.i64.cast([0,0]))||d.i64.eq(e[66],void 0)?e[94]=void 0:e[94]=e[66],b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[93],d.i64.cast([0,1e6])),e[19]),e[94]],e[82]=b[0],e[83]=b[1],e[84]=b[2],e[85]=b[3],e[86]=b[4],e[87]=b[5],e[88]=b[6],b):(f=c.item,e[93]=d.i64.of_float(Date.now()),d.i64.eq(e[66],d.i64.cast([0,0]))||d.i64.eq(e[66],void 0)?e[94]=void 0:e[94]=e[66],b=[a[0],f.queueName,f.enqueueTimestampMs,void 0,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[93],d.i64.cast([0,1e6])),e[19]),e[94]],e[82]=b[0],e[83]=b[1],e[84]=b[2],e[85]=b[3],e[86]=b[4],e[87]=b[5],e[88]=b[6],b)})},function(a){return e[90]=new d.Map(),e[90].set("task_id",e[82]),e[90].set("queue_name",e[83]),e[90].set("enqueue_timestamp_ms",e[84]),e[90].set("priority",e[85]),e[90].set("first_executed_timestamp_ms",e[86]),e[90].set("execution_time_ns",e[87]),e[90].set("echo_encoding_execution_time_ns",e[88]),e[91]=new d.Map(),e[91].set("task_metadata",e[90]),e[91].set("action_type",e[62]),e[91].set("content_type",e[63]),e[91].set("identifiers",void 0),e[91].set("identifiers_v2",e[55]),e[91].set("task_creation_source",void 0),e[91].set("message_payload_source",d.i64.cast([0,2])),e[77]!==void 0?(e[93]=e[77].get("stored_procedure"),e[94]=e[77].get("error_code"),e[95]=e[77].get("error_message"),e[96]=".",e[97]=[e[93],e[96],d.i64.to_string(e[94]),e[96],e[95]].join(""),e[6]!==void 0?e[97]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[97]):d.resolve():d.resolve()):d.resolve()},function(a){return void 0!==void 0?(e[93]=(void 0).get("stored_procedure"),e[94]=(void 0).get("error_code"),e[95]=(void 0).get("error_message"),e[96]=".",e[97]=[e[93],e[96],d.i64.to_string(e[94]),e[96],e[95]].join(""),e[6]!==void 0?e[97]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[97]):d.resolve():d.resolve()):d.resolve()},function(a){return e[6]!==void 0?d.nativeOperation(b("LSQplMarkEnd.nop"),d.i64.cast([0,637746317]),e[6],!1):d.resolve()},function(a){return e[92]=d.createArray(),e[93]=(e[92].push(void 0),e[92]),a=[void 0,e[77],e[91],e[92]],e[78]=a[0],e[79]=a[1],e[80]=a[2],e[81]=a[3],a}])},function(a){return a=[e[78],e[79],e[80],e[81]],e[58]=a[0],e[59]=a[1],e[60]=a[2],e[61]=a[3],a}]):d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[84]=d.i64.of_float(Date.now()),d.i64.eq(e[66],d.i64.cast([0,0]))||d.i64.eq(e[66],void 0)?e[85]=void 0:e[85]=e[66],b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[84],d.i64.cast([0,1e6])),e[19]),e[85]],e[72]=b[0],e[73]=b[1],e[74]=b[2],e[75]=b[3],e[76]=b[4],e[77]=b[5],e[78]=b[6],b):(f=c.item,e[84]=d.i64.of_float(Date.now()),d.i64.eq(e[66],d.i64.cast([0,0]))||d.i64.eq(e[66],void 0)?e[85]=void 0:e[85]=e[66],b=[a[0],f.queueName,f.enqueueTimestampMs,void 0,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[84],d.i64.cast([0,1e6])),e[19]),e[85]],e[72]=b[0],e[73]=b[1],e[74]=b[2],e[75]=b[3],e[76]=b[4],e[77]=b[5],e[78]=b[6],b)})},function(a){return e[80]=new d.Map(),e[80].set("task_id",e[72]),e[80].set("queue_name",e[73]),e[80].set("enqueue_timestamp_ms",e[74]),e[80].set("priority",e[75]),e[80].set("first_executed_timestamp_ms",e[76]),e[80].set("execution_time_ns",e[77]),e[80].set("echo_encoding_execution_time_ns",e[78]),e[81]=new d.Map(),e[81].set("task_metadata",e[80]),e[81].set("action_type",e[62]),e[81].set("content_type",e[63]),e[81].set("identifiers",void 0),e[81].set("identifiers_v2",e[55]),e[81].set("task_creation_source",void 0),e[81].set("message_payload_source",d.i64.cast([0,2])),e[82]=new d.Map(),e[82].set("error_code",e[64]),e[82].set("stored_procedure","LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure"),e[82].set("error_message",""),e[82]!==void 0?(e[84]=e[82].get("stored_procedure"),e[85]=e[82].get("error_code"),e[86]=e[82].get("error_message"),e[87]=".",e[88]=[e[84],e[87],d.i64.to_string(e[85]),e[87],e[86]].join(""),e[6]!==void 0?e[88]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[88]):d.resolve():d.resolve()):d.resolve()},function(a){return void 0!==void 0?(e[84]=(void 0).get("stored_procedure"),e[85]=(void 0).get("error_code"),e[86]=(void 0).get("error_message"),e[87]=".",e[88]=[e[84],e[87],d.i64.to_string(e[85]),e[87],e[86]].join(""),e[6]!==void 0?e[88]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[88]):d.resolve():d.resolve()):d.resolve()},function(a){return e[6]!==void 0?d.nativeOperation(b("LSQplMarkEnd.nop"),d.i64.cast([0,637746317]),e[6],!1):d.resolve()},function(a){return e[83]=d.createArray(),a=[void 0,e[82],e[81],e[83]],e[58]=a[0],e[59]=a[1],e[60]=a[2],e[61]=a[3],a}])},function(a){return a=[e[58],e[59],e[60],e[61]],e[50]=a[0],e[51]=a[1],e[52]=a[2],e[53]=a[3],a}]))})},function(a){return a=[e[50],e[51],e[52],e[53]],e[42]=a[0],e[43]=a[1],e[44]=a[2],e[45]=a[3],a}]):d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(b,c){var f=b.done;b=b.value;return f?(e[58]=d.i64.of_float(Date.now()),f=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[58],d.i64.cast([0,1e6])),e[19]),void 0],e[46]=f[0],e[47]=f[1],e[48]=f[2],e[49]=f[3],e[50]=f[4],e[51]=f[5],e[52]=f[6],f):(c=b.item,e[58]=d.i64.of_float(Date.now()),f=[a[0],c.queueName,c.enqueueTimestampMs,void 0,c.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[58],d.i64.cast([0,1e6])),e[19]),void 0],e[46]=f[0],e[47]=f[1],e[48]=f[2],e[49]=f[3],e[50]=f[4],e[51]=f[5],e[52]=f[6],f)})},function(a){return e[54]=new d.Map(),e[54].set("task_id",e[46]),e[54].set("queue_name",e[47]),e[54].set("enqueue_timestamp_ms",e[48]),e[54].set("priority",e[49]),e[54].set("first_executed_timestamp_ms",e[50]),e[54].set("execution_time_ns",e[51]),e[54].set("echo_encoding_execution_time_ns",e[52]),e[55]=new d.Map(),e[55].set("task_metadata",e[54]),e[55].set("action_type",void 0),e[55].set("content_type",void 0),e[55].set("identifiers",void 0),e[55].set("identifiers_v2",void 0),e[55].set("task_creation_source",void 0),e[55].set("message_payload_source",d.i64.cast([0,2])),e[56]=new d.Map(),e[56].set("error_code",d.i64.cast([0,24])),e[56].set("stored_procedure","LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure"),e[56].set("error_message",""),e[56]!==void 0?(e[58]=e[56].get("stored_procedure"),e[59]=e[56].get("error_code"),e[60]=e[56].get("error_message"),e[61]=".",e[62]=[e[58],e[61],d.i64.to_string(e[59]),e[61],e[60]].join(""),e[6]!==void 0?e[62]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[62]):d.resolve():d.resolve()):d.resolve()},function(a){return void 0!==void 0?(e[58]=(void 0).get("stored_procedure"),e[59]=(void 0).get("error_code"),e[60]=(void 0).get("error_message"),e[61]=".",e[62]=[e[58],e[61],d.i64.to_string(e[59]),e[61],e[60]].join(""),e[6]!==void 0?e[62]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[62]):d.resolve():d.resolve()):d.resolve()},function(a){return e[6]!==void 0?d.nativeOperation(b("LSQplMarkEnd.nop"),d.i64.cast([0,637746317]),e[6],!1):d.resolve()},function(a){return e[57]=d.createArray(),a=[void 0,e[56],e[55],e[57]],e[42]=a[0],e[43]=a[1],e[44]=a[2],e[45]=a[3],a}])},function(a){return a=[e[42],e[43],e[44],e[45]],e[12]=a[0],e[13]=a[1],e[14]=a[2],e[15]=a[3],a}]):d.sequence([function(b){return e[23]=e[10].get("errors"),e[24]=e[10].get("errors"),d.db.table(2).fetch([[[a[0]]]]).next().then(function(b,c){var f=b.done;b=b.value;return f?(e[37]=d.i64.of_float(Date.now()),f=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[37],d.i64.cast([0,1e6])),e[19]),void 0],e[25]=f[0],e[26]=f[1],e[27]=f[2],e[28]=f[3],e[29]=f[4],e[30]=f[5],e[31]=f[6],f):(c=b.item,e[37]=d.i64.of_float(Date.now()),f=[a[0],c.queueName,c.enqueueTimestampMs,void 0,c.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[37],d.i64.cast([0,1e6])),e[19]),void 0],e[25]=f[0],e[26]=f[1],e[27]=f[2],e[28]=f[3],e[29]=f[4],e[30]=f[5],e[31]=f[6],f)})},function(a){return e[33]=new d.Map(),e[33].set("task_id",e[25]),e[33].set("queue_name",e[26]),e[33].set("enqueue_timestamp_ms",e[27]),e[33].set("priority",e[28]),e[33].set("first_executed_timestamp_ms",e[29]),e[33].set("execution_time_ns",e[30]),e[33].set("echo_encoding_execution_time_ns",e[31]),e[34]=new d.Map(),e[34].set("task_metadata",e[33]),e[34].set("action_type",void 0),e[34].set("content_type",void 0),e[34].set("identifiers",void 0),e[34].set("identifiers_v2",void 0),e[34].set("task_creation_source",void 0),e[34].set("message_payload_source",d.i64.cast([0,2])),e[35]=new d.Map(),e[35].set("error_code",d.i64.cast([0,1])),e[35].set("stored_procedure","LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure"),e[35].set("error_message",""),e[35]!==void 0?(e[37]=e[35].get("stored_procedure"),e[38]=e[35].get("error_code"),e[39]=e[35].get("error_message"),e[40]=".",e[41]=[e[37],e[40],d.i64.to_string(e[38]),e[40],e[39]].join(""),e[6]!==void 0?e[41]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[41]):d.resolve():d.resolve()):d.resolve()},function(a){return void 0!==void 0?(e[37]=(void 0).get("stored_procedure"),e[38]=(void 0).get("error_code"),e[39]=(void 0).get("error_message"),e[40]=".",e[41]=[e[37],e[40],d.i64.to_string(e[38]),e[40],e[39]].join(""),e[6]!==void 0?e[41]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[41]):d.resolve():d.resolve()):d.resolve()},function(a){return e[6]!==void 0?d.nativeOperation(b("LSQplMarkEnd.nop"),d.i64.cast([0,637746317]),e[6],!1):d.resolve()},function(a){return e[36]=d.createArray(),a=[void 0,e[35],e[34],e[36]],e[12]=a[0],e[13]=a[1],e[14]=a[2],e[15]=a[3],a}])},function(a){return e[16]=d.i64.of_float(Date.now()),e[17]=d.i64.random(),e[20]="Finishing execution. Execution time: ",e[21]=d.i64.to_string(d.i64.sub(e[16],e[0])),e[22]=" ms",e[18]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][serializeBackupPayloadV2] ",e[18],e[20],e[18],e[21],e[18],e[22]].join("")),d.i64.eq(d.i64.mod_(e[17],d.i64.cast([0,1e3])),d.i64.cast([0,0]))?(e[23]=",",e[24]=d.createArray(),void 0!==void 0?e[25]=(e[24].push(void 0),e[24]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"serializeBackupPayloadV2",[e[20],e[23],e[21],e[23],e[22]].join(""),e[24],d.i64.cast([0,4]))):d.resolve()},function(a){return a=[e[12],e[13],e[14],e[15]],f[0]=a[0],f[1]=a[1],f[2]=a[2],f[3]=a[3],a}])},function(a){return d.resolve(f)}])}a.__sproc_name__="LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure";a.__tables__=["pending_tasks","secure_encrypted_backups_client_state","pending_backups_context_v2","pending_protobuf_backups_context","secure_encrypted_backups_epochs"];d=a;g["default"]=d}),98);
__d("LSTaskSerializerEncryptedBackupsUpload",["LSArrayGetObjectAt","LSLogMebClientEvent.nop","LSSerializeBackupPayloadV2"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][taskSerializerEncryptedBackupsUpload] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.forEach(c.db.table(177).fetch([[[a[0]]],"fk_pending_tasks"]),function(a){var b=a.update;a.item;return b({backupStatus:c.i64.cast([0,2])})})},function(e){return c.storedProcedure(b("LSSerializeBackupPayloadV2"),a[0]).then(function(a){return a=a,d[2]=a[0],d[3]=a[1],d[4]=a[2],d[5]=a[3],a})},function(a){return d[6]=c.createArray(),d[7]=c.i64.of_int32(d[5].length),c.i64.gt(d[7],c.i64.cast([0,0]))?c.loopAsync(d[7],function(a){return d[23]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[5],d[23]).then(function(a){return a=a,d[24]=a[0],d[25]=a[1],a})},function(a){return d[24]!==void 0?d[26]=(d[6].push(d[24]),d[6]):0}])}):c.resolve()},function(a){return d[8]=c.i64.of_int32(d[6].length),c.i64.gt(d[8],c.i64.cast([0,0]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[6],c.i64.cast([0,0])).then(function(a){return a=a,d[23]=a[0],d[24]=a[1],a})},function(a){return d[9]=d[23]}]):c.resolve(d[9]=void 0)},function(a){return d[2]?d[10]=!1:d[10]=!0,d[10]?(d[3]?d[23]=!1:d[23]=!0,d[23]?(a=[void 0,void 0,d[9],d[6],d[4]],d[24]=a[0],d[25]=a[1],d[26]=a[2],d[27]=a[3],d[28]=a[4],a):(a=[void 0,d[3],d[9],d[6],d[4]],d[24]=a[0],d[25]=a[1],d[26]=a[2],d[27]=a[3],d[28]=a[4],a),a=[d[24],d[25],d[26],d[27],d[28]],d[11]=a[0],d[12]=a[1],d[13]=a[2],d[14]=a[3],d[15]=a[4],a):(d[23]=d[2].get("payload"),a=[d[23],d[3],d[9],d[6],d[4]],d[11]=a[0],d[12]=a[1],d[13]=a[2],d[14]=a[3],d[15]=a[4],a),d[23]=new c.Map(),d[24]=d[23].set("success",d[11]),d[25]=d[23].set("failure",d[12]),d[26]=d[23].set("protobuf_failure",d[13]),d[27]=d[23].set("protobuf_failures",d[14]),d[28]=d[23].set("context",d[15]),d[29]=c.toJSON(d[23]),d[16]=d[29],d[17]=c.i64.of_float(Date.now()),d[18]=c.i64.random(),d[20]="Finishing execution. Execution time: ",d[21]=c.i64.to_string(c.i64.sub(d[17],d[0])),d[22]=" ms",d[19]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][taskSerializerEncryptedBackupsUpload] ",d[19],d[20],d[19],d[21],d[19],d[22]].join("")),c.i64.eq(c.i64.mod_(d[18],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[23]=",",d[24]=c.createArray(),void 0!==void 0?d[25]=(d[24].push(void 0),d[24]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"taskSerializerEncryptedBackupsUpload",[d[20],d[23],d[21],d[23],d[22]].join(""),d[24],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[16],c.i64.cast([0,50026])],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsTaskSerializerEncryptedBackupsUploadStoredProcedure";a.__tables__=["pending_backups_context_v2"];e.exports=a}),null);
__d("LSTaskSerializerEncryptedBackupsUploadProtobufOnly",[],(function(a,b,c,d,e,f){function a(){var a,b=arguments,c=b[b.length-1],d=[],e=[];return d[0]=new c.Map(),d[0].set("error_code",c.i64.cast([0,802])),d[0].set("stored_procedure","LSEncryptedBackupsTaskSerializerEncryptedBackupsUploadProtobufOnlyStoredProcedure"),d[0].set("error_message",""),d[2]=new c.Map(),d[3]=d[2].set("success",void 0),d[4]=d[2].set("failure",d[0]),d[5]=d[2].set("context",void 0),d[6]=c.toJSON(d[2]),d[1]=d[6],a=[d[1],c.i64.cast([0,50042]),void 0],e[0]=a[0],e[1]=a[1],e[2]=a[2],a,c.resolve(e)}a.__sproc_name__="LSEncryptedBackupsTaskSerializerEncryptedBackupsUploadProtobufOnlyStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSTaskSerializerEncryptedBackupsUploadSenderBackup",["LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(a){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][taskSerializerEncryptedBackupsUploadSenderBackup] Beginning execution."),d[1]=c.i64.of_float(Date.now()),function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupsUploadSenderBackupStoredProcedure] LSEncryptedBackupsMinosEncrypt native op not supported"),d[3]="LSEncryptedBackupsMinosEncrypt native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupsUploadSenderBackupStoredProcedure] ","",d[3]].join("")),d[2]=c.createArray(),void 0!==void 0?d[12]=(d[2].push(void 0),d[2]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsTaskSerializerEncryptedBackupsUploadSenderBackupStoredProcedure",d[3],d[2],c.i64.cast([0,3]))},function(a){return d[4]=new c.Map(),d[4].set("error_code",c.i64.cast([0,3])),d[4].set("stored_procedure","taskSerializerEncryptedBackupsUploadSenderBackup"),d[4].set("error_message",""),d[12]=new c.Map(),d[13]=d[12].set("success",void 0),d[14]=d[12].set("failure",d[4]),d[15]=d[12].set("context",void 0),d[16]=c.toJSON(d[12]),d[5]=d[16],d[6]=c.i64.of_float(Date.now()),d[7]=c.i64.random(),d[9]="Finishing execution. Execution time: ",d[10]=c.i64.to_string(c.i64.sub(d[6],d[0])),d[11]=" ms",d[8]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][taskSerializerEncryptedBackupsUploadSenderBackup] ",d[8],d[9],d[8],d[10],d[8],d[11]].join("")),c.i64.eq(c.i64.mod_(d[7],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[12]=",",d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"taskSerializerEncryptedBackupsUploadSenderBackup",[d[9],d[12],d[10],d[12],d[11]].join(""),d[13],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[5],c.i64.cast([0,50057]),void 0],e[0]=a[0],e[1]=a[1],e[2]=a[2],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsTaskSerializerEncryptedBackupsUploadSenderBackupStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSTaskSerializerMuteThreadV2",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(e){return b.sequence([function(d){return b.db.table(32).fetch([[[a[0]]]]).next().then(function(d,e){var f=d.done;d=d.value;return f?(c[4]=b.createArray(),c[5]=(c[4].push("TaskSerializerMuteThreadV2: Task ID not found"),c[4]),c[6]=(c[4].push(a[0]),c[4]),c[7]=b.toJSON(c[4]),function(a){b.logger(a).mustfix(a)}(c[7]),f=[void 0,void 0,void 0],c[0]=f[0],c[1]=f[1],c[2]=f[2],f):(e=d.item,b.sequence([function(a){return c[8]=e.threadKey,b.db.table(9).fetch([[[c[8]]]]).next().then(function(d,e){var a=d.done;d=d.value;return a?(c[9]=b.createArray(),c[10]=(c[9].push("TaskSerializerMuteThreadV2: Thread not found"),c[9]),c[11]=(c[9].push(c[8]),c[9]),c[12]=b.toJSON(c[9]),function(a){b.logger(a).mustfix(a)}(c[12]),a=[void 0,void 0,void 0],c[4]=a[0],c[5]=a[1],c[6]=a[2],a):(e=d.item,b.sequence([function(a){return b.db.table(9).fetch([[[c[8]]]]).next().then(function(d,e){var a=d.done;d=d.value;return a?c[9]=b.i64.cast([0,1]):(e=d.item,c[14]=e.syncGroup,b.i64.neq(c[14],void 0)?c[13]=c[14]:c[13]=b.i64.cast([0,1]),c[9]=c[13])})},function(a){return c[11]=new b.Map(),c[11].set("thread_key",c[8]),c[11].set("mailbox_type",b.i64.cast([0,0])),c[11].set("mute_expire_time_ms",e.muteExpireTimeMs),c[11].set("sync_group",c[9]),c[12]=b.toJSON(c[11]),a=[c[12],b.i64.cast([0,144]),void 0],c[4]=a[0],c[5]=a[1],c[6]=a[2],a}]))})},function(a){return a=[c[4],c[5],c[6]],c[0]=a[0],c[1]=a[1],c[2]=a[2],a}]))})},function(a){return a=[c[0],c[1]],d[0]=a[0],d[1]=a[1],a}])},function(a){return b.resolve(d)}])}a.__sproc_name__="LSMailboxTaskSerializerMuteThreadV2StoredProcedure";a.__tables__=["threads_optimistic_context","threads"];e.exports=a}),null);
__d("LSTaskSerializerRemoveThread",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(e){return b.sequence([function(d){return b.db.table(32).fetch([[[a[0]]]]).next().then(function(d,e){var f=d.done;d=d.value;return f?(c[4]=b.createArray(),c[5]=(c[4].push("TaskSerializerRemoveThreadV2: Task ID not found"),c[4]),c[6]=(c[4].push(a[0]),c[4]),c[7]=b.toJSON(c[4]),function(a){b.logger(a).mustfix(a)}(c[7]),f=[void 0,void 0,void 0],c[0]=f[0],c[1]=f[1],c[2]=f[2],f):(e=d.item,c[7]=e.removeType,b.i64.neq(c[7],void 0)?(c[8]=new b.Map(),c[8].set("thread_key",e.threadKey),c[8].set("remove_type",c[7]),c[8].set("sync_group",e.syncGroup==null?b.i64.cast([0,1]):e.syncGroup),c[9]=b.toJSON(c[8]),f=[c[9],b.i64.cast([0,146]),void 0],c[4]=f[0],c[5]=f[1],c[6]=f[2],f):(d=[void 0,void 0,void 0],c[4]=d[0],c[5]=d[1],c[6]=d[2],d),e=[c[4],c[5],c[6]],c[0]=e[0],c[1]=e[1],c[2]=e[2],e)})},function(a){return a=[c[0],c[1]],d[0]=a[0],d[1]=a[1],a}])},function(a){return b.resolve(d)}])}a.__sproc_name__="LSMailboxTaskSerializerRemoveThreadStoredProcedure";a.__tables__=["threads_optimistic_context"];e.exports=a}),null);
__d("LSTaskSerializerSendMessageV2",["LSSymmetricEncryptionCreateEncryptedString.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(e){return b.sequence([function(d){return b.db.table(31).fetch([[[a[0]]]]).next().then(function(d,e){var f=d.done;d=d.value;return f?(c[4]=b.createArray(),c[5]=(c[4].push("task ID not found"),c[4]),c[6]=(c[4].push(a[0]),c[4]),c[7]=b.toJSON(c[4]),function(a){b.logger(a).mustfix(a)}(c[7]),f=[void 0,void 0,void 0],c[0]=f[0],c[1]=f[1],c[2]=f[2],f):(e=d.item,b.sequence([function(d){return c[11]=e.offlineThreadingId,c[12]=e.messageId,c[21]=e.threadAttributionSource,c[9]=e.platformRef,c[10]=e.platformToken,c[8]=e.replySourceId,c[13]=e.replySourceType,c[20]=e.sendType,c[22]=e.markThreadRead,c[14]=e.initiatingSource,c[15]=e.skipUrlPreviewGen,c[17]=e.textHasLinks,c[18]=e.dataclassParams,c[19]=e.multitabEnv,c[16]=e.richTextFormatType,b.db.table(12).fetch([[[c[11]]],"optimistic"]).next().then(function(e,f){var d=e.done;e=e.value;return d?(c[23]=b.createArray(),c[24]=(c[23].push("OTID not found"),c[23]),c[25]=(c[23].push(c[11]),c[23]),c[26]=b.toJSON(c[23]),function(a){b.logger(a).mustfix(a)}(c[26]),d=[void 0,void 0,void 0],c[4]=d[0],c[5]=d[1],c[6]=d[2],d):(f=e.item,b.sequence([function(d){return c[31]=f.text,c[27]=f.threadKey,c[32]=f.messageId,c[40]=f.senderId,c[29]=f.stickerId,c[34]=f.mentionOffsets,c[35]=f.mentionLengths,c[28]=f.mentionIds,c[36]=f.mentionTypes,c[39]=f.replyType,c[37]=f.isForwarded,c[33]=f.forwardScore,c[38]=f.hotEmojiSize,c[30]=f.metadataDataclass,b.db.table(9).fetch([[[c[27]]]]).next().then(function(e,g){var d=e.done;e=e.value;return d?(c[41]=b.createArray(),c[42]=(c[41].push("thread not found"),c[41]),c[43]=(c[41].push(c[27]),c[41]),c[44]=b.toJSON(c[41]),function(a){b.logger(a).mustfix(a)}(c[44]),d=[void 0,void 0,void 0],c[23]=d[0],c[24]=d[1],c[25]=d[2],d):(g=e.item,b.sequence([function(d){return c[48]=g.threadName,c[47]=g.threadKey,c[49]=g.mailboxType,c[41]=g.threadType,c[50]=g.capabilities,c[51]=g.capabilities2,c[52]=g.capabilities3,c[53]=g.capabilities4,c[54]=g.capabilities5,b.db.table(2).fetch([[[a[0]]]]).next().then(function(e,f){var d=e.done;e=e.value;return d?c[42]=!1:(f=e.item,b.sequence([function(d){return b.islc(b.db.table(2).fetch([[[f.queueName]],"queueNameTaskId"]),0,b.i64.to_float(b.i64.cast([0,1]))).next().then(function(e,f){var d=e.done;e=e.value;return d?c[55]=!1:(f=e.item,c[55]=b.i64.eq(f.taskId,a[0]))})},function(a){return c[42]=c[55]}]))})},function(a){return b.i64.eq(g.authorityLevel,b.i64.cast([0,20]))&&(b.i64.eq(c[41],b.i64.cast([0,2]))||b.i64.eq(c[41],b.i64.cast([0,5]))||b.i64.eq(c[41],b.i64.cast([0,26])))&&c[42]?b.sequence([function(a){return c[58]=c[20]==null?b.i64.cast([0,1]):c[20],b.db.table(9).fetch([[[c[27]]]]).next().then(function(d,e){var a=d.done;d=d.value;return a?c[55]=b.i64.cast([0,1]):(e=d.item,c[73]=e.syncGroup,b.i64.neq(c[73],void 0)?c[72]=c[73]:c[72]=b.i64.cast([0,1]),c[55]=c[72])})},function(a){return c[57]=new b.Map(),c[57].set("thread_id",c[27]),c[57].set("otid",c[11]),c[57].set("source",c[21]==null?b.i64.cast([0,0]):c[21]),c[57].set("send_type",b.i64.cast([0,1])),c[57].set("sync_group",c[55]),c[57].set("mark_thread_read",c[22]),b.i64.eq(c[58],b.i64.cast([0,1]))?b.resolve(c[57].set("text",c[31])):b.i64.eq(c[58],b.i64.cast([0,2]))?b.resolve(b.i64.neq(c[29],void 0)?(c[57].set("sticker_id",c[29]),c[57].set("send_type",c[58])):0):b.i64.eq(c[58],b.i64.cast([0,7]))?b.sequence([function(a){return b.db.table(16).fetch([[[c[27],c[32]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?(a=[void 0,void 0],c[72]=a[0],c[73]=a[1],a):(d=b.item,a=[d.filename,d.attributionAppId],c[72]=a[0],c[73]=a[1],a)})},function(a){return c[72]!==void 0?b.i64.neq(c[73],void 0)?(c[57].set("url",c[72]),c[57].set("attribution_app_id",c[73]),c[57].set("send_type",c[58]),c[30]!==void 0?c[57].set("metadata_dataclass",c[30]):0):0:0}]):b.i64.eq(c[58],b.i64.cast([0,3]))?b.sequence([function(a){return c[57].set("text",c[31]),c[72]=b.createArray(),c[73]=b.createArray(),b.forEach(b.sortBy(b.db.table(16).fetch([[[c[27],c[32]]]]),[["attachmentIndex","ASC"]]),function(a){a=a.item;return c[74]=a.offlineAttachmentId,c[75]=(c[72].push(b.i64.from_string(a.attachmentFbid)),c[72]),c[74]!==void 0?c[75]=(c[73].push(c[74]),c[73]):0})},function(a){return c[57].set("attachment_fbids",c[72]),b.i64.eq(c[58],b.i64.cast([0,9]))?c[57].set("offline_attachment_ids",c[73]):0,c[57].set("send_type",c[58])}]):b.i64.eq(c[58],b.i64.cast([0,9]))?b.sequence([function(a){return c[57].set("text",c[31]),c[72]=b.createArray(),c[73]=b.createArray(),b.forEach(b.sortBy(b.db.table(16).fetch([[[c[27],c[32]]]]),[["attachmentIndex","ASC"]]),function(a){a=a.item;return c[74]=a.offlineAttachmentId,c[75]=(c[72].push(b.i64.from_string(a.attachmentFbid)),c[72]),c[74]!==void 0?c[75]=(c[73].push(c[74]),c[73]):0})},function(a){return c[57].set("attachment_fbids",c[72]),b.i64.eq(c[58],b.i64.cast([0,9]))?c[57].set("offline_attachment_ids",c[73]):0,c[57].set("send_type",c[58])}]):b.i64.eq(c[58],b.i64.cast([0,4]))?b.sequence([function(a){return b.db.table(16).fetch([[[c[27],c[32]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?c[72]=void 0:(d=b.item,c[72]=d.attachmentFbid)})},function(a){return b.db.table(16).fetch([[[c[27],c[32]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?c[74]=void 0:(d=b.item,c[74]=d.actionUrl)})},function(a){return c[72]!==void 0?(c[57].set("text",c[31]),c[74]!==void 0?c[57].set("url",c[74]):0,c[57].set("forwarded_share_id",c[72]),c[57].set("send_type",c[58])):0}]):b.i64.eq(c[58],b.i64.cast([0,5]))?b.resolve(c[12]!==void 0?(c[57].set("forwarded_msg_id",c[12]),c[57].set("send_type",c[58]),b.i64.neq(c[33],void 0)?c[57].set("forward_score",c[33]):0,c[57].set("strip_forwarded_msg_caption",!1)):0):b.i64.eq(c[58],b.i64.cast([0,6]))?b.sequence([function(a){return b.db.table(16).fetch([[[c[27],c[32]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?(a=[void 0,void 0],c[72]=a[0],c[73]=a[1],a):(d=b.item,a=[d.filename,d.attributionAppId],c[72]=a[0],c[73]=a[1],a)})},function(a){return c[72]!==void 0?(c[57].set("url",c[72]),c[57].set("text",c[31]),c[57].set("send_type",c[58])):0}]):b.i64.eq(c[58],b.i64.cast([0,11]))?b.sequence([function(a){return b.db.table(16).fetch([[[c[27],c[32]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?(a=[void 0,void 0],c[72]=a[0],c[73]=a[1],a):(d=b.item,a=[d.actionUrl,d.attributionAppId],c[72]=a[0],c[73]=a[1],a)})},function(a){return c[72]!==void 0?(c[57].set("url",c[72]),c[57].set("text",c[31]),c[57].set("send_type",c[58])):0}]):b.resolve(0)},function(a){return c[68]=c[8]===""?void 0:c[8],c[68]!==void 0?b.i64.neq(c[13],void 0)?(c[72]=new b.Map(),c[72].set("reply_source_id",c[68]),c[72].set("reply_source_type",c[13]),c[72].set("reply_type",c[39]==null?b.i64.cast([0,0]):c[39]),c[72].set("reply_source_attachment_id",void 0),c[57].set("reply_metadata",c[72])):0:0,c[69]=c[28]===""?void 0:c[28],c[69]!==void 0?(c[72]=c[34]===""?void 0:c[34],c[72]!==void 0?(c[73]=c[35]===""?void 0:c[35],c[73]!==void 0?(c[74]=new b.Map(),c[74].set("mention_ids",c[69]),c[74].set("mention_offsets",c[72]),c[74].set("mention_lengths",c[73]),c[74].set("mention_types",c[36]===""?void 0:c[36]),c[57].set("mention_data",c[74])):0):0):0,c[37]!==void 0?c[57].set("is_forwarded",c[37]):0,c[70]=c[9]===""?void 0:c[9],c[70]!==void 0?c[57].set("platform_ref",c[70]):0,c[71]=c[10]===""?void 0:c[10],c[71]!==void 0?c[57].set("platform_token",c[71]):0,[b.i64.cast([0,1]),b.i64.cast([0,2])].some(function(a){return b.i64.eq(c[58],a)})?b.i64.neq(c[38],void 0)?c[57].set("hot_emoji_size",c[38]):0:0,b.i64.neq(c[14],void 0)?c[57].set("initiating_source",c[14]):0,c[15]!==void 0?c[57].set("skip_url_preview_gen",c[15]):0,b.i64.neq(c[16],void 0)?c[57].set("rich_text_format_type",c[16]):0,b.resolve()},function(a){return c[17]!==void 0?c[57].set("text_has_links",c[17]):0,c[18]!==void 0?c[57].set("dataclass_params",c[18]):0,c[19]!==void 0?c[57].set("multitab_env",c[19]):0,b.filter(b.db.table(14).fetch([[[c[47],c[40]]]]),function(a){return b.i64.eq(a.threadKey,c[47])&&b.i64.eq(b.i64.cast([0,0]),c[49])&&b.i64.eq(a.contactId,c[40])}).next().then(function(d,e){var a=d.done;d=d.value;return a?c[59]=!1:(e=d.item,b.i64.eq(c[41],b.i64.cast([0,152]))?(c[73]=e.threadRoles,b.i64.lt(b.i64.cast([0,7]),b.i64.cast([0,0]))||b.i64.gt(b.i64.cast([0,7]),b.i64.cast([0,7]))?c[74]=!1:c[74]=!b.i64.eq(b.i64.and_(b.i64.lsl_(b.i64.cast([0,1]),b.i64.to_int32(b.i64.cast([0,7]))),c[73]),b.i64.cast([0,0])),c[75]=c[50],c[76]=c[51],c[77]=c[52],c[78]=c[53],c[79]=c[54],c[81]=b.i64.div(b.i64.cast([0,223]),b.i64.cast([0,64])),c[82]=b.i64.lsl_(b.i64.cast([0,1]),b.i64.to_int32(b.i64.sub(b.i64.cast([0,223]),b.i64.mul(c[81],b.i64.cast([0,64]))))),b.i64.lt(b.i64.cast([0,223]),b.i64.cast([0,0]))||b.i64.gt(b.i64.cast([0,223]),b.i64.cast([0,282]))?c[80]=!1:(b.i64.eq(c[81],b.i64.cast([0,0]))?c[83]=!b.i64.eq(b.i64.and_(c[82],c[75]),b.i64.cast([0,0])):(b.i64.eq(c[81],b.i64.cast([0,1]))?c[84]=!b.i64.eq(b.i64.and_(c[82],c[76]),b.i64.cast([0,0])):(b.i64.eq(c[81],b.i64.cast([0,2]))?c[85]=!b.i64.eq(b.i64.and_(c[82],c[77]),b.i64.cast([0,0])):(b.i64.eq(c[81],b.i64.cast([0,3]))?c[86]=!b.i64.eq(b.i64.and_(c[82],c[78]),b.i64.cast([0,0])):(b.i64.eq(c[81],b.i64.cast([0,4]))?c[87]=!b.i64.eq(b.i64.and_(c[82],c[79]),b.i64.cast([0,0])):c[87]=!1,c[86]=c[87]),c[85]=c[86]),c[84]=c[85]),c[83]=c[84]),c[80]=c[83]),c[74]===c[80]?0:(function(a){b.logger(a).mustfix(a)}("LS::assert is failed. Thread role and thread capability don't agree for Broadcast Channels message-as-page functionality; aborting"),b["throw"]("LS::assert is failed. Thread role and thread capability don't agree for Broadcast Channels message-as-page functionality; aborting")),c[72]=c[74]):c[72]=!1,c[59]=c[72])})},function(a){return c[59]?c[57].set("perform_action_as_page",!0):0,c[61]=b.createArray(),b.forEach(b.db.table(14).fetch([[[c[27]]]]),function(a){a=a.item;return c[72]=(c[61].push(a.contactId),c[61])})},function(a){return c[62]=new b.Map(),c[62].set("participants",c[61]),c[62].set("send_payload",c[57]),c[48]!==void 0?c[62].set("thread_name",c[48]):0,b.db.table(312).fetch([[[c[27]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?c[63]=void 0:(d=b.item,c[63]=d.metadata)})},function(a){return c[62].set("thread_metadata",c[63]),b.forEach(b.db.table(9).fetch([[[c[47]]]]),function(a){var b=a.update;a.item;return b({otidOfFirstMessage:f.offlineThreadingId})})},function(a){return c[63]===void 0||!1?(b.i64.eq(c[41],b.i64.cast([0,5]))||b.i64.eq(c[41],b.i64.cast([0,26]))?(function(a){b.logger(a).mustfix(a)}("For Marketplace & community chat subthreads, thread metadata cannot be null"),a=[void 0,void 0,void 0],c[72]=a[0],c[73]=a[1],c[74]=a[2],a):(c[75]=b.toJSON(c[62]),a=[c[75],b.i64.cast([0,130]),void 0],c[72]=a[0],c[73]=a[1],c[74]=a[2],a),a=[c[72],c[73],c[74]],c[65]=a[0],c[66]=a[1],c[67]=a[2],a):(b.i64.eq(c[41],b.i64.cast([0,5]))?(c[75]=b.toJSON(c[62]),a=[c[75],b.i64.cast([0,645]),void 0],c[72]=a[0],c[73]=a[1],c[74]=a[2],a):(b.i64.eq(c[41],b.i64.cast([0,2]))?(c[78]=b.toJSON(c[62]),a=[c[78],b.i64.cast([0,787]),void 0],c[75]=a[0],c[76]=a[1],c[77]=a[2],a):(c[78]=b.toJSON(c[62]),a=[c[78],b.i64.cast([0,645]),void 0],c[75]=a[0],c[76]=a[1],c[77]=a[2],a),a=[c[75],c[76],c[77]],c[72]=a[0],c[73]=a[1],c[74]=a[2],a),a=[c[72],c[73],c[74]],c[65]=a[0],c[66]=a[1],c[67]=a[2],a),a=[c[65],c[66],c[67]],c[44]=a[0],c[45]=a[1],c[46]=a[2],a}]):b.sequence([function(a){return c[58]=c[20]==null?b.i64.cast([0,1]):c[20],b.db.table(9).fetch([[[c[27]]]]).next().then(function(d,e){var a=d.done;d=d.value;return a?c[55]=b.i64.cast([0,1]):(e=d.item,c[67]=e.syncGroup,b.i64.neq(c[67],void 0)?c[66]=c[67]:c[66]=b.i64.cast([0,1]),c[55]=c[66])})},function(a){return c[57]=new b.Map(),c[57].set("thread_id",c[27]),c[57].set("otid",c[11]),c[57].set("source",c[21]==null?b.i64.cast([0,0]):c[21]),c[57].set("send_type",b.i64.cast([0,1])),c[57].set("sync_group",c[55]),c[57].set("mark_thread_read",c[22]),b.i64.eq(c[58],b.i64.cast([0,1]))?b.resolve(c[57].set("text",c[31])):b.i64.eq(c[58],b.i64.cast([0,2]))?b.resolve(b.i64.neq(c[29],void 0)?(c[57].set("sticker_id",c[29]),c[57].set("send_type",c[58])):0):b.i64.eq(c[58],b.i64.cast([0,7]))?b.sequence([function(a){return b.db.table(16).fetch([[[c[27],c[32]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?(a=[void 0,void 0],c[66]=a[0],c[67]=a[1],a):(d=b.item,a=[d.filename,d.attributionAppId],c[66]=a[0],c[67]=a[1],a)})},function(a){return c[66]!==void 0?b.i64.neq(c[67],void 0)?(c[57].set("url",c[66]),c[57].set("attribution_app_id",c[67]),c[57].set("send_type",c[58]),c[30]!==void 0?c[57].set("metadata_dataclass",c[30]):0):0:0}]):b.i64.eq(c[58],b.i64.cast([0,3]))?b.sequence([function(a){return c[57].set("text",c[31]),c[66]=b.createArray(),c[67]=b.createArray(),b.forEach(b.sortBy(b.db.table(16).fetch([[[c[27],c[32]]]]),[["attachmentIndex","ASC"]]),function(a){a=a.item;return c[68]=a.offlineAttachmentId,c[69]=(c[66].push(b.i64.from_string(a.attachmentFbid)),c[66]),c[68]!==void 0?c[69]=(c[67].push(c[68]),c[67]):0})},function(a){return c[57].set("attachment_fbids",c[66]),b.i64.eq(c[58],b.i64.cast([0,9]))?c[57].set("offline_attachment_ids",c[67]):0,c[57].set("send_type",c[58])}]):b.i64.eq(c[58],b.i64.cast([0,9]))?b.sequence([function(a){return c[57].set("text",c[31]),c[66]=b.createArray(),c[67]=b.createArray(),b.forEach(b.sortBy(b.db.table(16).fetch([[[c[27],c[32]]]]),[["attachmentIndex","ASC"]]),function(a){a=a.item;return c[68]=a.offlineAttachmentId,c[69]=(c[66].push(b.i64.from_string(a.attachmentFbid)),c[66]),c[68]!==void 0?c[69]=(c[67].push(c[68]),c[67]):0})},function(a){return c[57].set("attachment_fbids",c[66]),b.i64.eq(c[58],b.i64.cast([0,9]))?c[57].set("offline_attachment_ids",c[67]):0,c[57].set("send_type",c[58])}]):b.i64.eq(c[58],b.i64.cast([0,4]))?b.sequence([function(a){return b.db.table(16).fetch([[[c[27],c[32]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?c[66]=void 0:(d=b.item,c[66]=d.attachmentFbid)})},function(a){return b.db.table(16).fetch([[[c[27],c[32]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?c[68]=void 0:(d=b.item,c[68]=d.actionUrl)})},function(a){return c[66]!==void 0?(c[57].set("text",c[31]),c[68]!==void 0?c[57].set("url",c[68]):0,c[57].set("forwarded_share_id",c[66]),c[57].set("send_type",c[58])):0}]):b.i64.eq(c[58],b.i64.cast([0,5]))?b.resolve(c[12]!==void 0?(c[57].set("forwarded_msg_id",c[12]),c[57].set("send_type",c[58]),b.i64.neq(c[33],void 0)?c[57].set("forward_score",c[33]):0,c[57].set("strip_forwarded_msg_caption",!1)):0):b.i64.eq(c[58],b.i64.cast([0,6]))?b.sequence([function(a){return b.db.table(16).fetch([[[c[27],c[32]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?(a=[void 0,void 0],c[66]=a[0],c[67]=a[1],a):(d=b.item,a=[d.filename,d.attributionAppId],c[66]=a[0],c[67]=a[1],a)})},function(a){return c[66]!==void 0?(c[57].set("url",c[66]),c[57].set("text",c[31]),c[57].set("send_type",c[58])):0}]):b.i64.eq(c[58],b.i64.cast([0,11]))?b.sequence([function(a){return b.db.table(16).fetch([[[c[27],c[32]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?(a=[void 0,void 0],c[66]=a[0],c[67]=a[1],a):(d=b.item,a=[d.actionUrl,d.attributionAppId],c[66]=a[0],c[67]=a[1],a)})},function(a){return c[66]!==void 0?(c[57].set("url",c[66]),c[57].set("text",c[31]),c[57].set("send_type",c[58])):0}]):b.resolve(0)},function(a){return c[62]=c[8]===""?void 0:c[8],c[62]!==void 0?b.i64.neq(c[13],void 0)?(c[66]=new b.Map(),c[66].set("reply_source_id",c[62]),c[66].set("reply_source_type",c[13]),c[66].set("reply_type",c[39]==null?b.i64.cast([0,0]):c[39]),c[66].set("reply_source_attachment_id",void 0),c[57].set("reply_metadata",c[66])):0:0,c[63]=c[28]===""?void 0:c[28],c[63]!==void 0?(c[66]=c[34]===""?void 0:c[34],c[66]!==void 0?(c[67]=c[35]===""?void 0:c[35],c[67]!==void 0?(c[68]=new b.Map(),c[68].set("mention_ids",c[63]),c[68].set("mention_offsets",c[66]),c[68].set("mention_lengths",c[67]),c[68].set("mention_types",c[36]===""?void 0:c[36]),c[57].set("mention_data",c[68])):0):0):0,c[37]!==void 0?c[57].set("is_forwarded",c[37]):0,c[64]=c[9]===""?void 0:c[9],c[64]!==void 0?c[57].set("platform_ref",c[64]):0,c[65]=c[10]===""?void 0:c[10],c[65]!==void 0?c[57].set("platform_token",c[65]):0,[b.i64.cast([0,1]),b.i64.cast([0,2])].some(function(a){return b.i64.eq(c[58],a)})?b.i64.neq(c[38],void 0)?c[57].set("hot_emoji_size",c[38]):0:0,b.i64.neq(c[14],void 0)?c[57].set("initiating_source",c[14]):0,c[15]!==void 0?c[57].set("skip_url_preview_gen",c[15]):0,b.i64.neq(c[16],void 0)?c[57].set("rich_text_format_type",c[16]):0,b.resolve()},function(a){return c[17]!==void 0?c[57].set("text_has_links",c[17]):0,c[18]!==void 0?c[57].set("dataclass_params",c[18]):0,c[19]!==void 0?c[57].set("multitab_env",c[19]):0,b.filter(b.db.table(14).fetch([[[c[47],c[40]]]]),function(a){return b.i64.eq(a.threadKey,c[47])&&b.i64.eq(b.i64.cast([0,0]),c[49])&&b.i64.eq(a.contactId,c[40])}).next().then(function(d,e){var a=d.done;d=d.value;return a?c[59]=!1:(e=d.item,b.i64.eq(c[41],b.i64.cast([0,152]))?(c[67]=e.threadRoles,b.i64.lt(b.i64.cast([0,7]),b.i64.cast([0,0]))||b.i64.gt(b.i64.cast([0,7]),b.i64.cast([0,7]))?c[68]=!1:c[68]=!b.i64.eq(b.i64.and_(b.i64.lsl_(b.i64.cast([0,1]),b.i64.to_int32(b.i64.cast([0,7]))),c[67]),b.i64.cast([0,0])),c[69]=c[50],c[70]=c[51],c[71]=c[52],c[72]=c[53],c[73]=c[54],c[75]=b.i64.div(b.i64.cast([0,223]),b.i64.cast([0,64])),c[76]=b.i64.lsl_(b.i64.cast([0,1]),b.i64.to_int32(b.i64.sub(b.i64.cast([0,223]),b.i64.mul(c[75],b.i64.cast([0,64]))))),b.i64.lt(b.i64.cast([0,223]),b.i64.cast([0,0]))||b.i64.gt(b.i64.cast([0,223]),b.i64.cast([0,282]))?c[74]=!1:(b.i64.eq(c[75],b.i64.cast([0,0]))?c[77]=!b.i64.eq(b.i64.and_(c[76],c[69]),b.i64.cast([0,0])):(b.i64.eq(c[75],b.i64.cast([0,1]))?c[78]=!b.i64.eq(b.i64.and_(c[76],c[70]),b.i64.cast([0,0])):(b.i64.eq(c[75],b.i64.cast([0,2]))?c[79]=!b.i64.eq(b.i64.and_(c[76],c[71]),b.i64.cast([0,0])):(b.i64.eq(c[75],b.i64.cast([0,3]))?c[80]=!b.i64.eq(b.i64.and_(c[76],c[72]),b.i64.cast([0,0])):(b.i64.eq(c[75],b.i64.cast([0,4]))?c[81]=!b.i64.eq(b.i64.and_(c[76],c[73]),b.i64.cast([0,0])):c[81]=!1,c[80]=c[81]),c[79]=c[80]),c[78]=c[79]),c[77]=c[78]),c[74]=c[77]),c[68]===c[74]?0:(function(a){b.logger(a).mustfix(a)}("LS::assert is failed. Thread role and thread capability don't agree for Broadcast Channels message-as-page functionality; aborting"),b["throw"]("LS::assert is failed. Thread role and thread capability don't agree for Broadcast Channels message-as-page functionality; aborting")),c[66]=c[68]):c[66]=!1,c[59]=c[66])})},function(a){return c[59]?c[57].set("perform_action_as_page",!0):0,c[61]=b.toJSON(c[57]),a=[c[61],b.i64.cast([0,46]),void 0],c[44]=a[0],c[45]=a[1],c[46]=a[2],a}])},function(a){return a=[c[44],c[45],c[46]],c[23]=a[0],c[24]=a[1],c[25]=a[2],a}]))})},function(a){return a=[c[23],c[24],c[25]],c[4]=a[0],c[5]=a[1],c[6]=a[2],a}]))})},function(a){return a=[c[4],c[5],c[6]],c[0]=a[0],c[1]=a[1],c[2]=a[2],a}]))})},function(a){return a=[c[0],c[1]],d[0]=a[0],d[1]=a[1],a}])},function(a){return b.resolve(d)}])}a.__sproc_name__="LSMailboxTaskSerializerSendMessageV2StoredProcedure";a.__tables__=["messages_optimistic_context","messages","threads","pending_tasks","attachments","participants","threads_optimistic_metadata"];e.exports=a}),null);
__d("LSTaskSerializerSyncThreadCapabilities",[],(function(a,b,c,d,e,f){function a(){var a,b=arguments,c=b[b.length-1],d=[];return a=[void 0,void 0,void 0],d[0]=a[0],d[1]=a[1],d[2]=a[2],a,c.resolve(d)}a.__sproc_name__="LSMailboxTaskSerializerSyncThreadCapabilitiesStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSIsExperimentCapabilityEnabled.nop",["LSACSExperimentCapability","LSIntEnum","MetaConfig","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=c("MetaConfig")._("87"),k=c("MetaConfig")._("156");a=function(a,e,f,g){switch((i||(i=d("LSIntEnum"))).toNumber(f)){case c("LSACSExperimentCapability").BUMP_TOKEN_SYNC_TASK_AT_TASK_SERIALIZATION:return(h||(h=b("Promise"))).resolve([k]);case c("LSACSExperimentCapability").INSERT_PENDING_TASK_PARENT_ROW_WHEN_NO_ACS_TOKENS_AT_TASK_INSERTION:return(h||(h=b("Promise"))).resolve([!1]);case c("LSACSExperimentCapability").RETRY_AFTER_TASK_SERIALIZATION_FAILURE_EXPONENTIAL_BACKOFF:return(h||(h=b("Promise"))).resolve([j])}return(h||(h=b("Promise"))).resolve([!1])};a.__nop_name__="LSIsExperimentCapabilityEnabled";g["default"]=a}),98);
__d("LSVoprfHmac.nop",["ACSCipherSuiteModule","ACSTokenHmacUtil","XPlatReactTextEncoder"],(function(a,b,c,d,e,f,g){"use strict";a=async function(a,b,c,e){a=d("ACSCipherSuiteModule").getACSCipherSuiteByValue(d("ACSCipherSuiteModule").VOPRF_RISTRETTO_HMACSHA512.value);if(!a)return Promise.resolve([void 0]);b=await d("ACSTokenHmacUtil").hmac(a.macAlgorithm,new Uint8Array(e).slice(),new(d("XPlatReactTextEncoder").TextEncoder)().encode(c));return Promise.resolve([b.buffer])};a.__nop_name__="LSVoprfHmac";g.default=a}),98);
__d("LSTaskSerializerUnauthenticatedTask",["LSArrayGetObjectAt","LSBase64Encode.nop","LSIsExperimentCapabilityEnabled.nop","LSMailboxTaskCompletionApiOnTaskCompletion","LSRemoveUsedTokens","LSVoprfHmac.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){return c.db.table(311).fetch([[[a[0]]]]).next().then(function(a,b){var c=a.done;a=a.value;return c?d[0]=void 0:(b=a.item,d[0]=b.projectName)})},function(e){return d[0]!==void 0?c.sequence([function(e){return a[1]!==void 0?c.sequence([function(a){return d[9]=c.createArray(),d[10]=c.i64.of_float(Date.now()),c.forEach(c.filter(c.db.table(307).fetch(),function(a){return d[0]===a.projectName&&c.i64.gt(a.expirationTimestampMs,d[10])}),function(a){a=a.item;return d[16]=(d[9].push(a.configId),d[9])})},function(a){return c.sequence([function(a){return d[16]=c.createArray(),d[17]=c.i64.of_int32(d[9].length),c.i64.gt(d[17],c.i64.cast([0,0]))?c.loopAsync(d[17],function(a){return d[19]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[9],d[19]).then(function(a){return a=a,d[20]=a[0],d[21]=a[1],a})},function(a){return d[22]=(d[16].push(d[20]),d[16])}])}):c.resolve()},function(a){return d[18]=d[16].join(","),d[11]=d[18]}])},function(e){return c.filter(c.db.table(309).fetch(),function(a){return d[9].includes(a.configId)&&c.i64.gt(a.redeemLimit,c.i64.cast([0,0]))}).next().then(function(e,f){var g=e.done;e=e.value;return g?c.sequence([function(a){return c.nativeOperation(b("LSIsExperimentCapabilityEnabled.nop"),c.i64.cast([0,0]),d[0]).then(function(a){return a=a,d[16]=a[0],a})},function(e){return d[16]?c.sequence([function(b){return c.db.table(311).fetch([[[a[0]]]]).next().then(function(b,e){var a=b.done;b=b.value;return a?d[20]=c.i64.cast([0,0]):(e=b.item,d[20]=e.failureCount)})},function(b){return c.forEach(c.db.table(311).fetch([[[a[0]]]]),function(a){a=a.item;return c.forEach(c.db.table(311).fetch([[[a.taskId]]]),function(a){var b=a.update;a.item;return b({failureCount:c.i64.add(d[20],c.i64.cast([0,1]))})})})},function(a){return a=[void 0,void 0,c.i64.mul(c.i64.lsl_(c.i64.cast([0,1]),c.i64.to_int32(c.i64.mod_(d[20],c.i64.cast([0,7])))),c.i64.cast([0,500]))],d[17]=a[0],d[18]=a[1],d[19]=a[2],a}]):c.sequence([function(d){return c.storedProcedure(b("LSMailboxTaskCompletionApiOnTaskCompletion"),a[0],!1)},function(b){return d[20]=c.createArray(),d[21]=(d[20].push("Unauthenticated Task Serializer: no valid tokens"),d[20]),d[22]=(d[20].push(a[0]),d[20]),d[23]=(d[20].push(d[0]),d[20]),d[24]=c.toJSON(d[20]),function(a){c.logger(a).mustfix(a)}(d[24]),b=[void 0,void 0,void 0],d[17]=b[0],d[18]=b[1],d[19]=b[2],b}])},function(a){return a=[d[17],d[18],d[19]],d[12]=a[0],d[13]=a[1],d[14]=a[2],a}]):(f=e.item,c.sequence([function(e){return d[20]=f.tokenId,c.nativeOperation(b("LSVoprfHmac.nop"),a[2]==null?"":a[2],f.sharedSecret).then(function(a){return a=a,d[16]=a[0],a})},function(e){return c.blobs.neq(d[16],void 0)?c.sequence([function(a){return c.forEach(c.db.table(309).fetch([[[d[20]]]]),function(a){var b=a.update;a=a.item;return b({redeemLimit:c.i64.sub(a.redeemLimit,c.i64.cast([0,1]))})})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[16]).then(function(a){return a=a,d[21]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),f.nonce).then(function(a){return a=a,d[22]=a[0],a})},function(b){return d[23]=new c.Map(),d[23].set("config_id",f.configId),d[23].set("tag",d[21]==null?"":d[21]),d[23].set("aux",d[22]==null?"":d[22]),d[23].set("project_name",d[0]),d[24]=c.toJSON(d[23]),d[25]=new c.Map(),d[25].set("payload",a[2]==null?"":a[2]),d[25].set("token",d[24]),d[26]=c.toJSON(d[25]),b=[d[26],c.i64.from_string(a[1]),void 0],d[17]=b[0],d[18]=b[1],d[19]=b[2],b}]):c.sequence([function(a){return c.forEach(c.db.table(309).fetch([[[d[20]]]]),function(a){return a["delete"]()})},function(d){return c.storedProcedure(b("LSMailboxTaskCompletionApiOnTaskCompletion"),a[0],!1)},function(b){return d[21]=c.createArray(),d[22]=(d[21].push("Unauthenticated Task Serializer: hmac failed"),d[21]),d[23]=(d[21].push(a[0]),d[21]),d[24]=c.toJSON(d[21]),function(a){c.logger(a).mustfix(a)}(d[24]),b=[void 0,void 0,void 0],d[17]=b[0],d[18]=b[1],d[19]=b[2],b}])},function(a){return a=[d[17],d[18],d[19]],d[12]=a[0],d[13]=a[1],d[14]=a[2],a}]))})},function(a){return a=[d[12],d[13],d[14]],d[6]=a[0],d[7]=a[1],d[8]=a[2],a}]):c.sequence([function(d){return c.storedProcedure(b("LSMailboxTaskCompletionApiOnTaskCompletion"),a[0],!1)},function(b){return d[9]=c.createArray(),d[10]=(d[9].push("Unauthenticated Task Serializer: task has no write label"),d[9]),d[11]=(d[9].push(a[0]),d[9]),d[12]=c.toJSON(d[9]),function(a){c.logger(a).mustfix(a)}(d[12]),b=[void 0,void 0,void 0],d[6]=b[0],d[7]=b[1],d[8]=b[2],b}])},function(a){return a=[d[6],d[7],d[8]],d[2]=a[0],d[3]=a[1],d[4]=a[2],a}]):c.sequence([function(d){return c.storedProcedure(b("LSMailboxTaskCompletionApiOnTaskCompletion"),a[0],!1)},function(b){return d[6]=c.createArray(),d[7]=(d[6].push("Unauthenticated Task Serializer: anonymous_task_context row not found"),d[6]),d[8]=(d[6].push(a[0]),d[6]),d[9]=c.toJSON(d[6]),function(a){c.logger(a).mustfix(a)}(d[9]),b=[void 0,void 0,void 0],d[2]=b[0],d[3]=b[1],d[4]=b[2],b}])},function(a){return c.storedProcedure(b("LSRemoveUsedTokens"))},function(a){return d[0]!==void 0?c.sequence([function(a){return c.nativeOperation(b("LSIsExperimentCapabilityEnabled.nop"),c.i64.cast([0,1]),d[0]).then(function(a){return a=a,d[6]=a[0],a})},function(a){return d[6]?c.sequence([function(a){return c.i64.neq(d[4],void 0)?c.resolve(d[8]=!0):c.sequence([function(a){return d[10]=c.createArray(),d[11]=c.i64.of_float(Date.now()),c.forEach(c.filter(c.db.table(307).fetch(),function(a){return d[0]===a.projectName&&c.i64.gt(a.expirationTimestampMs,d[11])}),function(a){a=a.item;return d[15]=(d[10].push(a.configId),d[10])})},function(a){return c.sequence([function(a){return d[15]=c.createArray(),d[16]=c.i64.of_int32(d[10].length),c.i64.gt(d[16],c.i64.cast([0,0]))?c.loopAsync(d[16],function(a){return d[18]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[10],d[18]).then(function(a){return a=a,d[19]=a[0],d[20]=a[1],a})},function(a){return d[21]=(d[15].push(d[19]),d[15])}])}):c.resolve()},function(a){return d[17]=d[15].join(","),d[12]=d[17]}])},function(a){return c.filter(c.db.table(309).fetch(),function(a){return d[10].includes(a.configId)&&c.i64.gt(a.redeemLimit,c.i64.cast([0,0]))}).next().then(function(a,b){b=a.done;a=a.value;return b?d[13]=!0:(a.item,d[13]=!1)})},function(a){return d[8]=d[13]}])},function(a){return d[8]?c.sequence([function(a){return c.filter(c.db.table(310).fetch(),function(a){return a.projectName===d[0]}).next().then(function(a,b){var c=a.done;a=a.value;return c?d[10]=void 0:(b=a.item,d[10]=b.taskId)})},function(a){return d[9]=d[10]}]):c.resolve(d[9]=void 0)},function(a){return d[7]=d[9]}]):c.resolve(d[7]=void 0)},function(a){return d[5]=d[7]}]):c.resolve(d[5]=void 0)},function(a){return a=[d[2],d[3],d[4],d[5]],e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSAnonymousCredentialsTaskSerializerUnauthenticatedTaskStoredProcedure";a.__tables__=["anonymous_task_context","secure_acs_configurations","secure_acs_tokens","acs_request_context"];e.exports=a}),null);
__d("LSTaskSerializerUpdateThreadName",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(e){return b.sequence([function(d){return b.db.table(32).fetch([[[a[0]]]]).next().then(function(d,e){var f=d.done;d=d.value;return f?(c[4]=b.createArray(),c[5]=(c[4].push("taskSerializerUpdateThreadName: Task ID not found"),c[4]),c[6]=(c[4].push(a[0]),c[4]),c[7]=b.toJSON(c[4]),function(a){b.logger(a).mustfix(a)}(c[7]),f=[void 0,void 0,void 0],c[0]=f[0],c[1]=f[1],c[2]=f[2],f):(e=d.item,b.sequence([function(a){return c[8]=e.threadKey,b.db.table(9).fetch([[[c[8]]]]).next().then(function(d,e){var a=d.done;d=d.value;return a?(c[9]=b.createArray(),c[10]=(c[9].push("taskSerializerUpdateThreadName: Thread not found"),c[9]),c[11]=(c[9].push(c[8]),c[9]),c[12]=b.toJSON(c[9]),function(a){b.logger(a).mustfix(a)}(c[12]),a=[void 0,void 0,void 0],c[4]=a[0],c[5]=a[1],c[6]=a[2],a):(e=d.item,b.sequence([function(a){return b.db.table(9).fetch([[[c[8]]]]).next().then(function(d,e){var a=d.done;d=d.value;return a?c[9]=b.i64.cast([0,1]):(e=d.item,c[14]=e.syncGroup,b.i64.neq(c[14],void 0)?c[13]=c[14]:c[13]=b.i64.cast([0,1]),c[9]=c[13])})},function(a){return c[11]=new b.Map(),c[11].set("thread_key",c[8]),c[11].set("thread_name",e.threadName==null?"":e.threadName),c[11].set("sync_group",c[9]),c[12]=b.toJSON(c[11]),a=[c[12],b.i64.cast([0,32]),void 0],c[4]=a[0],c[5]=a[1],c[6]=a[2],a}]))})},function(a){return a=[c[4],c[5],c[6]],c[0]=a[0],c[1]=a[1],c[2]=a[2],a}]))})},function(a){return a=[c[0],c[1],c[2]],d[0]=a[0],d[1]=a[1],d[2]=a[2],a}])},function(a){return b.resolve(d)}])}a.__sproc_name__="LSMailboxTaskSerializerUpdateThreadNameStoredProcedure";a.__tables__=["threads_optimistic_context","threads"];e.exports=a}),null);
__d("LSSerializeTask",["LSForceTaskExecutionImmediately","LSLogMebClientEvent.nop","LSTaskSerializerAcsIssueNextSync","LSTaskSerializerDeleteChatHistory","LSTaskSerializerE2eeMessageIntegrityCheckV2","LSTaskSerializerE2eeMetadataThreadIntegrityCheck","LSTaskSerializerEncryptedBackupAction","LSTaskSerializerEncryptedBackupsLoopingUpload","LSTaskSerializerEncryptedBackupsOpenUpload","LSTaskSerializerEncryptedBackupsRestoreWithSerializer","LSTaskSerializerEncryptedBackupsUpload","LSTaskSerializerEncryptedBackupsUploadProtobufOnly","LSTaskSerializerEncryptedBackupsUploadSenderBackup","LSTaskSerializerMuteThreadV2","LSTaskSerializerRemoveThread","LSTaskSerializerSendMessageV2","LSTaskSerializerSyncThreadCapabilities","LSTaskSerializerUnauthenticatedTask","LSTaskSerializerUpdateThreadName"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return a[1]==="46"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerSendMessageV2"),a[0]).then(function(a){return a=a,d[8]=a[0],d[9]=a[1],a})},function(a){return a=[d[8],c.i64.to_string(d[9]),void 0,void 0],d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[3],a}]):c.sequence([function(e){return a[1]==="144"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerMuteThreadV2"),a[0]).then(function(a){return a=a,d[12]=a[0],d[13]=a[1],a})},function(a){return a=[d[12],c.i64.to_string(d[13]),void 0,void 0],d[8]=a[0],d[9]=a[1],d[10]=a[2],d[11]=a[3],a}]):c.sequence([function(e){return a[1]==="146"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerRemoveThread"),a[0]).then(function(a){return a=a,d[16]=a[0],d[17]=a[1],a})},function(a){return a=[d[16],c.i64.to_string(d[17]),void 0,void 0],d[12]=a[0],d[13]=a[1],d[14]=a[2],d[15]=a[3],a}]):c.sequence([function(e){return a[1]==="32"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerUpdateThreadName"),a[0]).then(function(a){return a=a,d[20]=a[0],d[21]=a[1],d[22]=a[2],a})},function(a){return a=[d[20],c.i64.to_string(d[21]),void 0,d[22]],d[16]=a[0],d[17]=a[1],d[18]=a[2],d[19]=a[3],a}]):c.sequence([function(e){return a[1]==="362"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerAcsIssueNextSync"),a[0]).then(function(a){return a=a,d[24]=a[0],d[25]=a[1],d[26]=a[2],a})},function(a){return a=[d[24],c.i64.to_string(d[25]),void 0,d[26]],d[20]=a[0],d[21]=a[1],d[22]=a[2],d[23]=a[3],a}]):c.sequence([function(e){return a[1]==="50015"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerEncryptedBackupsRestoreWithSerializer"),a[0]).then(function(a){return a=a,d[28]=a[0],d[29]=a[1],d[30]=a[2],a})},function(a){return a=[d[28],c.i64.to_string(d[29]),void 0,d[30]],d[24]=a[0],d[25]=a[1],d[26]=a[2],d[27]=a[3],a}]):c.sequence([function(e){return a[1]==="319"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerEncryptedBackupAction"),a[0]).then(function(a){return a=a,d[32]=a[0],d[33]=a[1],d[34]=a[2],a})},function(a){return a=[d[32],c.i64.to_string(d[33]),void 0,d[34]],d[28]=a[0],d[29]=a[1],d[30]=a[2],d[31]=a[3],a}]):c.sequence([function(e){return a[1]==="50026"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerEncryptedBackupsUpload"),a[0]).then(function(a){return a=a,d[36]=a[0],d[37]=a[1],a})},function(a){return a=[d[36],c.i64.to_string(d[37]),void 0,void 0],d[32]=a[0],d[33]=a[1],d[34]=a[2],d[35]=a[3],a}]):c.sequence([function(e){return a[1]==="50042"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerEncryptedBackupsUploadProtobufOnly"),a[0]).then(function(a){return a=a,d[40]=a[0],d[41]=a[1],d[42]=a[2],a})},function(a){return a=[d[40],c.i64.to_string(d[41]),void 0,d[42]],d[36]=a[0],d[37]=a[1],d[38]=a[2],d[39]=a[3],a}]):c.sequence([function(e){return a[1]==="700"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerE2eeMetadataThreadIntegrityCheck"),a[0]).then(function(a){return a=a,d[44]=a[0],d[45]=a[1],d[46]=a[2],a})},function(a){return a=[d[44],c.i64.to_string(d[45]),void 0,d[46]],d[40]=a[0],d[41]=a[1],d[42]=a[2],d[43]=a[3],a}]):c.sequence([function(e){return a[1]==="705"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerE2eeMessageIntegrityCheckV2"),a[0]).then(function(a){return a=a,d[48]=a[0],d[49]=a[1],d[50]=a[2],a})},function(a){return a=[d[48],c.i64.to_string(d[49]),void 0,d[50]],d[44]=a[0],d[45]=a[1],d[46]=a[2],d[47]=a[3],a}]):c.sequence([function(e){return a[1]==="50043"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerEncryptedBackupsLoopingUpload"),a[0]).then(function(a){return a=a,d[52]=a[0],d[53]=a[1],d[54]=a[2],a})},function(a){return a=[d[52],c.i64.to_string(d[53]),void 0,d[54]],d[48]=a[0],d[49]=a[1],d[50]=a[2],d[51]=a[3],a}]):c.sequence([function(e){return a[1]==="50048"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerEncryptedBackupsOpenUpload"),a[0]).then(function(a){return a=a,d[56]=a[0],d[57]=a[1],a})},function(a){return a=[d[56],c.i64.to_string(d[57]),void 0,void 0],d[52]=a[0],d[53]=a[1],d[54]=a[2],d[55]=a[3],a}]):c.sequence([function(e){return a[1]==="160013"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerSyncThreadCapabilities"),a[0]).then(function(a){return a=a,d[60]=a[0],d[61]=a[1],d[62]=a[2],a})},function(a){return a=[d[60],c.i64.to_string(d[61]),void 0,d[62]],d[56]=a[0],d[57]=a[1],d[58]=a[2],d[59]=a[3],a}]):c.sequence([function(e){return a[1]==="903"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerDeleteChatHistory"),a[0]).then(function(a){return a=a,d[64]=a[0],d[65]=a[1],d[66]=a[2],a})},function(a){return a=[d[64],c.i64.to_string(d[65]),void 0,d[66]],d[60]=a[0],d[61]=a[1],d[62]=a[2],d[63]=a[3],a}]):c.sequence([function(e){return a[1]==="50057"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerEncryptedBackupsUploadSenderBackup"),a[0]).then(function(a){return a=a,d[68]=a[0],d[69]=a[1],d[70]=a[2],a})},function(a){return a=[d[68],c.i64.to_string(d[69]),void 0,d[70]],d[64]=a[0],d[65]=a[1],d[66]=a[2],d[67]=a[3],a}]):c.resolve((e=[a[2],a[1],void 0,void 0],d[64]=e[0],d[65]=e[1],d[66]=e[2],d[67]=e[3],e))},function(a){return a=[d[64],d[65],d[66],d[67]],d[60]=a[0],d[61]=a[1],d[62]=a[2],d[63]=a[3],a}])},function(a){return a=[d[60],d[61],d[62],d[63]],d[56]=a[0],d[57]=a[1],d[58]=a[2],d[59]=a[3],a}])},function(a){return a=[d[56],d[57],d[58],d[59]],d[52]=a[0],d[53]=a[1],d[54]=a[2],d[55]=a[3],a}])},function(a){return a=[d[52],d[53],d[54],d[55]],d[48]=a[0],d[49]=a[1],d[50]=a[2],d[51]=a[3],a}])},function(a){return a=[d[48],d[49],d[50],d[51]],d[44]=a[0],d[45]=a[1],d[46]=a[2],d[47]=a[3],a}])},function(a){return a=[d[44],d[45],d[46],d[47]],d[40]=a[0],d[41]=a[1],d[42]=a[2],d[43]=a[3],a}])},function(a){return a=[d[40],d[41],d[42],d[43]],d[36]=a[0],d[37]=a[1],d[38]=a[2],d[39]=a[3],a}])},function(a){return a=[d[36],d[37],d[38],d[39]],d[32]=a[0],d[33]=a[1],d[34]=a[2],d[35]=a[3],a}])},function(a){return a=[d[32],d[33],d[34],d[35]],d[28]=a[0],d[29]=a[1],d[30]=a[2],d[31]=a[3],a}])},function(a){return a=[d[28],d[29],d[30],d[31]],d[24]=a[0],d[25]=a[1],d[26]=a[2],d[27]=a[3],a}])},function(a){return a=[d[24],d[25],d[26],d[27]],d[20]=a[0],d[21]=a[1],d[22]=a[2],d[23]=a[3],a}])},function(a){return a=[d[20],d[21],d[22],d[23]],d[16]=a[0],d[17]=a[1],d[18]=a[2],d[19]=a[3],a}])},function(a){return a=[d[16],d[17],d[18],d[19]],d[12]=a[0],d[13]=a[1],d[14]=a[2],d[15]=a[3],a}])},function(a){return a=[d[12],d[13],d[14],d[15]],d[8]=a[0],d[9]=a[1],d[10]=a[2],d[11]=a[3],a}])},function(a){return a=[d[8],d[9],d[10],d[11]],d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[3],a}])},function(e){return a[3]?c.sequence([function(a){return d[9]="60009"===d[1]||"60006"===d[1]||"60008"===d[1]||"60011"===d[1]||"765"===d[1]||"1006"===d[1]||"160009"===d[1]||"761"===d[1]||"1018"===d[1]||"632"===d[1]||"384"===d[1]||"384"===d[1],d[9]?d[1]!==void 0?(d[15]=["Deidentified task is being executed through the 'identified' path. Canceling task with label: ",d[1]].join(""),function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSCoreSerializeTaskStoredProcedure] ","",d[15]].join("")),d[14]=c.createArray(),void 0!==void 0?d[16]=(d[14].push(void 0),d[14]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSCoreSerializeTaskStoredProcedure",d[15],d[14],c.i64.cast([0,3]))):c.resolve():c.resolve()},function(a){return c.resolve(d[8]=!1)},function(a){return d[9]||d[8]?(a=[void 0,void 0,void 0,void 0],d[10]=a[0],d[11]=a[1],d[12]=a[2],d[13]=a[3],a):(a=[d[0],d[1],d[2],d[3]],d[10]=a[0],d[11]=a[1],d[12]=a[2],d[13]=a[3],a),a=[d[10],d[11],d[12],d[13]],d[4]=a[0],d[5]=a[1],d[6]=a[2],d[7]=a[3],a}]):c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerUnauthenticatedTask"),a[0],d[1],d[0]).then(function(a){return a=a,d[8]=a[0],d[9]=a[1],d[10]=a[2],d[11]=a[3],a})},function(a){return c.i64.neq(d[11],void 0)?c.storedProcedure(b("LSForceTaskExecutionImmediately"),d[11]):c.resolve()},function(a){return a=[d[8],c.i64.to_string(d[9]),void 0,d[10]],d[4]=a[0],d[5]=a[1],d[6]=a[2],d[7]=a[3],a}])},function(a){return a=[d[4],d[5],d[6],d[7]],e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSCoreSerializeTaskStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSSerializeTaskStoredProcedure",["LSSerializeTask","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSSerializeTask"),e.taskId,e.taskLabel,e.taskValue,e.requiresAuthentication);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSBeginHandlingPendingTasksForQueue2",["I64","LSFactory","LSIntEnum","LSPendingTasksPluginType","LSSerializeTaskStoredProcedure","LSShape","LSVec","ReQL","XPlatReactCrypto","gkx","isNativeTask","qex"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=500,k=3e4,l=5,m=(b=c("qex")._("4835"))!=null?b:50,n=7;async function o(a,b){a=await a.lightspeed_task_context.get(b);return a==null||a.requiresAuthentication}async function p(a,b){a=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.pending_tasks.index("queueNameTaskId")).getKeyRange(b));return a==null?{context:void 0,failureCount:(h||(h=d("I64"))).neg_one,httpUrlOverride:void 0,minTimeToSyncTimestampMs:h.neg_one,pluginType:(i||(i=d("LSIntEnum"))).ofNumber(c("LSPendingTasksPluginType").LS_BROKER),queueName:""}:a}async function q(a,b){a=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.network_requests).getKeyRange(b));return a==null?0:(h||(h=d("I64"))).to_float(a.lastSyncRequestTimestampMs)}function r(a,b,c){b=(h||(h=d("I64"))).equal(a.failureCount,(h||(h=d("I64"))).zero)||b;if(b)return 0;b=(h||(h=d("I64"))).to_float(a.failureCount)>n?(h||(h=d("I64"))).to_float(a.failureCount)-n:(h||(h=d("I64"))).to_float(a.failureCount);a=Math.min((1<<Math.min(b-1,n))*j,k);b=c+a;return Math.max(b-Date.now(),0)}function s(){var a=Array.from(d("XPlatReactCrypto").getRandomValues(new Uint32Array(2)));a[0]>>>=1;return(h||(h=d("I64"))).add(h.lsl_(h.of_float(a[0]),32),h.of_float(a[1]))}function t(){var a=(h||(h=d("I64"))).of_float(Date.now());return h.and_(h.or_(h.lsl_(a,22),h.and_(s(),h.castExn([0,4194303]))),h.castExn([2147483647,4294967295]))}async function u(a,b){var c=t(),e=await a.network_requests.get(b,(h||(h=d("I64"))).neg_one);e==null?await a.network_requests.add({epochId:c,failureCount:(h||(h=d("I64"))).zero,lastSentTimestampMs:h.zero,lastSyncRequestTimestampMs:h.of_float(Date.now()),syncDatabaseId:h.neg_one,taskQueueName:b}):await a.network_requests.put(babelHelpers.extends({},e,{epochId:c,lastSyncRequestTimestampMs:(h||(h=d("I64"))).of_float(Date.now())}));return c}async function v(a,b){return await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.network_requests).getKeyRange(b).filter(function(a){return a.epochId!=null}))!=null}function w(a,b,c){var e=(h||(h=d("I64"))).to_float(a.minTimeToSyncTimestampMs),f=Date.now();e=e-f;f=e<=0;return f?r(a,b,c):e}function x(a){return a.httpUrlOverride!=null||(h||(h=d("I64"))).to_float(a.failureCount)>n}function y(a){return a.timeoutTimestampMs!=null?(h||(h=d("I64"))).to_float(a.timeoutTimestampMs)<=Date.now():!1}function z(a){return a===90..toString()||a===130..toString()||a===153..toString()}function A(a,b,c,d,e){e=e===0?void 0:e;return{failureCount:e,label:a,payload:b,queueName:c,taskId:d}}async function B(a,b,e){a=await c("LSSerializeTaskStoredProcedure")(c("LSFactory")(a),{requiresAuthentication:e,taskId:b.taskId,taskLabel:b.context,taskValue:b.taskValue});e=a[0];var f=a[1];a[2];a=a[3];if(e==null){if(a!=null)return{minRetryDelayMs:a};return}return A(f,e,b.queueName,b.taskId,(h||(h=d("I64"))).to_float(b.failureCount))}async function C(a,b,c){if(b.context==null){await a.pending_tasks.delete(b.taskId);return}var d=y(b);if(d){await a.pending_tasks.delete(b.taskId);return}return B(a,b,c)}function D(a,b){b=b>=(c("gkx")("26373")&&a===String(207)?m:l)||z(a);return!b}async function E(a,b){var c=await a.pending_tasks.get(b.taskId);c!=null&&(h||(h=d("I64"))).equal(b.firstExecutedTimestampMs,(h||(h=d("I64"))).zero)&&await a.pending_tasks.put(babelHelpers.extends({},c,{firstExecutedTimestampMs:(h||(h=d("I64"))).of_float(Date.now())}))}async function F(a,b){if(b.length===0)return{epochId:void 0,tasks:[]};var c=[],e=b[0].httpUrlOverride,f=(await Promise.all(b.map(function(b){return o(a,b.taskId)}))).some(Boolean);for(b of b){var g=b.httpUrlOverride===e,i=await o(a,b.taskId)===f;await E(a,b);if(!g||!i)break;g=await C(a,b,f);if(g!=null&&g.payload!=null)c.push(g);else if((g==null?void 0:g.minRetryDelayMs)!=null){i=await a.pending_tasks.get(b.taskId);if(i!=null){await a.pending_tasks.put(babelHelpers.extends({},i,{failureCount:(h||(h=d("I64"))).add((i=i.failureCount)!=null?i:(h||(h=d("I64"))).zero,h.one),minTimeToSyncTimestampMs:h.add(g.minRetryDelayMs,h.of_float(Date.now()))}))}}else await a.pending_tasks.delete(b.taskId);if(!D(b.context,c.length))break}return{epochId:void 0,tasks:c}}async function G(a,b,c,d,e){e===void 0&&(e=!0);b=await F(a,b);var f=b.tasks;if(f.length===0)return{httpUrlOverride:void 0,networkPayload:void 0,nextSyncMs:void 0,queueName:c,skipRealtimeGateway:!1,workItemType:4};if(e===!0){f=await u(a,c);b.epochId=f}e=await p(a,c);return{httpUrlOverride:e.httpUrlOverride,networkPayload:b,nextSyncMs:void 0,queueName:c,skipRealtimeGateway:x(e),workItemType:d}}async function H(a,b,e){var f=await p(a,b),g=await q(a,b);f=w(f,e,g);e=f!==0;if(e)return[{httpUrlOverride:void 0,networkPayload:void 0,nextSyncMs:f,queueName:b,skipRealtimeGateway:!1,workItemType:3}];g=[];e=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.pending_tasks.index("queueNameTaskId")).getKeyRange(b));f=e.filter(c("isNativeTask"));if(f.length>0){f=await G(a,f,b,2,c("gkx")("4778")===!0);g.push(f)}f=e.filter(function(a){return!c("isNativeTask")(a)});if(f.length>0){e=await G(a,f,b,1);g.push(e)}return g}async function I(a,b,c){var d=!await v(a,b);return d?H(a,b,c):[{httpUrlOverride:void 0,networkPayload:void 0,nextSyncMs:void 0,queueName:b,skipRealtimeGateway:!1,workItemType:4}]}async function a(a,b){var e=b.ignoreSoftDelay;b=b.queueName;a=await I(a,b,e);return a.map(function(a){var b;return d("LSShape").ofRecord({network_payload:d("LSShape").ofRecord({epoch_id:(b=a.networkPayload)==null?void 0:b.epochId,tasks:c("LSVec").ofArray(((b=(b=a.networkPayload)==null?void 0:b.tasks)!=null?b:[]).map(function(a){var b;return d("LSShape").ofRecord({failure_count:a.failureCount!=null?(h||(h=d("I64"))).of_float(a.failureCount):void 0,label:(b=a.label)!=null?b:void 0,payload:a.payload,queue_name:a.queueName,task_id:a.taskId})}))}),next_sync_ms:a.nextSyncMs!=null?(h||(h=d("I64"))).of_float(a.nextSyncMs):void 0,queue_name:a.queueName,skip_realtime_gateway:a.skipRealtimeGateway,work_item_type:(i||(i=d("LSIntEnum"))).ofNumber(a.workItemType)})})}a._updateTaskIfNeeded=E;a._getHeadOfNormalQueue=p;a._lastSyncRequestTimestampForQueue=q;a._exponentialBackoffForNormalQueue=r;a._generateNewEpoch=t;a._openNewEpochForQueue=u;a._isEpochOpenForQueue=v;a._calculateDelayForNormalQueue=w;a._queueShouldSkipRealtimeGateway=x;a._isNativeTask=c("isNativeTask");a._taskIsTimedOut=y;a._taskShouldStopBatching=z;a._buildTaskPayloadExpressionForNormalTaskWithParameters=A;a._buildTaskPayloadExpressionForValidatedNormalTask=B;a._buildTaskPayloadExpressionForUnvalidatedNormalTask=C;a._workForNormalQueueWithoutDelay=G;a._workForNormalQueueWithClosedEpoch=H;a._buildWorkForNormalQueue=I;a._buildNetworkPayloadShapeForTasks=F;a._canContinueBatchingForQueue=D;g.default=a}),98);
__d("LSDataTraceFlushDeferred",["MetaConfig","Promise","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("LSDataTraceFlush").__setRef("LSDataTraceFlushDeferred");function a(a){if(!c("MetaConfig")._("62"))return(h||(h=b("Promise"))).resolve(function(){});else return i.load().then(function(b){return b.flushExpiredDataTraces(a)})}g.watchForExpiredTraces=a}),98);
__d("LSDedicatedMqttChannel",["FBMqttChannel","cr:1232"],(function(a,b,c,d,e,f,g){"use strict";function a(){b("cr:1232")!=null&&b("cr:1232").shutdownAndClear()}function d(a,d,e,f,g,h){return function(i){if(b("cr:1232")!=null)return b("cr:1232").getInstance(i,a,d,e,f,g,h);else return c("FBMqttChannel")}}g.shutdownAndClear=a;g.getInstance=d}),98);
__d("LSTruncateTableAndSetShowError",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(d){return b.sequence([function(a){return b.forEach(b.db.table(115).fetch(),function(a){return a["delete"]()})},function(d){return c[0]=b.i64.of_float(Date.now()),b.db.table(115).add({statusId:b.i64.cast([0,0]),timestampMs:c[0],errorShouldBeShown:a[0]})}])},function(a){return b.resolve(d)}])}a.__sproc_name__="LSConnectivityTruncateTableAndSetShowErrorStoredProcedure";a.__tables__=["user_visible_network_connectivity_error"];e.exports=a}),null);
__d("LSDeleteAllAndInsertConnectivityStatus",["LSTruncateTableAndSetShowError"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(a){return c.forEach(c.db.table(114).fetch(),function(a){return a["delete"]()})},function(b){return d[0]=c.i64.of_float(Date.now()),c.db.table(114).add({statusId:void 0,timestampMs:d[0],internetConnectionState:a[0]})},function(d){return c.storedProcedure(b("LSTruncateTableAndSetShowError"),c.i64.neq(a[0],c.i64.cast([0,1])))}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSConnectivityDeleteAllAndInsertConnectivityStatusStoredProcedure";a.__tables__=["connectivity_status"];e.exports=a}),null);
__d("LSDeleteAllAndInsertConnectivityStatusStoredProcedure",["LSDeleteAllAndInsertConnectivityStatus","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSDeleteAllAndInsertConnectivityStatus"),e.internetConnectionState);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSFetchBackupIds",["LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsFetchBackupIdsStoredProcedure] Beginning execution."),d[11]=c.i64.cast([0,0]),d[7]=d[11],d[8]=new c.Map(),d[8].set("backup_tenancy",a[0]),d[8].set("trace_id",void 0),d[9]=c.toJSON(d[8]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",c.i64.cast([0,50008]),d[9],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,d[7]).then(function(a){return a=a,d[10]=a[0],a})},function(a){return d[1]=c.i64.of_float(Date.now()),d[2]=c.i64.random(),d[4]="Finishing execution. Execution time: ",d[5]=c.i64.to_string(c.i64.sub(d[1],d[0])),d[6]=" ms",d[3]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsFetchBackupIdsStoredProcedure] ",d[3],d[4],d[3],d[5],d[3],d[6]].join("")),c.i64.eq(c.i64.mod_(d[2],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[7]=",",d[8]=c.createArray(),void 0!==void 0?d[9]=(d[8].push(void 0),d[8]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFetchBackupIdsStoredProcedure",[d[4],d[7],d[5],d[7],d[6]].join(""),d[8],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsFetchBackupIdsStoredProcedure";a.__tables__=["encrypted_backups"];e.exports=a}),null);
__d("LSFetchBackupIdsStoredProcedure",["LSFetchBackupIds","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSFetchBackupIds"),e.backupTenancy,e.traceId,e.isUiBlocking);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSSyncStoredProcedureUtils",["I64","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h;async function i(a,b,c){c=c!=null?(h||(h=d("I64"))).of_float(Date.now()+c):b.minTimeToSyncTimestampMs;await a.pending_tasks.put(babelHelpers.extends({},b,{failureCount:(h||(h=d("I64"))).add(b.failureCount,h.one),minTimeToSyncTimestampMs:c}))}async function a(a,b,c){b=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.pending_tasks.index("queueNameTaskId")).getKeyRange(b));if(b==null)return;return i(a,b,c)}async function b(a,b,c){b=await a.network_requests.get(b,c);if(b==null)return;await a.network_requests.put(babelHelpers.extends({},b,{failureCount:(h||(h=d("I64"))).add(b==null?void 0:b.failureCount,h.one)}))}async function c(a,b,c){b=await a.network_requests.get(b,c);if(b==null)return;await a.network_requests.put(babelHelpers.extends({},b,{epochId:void 0,networkTaskIdentifier:void 0}))}g.incrementPendingTaskFailureCount=i;g.incrementPendingTasksTaskFailureCount=a;g.incrementNetworkRequestsTaskFailureCount=b;g.closeEpoch=c}),98);
__d("LSHandleTaskSendFailureForQueue2",["I64","LSSyncStoredProcedureUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;async function a(a,b,c){await d("LSSyncStoredProcedureUtils").incrementPendingTasksTaskFailureCount(a,b,c),await d("LSSyncStoredProcedureUtils").incrementNetworkRequestsTaskFailureCount(a,b,(h||(h=d("I64"))).neg_one),await d("LSSyncStoredProcedureUtils").closeEpoch(a,b,h.neg_one)}g.default=a}),98);
__d("LSHandleTaskSendSuccessForQueue2",["I64"],(function(a,b,c,d,e,f,g){"use strict";var h;async function a(a,b){var c=await a.network_requests.get(b,(h||(h=d("I64"))).neg_one);if(c==null||c.epochId==null)return;await a.network_requests.delete(b,h.neg_one)}g.default=a}),98);
__d("LSPlatformDefaultUnderlyingApi",["Promise","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){return c("emptyFunction")}function d(){return(h||(h=b("Promise"))).resolve()}e={cleanup:c("emptyFunction"),logEvent:function(a){},onConnectionStatusChange:a,onReconnect:a,publish:d,subscribe:a};g["default"]=e}),98);
__d("MessengerPWAVersionForUserAgent",["isMessengerPWA","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function a(){if(!c("justknobx")._("3005"))return void 0;var a=c("isMessengerPWA")();if(!a)return void 0;a=(a=new URL(window.location.href).searchParams.get("__pwa"))!=null?a:"1.0.0";return a}g["default"]=a}),98);
__d("LSPlatformRealtimeTransport",["CurrentEnvironment","I64","LSDynamicDependencies","LSIntEnum","LSJson","LSMailboxInitialSyncCursor","LSShape","MessengerPWAVersionForUserAgent","Promise","clearTimeout","promiseDone","qex","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=(c("CurrentEnvironment").facebookdotcom||c("CurrentEnvironment").messengerdotcom)&&((e=c("qex")._("512"))!=null?e:!1);f="LSPlatformRealtimeTransport.NotConnected";var l="LSPlatformRealtimeTransport.Timeout";function m(a){var b=new Map();return{getAll:function(){return Array.from(b.values())},getOrStart:function(c){var d=c.toString(),e=b.get(d);e==null&&(e=a(c),b.set(d,e));return e}}}function n(){}function a(a,e,f){var g=new Map(),o={contents:n},p=new Set(),q=new Map(),r=[],s=m(function(b){b=a(b,f);r.push(b.subscribe(function(a){var b=JSON.parse(a),e=d("LSDynamicDependencies").downloadBootloaderDependencies(b.sp,b.nop,b.ntop);a=b.request_id;var f;if(a!=null){var h=g.get(a);h==null?f=!1:(c("clearTimeout")(h.timeoutId),h.resolve({downloadTask:e,payload:b,type:"taskresponse"}),g["delete"](a),f=!0)}else f=!1;if(!f){Array.from(q.entries()).forEach(function(a){return a[1](e,b)});return}}));r.push(b.onReconnect(function(){return o.contents()}));r.push(b.onConnectionStatusChange(function(a){p.forEach(function(b){return b(a)})}));return b});k?(s.getOrStart((i||(i=d("LSIntEnum"))).unwrapIntEnum((j||(j=d("I64"))).of_int32(3))),s.getOrStart(i.unwrapIntEnum(j.of_int32(1)))):s.getOrStart((i||(i=d("LSIntEnum"))).unwrapIntEnum(d("LSMailboxInitialSyncCursor").syncChannel));return{cleanup:function(){r.forEach(function(a){return a()}),s.getAll().forEach(function(a){return a.cleanup()})},logEvent:function(a){s.getAll().forEach(function(b){return b.logEvent(a)})},onConnectionStatusChange:function(a){p.add(a);return function(){p["delete"](a)}},onReconnect:function(a){o.contents=a;return function(){o.contents=n}},publish:function(a){var f=a.databaseType,k=a.payload,m=a.queueName,n=a.requestId,o=a.syncChannel,p=a.type_;return new(h||(h=b("Promise")))(function(a,b){var h=s.getOrStart((i||(i=d("LSIntEnum"))).unwrapIntEnum(o));if((j||(j=d("I64"))).equal(p,(i||(i=d("LSIntEnum"))).ofNumber(3))){var q=c("setTimeout")(function(){h.logEvent("Timeout");var a=g.get(n);a!=null&&(g["delete"](n),a.reject({RE_EXN_ID:l}));return b({RE_EXN_ID:l})},3e4);g.set(n,{queueName:m,reject:b,resolve:a,timeoutId:q,timestamp:Date.now()})}q=c("MessengerPWAVersionForUserAgent")();c("promiseDone")(h.publish(d("LSJson").stringify(d("LSShape").ofRecord(babelHelpers["extends"]({app_id:e,payload:k},q!=null?{pwa_version:q}:{},{request_id:n,type:p}))),p,f),function(){if(!(j||(j=d("I64"))).equal(p,(i||(i=d("LSIntEnum"))).ofNumber(3)))return a({type:"noresponseexpected"})},function(a){b(a)})})},subscribeToNonTaskResponses:function(a){var b={};q.set(b,a);return function(){q["delete"](b)}}}}g.NotConnected=f;g.Timeout=l;g.LSPlatformRealtimeTransport=a}),98);
__d("shouldStubUnderlyingTransport",["ExecutionEnvironment"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){return!(h||(h=c("ExecutionEnvironment"))).canUseDOM&&!(h||(h=c("ExecutionEnvironment"))).isInWorker}g["default"]=a}),98);
__d("LSPlatformMqttRealtimeTransport",["I64","LSIntEnum","LSPlatformDefaultUnderlyingApi","LSPlatformRealtimeTransport","Promise","promiseDone","shouldStubUnderlyingTransport"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(a){return[{payload:JSON.stringify({ls_fdid:"",ls_sv:a}),qos:1,topic:"/ls_app_settings"}]}function l(a){var e={contents:a.getConnectionState()},f={contents:function(){}},g={contents:new(j||(j=b("Promise")))(function(a,b){f.contents=a})},k={onMQTTStateChanged:function(a){a==="Connected"?f.contents():a==="Disconnected"&&e.contents==="Connected"&&(g.contents=new(j||(j=b("Promise")))(function(a,b){f.contents=a})),e.contents=a}};e.contents==="Connected"&&f.contents();a.subscribeChannelEvents(k);return[function(){a.unsubscribeChannelEvents(k)},function(e,f,k){return g.contents.then(function(){return new(j||(j=b("Promise")))(function(b,g){c("promiseDone")(a.publish("/ls_req",e,{listener:{onEvent:function(a){if(a==="NOT_CONNECTED")return g({RE_EXN_ID:d("LSPlatformRealtimeTransport").NotConnected})}},qos:(h||(h=d("I64"))).equal(f,(i||(i=d("LSIntEnum"))).ofNumber(4))?0:1,skipBuffer:!1}),function(){return b()},function(a){if(a.message==="Publish Timed Out")return g({RE_EXN_ID:d("LSPlatformRealtimeTransport").Timeout});else return g(a)})})})}]}var m={contents:void 0};function a(a,b,d){if(c("shouldStubUnderlyingTransport")())return c("LSPlatformDefaultUnderlyingApi");var e=d.getInstance(b),f={getPublishMessages:function(){return k(a)}};e.registerExtraConnectPayloadProvider(f);var g={onMQTTStateChanged:function(a){var b=m.contents;if(b!=null)return b(a)}};e.subscribeChannelEvents(g);var h=e.subscribe("/ls_foreground_state",function(){});b=l(e);var i=b[0];b=b[1];return{cleanup:function(){e.unregisterExtraConnectPayloadProvider(f),d.shutdownAndClear(),e.unsubscribeChannelEvents(g),h(),i()},logEvent:function(a){},onConnectionStatusChange:function(a){m.contents=a;return function(){m.contents=void 0}},onReconnect:function(a){var b={contents:e.getConnectionState()},c={contents:b.contents==="Connected"},d={onMQTTStateChanged:function(d){d==="Connected"&&(c.contents&&b.contents!=="Connected"&&a(),c.contents=!0),b.contents=d}};e.subscribeChannelEvents(d);return function(){e.unsubscribeChannelEvents(d)}},publish:b,subscribe:function(a){return e.subscribe("/ls_resp",function(b){return a(b)})}}}g["default"]=a}),98);
__d("LSPlatformRequestId",[],(function(a,b,c,d,e,f){"use strict";var g=4;function a(){var a=g;g+=1;return a}b={generate:a};f["default"]=b}),66);
__d("LSPlatformRequestScheduler",["clearTimeout","justknobx","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h=Math.pow(2,31)-1;a=function(){function a(){this.requests=new Map()}var b=a.prototype;b.schedule=function(a,b,d){var e=this.requests.get(b);e!=null&&c("clearTimeout")(e);e=c("justknobx")._("4435")?Math.min(d,h):d;this.requests.set(b,c("setTimeout")(a,e))};b.cleanup=function(){this.requests.forEach(function(a){return c("clearTimeout")(a)})};return a}();g["default"]=a}),98);
__d("LSPlatformServerResponseHandler",["FBLogger","clearTimeout","nullthrows","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h="executeFirstBlockForSyncTransaction";a=function(){function a(a){this.eval=a,this.currentlyRunning=new Map()}var b=a.prototype;b.evalWhenReady=async function(a,b){var d;try{await a,d=c("setTimeout")(function(){c("FBLogger")("messenger_web").mustfix("waited longer than 30 seconds to eval sync script")},3e4),await this.eval(b)}finally{c("clearTimeout")(d)}};b.$1=function(a){var b=this.currentlyRunning.get(a);b==null&&(b=Promise.resolve(),this.currentlyRunning.set(a,b));return b};a.getSyncScriptType=function(a){var b;if(!((b=a.sp)==null?void 0:b.includes(h)))return{status:"non-transactional"};b=function(){try{var b;return(b=JSON.parse(a.syncScript))==null?void 0:b.step}catch(a){return null}}();if(!Array.isArray(b)){c("FBLogger")("messenger_web").warn("Sync payload appears invalid.");return{status:"non-transactional"}}b=[b];while(b.length){var d=c("nullthrows")(b.shift());for(d of d)if(Array.isArray(d)){if(d[0]===5&&d[1]===h&&Array.isArray(d[2]))return{status:"transactional",syncGroup:parseInt(d[2][1],10)};b.push(d)}}return{status:"err"}};b.maybeEvalInOrderReceived=function(b,d){var e,f=this,g=a.getSyncScriptType(d),h=0;switch(g.status){case"err":c("FBLogger")("messenger_web").warn("Sync script sync group parsing failed: employed sprocs were %s",JSON.stringify((e=d.sp)!=null?e:void 0));break;case"non-transactional":return this.evalWhenReady(b,d);case"transactional":h=g.syncGroup;break}e=this.$1(h);g=e.then(function(){return f.evalWhenReady(b,babelHelpers.extends({},d,{priority:"sync_script"}))}).catch(function(a){f.currentlyRunning.delete(h);throw a});this.currentlyRunning.set(h,g);return g};return a}();g.default=a}),98);
__d("LSPlatformTaskSyncGroupId",[],(function(a,b,c,d,e,f){"use strict";a=-1;b=a;f["default"]=b}),66);
__d("MWPBeginHandlingPendingTasksForQueue",["LSBeginHandlingFireForgetTasksForQueueStoredProcedure","LSBeginHandlingPendingTasksForQueue2","LSFactory"],(function(a,b,c,d,e,f,g){"use strict";async function a(a,b){var d=b.fireAndForgetTask,e=b.ignoreSoftDelay,g=b.queueName;b=await a.runInTransaction(async function(a){if(d===!0){var b=await c("LSBeginHandlingFireForgetTasksForQueueStoredProcedure")(c("LSFactory")(a),{queueName:g});b=b[0];return[b]}return c("LSBeginHandlingPendingTasksForQueue2")(a,{ignoreSoftDelay:e,queueName:g})},"readwrite",void 0,void 0,f.id+":37");return b}g.default=a}),98);
__d("MWPlatformTaskUtils",["FBLogger","I64","JSScheduler","MetaConfig","ReQL","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,b){async function e(){try{await a(b)}catch(a){c("FBLogger")("messenger_web").catching(a).warn("Failed to calculate work for task queue %s",b.queueName)}}if((i||(i=d("I64"))).gt(b.priority,(i||(i=d("I64"))).zero)&&c("MetaConfig")._("78")){var f=function(){e()};(h||(h=c("JSScheduler"))).scheduleLoggingPriCallback(f)}else c("promiseDone")(e())}async function k(a,b){try{await a(b)}catch(a){c("FBLogger")("messenger_web").catching(a).warn("Failed to calculate work for fire forget queue %s",b.queueName)}}function a(a,b){var c=new Set(),e=[],f=[];f.push(a.tables.pending_tasks.index("queueNameTaskId").subscribe(function(a,b){var f;if(b.operation==="delete"){c.add(a[0]);return}a=b.operation==="put"&&b.prevValue==null||b.operation==="add";f=b.operation==="put"&&(i||(i=d("I64"))).compare(b.value.failureCount,(f=(f=b.prevValue)==null?void 0:f.failureCount)!=null?f:(i||(i=d("I64"))).zero)>0;(a||f)&&c.add(b.value.queueName);(b.operation==="add"&&b.value.dataTraceId==null||b.value.dataTraceId==="")&&e.push(b.value)}));f.push(a.tables.network_requests.subscribe(function(a,b){a=a[0];if(a==="")return;b.operation==="delete"?c.add(a):b.value.epochId==null&&c.add(a)}));f.push(a.subscribeToCommit(function(){var f=Array.from(c);c.clear();e=[];f.forEach(async function(c){c=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.pending_tasks.index("queueNameTaskId")).bounds({gte:[c]}));c!=null&&j(b,c)})}));return f}function b(a,b){c("promiseDone")(async function(){var c=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.tables.pending_tasks)),e=new Set();for(c of c){if(e.has(c.queueName))continue;e.add(c.queueName);j(b,c)}}())}function l(a,b){c("promiseDone")(async function(){var e=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.tables.pending_fire_and_forget_tasks));await Promise.all(e.map(function(a){return k(b,a)}));c("promiseDone")(a.runInTransaction(function(a){return Promise.all(e.map(function(b){return a.pending_fire_and_forget_tasks.delete(b.taskId)}))},"readwrite","background",void 0,f.id+":196"))}())}function e(a,b){var c=!1,d=[];d.push(a.tables.pending_fire_and_forget_tasks.subscribe(function(a,b){if(b.operation==="delete")return;a=b.operation==="put"&&b.prevValue==null||b.operation==="add";a&&(c=!0)}));d.push(a.subscribeToCommit(function(){c&&l(a,b),c=!1}));return d}g.checkQueuesWhenPendingTaskTableUpdates=a;g.checkAllPendingTasksForWork=b;g.checkAllFireForgetTasksForWork=l;g.checkQueuesWhenPendingFireForgetTaskTableUpdates=e}),98);
__d("LSPlatformTaskSystemTransport",["CurrentMessengerUser","FBLogger","I64","JSResourceForInteraction","JSScheduler","LSDatabaseProviderType","LSHandleTaskSendFailureForQueue2","LSHandleTaskSendSuccessForQueue2","LSIntEnum","LSJson","LSMailboxInitialSyncCursor","LSPlatformRealtimeTransport","LSPlatformRequestId","LSPlatformRequestScheduler","LSPlatformServerResponseHandler","LSPlatformTaskSyncGroupId","LSShape","LSVec","MWPBeginHandlingPendingTasksForQueue","MWPBumpEntityKey","MWPlatformTaskUtils","ReQL","cr:4031","cr:6668","gkx","isInstamadillo","justknobx","promiseDone","qex"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=500,l=c("JSResourceForInteraction")("publishLSPlatformDeidentifiedPayload").__setRef("LSPlatformTaskSystemTransport"),m=new Set([632,765,60011,1006,1018].map(function(a){return a.toString()}));a=function(){function a(a,b,e,f){var g=this;this.key="ls";this.$8=!1;this.$18=async function(a,b){b=await c("MWPBeginHandlingPendingTasksForQueue")(g.$1,{ignoreSoftDelay:b,queueName:a});for(a of b)await g.$17(d("LSShape").toRecord(a))};this.$1=a;this.$2=b;this.$3=e;this.$4=f;this.$8=d("LSDatabaseProviderType").isProviderPersisted(a);this.$5=new(c("LSPlatformRequestScheduler"))();this.$6=new(c("LSPlatformServerResponseHandler"))(e);this.$7=this.$9();this.$10()}var e=a.prototype;e.$11=async function(a,b){if(!(c("justknobx")._("3637")||c("isInstamadillo")())){var d=await this.$2.publish(b);return d}d=a.filter(function(a){return a.label!=null&&m.has(a.label)});if(d.length<a.length){d.length>0&&c("FBLogger")("maw_ohai").mustfix("Deidentifed tasks label %s sent together with normal tasks",d[0].label);a=await this.$2.publish(b);return a}a=d[0];d=await l.load();d=await d(babelHelpers.extends({},b,{taskLabel:a.label}));return d};e.$12=async function(a){await this.$1.runInTransaction(function(b){return c("LSHandleTaskSendFailureForQueue2")(b,a)},"readwrite",void 0,void 0,f.id+":157")};e.$13=async function(a){await this.$1.runInTransaction(function(b){return c("LSHandleTaskSendSuccessForQueue2")(b,a)},"readwrite","background",void 0,f.id+":166")};e.$14=async function(a){a=c("LSVec").toArray(a.tasks).slice(0).map(function(a){return d("LSShape").toRecord(a)});a=a[0];if(a==null)return;a=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(this.$1.tables.pending_tasks).getKeyRange(a.task_id));return a==null?void 0:a.dataTraceId};e.$15=async function(a,e){var f=this;if(a.network_payload==null)return;var g=d("LSShape").toRecord(a.network_payload);(j||(j=c("JSScheduler"))).scheduleLoggingPriCallback(function(){return g&&(b("cr:6668")==null?void 0:b("cr:6668").recordTaskSending(g.tasks))});var i=this.$4;try{await Promise.all(c("LSVec").toArray(g.tasks).map(function(a){return d("LSShape").toRecord(a)}).map(function(b){var g=c("LSPlatformRequestId").generate();return f.$11([b],{databaseType:c("LSPlatformTaskSyncGroupId"),payload:d("LSJson").stringify(d("LSShape").ofRecord({label:b.label,payload:b.payload,version:i})),queueName:a.queue_name,requestId:g,syncChannel:d("LSMailboxInitialSyncCursor").taskChannel,type_:(h||(h=d("I64"))).of_int32(e)})}))}catch(a){}};e.$16=async function(a,e){if(a.network_payload==null)return;var f=d("LSShape").toRecord(a.network_payload),g=c("LSVec").toArray(f.tasks).map(function(a){return d("LSShape").toRecord(a)}),k=await this.$14(f);(j||(j=c("JSScheduler"))).scheduleLoggingPriCallback(function(){return f&&(b("cr:6668")==null?void 0:b("cr:6668").recordTaskSending(f.tasks))});var l=c("LSPlatformRequestId").generate(),m,n=c("qex")._("789");if(n!=null&&n!=="default"){var o=n+"."+(i||(i=d("LSIntEnum"))).toNumber(d("LSMailboxInitialSyncCursor").taskChannel)+"."+e.toString();d("MWPBumpEntityKey").bumpEntityKeyWithAppId("messenger.lightspeed",o)}try{m=await this.$11(g,{databaseType:c("LSPlatformTaskSyncGroupId"),payload:d("LSJson").stringify(d("LSShape").ofRecord(babelHelpers.extends({},f,{version_id:this.$4},k==null?{}:{data_trace_id:k}))),queueName:a.queue_name,requestId:l,syncChannel:d("LSMailboxInitialSyncCursor").taskChannel,type_:(h||(h=d("I64"))).of_int32(e)})}catch(b){if(n!=null&&n!=="default"){o=n+"."+(i||(i=d("LSIntEnum"))).toNumber(d("LSMailboxInitialSyncCursor").taskChannel)+"."+e.toString();d("MWPBumpEntityKey").bumpEntityKeyWithAppId("messenger.lightspeed",o+".exception");b.RE_EXN_ID===d("LSPlatformRealtimeTransport").Timeout?d("MWPBumpEntityKey").bumpEntityKeyWithAppId("messenger.lightspeed",o+".exception.timeout"):b.RE_EXN_ID===d("LSPlatformRealtimeTransport").NotConnected&&d("MWPBumpEntityKey").bumpEntityKeyWithAppId("messenger.lightspeed",o+".exception.notconnected")}b.RE_EXN_ID===d("LSPlatformRealtimeTransport").Timeout?d("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_tasks","send_fail_timeout"):b.RE_EXN_ID===d("LSPlatformRealtimeTransport").NotConnected?(d("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_tasks","send_fail_notconnected"),c("FBLogger")("messenger_web").warn("Publishing a task to the server not connected")):(d("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_tasks","send_fail_generic"),c("FBLogger")("messenger_web").warn("Error while publishing a task for request: %s, error %s",e,JSON.stringify(b)));await this.$12(a.queue_name)}if(m!=null&&m.type==="taskresponse")try{k=m.downloadTask;var p=m.payload;l={experiments:p.ex,sp:p.sp,syncScript:p.payload,target:p.target,taskNames:g.map(function(a){return a.label}).filter(Boolean)};this.$8||c("gkx")("10470")?await this.$6.evalWhenReady(k,l):await this.$3(l);await this.$13(a.queue_name);(j||(j=c("JSScheduler"))).scheduleLoggingPriCallback(function(){return f&&(b("cr:6668")==null?void 0:b("cr:6668").recordTaskSent(f.tasks,p.payload))})}catch(b){d("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_tasks","handle_task_failure"),c("FBLogger")("messenger_web").catching(b).mustfix("Encountered an error while processing a task response via realtime transport"),await this.$12(a.queue_name)}};e.decideWhatToDoWithTask=async function(a,b,e,f){var g=this,h=await c("MWPBeginHandlingPendingTasksForQueue")(a,{fireAndForgetTask:f,ignoreSoftDelay:!1,queueName:b,transportKey:e});c("promiseDone")(async function(){for(var a of h)await g.$17(d("LSShape").toRecord(a))}())};e.$17=async function(a){var e=this.$5,f=this.$18;function g(a,b){e.schedule(function(){c("promiseDone")(f(a,!1))},a,b!=null?(h||(h=d("I64"))).to_float(b):k)}var i=(h||(h=d("I64"))).to_int32(a.work_item_type);switch(i){case 1:await this.$16(a,3);break;case 5:await this.$15(a,4);break;case 3:g(a.queue_name,a.next_sync_ms);break;case 2:await b("cr:4031").handleLSWork(this.$1,a,d("CurrentMessengerUser").getAccountID());break;case 4:break;default:c("FBLogger")("messenger_web").warn("Unknown Task type of %s",i)}};e.$9=function(){var a=this,b=this.$1;return this.$2.onReconnect(function(){c("promiseDone")(b.runInTransaction(async function(a){var b=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.network_requests).bounds({gte:d("ReQL").key("")}));await Promise.all(b.map(function(b){b=b.taskQueueName;return c("LSHandleTaskSendFailureForQueue2")(a,b)}))},"readwrite",void 0,void 0,f.id+":473")),a.$10()})};e.$10=function(){var a=this;d("MWPlatformTaskUtils").checkAllPendingTasksForWork(this.$1,function(b){b=b.queueName;return a.decideWhatToDoWithTask(a.$1,b)})};e.cleanup=function(){this.$7()};return a}();g.default=a}),98);
__d("LSProcessBackupIds",["LSAppendDataTraceAddon","LSIsMobileClient","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsProcessBackupIdsStoredProcedure] Beginning execution."),c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1487]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[9]=a[0],a})},function(a){return d[9]?d[10]=!0:d[10]=!1,d[10]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[12]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[12]].join("")),d[11]=c.createArray(),void 0!==void 0?d[13]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[12],d[11],c.i64.cast([0,3]))):c.resolve()}])},function(e){return c.db.table(172).fetch([[[c.i64.cast([0,1])]]]).next().then(function(e,f){var g=e.done;e=e.value;return g?c.sequence([function(e){return c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1488]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[9]=a[0],a})},function(a){return d[9]?d[10]=!0:d[10]=!1,d[10]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[12]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[12]].join("")),d[11]=c.createArray(),void 0!==void 0?d[13]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[12],d[11],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[1]=c.i64.cast([0,0])}]):(f=e.item,c.sequence([function(e){return d[11]=f.backupId,d[10]=f.authorityLevel,c.i64.eq(d[10],c.i64.cast([0,20]))?c.resolve(d[9]=c.i64.cast([0,1])):c.sequence([function(e){return c.i64.eq(d[10],c.i64.cast([0,80]))?c.sequence([function(e){return c.i64.eq(d[11],void 0)?c.sequence([function(e){return c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1492]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[14]=a[0],a})},function(a){return d[14]?d[15]=!0:d[15]=!1,d[15]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[17]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[17]].join("")),d[16]=c.createArray(),void 0!==void 0?d[18]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[17],d[16],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[13]=c.i64.cast([0,2])}]):c.sequence([function(e){return c.i64.eq(d[11],c.i64.cast([-1,4294967295]))?c.sequence([function(e){return c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1489]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[15]=a[0],a})},function(a){return d[15]?d[16]=!0:d[16]=!1,d[16]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[18]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[18]].join("")),d[17]=c.createArray(),void 0!==void 0?d[19]=(d[17].push(void 0),d[17]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[18],d[17],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[14]=c.i64.cast([-1,4294967295])}]):c.sequence([function(e){return c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.backupId,d[11])&&c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}).next().then(function(e,f){f=e.done;e=e.value;return f?c.sequence([function(e){return c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1490]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[17]=a[0],a})},function(a){return d[17]?d[18]=!0:d[18]=!1,d[18]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[20]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[20]].join("")),d[19]=c.createArray(),void 0!==void 0?d[21]=(d[19].push(void 0),d[19]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[20],d[19],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[15]=c.i64.cast([0,4])}]):(e.item,c.sequence([function(e){return c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1491]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[17]=a[0],a})},function(a){return d[17]?d[18]=!0:d[18]=!1,d[18]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[20]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[20]].join("")),d[19]=c.createArray(),void 0!==void 0?d[21]=(d[19].push(void 0),d[19]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[20],d[19],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[15]=c.i64.cast([0,3])}]))})},function(a){return d[14]=d[15]}])},function(a){return d[13]=d[14]}])},function(a){return d[12]=d[13]}]):c.sequence([function(e){return c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1489]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[13]=a[0],a})},function(a){return d[13]?d[14]=!0:d[14]=!1,d[14]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[16]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[16]].join("")),d[15]=c.createArray(),void 0!==void 0?d[17]=(d[15].push(void 0),d[15]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[16],d[15],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[12]=c.i64.cast([-1,4294967295])}])},function(a){return d[9]=d[12]}])},function(a){return d[1]=d[9]}]))})},function(a){return d[3]=c.i64.of_float(Date.now()),d[4]=c.i64.random(),d[6]="Finishing execution. Execution time: ",d[7]=c.i64.to_string(c.i64.sub(d[3],d[0])),d[8]=" ms",d[5]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsProcessBackupIdsStoredProcedure] ",d[5],d[6],d[5],d[7],d[5],d[8]].join("")),c.i64.eq(c.i64.mod_(d[4],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[9]=",",d[10]=c.createArray(),void 0!==void 0?d[11]=(d[10].push(void 0),d[10]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsProcessBackupIdsStoredProcedure",[d[6],d[9],d[7],d[9],d[8]].join(""),d[10],c.i64.cast([0,4]))):c.resolve()},function(a){return e[0]=d[1]}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsProcessBackupIdsStoredProcedure";a.__tables__=["encrypted_backups","secure_encrypted_backups_client_state"];e.exports=a}),null);
__d("LSProcessBackupIdsStoredProcedure",["LSProcessBackupIds","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){e===void 0&&(e={});a=a.storedProcedure(c("LSProcessBackupIds"),e.traceId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("WAPREList",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({APP_STATE_SYNC_DAILY:"app_state_sync_daily",CREATE_GROUP:"create_group",DECRYPT_MESSAGE_FINAL:"decrypt_message_final",DELETE_THREAD:"delete_thread",DOWNLOAD_AND_DECRYPT:"download_and_decrypt",EBDB_INIT:"ebdb_init",FRANKING_VALIDATION:"franking_validation",GET_DEVICES:"get_devices",ICDC_ERROR:"icdc_error",MEDIA_DOWNLOAD:"media_download",MEDIA_UPLOAD:"media_upload",MEDIA_VALIDATE:"media_validate",MESSAGE_DECRYPTION:"message_decryption",MESSAGE_ENCRYPTION:"message_encryption",OFFLINE_QUEUE:"offline_queue",OFFLINE_RETRY:"offline_retry",ONE_QUEUE:"one_queue",QUERY_GROUP:"query_group",QUERY_GROUPS:"query_groups",RECEIVE_MESSAGE:"receive_message",REMOVE_PARTICIPANTS:"remove_participants",SEND_MESSAGE:"send_message",STANZA_QUEUE_MESSAGE_CONSUMER:"stanza_queue_message_consumer",SYNCD:"syncd",SYNCD_BOOTSTRAP_APP_STATE_DOWNLOAD:"syncd_bootstrap_app_state_download",SYNCD_BOOTSTRAP_DATA_APPLIED:"syncd_bootstrap_data_applied",SYNCD_CRITICAL_BOOTSTRAP_STAGE:"syncd_critical_bootstrap_stage",SYNCD_CRITICAL_EVENT:"syncd_critical_event",SYNCD_DECRYPT_MUTATIONS:"syncd_decrypt_mutations",SYNCD_FATAL_ERROR:"syncd_fatal_error",SYNCD_KEY_ROTATION:"syncd_key_rotation",WA_DISCONNECT:"wa_disconnect",WA_FAIL_STANZA_QUEUE_ITEM:"stanza_queue_item_failure",WA_JOB_MANAGER:"wa_job_manager",WA_JOBS_ORCHESTRATOR:"wa_jobs_orchestrator",WA_NO_SIGNED_PRE_KEY:"wa_no_signed_pre_key"});f.PRE_METRIC=a}),66);
__d("WAPREMetrics",["WALogger","WAPREList"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[PRE][","] EventFlow still active during garbage collection"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[PRE] There are no subscribers to PRE events "," ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Removing all listeners from PRE_METRICS"]);j=function(){return a};return a}c=6e4;e=18e4;f=10*60*1e3;var k=0;function a(){var c=[];function e(a){c.push(a)}function b(){d("WALogger").WARN(j()),c.length=0}function a(a){c.length===0&&d("WALogger").WARN(i(),a.name,a.stage),c.forEach(function(b){b(a)})}return{subscribe:e,notify:a,clear:b}}a=a();var l=a.notify,m=a.clear;a=a.subscribe;var n;"FinalizationRegistry"in self&&"WeakRef"in self&&(n=new FinalizationRegistry(function(a){var b=a.event;a=a.eventFlow;if(a.isActive())try{d("WALogger").ERROR(h(),b)}catch(a){}}));var o=new Set([d("WAPREList").PRE_METRIC.SEND_MESSAGE,d("WAPREList").PRE_METRIC.MEDIA_DOWNLOAD]);function b(a,b,c,d){c==null&&k++;var e=c!=null?c:k,f="open";c==null?l({name:a,stage:"START",instanceKey:e,annotations:b,timeoutInMs:d}):l({name:a,stage:"RESUME",instanceKey:e,annotations:b});var g;function h(){if(g!=null){var a=g.deref();if(a!=null){var b;(b=n)==null?void 0:b.unregister(a)}}}d={addPoint:function(c,b){l({name:a,stage:"POINT",reason:c,instanceKey:e,annotations:b})},addAnnotations:function(b){l({name:a,stage:"ANNOTATE",instanceKey:e,annotations:b})},endSuccess:function(b){l({name:a,stage:"SUCCESS",instanceKey:e,annotations:b}),f="closed",h()},endCancel:function(b){l({name:a,stage:"CANCEL",instanceKey:e,annotations:b}),h()},endFail:function(c,b){l({name:a,stage:"FAIL",reason:c,instanceKey:e,annotations:b}),f="closed",h()},getFlowDetails:function(){return{name:a,instanceKey:e}},isActive:function(){return f==="open"}};n&&!o.has(a)&&c==null&&(n.register(d,{event:a,eventFlow:{endCancel:d.endCancel,isActive:d.isActive}}),g=new WeakRef(d));return d}g.QPL_DEFAULT_TIMEOUT_IN_MS=c;g.QPL_RECEIVE_MESSAGE_TIMEOUT_IN_MS=e;g.QPL_MEDIA_DOWNLOAD_TIMEOUT_IN_MS=f;g.clear=m;g.subscribe=a;g.startMetric=b}),98);
__d("MAWEchoToProtobufConversionLoggingUtils",["QPLUserFlow","qpl"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){c("QPLUserFlow").start(c("qpl")._(521484676,"2684"),{annotations:b,instanceKey:a})}function b(a,b,d){c("QPLUserFlow").endFailure(c("qpl")._(521484676,"2684"),b,{annotations:d,instanceKey:a})}function d(a,b){c("QPLUserFlow").endSuccess(c("qpl")._(521484676,"2684"),{annotations:b,instanceKey:a})}function e(a,b,d){d&&c("QPLUserFlow").addAnnotations(c("qpl")._(521484676,"2684"),d,{instanceKey:a}),c("QPLUserFlow").addPoint(c("qpl")._(521484676,"2684"),b,{instanceKey:a})}g.startQplUserFlow=a;g.endFailure=b;g.endSuccess=d;g.addPoint=e}),98);
__d("WAWaitForUserUnblocked",["WAResolvable","WorkerScheduler"],(function(a,b,c,d,e,f,g){"use strict";f=2*60*1e3;var h=new(d("WAResolvable").Resolvable)(),i=d("WorkerScheduler").makeScheduler("offline-queue",{concurrency:1,maxConcurrency:1,defaultSamplingRate:1e3,timeToStuckMs:f});function a(){h.resolveWasCalled()&&(h=new(d("WAResolvable").Resolvable)(),j())}function j(){void i.runTask({name:"offline-queue",fn:function(){return h.promise},priority:d("WorkerScheduler").BLOCKING_PRIORITY})}function b(){return h.promise}function c(){h.resolve()}function e(){return!h.resolveWasCalled()}g.maybeResetWaitForUserUnblocked=a;g.markOfflineQueueAsStarted=j;g.waitForUserUnblocked=b;g.unblockUser=c;g.isStillWaitingForUserUnblocked=e}),98);
__d("isE2EEConversationSearchEnabled",["gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("gkx")("4741")}g["default"]=a}),98);
__d("isMAWUniversalSearchEnabled",["gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("gkx")("4741")}g["default"]=a}),98);
__d("MAWHandleEBRestoreWithHIM",["EBAPIWorkerCheck","EchoMessage","EncryptedBackupsUploadEntity","FBLogger","MAWAckLevel","MAWAsMessageApplication","MAWBulkEditMsgsTxns","MAWConvertXMAGatingTypeToExtendedContentOverlayIconGlyph","MAWConvertXMALayoutTypeToExtendedContentXMLLayoutType","MAWConvertXMATargetTypeToExtendedContentTargetType","MAWDbMsg","MAWEchoToProtobufConversionLoggingUtils","MAWFrontendMediaUtils","MAWHandleEchoMediaMsgsRestoreV2","MAWHandleEchoMsgsRestoreApiUtils","MAWHandleEchoReactionsRestore","MAWHandleEchoXMARestoreV2","MAWJids","MAWMsgType","MAWODSProxy","MAWParseXMAProtocol","MAWUnsafeCoerce","MAWUserJidWrapper","MessageBackupSupplementalKeyGenerator","Random","WAGlobals","WAHashUtils","WAJids","WALogger","WALongInt","WAOdsEnums","WAProtocolQueue","WAResultOrError","WASortedLists","WAStanzaUtils","WATimeUtils","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Exception when trying to encode reaction supplemental protobuf: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][echo2protobuf] Failed to create reaction supplemental key"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Exception when trying to encode edit supplemental protobuf: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][echo2protobuf] Failed to fetch edit external id"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][echo2protobuf] Failed to create edit supplemental key"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][echo2protobuf] Exception when trying to encode top-level protobuf: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][echo2protobuf] Failed to extract UnstoredDbMsg from EchoMessage: unstoredDbMsg missing in UnstoredDbContent"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][echo2protobuf] Failed to extract UnstoredDbMsg from EchoMessage: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][echo2protobuf] One of the mandatory fields is null for Echo message. Echo message origin ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][echo2protobuf] Failed to decode echo message"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to convert all echo messages to protobuf. Chat: ",", echo messages count: ",", converted echo messages count: ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to decode echo message: ",""]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Unsupported receiver fetch message type: ",". Echo message origin ",""]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] defautlCTA failed validation check. Echo message origin ",""]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Mandatory XMA Data missing for XMA message. Echo message origin ",""]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Unable to construct downloadableThumbnail from previewMediaData: ",", msg id: ",". Echo message origin ",""]);w=function(){return a};return a}function x(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] downloadableThumbnail was created without metadata, source: protobuf"]);x=function(){return a};return a}function y(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] messageId is null in edit, original externalId: ",""]);y=function(){return a};return a}function z(a,b){if(a==="@me"||a==="@system")return b;else return a}function A(a,b,c,e,f){var g=[];if(a.reactionXOfflineThreadingIds!=null)for(var h=0;h<a.reactionXOfflineThreadingIds.length;++h){var i=d("MAWHandleEchoReactionsRestore").getReactionsForReactionStore(b,c,e,null,f,a);i=i.map(function(a){return{decodedMsg:{unstoredDbMedia:void 0,unstoredDbMsg:void 0,unstoredDbReaction:a,unstoredDbReceiverFetchInfo:void 0},stanza:D(a.externalId,a.ts,z(a.author,c),b,"reaction")}});g.push.apply(g,i)}return g}function B(a,b,c,e,f){return e.map(function(e){if(e.messageId==null){d("WALogger").ERROR(y(),a);f!=null&&d("MAWEchoToProtobufConversionLoggingUtils").addPoint(f,"getUnstoredDbEditsFromEcho_messageId_missing");return null}var g=e.messageId;return{decodedMsg:{unstoredDbEditActionMsg:{ack:d("MAWAckLevel").ACK.sent,author:c,editMsgContent:{content:e.text},externalId:d("WAStanzaUtils").toStanzaId(g),originalMsgExternalId:a,serverTs:d("WATimeUtils").castToUnixTime(e.timestamp),ts:d("WATimeUtils").castToUnixTime(e.timestamp),type:d("MAWMsgType").MSG_TYPE.EDIT_ACTION},unstoredDbMedia:void 0,unstoredDbMsg:void 0,unstoredDbReaction:void 0},stanza:D(d("WAStanzaUtils").toStanzaId(g),d("WATimeUtils").castToUnixTime(e.timestamp),c,b,"text")}}).filter(Boolean)}function a(a,b){return a.map(I).filter(Boolean).map(function(a){return C(a,b)})}function C(a,b){var e,f=d("MAWUserJidWrapper").getMyUserJid(),g=a.from,h=d("MAWHandleEchoMsgsRestoreApiUtils").getDbMsgTypeFromEchoMessage(a);if(g==null||h==null)return[];h=a.xOfflineThreadingId;if(h==null){c("FBLogger")("labyrinth_web").warn("xOfflineThreadingId is null for Echo message");return[]}h=d("WAStanzaUtils").toStanzaId(h);e=d("WATimeUtils").castToUnixTime(((e=a.authoritativeTimestampMs)!=null?e:a.sortOrderMs)/1e3);g=d("MAWJids").toUserJid(g.localKey);var i=H(a,b,f,h,"echo_content");if(i.success===!1)return[];i=i.value;f=A(a,b,f,h,g);var j=a.contentType===d("EchoMessage").EchoMessageContentType.TEXT||a.contentType===d("EchoMessage").EchoMessageContentType.PLACEHOLDER?"text":"media";a=B(h,b,g,a.editHistory);return[{decodedMsg:i,stanza:D(h,e,g,b,j)}].concat(f,a)}function D(a,b,c,e,f){var g={applicationPayload:new Uint8Array(0).buffer,backupDirective:null,icdc:null,metadata:null,protobuf:new Uint8Array(0),subprotocol:new Uint8Array(0),subprotocolType:"consumerMessage",type:"subprotocol",version:"v3"};g={folder:null,id:{author:c,chat:e,externalId:a},msg:g,recipientsCount:null,reportingMeta:null,ts:b,type:"IncomingMsg"};return{incomingType:"ebrestore",jid:e,message:{decrypted:g,details:{count:0,externalId:a,from:d("WAJids").switchOnMsgrChatJidType(e,{group:function(a){return{author:d("WAJids").defaultDeviceJidForUser(c),chat:a,groupJid:a,type:"group"}},user:function(a){return{author:d("WAJids").defaultDeviceJidForUser(c),chat:a,deviceJid:d("WAJids").defaultDeviceJidForUser(c),type:"device"}}}),hideDecryptionFailure:!0,isInstamadillo:!1,offline:null,recipient:null,reportingMeta:null,retryCount:0,ts:b,type:f}},priority:d("WAProtocolQueue").WAProtocolQueuePriorityLow,stanzaId:a,stanzaQueueId:d("MAWUnsafeCoerce").unsafeCoerce(-1),type:"message"}}function E(a){if(a.mediaData==null)return d("WAResultOrError").makeResult(null);var b=a.previewMediaData,c=a.sortOrderMs,e=a.xOfflineThreadingId,f=a.mediaData,g=f.attachmentObjectId,h=f.backupEntFbid,i=f.directPath,j=f.encryptedHash,k=f.filename,l=f.height,m=f.mediaContentType,n=f.mediaKey,o=f.mediaKeyTimestamp,p=f.mediaPlayableDuration,q=f.plaintextHash,r=f.previewContentHeight,s=f.previewContentWidth,t=f.size;f=f.width;var u=a.contentType===d("EchoMessage").EchoMessageContentType.XMA;m=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(m||"",u);u=m.mediaType;m=m.serverMediaType;var v=d("WAHashUtils").stringToPlaintextHash(d("MAWHandleEchoMediaMsgsRestoreV2").getBase64WithoutPadding(q)),y=null;if(b!=null)try{y=d("MAWHandleEchoMediaMsgsRestoreV2").constructRawDownloadableThumbnail(b),y!=null&&y.objectId==null&&d("WALogger").ERROR(x())}catch(b){d("WALogger").ERROR(w(),b,e,a.serializationOrigin)}if(n==null)return d("WAResultOrError").makeError("missing_media_key");if(j==null)return d("WAResultOrError").makeError("missing_encrypted_hash");b=d("MAWHandleEchoMediaMsgsRestoreV2").constructMediaEntry(v,j,n,i,o,m,k,h,g,y,t);e=d("MAWHandleEchoMediaMsgsRestoreV2").getMediaInfo({filename:k,height:l,mediaPlayableDuration:p,mediaType:u,previewContentHeight:r,previewContentWidth:s,width:f});a=e.validatedAudioInfo;v=e.validatedDocumentFileInfo;j=e.validatedImageInfo;n=e.validatedVideoInfo;return d("WAResultOrError").makeResult({mediaEntry:b,mediaType:u,msgIds:d("WASortedLists").asSortedSet(new Set()),plaintextHash:d("WAHashUtils").stringToPlaintextHash(q),size:t||0,ts:o!=null?d("WATimeUtils").castToUnixTime(o):d("WATimeUtils").castMilliSecondsToUnixTime(c),validatedAudioInfo:a,validatedDocumentFileInfo:v,validatedImageInfo:j,validatedVideoInfo:n})}function F(a,b){if(a.xmaData==null||a.from==null||a.xOfflineThreadingId==null)return d("WAResultOrError").makeResult(null);var c=a.from,e=a.serializationOrigin,f=a.xmaData;a=a.xOfflineThreadingId;var g=f.xmaContentRef,h=f.xmaDataclass,i=f.xmaDefaultCTA,j=f.xmaGatingType,k=f.xmaHeaderSubtitle,l=f.xmaHeaderTitle,m=f.xmaIsTombstoned,n=f.xmaLayoutType,o=f.xmaMaxSubtitleNumLines,p=f.xmaMaxTitleNumLines,q=f.xmaSubtitleText,r=f.xmaTargetExpiry,s=f.xmaTargetId,t=f.xmaTargetType,w=f.xmaTargetUsername;f=f.xmaTitleText;if(t==null){d("WALogger").ERROR(v(),e);return d("WAResultOrError").makeError("xma_mandatory_fields_missing")}t=d("MAWConvertXMATargetTypeToExtendedContentTargetType").convertXMATargetTypeToExtendedContentTargetType(t);var x;i!=null&&(x=d("MAWHandleEchoXMARestoreV2").getDefaultCTA(i));if(x!=null&&!d("MAWParseXMAProtocol").isValidCTA(x,t,!0)){d("WALogger").ERROR(u(),e);return d("WAResultOrError").makeError("xma_cta_validation_failure")}var y;j!=null&&(y=d("MAWConvertXMAGatingTypeToExtendedContentOverlayIconGlyph").convertXMAGatingTypeToExtendedContentOverlayIconGlyph(j));var z;r!=null&&(z=d("WATimeUtils").castToUnixTime(r));var A;n!=null&&(A=d("MAWConvertXMALayoutTypeToExtendedContentXMLLayoutType").convertXMALayoutTypeToExtendedContentXMLLayoutType(n));return d("WAResultOrError").makeResult({unstoredDbXMA:{author:d("MAWJids").toUserJid(c.localKey),contentRef:g,ctas:[],defaultCTA:x,externalId:d("WAStanzaUtils").toStanzaId(a),headerTitle:l,isTombstoned:m,maxSubtitleNumOfLines:o,maxTitleNumOfLines:p,overlayDescription:k,overlayIconGlyph:y,overlayTitle:l,subtitleText:q,targetExpiringAtSec:z,targetId:s,targetType:t,targetUsername:w,threadJid:b,titleText:f,xmaDataclass:h,xmaLayoutType:A}})}function G(a){if(a.receiverFetchId==null||a.receiverFetchData==null)return d("WAResultOrError").makeResult(null);var b=a.receiverFetchData,c=a.receiverFetchId;if(b.type!=="sticker"){d("WALogger").ERROR(t(),b.type,a.serializationOrigin);return d("WAResultOrError").makeError("unsupported_message_type")}return d("WAResultOrError").makeResult({mimetype:b.mimetype,previewHeight:b.previewHeight,previewWidth:b.previewWidth,receiverFetchId:c,type:b.type})}function H(a,b,c,e,f){c=d("MAWHandleEchoMsgsRestoreApiUtils").getUnstoredDbMessageFromEchoMessage(a,b,c,e,void 0,f);if(c.success===!1)return d("WAResultOrError").makeError(c.error);e=c.value;e.originalTs;e.threadJid;e.unsendMsgContentDeleteTs;f=babelHelpers.objectWithoutPropertiesLoose(e,["originalTs","threadJid","unsendMsgContentDeleteTs"]);f.sortOrderMs=a.sortOrderMs;c=E(a);if(c.success===!1)return c;e=F(a,b);if(e.success===!1)return d("WAResultOrError").makeError(e.error);b=e.value;e=G(a);if(e.success===!1)return d("WAResultOrError").makeError(e.error);a=e.value;return d("WAResultOrError").makeResult({unstoredDbMedia:c.value,unstoredDbMsg:f,unstoredDbReaction:void 0,unstoredDbReceiverFetchInfo:a!=null?a:void 0,unstoredXMA:b!=null?b:void 0})}function I(a){try{return d("EchoMessage").decodeEchoMessage(a)}catch(a){d("WALogger").ERROR(s(),a);return null}}function b(a,b){if(!d("EBAPIWorkerCheck").runningInWorker)throw c("FBLogger")("messenger_web").mustfixThrow("convertEchoMessagesToEBProtobufs should be called from the worker thread");var e=a.map(function(a){return J(a,b)}).filter(Boolean);d("MAWODSProxy").odsBumpEntityKey({amount:e.length,entity:d("WAOdsEnums").Entity.EB_RESTORE,key:"echo2protobuf.success"});e.length!==a.length&&(d("WALogger").WARN(r(),b,a.length,e.length),d("MAWODSProxy").odsBumpEntityKey({amount:a.length-e.length,entity:d("WAOdsEnums").Entity.EB_RESTORE,key:"echo2protobuf.fail"}));return e}function J(a,b){var e=c("Random").uint32();d("MAWEchoToProtobufConversionLoggingUtils").startQplUserFlow(e);a=I(a);if(a==null){d("WALogger").ERROR(q());d("MAWEchoToProtobufConversionLoggingUtils").endFailure(e,"echo_decode_failure");return null}var f=d("WAGlobals").getMyUserJid(),g=a.from,r=a.sortOrderMs,s=a.xOfflineThreadingId;r=d("WATimeUtils").castToMillisTime(r);if(s==null||g==null){d("WALogger").ERROR(p(),a.serializationOrigin);d("MAWEchoToProtobufConversionLoggingUtils").endFailure(e,"mandatory_fields_missing");return null}var t=d("MAWJids").toUserJid(g.localKey);g=d("WAStanzaUtils").toStanzaId(s);s=H(a,b,f,g,"first_edit_content");if(s.success===!1){d("WALogger").ERROR(o(),s.error);d("MAWEchoToProtobufConversionLoggingUtils").endFailure(e,"echo_message_parsing_failure_"+s.error);return null}if(s.value.unstoredDbMsg==null){d("WALogger").ERROR(n());d("MAWEchoToProtobufConversionLoggingUtils").endFailure(e,"unstoredDbMsg_conversion_failure_unstoredDbMsg_missing");return null}s=s.value;var u=s.unstoredDbMedia,v=s.unstoredDbMsg,w=s.unstoredDbReceiverFetchInfo;s=s.unstoredXMA;var x={author:t,chat:b,externalId:g};v!=null&&(v.msgId=d("MAWDbMsg").stanzaIdToMsgId(g));(s==null?void 0:s.unstoredDbXMA)!=null&&(s.unstoredDbXMA.msgId=d("MAWDbMsg").stanzaIdToMsgId(g));u!=null&&(u.msgIds=d("WASortedLists").asSortedSet(new Set([d("MAWDbMsg").stanzaIdToMsgId(g)])));var y;(s==null?void 0:s.unstoredDbXMA)!=null&&(y={associatedMessage:null,defaultPreview:u!=null?u:null,favicon:null,header:u!=null?u:null,previews:u!=null?[u]:null,xma:s.unstoredDbXMA});var z={frankingKey:null,frankingTag:null,frankingVersion:null,reportingContent:null,reportingTag:null},C;try{C={decryptedProtobuf:d("EncryptedBackupsUploadEntity").getEbBackupMessageBytesBuffer(d("EncryptedBackupsUploadEntity").encodeBackupMessage({messageApplication:d("MAWAsMessageApplication").encodeMessageApplication(v,u,null,y,b,c("justknobx")._("3632")?w:null),msgId:x,reportingMeta:z,sortOrderMs:r})),protobufTimestampMS:r}}catch(a){d("MAWEchoToProtobufConversionLoggingUtils").endFailure(e,"top_level_protobuf_encoding_failure");d("WALogger").ERROR(m(),a);return null}var D=new Map();s=B(g,b,t,a.editHistory).map(function(a){return(a=a.decodedMsg)==null?void 0:a.unstoredDbEditActionMsg}).filter(Boolean).filter(function(a){return a.externalId!==a.originalMsgExternalId}).map(function(a){return d("MAWBulkEditMsgsTxns").getMessageHistory(a,b)});s.length>0&&d("MAWEchoToProtobufConversionLoggingUtils").addPoint(e,"convert_edits");s.forEach(function(a){var c=a.author,f=a.editTs;c=d("MessageBackupSupplementalKeyGenerator").createEditSupplementalKey(c,d("WATimeUtils").castUnixTimeToMillisTime(f));if(c==null){d("MAWEchoToProtobufConversionLoggingUtils").addPoint(e,"edit_supplemental_key_generation_failure");d("WALogger").ERROR(l());return}if(a.editExternalId==null){d("MAWEchoToProtobufConversionLoggingUtils").addPoint(e,"edit_supplemental_key_generation_failure");d("WALogger").ERROR(k());return}var g=a.editExternalId;try{D.set(c,{decryptedProtobuf:d("EncryptedBackupsUploadEntity").getEbBackupMessageBytesBuffer(d("EncryptedBackupsUploadEntity").encodeBackupMessage({messageApplication:d("MAWAsMessageApplication").encodeEditMessageApplication(a),msgId:{author:t,chat:b,externalId:g},reportingMeta:z,sortOrderMs:d("WATimeUtils").castUnixTimeToMillisTime(a.editTs)})),protobufTimestampMS:d("WATimeUtils").castUnixTimeToMillisTime(f)})}catch(a){d("MAWEchoToProtobufConversionLoggingUtils").addPoint(e,"edit_supplemental_protobuf_encoding_failure"),d("WALogger").ERROR(j(),a)}});v=A(a,b,f,g,t).map(function(a){return(a=a.decodedMsg)==null?void 0:a.unstoredDbReaction}).filter(Boolean);v.length>0&&d("MAWEchoToProtobufConversionLoggingUtils").addPoint(e,"convert_reactions");v.forEach(function(a){var c=a.author,f=a.senderTimestampMs,g=a.ts;f=f!=null?d("WATimeUtils").castToMillisTime(d("WALongInt").numberOrThrowIfTooLarge(f)):d("WATimeUtils").castUnixTimeToMillisTime(g);g=d("MessageBackupSupplementalKeyGenerator").createReactionSupplementalKey(c);if(g==null){d("MAWEchoToProtobufConversionLoggingUtils").addPoint(e,"reaction_supplemental_key_generation_failure");d("WALogger").ERROR(i());return}try{D.set(g,{decryptedProtobuf:d("EncryptedBackupsUploadEntity").getEbBackupMessageBytesBuffer(d("EncryptedBackupsUploadEntity").encodeBackupMessage({messageApplication:d("MAWAsMessageApplication").encodeReactionMessageApplication(a),msgId:{author:t,chat:b,externalId:a.externalId},reportingMeta:z,sortOrderMs:f})),protobufTimestampMS:f})}catch(a){d("MAWEchoToProtobufConversionLoggingUtils").addPoint(e,"reaction_supplemental_protobuf_encoding_failure"),d("WALogger").ERROR(h(),a)}});d("MAWEchoToProtobufConversionLoggingUtils").endSuccess(e);return{otid:g,supplementalProtobufs:D,toplevelProtobuf:C}}g.convertEchoMessages=a;g.convertEchoMessagesToEBProtobufs=b}),98);
__d("MWEBODSUtils",["CurrentMessengerUser","MWEBODSCategory","ODS"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,e){var f=d("CurrentMessengerUser").getAppID();f=f!=null?f.toString():"unknown";f=a+"."+f;(h||(h=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),f,b,e!=null?e:1);h.bumpEntityKey(c("MWEBODSCategory"),a,b,e!=null?e:1)}g.markODSForEB=a}),98);
__d("WAGetHashFromProtocolMsgId",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a.externalId+"_"+a.author+"_"+a.chat}f.getHashFromProtocolMsgId=a}),66);
__d("MAWEBUploadTrackingUtils",["MAWAckLevel","MAWEBSwitch","MAWExternalId","MAWMsgType","MWEBODSEntityKey.enum","MWEBODSEntityName.enum","MWEBODSUtils","ODS","QPLUserFlow","QuickPerformanceLogger","WACommsConnectionState","WAExceededStorageQuota","WAGetHashFromProtocolMsgId","WAGlobals","WAHashStringToNumber","justknobx","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j={ERROR_FETCHING_DB_MESSAGE:"error_fetching_db_message",FAILED_TO_ACK_MESSAGE:"failed_to_ack_message",FAILED_TO_CONSTRUCT_ECHO_MESSAGE:"failed_to_construct_echo_message",MESSAGE_UPLOAD_TIMEOUT:"message_upload_timeout",RUNTIME_ERROR:"runtime_error"};function a(a,b,e,f,g,h,j,k,m){g===void 0&&(g=!1);h===void 0&&(h=!1);k===void 0&&(k="unknown");m===void 0&&(m=0);if(!c("MAWEBSwitch").isEnabled())return;c("QPLUserFlow").start(c("qpl")._(521481602,"829"),{annotations:{bool:{eb_switch:c("MAWEBSwitch").isEnabled(),eb_upload_queue:!0,fromUploadQueue:g,is_retroactive_upload:h,middleware_init:!1},"int":{attachmentsSize:j!=null?j:0,instanceKey:f,retryCount:m},string:{comms_status:d("WACommsConnectionState").WACommsConnectionState.isConnected()===!0?"connected":"disconnected",externalId:a,msgType:b,payloadType:k,triggerType:e}},instanceKey:f,timeoutInMs:c("justknobx")._("1405")});l(f,"upload_tracking_started");(i||(i=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_TRACKING,c("MWEBODSEntityKey.enum").START);d("MWEBODSUtils").markODSForEB(c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_COUNTER,"upload."+(b!=null?b:"unknown"));g=d("MAWMsgType").isMAWSupportedMediaType(b!=null?b:"Text")?"media":"non-media";d("MWEBODSUtils").markODSForEB(c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_COUNTER,"upload."+g)}function k(a){return a==null?{string:{comms_status_on_failure:d("WACommsConnectionState").WACommsConnectionState.isConnected()===!0?"connected":"disconnected"}}:babelHelpers["extends"]({},a,{string:babelHelpers["extends"]({},a.string,{comms_status_on_failure:d("WACommsConnectionState").WACommsConnectionState.isConnected()===!0?"connected":"disconnected"})})}function b(a,b,c,d){switch(a){case"success":n(b,c,d);break;case"fail":m(b,c,d);break;case"point":l(b,c,d);break}}function l(a,b,d){d&&c("QPLUserFlow").addAnnotations(c("qpl")._(521481602,"829"),d,{instanceKey:a}),c("QPLUserFlow").addPoint(c("qpl")._(521481602,"829"),b,{instanceKey:a})}function e(a,b){c("QPLUserFlow").addAnnotations(c("qpl")._(521481602,"829"),k(b),{instanceKey:a});c("QPLUserFlow").endCancel(c("qpl")._(521481602,"829"),{annotations:{bool:{exceededStorageQuota:d("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0},string:{threadID:b==null?void 0:(b=b.string)==null?void 0:b.jid}},instanceKey:a});(i||(i=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_TRACKING,c("MWEBODSEntityKey.enum").CANCEL)}function m(a,b,e){c("QPLUserFlow").addAnnotations(c("qpl")._(521481602,"829"),k(e),{instanceKey:a});c("QPLUserFlow").endFailure(c("qpl")._(521481602,"829"),b,{annotations:{bool:{exceededStorageQuota:d("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0},string:{threadID:e==null?void 0:(b=e.string)==null?void 0:b.jid}},instanceKey:a});(i||(i=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_TRACKING,c("MWEBODSEntityKey.enum").FAIL)}function n(a,b,c){l(a,b),o(a,c)}function o(a,b){b&&c("QPLUserFlow").addAnnotations(c("qpl")._(521481602,"829"),b,{instanceKey:a}),c("QPLUserFlow").endSuccess(c("qpl")._(521481602,"829"),{annotations:{bool:{exceededStorageQuota:d("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0}},instanceKey:a}),(i||(i=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_TRACKING,c("MWEBODSEntityKey.enum").SUCCESS)}function f(a,b,e){l(a,b);e&&c("QPLUserFlow").addAnnotations(c("qpl")._(521481602,"829"),e,{instanceKey:a});c("QPLUserFlow").endTimeout(c("qpl")._(521481602,"829"),{annotations:{bool:{exceededStorageQuota:d("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0},string:{threadID:e==null?void 0:(b=e.string)==null?void 0:b.jid}},instanceKey:a});(i||(i=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_TRACKING,c("MWEBODSEntityKey.enum").TIMEOUT)}function p(a,b,d){var e=c("qpl")._(521481602,"829");l(a,b);d&&(h||(h=c("QuickPerformanceLogger"))).markerAnnotate(e,d,{instanceKey:a});(h||(h=c("QuickPerformanceLogger"))).markerEnd(e,52,a,h.currentTimestamp())}function q(){return d("WAHashStringToNumber").hashStringToNumber(d("MAWExternalId").generateExternalId())}function r(a,b){b===void 0&&(b=0);return d("WAHashStringToNumber").hashStringToNumber(d("WAGetHashFromProtocolMsgId").getHashFromProtocolMsgId(a)+"_"+d("WAGlobals").getMyDeviceJid()+"_"+b)}function s(a){return c("MAWEBSwitch").isEnabled()&&d("MAWMsgType").isEBSupportedMsgType(a.type)&&a.ack>=d("MAWAckLevel").ACK.sent&&a.serverTs!=null&&!(a.ephemeralSetting!=null&&a.ephemeralSetting.ephemeralExpirationInSec>0)}function t(a){return{addAnnotations:function(b){u(a,b)},addPoint:function(b,c){l(a,b,c)},endFail:function(b,c){m(a,b,c)},endSuccess:function(b){o(a,b)},getQPLAttrs:function(){return{event:c("qpl")._(521481602,"829"),instanceKey:a}},isActive:function(){return!0}}}function u(a,b){c("QPLUserFlow").addAnnotations(c("qpl")._(521481602,"829"),b,{instanceKey:a})}function v(a,b){return a.get(b)}function w(a,b,c,d,e){b=v(b,c);if(b!=null)switch(a){case"success":n(b,d,e);break;case"fail":m(b,d,e);break;case"point":l(b,d,e);break}}g.EBUploadTrackingWorkerFailurePoints=j;g.startUploadTracking=a;g.handleBridgeEbUploadTrackingQPL=b;g.addPointWorkerOnly=l;g.endCancelWorkerOnly=e;g.endFailWorkerOnly=m;g.endSuccessWorkerOnly=n;g.endTimeoutWorkerOnly=f;g.endRetryWorkerOnly=p;g.genInstanceKeyOnly=q;g.genInstanceKeyForUploadQueue=r;g.isUploadSupported=s;g.makeEBWorkerQplFlowFromInstanceKey=t;g.addAnnotationsForEBWorkerQplFlow=u;g.getUploadTrackingInstanceKey=v;g.addUploadTrackingByType=w}),98);
__d("MAWEBUnstoredDbMsgUtils",["EBLogger","MAWHandleEBRestoreWithHIM","MAWHandleEchoProtobufsRestoreApi","MAWMessageSortOrderUtils","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to convert echo message to unstored db message"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to convert protobuf to unstored db message: type: "," error: ",""]);i=function(){return a};return a}var j=d("EBLogger").EBLogger.tags(["restore","MAWEBUnstoredDbMsgUtils"]);function a(a,b,c,e){var f=c!=null?c:b!=null?d("WAJids").unsafeCoerceToChatJid(b):void 0;if(f==null){j.mustfix("threadId and chatJid are both null - cannot convert protobuf to unstoredDbMsg");return[]}return d("MAWHandleEchoProtobufsRestoreApi").decodeProtobufArray(a,e,void 0,new Set(),new Set(),new Map(),new Map(),new Map(),!0).map(function(a){var b;if((a==null?void 0:(b=a.metadata)==null?void 0:b.messageId)!=null)try{b=d("MAWHandleEchoProtobufsRestoreApi").createUnstoredDbContentFromProtobufObject(a,f,e,new Map(),void 0);if(b!=null&&b.unstoredDbContent.unstoredDbMsg!=null){b=b.unstoredDbContent.unstoredDbMsg;var c=d("MAWMessageSortOrderUtils").generateAuthoritativeMessageSortOrder(b);b.sortOrderMs=c;return b}}catch(b){j.MUSTFIX(i(),a.msgType,b.message)}return null}).filter(Boolean)}function b(a,b){return d("MAWHandleEBRestoreWithHIM").convertEchoMessages(a,b).map(function(a){var b;if(a==null||a.length===0||((b=a[0].decodedMsg)==null?void 0:b.unstoredDbMsg)==null){j!=null&&j.MUSTFIX(h());return null}return(b=a[0].decodedMsg)==null?void 0:b.unstoredDbMsg}).filter(Boolean)}g.getUnstoredDbMsgFromProtobuf=a;g.getUnstoredDbMsgFromEcho=b}),98);
__d("MAWEncryptedBackupsStateManager",["MAWEBSwitch"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(a){case 1:return;case 3:c("MAWEBSwitch").set(!0);return;case 2:case 4:default:c("MAWEBSwitch").set(!1);return}}function b(a){return a===4||a===3}g.setEncryptedBackupsState=a;g.eligibleForEBUX=b}),98);
__d("MWChatEncryptedBackupsLogging",["MWEBODSCategory","MWEBODSEntityKey.enum","ODS","QPLUserFlow"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){var b=a.cancelEndPoint,d=a.event,e=a.instanceKey;a=a.source;a!=null&&c("QPLUserFlow").addAnnotations(d,{string:{source:a}},{instanceKey:e});c("QPLUserFlow").addPoint(d,"cancel",{instanceKey:e});c("QPLUserFlow").addAnnotations(d,{string:{cancel_end_point:b}},{instanceKey:e});c("QPLUserFlow").endCancel(d,{instanceKey:e})}function a(a){var b=a.event,d=a.instanceKey,e=a.onClose;a=a.source;a!=null&&c("QPLUserFlow").addAnnotations(b,{string:{source:a}},{instanceKey:d});i({cancelEndPoint:"dialog_x_button",event:b,instanceKey:d});e()}function b(a){var b=a.annotations,e=a.event,f=a.instanceKey;a=a.odsEntityName;c("QPLUserFlow").addPoint(e,"success",{instanceKey:f});c("QPLUserFlow").endSuccess(e,{annotations:b,instanceKey:f});a&&(h||(h=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),a,c("MWEBODSEntityKey.enum").SUCCESS)}function e(a){var b=a.annotations,e=a.errorName,f=a.event,g=a.instanceKey,i=a.odsEntityKey;a=a.odsEntityName;c("QPLUserFlow").addPoint(f,"failure",{instanceKey:g});c("QPLUserFlow").endFailure(f,e,{annotations:b,instanceKey:g});a&&(h||(h=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),a,i!=null?i:c("MWEBODSEntityKey.enum").FAIL)}g.cancelFlow=i;g.closeDialogCancelFlow=a;g.endSuccess=b;g.endFailure=e}),98);
__d("MWEncryptedBackupsProcessBackupIdsDEPRECATED",["FBLogger","LSFactory","LSIntEnum","LSProcessBackupIdsStoredProcedure","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWEncryptedBackupsFirstRestoreUpsellTime","Promise","QPLEvent","QPLUserFlow","ReQL","WebSession","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=c("gkx")("23914");function l(a){if(k){var e=d("MWEncryptedBackupsFirstRestoreUpsellTime").getFirstRestoreUpsellTime();c("QPLUserFlow").getActiveFlowIDs().includes((i||(i=d("QPLEvent"))).getMarkerId(d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent))||c("QPLUserFlow").start(d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent,{annotations:{string:{ebSessionIdentifier:e,processBackupIdsVersion:"msys",sessionTabId:d("WebSession").getId()}}});return a.runInTransaction(function(a){return c("LSProcessBackupIdsStoredProcedure")(c("LSFactory")(a))},"readwrite",void 0,void 0,f.id+":53").then(function(a){a=(j||(j=d("LSIntEnum"))).unwrapIntEnum(a[0]);c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent,"EB_STATE_"+a+".");d("MWChatEncryptedBackupsLogging").endSuccess({event:d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent});return a})}else return(h||(h=b("Promise"))).resolve(0)}function a(a,b){return a.tables.encrypted_backups.subscribe(function(){c("promiseDone")(d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.tables.encrypted_backups)),function(d){if(d!=null){c("promiseDone")(l(a),b,function(a){c("FBLogger")("labyrinth_web").catching(a).info("Error in db transaction")});return}})})}g.processBackupIdsStoredProcedure=l;g.subscribeToEncryptedBackupsRow=a}),98);
__d("isInstamadilloEB",["qex"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("qex")._("670")===!0}g["default"]=a}),98);
__d("MWEncryptedBackupsListenForChangesToBackupStateInitPath",["EBAPIWorkerCheck","I64","LSAuthorityLevel","LSDataTraceType","LSEncryptedBackupsBackupTenancy","LSFactory","LSFetchBackupIdsStoredProcedure","LSIntEnum","LSIssueMessageRangeQueryTaskStoredProcedure","LSMEBTaskCreationSource","MAWEBRestoreTrackingUtils","MAWMainTraceUtils","MAWOfflineQueueStatus","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWEncryptedBackupsFirstRestoreUpsellTime","MWEncryptedBackupsProcessBackupIdsDEPRECATED","Promise","QPLEvent","QPLUserFlow","ReQL","WAJids","WATagsLogger","WebSession","gkx","isInstamadilloEB","promiseDone","qex"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[EB Prefetch] Issuing message range query for thread "," with params ",""]);l=function(){return a};return a}var m=c("gkx")("23961"),n=c("qex")._("121")===!0;function a(a){function b(){var b=d("ReQL").fromTableAscending(a.tables.encrypted_backups),e=b.subscribe(function(a,b){if(b.operation==="delete"||!(i||(i=d("I64"))).equal(b.value.authorityLevel,(j||(j=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE)))return;e();c("QPLUserFlow").getActiveFlowIDs().includes((k||(k=d("QPLEvent"))).getMarkerId(d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent))&&d("MWChatEncryptedBackupsLogging").endSuccess({event:d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent})});b=d("MWEncryptedBackupsFirstRestoreUpsellTime").getFirstRestoreUpsellTime();c("QPLUserFlow").getActiveFlowIDs().includes((k||(k=d("QPLEvent"))).getMarkerId(d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent))||c("QPLUserFlow").start(d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent,{annotations:{string:{ebSessionIdentifier:b,fetchBackupIdsVersion:"msys",sessionTabId:d("WebSession").getId()}}});c("promiseDone")(a.runInTransaction(function(a){return c("LSFetchBackupIdsStoredProcedure")(c("LSFactory")(a),{backupTenancy:(j||(j=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsBackupTenancy").PRODUCTION),isUiBlocking:!1})},"readwrite",void 0,void 0,f.id+":93"),function(){return p(a)})}(n||c("isInstamadilloEB")())&&b();var e=d("ReQL").fromTableAscending(a.tables.encrypted_backups_status_trigger);return e.subscribe(b)}function o(a){return a.runInTransaction(function(a){var e=d("MAWOfflineQueueStatus").getAllThreadsWithOfflineQueueIncomplete();return(h||(h=b("Promise"))).all(e.map(function(b){var e=d("WAJids").threadIdForChatJid(b),f=d("MAWMainTraceUtils").createTraceId();c("promiseDone")(d("MAWMainTraceUtils").startTraceWithTxn(a,(i||(i=d("I64"))).of_float(Date.now()),f,(j||(j=d("LSIntEnum"))).ofNumber(c("LSDataTraceType").ENCRYPTED_BACKUPS_RESTORE)));e={isPointQuery:!1,newerNumMessages:i.zero,numMessages:i.of_int32(20),source:j.ofNumber(c("LSMEBTaskCreationSource").UNKNOWN),threadId:e,traceId:f};d("WATagsLogger").TAGS(["labyrinth_web","eb_prefetch",f]).LOG(l(),b,JSON.stringify(e));d("MAWEBRestoreTrackingUtils").markEBRestoreFrontloaded(c("LSMEBTaskCreationSource").UNKNOWN,f,!1);return c("LSIssueMessageRangeQueryTaskStoredProcedure")(c("LSFactory")(a),e)}))},"readonly",void 0,void 0,f.id+":122")}function p(a){var b=d("MAWOfflineQueueStatus").isOfflineQueueComplete();m&&!b&&c("promiseDone")(d("MWEncryptedBackupsProcessBackupIdsDEPRECATED").processBackupIdsStoredProcedure(a),function(b){if(d("EBAPIWorkerCheck").runningInWorker())return;b===3&&c("promiseDone")(o(a))})}e={listenForChangesToBackupState:a,preloadEBData:p};g["default"]=e}),98);
__d("MWPlatformTaskSystem",["LSPlatformRequestScheduler","MWPlatformTaskUtils"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,b){var e=this;this.$1=a;this.$2=b;this.$3=new(c("LSPlatformRequestScheduler"))();this.$4=d("MWPlatformTaskUtils").checkQueuesWhenPendingTaskTableUpdates(a,function(b){var c=b.queueName;b=b.transportKey;return e.$6(a,c,b,!1)});this.$5=d("MWPlatformTaskUtils").checkQueuesWhenPendingFireForgetTaskTableUpdates(a,function(b){var c=b.queueName;b=b.transportKey;return e.$6(a,c,b,!0)});this.$7()}var b=a.prototype;b.$6=async function(a,b,c,d){await this.$2.decideWhatToDoWithTask(a,b,c,d)};b.$7=function(){var a=this;d("MWPlatformTaskUtils").checkAllPendingTasksForWork(this.$1,function(b){b=b.queueName;return a.$6(a.$1,b)})};b.cleanup=function(){this.$4.forEach(function(a){return a()}),this.$5.forEach(function(a){return a()}),this.$2.cleanup()};return a}();g.default=a}),98);
__d("MWSimpleWorkQueue",["FBLogger","Promise","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i={first:null,last:null};function a(a){return new(h||(h=b("Promise")))(function(d,e){var f=function(){var f=new(h||(h=b("Promise")))(function(a,b){window.setTimeout(function(){b(c("err")("Work item timed out after 30 seconds"))},3e4)});return h.race([a(),f]).then(d,e)};if(i.first===null||i.last==null)i.first=i.last={next:null,value:f},j();else{var g=i.last;g.next={next:null,value:f};i.last=g.next}})}function j(){if(i.first===null)return;var a=i.first;if(a==null)return;var b=function(){i.first=a.next;if(i.first==null){i.last=null;return}j()};a.value().then(function(){b()})["catch"](function(a){c("FBLogger")("messenger_web").catching(a).mustfix("Error in MWSimpleWorkQueue"),b()})}g.queueWork=a}),98);/*FB_PKG_DELIM*/
__d("EBMarkerIdToQPLEvent",["I64","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){a=(h||(h=d("I64"))).to_int32(a);switch(a){case 1021646192:return c("qpl")._(1021646192,"3099");case 1021656232:return c("qpl")._(1021656232,"3100");case 1021647318:return c("qpl")._(1021647318,"3101");case 1021651622:return c("qpl")._(1021651622,"3102");case 1021655799:return c("qpl")._(1021655799,"3103");case 1021648929:return c("qpl")._(1021648929,"3104");case 1021647593:return c("qpl")._(1021647593,"3105");case 1021653744:return c("qpl")._(1021653744,"3106");case 1021655355:return c("qpl")._(1021655355,"3107");case 1021648240:return c("qpl")._(1021648240,"3108");case 1021651939:return c("qpl")._(1021651939,"3109");case 1021656851:return c("qpl")._(1021656851,"3110");case 1021652813:return c("qpl")._(1021652813,"3111");case 1021653501:return c("qpl")._(1021653501,"3112");case 1021655710:return c("qpl")._(1021655710,"3114");case 1021655643:return c("qpl")._(1021655643,"3115");case 1021646076:return c("qpl")._(1021646076,"3116");case 1021642512:return c("qpl")._(1021642512,"3117");case 1021654781:return c("qpl")._(1021654781,"3118");case 1021649468:return c("qpl")._(1021649468,"3120");case 1021652080:return c("qpl")._(1021652080,"3121");case 1021652512:return c("qpl")._(1021652512,"3122");case 1021655828:return c("qpl")._(1021655828,"3124");case 1021642298:return c("qpl")._(1021642298,"3126");case 1021652377:return c("qpl")._(1021652377,"3127");case 521471316:return c("qpl")._(521471316,"2831");case 521478596:return c("qpl")._(521478596,"1329");case 521479468:return c("qpl")._(521479468,"3128");case 521473151:return c("qpl")._(521473151,"2593");case 521482563:return c("qpl")._(521482563,"3129");case 521482912:return c("qpl")._(521482912,"3131");case 521481876:return c("qpl")._(521481876,"1407");case 521471732:return c("qpl")._(521471732,"1454");case 521477507:return c("qpl")._(521477507,"1406");case 521478817:return c("qpl")._(521478817,"2806");case 521476801:return c("qpl")._(521476801,"3132");case 521484724:return c("qpl")._(521484724,"141");case 521473756:return c("qpl")._(521473756,"2768");case 521477113:return c("qpl")._(521477113,"2698");case 521478750:return c("qpl")._(521478750,"2850");case 521479165:return c("qpl")._(521479165,"3055");case 521484370:return c("qpl")._(521484370,"2995");case 521473213:return c("qpl")._(521473213,"27");case 521482281:return c("qpl")._(521482281,"2703");case 521476771:return c("qpl")._(521476771,"2454");case 521474469:return c("qpl")._(521474469,"2612");case 521471755:return c("qpl")._(521471755,"2586");case 521476367:return c("qpl")._(521476367,"2704");case 521473850:return c("qpl")._(521473850,"2910");case 521482558:return c("qpl")._(521482558,"2558");case 521482880:return c("qpl")._(521482880,"16");case 521473150:return c("qpl")._(521473150,"2143");case 521473369:return c("qpl")._(521473369,"2834");case 521485893:return c("qpl")._(521485893,"2835");case 521473922:return c("qpl")._(521473922,"2832");case 521479146:return c("qpl")._(521479146,"3133");case 521471468:return c("qpl")._(521471468,"2968");case 521480391:return c("qpl")._(521480391,"1167");case 521480745:return c("qpl")._(521480745,"3134");case 521481602:return c("qpl")._(521481602,"829");case 521475102:return c("qpl")._(521475102,"3135");case 521484676:return c("qpl")._(521484676,"2684");case 521485625:return c("qpl")._(521485625,"1876");case 521482085:return c("qpl")._(521482085,"409");case 521471024:return c("qpl")._(521471024,"2275");case 521474385:return c("qpl")._(521474385,"263");case 521479842:return c("qpl")._(521479842,"2163");case 521485383:return c("qpl")._(521485383,"2200");case 521478580:return c("qpl")._(521478580,"3136");case 521485815:return c("qpl")._(521485815,"3137");case 521482969:return c("qpl")._(521482969,"1519");case 521485406:return c("qpl")._(521485406,"272");case 521479972:return c("qpl")._(521479972,"3138");case 521474688:return c("qpl")._(521474688,"2714");case 521484777:return c("qpl")._(521484777,"2715");case 521483076:return c("qpl")._(521483076,"3140");case 521482858:return c("qpl")._(521482858,"1290");case 521472542:return c("qpl")._(521472542,"295");case 521472456:return c("qpl")._(521472456,"1646");case 521476140:return c("qpl")._(521476140,"378");case 521473194:return c("qpl")._(521473194,"1331");case 521482763:return c("qpl")._(521482763,"296");case 521484295:return c("qpl")._(521484295,"1460");case 521476165:return c("qpl")._(521476165,"2432");case 521477947:return c("qpl")._(521477947,"2395");case 521486220:return c("qpl")._(521486220,"827");case 521482576:return c("qpl")._(521482576,"1069");case 521479124:return c("qpl")._(521479124,"1939");case 521476098:return c("qpl")._(521476098,"504");case 521472095:return c("qpl")._(521472095,"2859")}return null}g.markerIdToQPLEvent=a}),98);
__d("EBMinosQplFlow",["QPLUserFlow","Random","gkx","justknobx","qpl"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=a.threadId;return h({annotations:{string:{threadId:a}},event:c("qpl")._(521473369,"2834")})}function b(a){a=a.threadId;return h({annotations:{string:{threadId:a}},event:c("qpl")._(521485893,"2835")})}function e(){return h({event:c("qpl")._(521473922,"2832")})}function h(a){var b=a.annotations;a=a.event;var e=d("Random").uint32();c("QPLUserFlow").start(a,{annotations:babelHelpers["extends"]({},b,{bool:babelHelpers["extends"]({},b==null?void 0:b.bool,{m1_1_enabled:c("gkx")("14828"),m1_2_enabled:c("gkx")("14827"),use_minos_thread_id:!0}),"int":babelHelpers["extends"]({},b==null?void 0:b["int"],{instanceKey:e,retryCount:0})}),instanceKey:e,timeoutInMs:c("justknobx")._("1405")});return k(a,e)}function f(){return h({event:c("qpl")._(521473150,"2143")})}function i(){return h({event:c("qpl")._(521482880,"16")})}function j(){return h({event:c("qpl")._(521479165,"3055")})}function k(a,b){return{addAnnotations:function(d){c("QPLUserFlow").addAnnotations(a,d,{instanceKey:b})},addPoint:function(d,e){e&&c("QPLUserFlow").addAnnotations(a,e,{instanceKey:b}),c("QPLUserFlow").addPoint(a,d,{instanceKey:b})},endFailWithError:function(d,e,f){f=babelHelpers["extends"]({},f,{string:babelHelpers["extends"]({},f==null?void 0:f.string,{failReason:e})});c("QPLUserFlow").endFailure(a,d,{annotations:f,instanceKey:b})},endSuccess:function(d){c("QPLUserFlow").endSuccess(a,{annotations:d,instanceKey:b})},getInstanceKey:function(){return b}}}g.startMinosMessageEnqueueQpl=a;g.startMinosMessageUploadQpl=b;g.startMinosUploadMekQpl=e;g.startMinosWritePublicKeysQpl=f;g.startMinosVerifySingleEpochQpl=i;g.startMinosCreateEpochParamsQpl=j}),98);
__d("InstagramMediaProductTypeName",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum")({LIVE:"live",FEED:"feed",STORY:"story",DIRECT:"direct",IGTV:"igtv",NAMETAG:"nametag",DIRECT_AUDIO:"direct_audio",CAROUSEL_ITEM:"carousel_item",CAROUSEL_CONTAINER:"carousel_container",PROFILE_PIC:"profile_pic",AD:"ad",AR_EFFECT_PREVIEW:"ar_effect_preview",DIRECT_PERMANENT:"direct_permanent",SELFIE_STICKER:"selfie_sticker",COWATCH_LOCAL:"cowatch_local",CLIPS:"clips",GUIDE_MEDIA_FACADE:"guide_media_facade",FUNDRAISER_COVER:"fundraiser_cover",LIVE_ARCHIVE:"live_archive",HIGHLIGHT_POST_FACADE:"highlight_post_facade",DIRECT_THREAD:"direct_thread",SCHEDULED_LIVE:"scheduled_live",RATINGS_AND_REVIEWS:"ratings_and_reviews",DIRECT_HEADMOJI:"direct_headmoji",CLIPS_PREVIEW:"clips_preview",REPOST_MEDIA_FACADE:"repost_media_facade",STORY_INTERACTION_RESPONSE:"story_interaction_response",MEDIA_KIT:"media_kit",TEXT_POST:"text_post",NOTE_AUDIO:"note_audio",DIRECT_MESSAGE_COMMENT_FACADE:"direct_message_comment_facade"});c=a;f["default"]=c}),66);
__d("IGDThreadTTLCUtils",["IGDInstamadilloUtils","InstagramMediaProductTypeName","LSThreadBitOffset","ZenonRTWebBrowserFeatureSupport","gkx","qex"],(function(a,b,c,d,e,f,g){"use strict";var h=[225,235,226,227,228,229,230,231,232,233,234,236];function i(a,b){if(a==null||d("IGDInstamadilloUtils").isIGDDisappearingModeEnabled(a))return!1;return!c("qex")._("954")?!1:d("LSThreadBitOffset").has(b,a)}function j(a){return i(a,225)}function k(a){if(!c("gkx")("2400"))return!1;return!d("ZenonRTWebBrowserFeatureSupport").isInsertableStreamsSupported()?!1:i(a,235)}function l(a){return i(a,226)}function m(a){return i(a,227)}function n(a){return i(a,228)}function o(a){return i(a,229)}function p(a){return i(a,230)}function q(a){return i(a,231)}function r(a){return i(a,232)}function s(a){return i(a,233)}function t(a){return i(a,234)}function u(a){return i(a,236)}function v(a){return a==null||d("IGDInstamadilloUtils").isIGDDisappearingModeEnabled(a)||!c("qex")._("954")?!1:w(a)}function w(a){return a==null?!1:h.some(function(b){return d("LSThreadBitOffset").has(b,a)})}function a(a,b){var d=a.isDisappearingModeSettingOn,e=a.isTTLCClipEnabled,f=a.isTTLCGenericXMAShareEnabled,g=a.isTTLCMediaShareEnabled;a=a.isTTLCStoryShareEnabled;b=c("InstagramMediaProductTypeName").cast(b);if(b==null||d)return!1;if(!c("qex")._("954"))return!1;switch(b){case"feed":case"carousel_container":case"ad":return g;case"clips":return e;case"story":return a;case"live":return f;default:return!1}}function b(a){return new Map([["Text",j(a)],["Clip",l(a)],["Reel Share",m(a)],["Media Share",n(a)],["Story Share",o(a)],["Link",p(a)],["Generic XMA",q(a)],["Profile",u(a)],["Image",r(a)],["Video",s(a)],["Audio",t(a)],["Gif/Sticker/Avatar",void 0],["Raven",void 0],["Media Collection",void 0],["Calling",k(a)],["Rest of Message Types",void 0]])}function e(a){return{is_instamadillo_ttlc:String(v(a)),is_instamadillo_ttlc_audio:String(t(a)),is_instamadillo_ttlc_clip:String(l(a)),is_instamadillo_ttlc_generic_xma:String(q(a)),is_instamadillo_ttlc_image:String(r(a)),is_instamadillo_ttlc_link:String(p(a)),is_instamadillo_ttlc_media_share:String(n(a)),is_instamadillo_ttlc_profile:String(u(a)),is_instamadillo_ttlc_reel_share:String(m(a)),is_instamadillo_ttlc_story_share:String(o(a)),is_instamadillo_ttlc_text:String(j(a)),is_instamadillo_ttlc_video:String(s(a))}}function f(a){return{is_instamadillo_ttlc:v(a),is_instamadillo_ttlc_audio:t(a),is_instamadillo_ttlc_clip:l(a),is_instamadillo_ttlc_generic_xma:q(a),is_instamadillo_ttlc_image:r(a),is_instamadillo_ttlc_link:p(a),is_instamadillo_ttlc_media_share:n(a),is_instamadillo_ttlc_profile:u(a),is_instamadillo_ttlc_reel_share:m(a),is_instamadillo_ttlc_story_share:o(a),is_instamadillo_ttlc_text:j(a),is_instamadillo_ttlc_video:s(a)}}function x(a,b){if(a==null)return!1;switch(a.__typename){case"XMSGIgReceiverFetchXmaFeedFetchParams":return n(b);case"XMSGIgReceiverFetchXmaProfileFetchParams":return q(b);case"XMSGIgReceiverFetchXmaClipFetchParams":return l(b);default:return!1}}function y(a){return a==null?!1:d("LSThreadBitOffset").has(261,a)}g.isInstamadilloTTLCTextEnabled=j;g.isInstamadilloTTLCCallingEnabled=k;g.isInstamadilloTTLCClipEnabled=l;g.isInstamadilloTTLCReelShareEnabled=m;g.isInstamadilloTTLCMediaShareEnabled=n;g.isInstamadilloTTLCStoryShareEnabled=o;g.isInstamadilloTTLCLinkEnabled=p;g.isInstamadilloTTLCGenericXmaEnabled=q;g.isInstamadilloTTLCImageEnabled=r;g.isInstamadilloTTLCVideoEnabled=s;g.isInstamadilloTTLCAudioEnabled=t;g.isInstamadilloTTLCProfileEnabled=u;g.isIGDTTLCEnabledForThread=v;g.threadHasInstamadilloTTLCCapability=w;g.isIGDTTLCEnabledForIGDCandidate=a;g.getTtlcMessageTypeMap=b;g.getTTLCLoggingExtraData=e;g.getTTLCBooleanAnnotations=f;g.isXmaReceiverFetchTTLCEnabled=x;g.isInstamadilloOptionalE2EE=y}),98);
__d("IGDInstamadilloUtils",["ExecutionEnvironment","IGDThreadTTLCUtils","LSThreadBitOffset","gkx","isInstamadillo","qex"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){return(a==null?void 0:a.transportKey)==="Instamadillo"}function j(a){return a==null?!1:d("LSThreadBitOffset").has(214,a)}function a(a){return a==null?!1:d("LSThreadBitOffset").has(212,a)}function k(a){return a==null?!1:d("LSThreadBitOffset").has(38,a)}function b(a){return a==null?!1:d("LSThreadBitOffset").has(211,a)}function e(a){var b=j(a);a=l(a);return a||b}function l(a){if(c("gkx")("6650"))return!1;var b=k(a),e=j(a);a=d("IGDThreadTTLCUtils").threadHasInstamadilloTTLCCapability(a);return b&&(e||a)}function f(a,b){a=i(a)&&a.ephemeralExpirationTs!=null;return b&&a||!b&&!a}function m(a){a=i(a);return!a?!0:c("isInstamadillo")()}var n=function(){var a={browser:(h||(h=c("ExecutionEnvironment"))).isInBrowser,isLegacyArmadilloTLC:c("qex")._("121")===!0,isMobileDM:c("gkx")("2553"),isMobileInstamadilloTLC:c("gkx")("2322"),isMobileOrWebTTLC:c("gkx")("2406"),isWebTTLC:c("qex")._("954")===!0,sharedWorker:h.isInSharedWorker,worker:h.isInWorker},b="";for(a of Object.entries(a)){var d=a[0],e=a[1];b+=d+": "+String(e)+"\n"}return b};g.isInstamadilloMessage=i;g.isInstamadilloCutover=j;g.isInstamadilloDMToggleEnabled=a;g.isIGDDisappearingModeEnabled=k;g.isInstamadilloTransportEnabled=b;g.isInstamadilloHardblockEnabled=e;g.isDMHardblockedEnabled=l;g.shouldRenderMessageReply=f;g.canMutateIGDMessage=m;g.getE2EEGatingStateAsString=n}),98);
__d("IGDRouteProvider.react",["I64","react","react-compiler-runtime","useCurrentRoute"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=h||(h=d("react"));e=h;f=e.createContext;var k=e.useContext;function l(a){try{return(i||(i=d("I64"))).of_string(a)}catch(a){return}}function m(a){if(a==null)return;a=a.params.thread_key;if(a!=null&&typeof a==="string")return l(a)}var n=f();function a(a){var b=d("react-compiler-runtime").c(5);a=a.children;var e=c("useCurrentRoute")(),f;b[0]!==e?(f=m(e),b[0]=e,b[1]=f):f=b[1];e=f;b[2]!==a||b[3]!==e?(f=j.jsx(n.Provider,{value:e,children:a}),b[2]=a,b[3]=e,b[4]=f):f=b[4];return f}function b(){return k(n)}g.IGDRouteContextProvider=a;g.useThreadKeyFromCurrentRoute=b}),98);
__d("IGDInteractionTraceAnnotations",["I64","IGDInstamadilloUtils","IGDRouteProvider.react","IGDThreadTTLCUtils","Int64Hooks","InteractionTracing","LSIntEnum","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=(h||d("react")).useEffect;function a(a){return babelHelpers["extends"]({},d("IGDThreadTTLCUtils").getTTLCBooleanAnnotations(a),{is_dm:d("IGDInstamadilloUtils").isIGDDisappearingModeEnabled(a),is_instamadillo:d("IGDInstamadilloUtils").isInstamadilloTransportEnabled(a),is_instamadillo_tlc:d("IGDInstamadilloUtils").isInstamadilloCutover(a)})}function l(a,b){var c=d("IGDInstamadilloUtils").isInstamadilloCutover(a),e=d("IGDInstamadilloUtils").isInstamadilloTransportEnabled(a),f=d("IGDInstamadilloUtils").isIGDDisappearingModeEnabled(a);b.addAnnotationBoolean("is_instamadillo",e);b.addAnnotationBoolean("is_instamadillo_tlc",c);b.addAnnotationBoolean("is_dm",f);b.addAnnotationBoolean("is_instamadillo_ttlc",(e=d("IGDThreadTTLCUtils")).isIGDTTLCEnabledForThread(a));b.addAnnotationBoolean("is_instamadillo_ttlc_audio",e.isInstamadilloTTLCAudioEnabled(a));b.addAnnotationBoolean("is_instamadillo_ttlc_clip",e.isInstamadilloTTLCClipEnabled(a));b.addAnnotationBoolean("is_instamadillo_ttlc_generic_xma",e.isInstamadilloTTLCGenericXmaEnabled(a));b.addAnnotationBoolean("is_instamadillo_ttlc_image",e.isInstamadilloTTLCImageEnabled(a));b.addAnnotationBoolean("is_instamadillo_ttlc_link",e.isInstamadilloTTLCLinkEnabled(a));b.addAnnotationBoolean("is_instamadillo_ttlc_media_share",e.isInstamadilloTTLCMediaShareEnabled(a));b.addAnnotationBoolean("is_instamadillo_ttlc_profile",e.isInstamadilloTTLCProfileEnabled(a));b.addAnnotationBoolean("is_instamadillo_ttlc_reel_share",e.isInstamadilloTTLCReelShareEnabled(a));b.addAnnotationBoolean("is_instamadillo_ttlc_story_share",e.isInstamadilloTTLCStoryShareEnabled(a));b.addAnnotationBoolean("is_instamadillo_ttlc_text",e.isInstamadilloTTLCTextEnabled(a));b.addAnnotationBoolean("is_instamadillo_ttlc_video",e.isInstamadilloTTLCVideoEnabled(a))}function b(a){var b=d("react-compiler-runtime").c(3),e,f;b[0]!==a?(e=function(){c("InteractionTracing").getPendingInteractions().forEach(function(b){l(a,b)})},f=[a],b[0]=a,b[1]=e,b[2]=f):(e=b[1],f=b[2]);d("Int64Hooks").useEffectInt64(e,f)}var m=new Set();function e(a){var b=d("react-compiler-runtime").c(7),e;b[0]!==a.consistentThreadFbid||b[1]!==a.threadKey||b[2]!==a.threadSubtype||b[3]!==a.threadType?(e=function(){var b=(i||(i=d("I64"))).to_string(a.threadKey);c("InteractionTracing").getPendingInteractions().forEach(function(c){var e=m.has(b);c.addAnnotationBoolean("is_thread_visited",e);c.addAnnotation("thread_key",(i||(i=d("I64"))).to_string(a.threadKey));a.consistentThreadFbid!=null&&c.addAnnotation("consistent_thread_fbid",(i||(i=d("I64"))).to_string(a.consistentThreadFbid));c.addAnnotationInt("thread_type",(j||(j=d("LSIntEnum"))).toNumber(a.threadType));a.threadSubtype!=null&&c.addAnnotation("thread_subtype",(i||(i=d("I64"))).to_string(a.threadSubtype))});return function(){m.add(b)}},b[0]=a.consistentThreadFbid,b[1]=a.threadKey,b[2]=a.threadSubtype,b[3]=a.threadType,b[4]=e):e=b[4];var f;b[5]!==a?(f=[a],b[5]=a,b[6]=f):f=b[6];d("Int64Hooks").useEffectInt64(e,f)}function f(){var a=d("react-compiler-runtime").c(5),b=d("IGDRouteProvider.react").useThreadKeyFromCurrentRoute(),e;a[0]!==b?(e=b!=null?(i||(i=d("I64"))).to_string(b):null,a[0]=b,a[1]=e):e=a[1];var f=e;a[2]!==f?(b=function(){c("InteractionTracing").getPendingInteractions().forEach(function(a){if(f==null){a.addAnnotationInt("rendered_direct_null_state",1);a.addAnnotationInt("has_thread_key",0);return}a.addAnnotationInt("has_thread_key",1);a.addAnnotationInt("rendered_direct_null_state",0)})},e=[f],a[2]=f,a[3]=b,a[4]=e):(b=a[3],e=a[4]);k(b,e)}g.getInstamadilloBooleanAnnotations=a;g.addInstamadilloAnnotationsToInteractionTrace=l;g.useAddInstamadilloAnnotationsToInteractionTraces=b;g.useAddThreadAnnotationToInteractionTraces=e;g.useAddThreadRouteAnnotations=f}),98);
__d("LSCheckIfAuthoritativeThreadMissingMiActMapping",["gkx"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,b=a[a.length-1],d=[],e=[];return b.sequence([function(f){return b.sequence([function(e){return c("gkx")("4792")?b.sequence([function(c){return b.db.table(173).fetch([[[a[0]]]]).next().then(function(c,e){e=c.done;c=c.value;return e?b.sequence([function(c){return b.db.table(9).fetch([[[a[0]]]]).next().then(function(a,c){var e=a.done;a=a.value;return e?d[3]=!1:(c=a.item,d[3]=b.i64.eq(c.authorityLevel,b.i64.cast([0,80])))})},function(a){return d[1]=d[3]}]):(c.item,d[1]=!1)})},function(a){return d[0]=d[1]}]):b.resolve(d[0]=!1)},function(a){return e[0]=d[0]}])},function(a){return b.resolve(e)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxCheckIfAuthoritativeThreadMissingMiActMappingStoredProcedure";a.__tables__=["mi_act_mapping_table","threads"];b=a;g["default"]=b}),98);
__d("LSInitSyncCompleteSubscription",["I64","LSIntEnum","Promise","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(a,c){return new(j||(j=b("Promise")))(function(b,e){var f=d("ReQL").fromTableAscending(a.tables.sync_groups).getKeyRange(c).subscribe(function(a,c){if(c.operation==="delete")return;if((h||(h=d("I64"))).equal(c.value.syncStatus,(i||(i=d("LSIntEnum"))).ofNumber(2))){f();return b()}})})}function a(a,b){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.sync_groups).getKeyRange(b)).then(function(c){if(c!=null&&(h||(h=d("I64"))).equal(c.syncStatus,(i||(i=d("LSIntEnum"))).ofNumber(2)))return;return k(a,b)})}function c(a){return k(a,(i||(i=d("LSIntEnum"))).ofNumber(1))}g.maybeWaitForSyncGroup=a;g.use=c}),98);
__d("WAHashStringToNumber",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b=0;for(var c=0;c<a.length;c++){var d=a.charCodeAt(c);b=(b<<5)-b+d;b|=0}return Math.abs(b)}f.hashStringToNumber=a}),66);
__d("LSQplMarkPoint.nop",["EBMarkerIdToQPLEvent","Promise","QPLUserFlow","WAHashStringToNumber","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,e,f,g,i){try{a=c("nullthrows")(d("EBMarkerIdToQPLEvent").markerIdToQPLEvent(f));e=d("WAHashStringToNumber").hashStringToNumber(g);c("QPLUserFlow").addPoint(a,i,{instanceKey:e});return(h||(h=b("Promise"))).resolve()}catch(a){return(h||(h=b("Promise"))).resolve()}};a.__nop_name__="LSQplMarkPoint";g["default"]=a}),98);
__d("LSQplStartTrace.nop",["EBMarkerIdToQPLEvent","Promise","QPLUserFlow","WAHashStringToNumber","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,e,f,g,i,j){try{a=c("nullthrows")(d("EBMarkerIdToQPLEvent").markerIdToQPLEvent(f));e=d("WAHashStringToNumber").hashStringToNumber(g);c("QPLUserFlow").start(a,{instanceKey:e});return(h||(h=b("Promise"))).resolve()}catch(a){return(h||(h=b("Promise"))).resolve()}};a.__nop_name__="LSQplStartTrace";g["default"]=a}),98);
__d("LSShape",["LSDict"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return c("LSDict").fromObject(a)}function b(a){return c("LSDict").shapeToRecord(a)}g.ofRecord=a;g.toRecord=b}),98);
__d("LSVerifyE2EEMetadataThreadExistsV2",["LSCheckIfAuthoritativeThreadMissingMiActMapping","LSCreateOfflineThreadingID","LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){return c.i64.neq(a[1],void 0)?c.sequence([function(b){return c.db.table(9).fetch([[[a[1]]]]).next().then(function(b,c){var e=b.done;b=b.value;return e?(e=[void 0,void 0],d[3]=e[0],d[4]=e[1],e):(c=b.item,e=[a[1],c.authorityLevel],d[3]=e[0],d[4]=e[1],e)})},function(a){return a=[d[3],d[4]],d[0]=a[0],d[1]=a[1],a}]):c.resolve((b=[void 0,void 0],d[0]=b[0],d[1]=b[1],b))},function(e){return c.i64.neq(d[0],void 0)?c.sequence([function(e){return c.i64.neq(d[1],void 0)?c.sequence([function(a){return c.storedProcedure(b("LSCheckIfAuthoritativeThreadMissingMiActMapping"),d[0]).then(function(a){return a=a,d[3]=a[0],a})},function(b){return c.i64.gt(a[2],d[1])?c.forEach(c.db.table(9).fetch([[[d[0]]]]),function(b){var c=b.update;b.item;return c({authorityLevel:a[2]})}):c.resolve()},function(e){return d[3]||c.i64.gt(a[2],d[1])?(d[4]=new c.Map(),d[4].set("thread_fbid",d[0]),d[4].set("force_upsert",!1),d[4].set("use_open_messenger_transport",!1),d[4].set("sync_group",c.i64.cast([0,95])),d[4].set("metadata_only",!1),d[4].set("preview_only",!1),d[5]=d[4].get("thread_fbid"),d[6]=c.toJSON(d[4]),c.storedProcedure(b("LSIssueNewTask"),c.i64.to_string(d[5]),c.i64.cast([0,209]),d[6],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))):c.resolve()}]):c.resolve()},function(a){return d[2]=d[0]}]):c.sequence([function(e){return c.i64.neq(a[1],void 0)?c.sequence([function(e){return c.i64.neq(a[2],c.i64.cast([0,20]))?(d[11]=new c.Map(),d[11].set("thread_fbid",a[1]),d[11].set("force_upsert",!1),d[11].set("use_open_messenger_transport",!1),d[11].set("sync_group",c.i64.cast([0,95])),d[11].set("metadata_only",!1),d[11].set("preview_only",!1),d[12]=d[11].get("thread_fbid"),d[13]=c.toJSON(d[11]),c.storedProcedure(b("LSIssueNewTask"),c.i64.to_string(d[12]),c.i64.cast([0,209]),d[13],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))):c.resolve()},function(b){return d[3]=a[1]}]):c.sequence([function(a){return d[11]=c.i64.of_float(Date.now()),c.storedProcedure(b("LSCreateOfflineThreadingID"),d[11]).then(function(a){return a=a,d[12]=a[0],a})},function(a){return d[3]=d[12]}])},function(b){return c.i64.eq(c.i64.cast([0,0]),c.i64.cast([0,0]))?(b=["inbox",c.i64.cast([0,0])],d[4]=b[0],d[5]=b[1],b):(c.i64.eq(c.i64.cast([0,0]),c.i64.cast([0,1]))?(b=["pending",c.i64.cast([-1,4294967295])],d[11]=b[0],d[12]=b[1],b):(c.i64.eq(c.i64.cast([0,0]),c.i64.cast([0,2]))?(b=["other",c.i64.cast([-1,4294967294])],d[13]=b[0],d[14]=b[1],b):(c.i64.eq(c.i64.cast([0,0]),c.i64.cast([0,3]))?(b=["spam",c.i64.cast([-1,4294967293])],d[15]=b[0],d[16]=b[1],b):(c.i64.eq(c.i64.cast([0,0]),c.i64.cast([0,5]))?(b=["hidden",c.i64.cast([-1,4294967292])],d[17]=b[0],d[18]=b[1],b):(c.i64.eq(c.i64.cast([0,0]),c.i64.cast([0,4]))?(b=["archived",c.i64.cast([-1,4294967286])],d[19]=b[0],d[20]=b[1],b):(c.i64.eq(c.i64.cast([0,0]),c.i64.cast([0,15]))?(b=["restricted",c.i64.cast([-1,4294967281])],d[21]=b[0],d[22]=b[1],b):(b=["inbox",c.i64.cast([0,0])],d[21]=b[0],d[22]=b[1],b),b=[d[21],d[22]],d[19]=b[0],d[20]=b[1],b),b=[d[19],d[20]],d[17]=b[0],d[18]=b[1],b),b=[d[17],d[18]],d[15]=b[0],d[16]=b[1],b),b=[d[15],d[16]],d[13]=b[0],d[14]=b[1],b),b=[d[13],d[14]],d[11]=b[0],d[12]=b[1],b),b=[d[11],d[12]],d[4]=b[0],d[5]=b[1],b),d[6]=c.i64.cast([0,1083495711]),d[7]=c.i64.cast([0,1024]),d[8]=c.i64.cast([0,0]),d[9]=c.i64.cast([0,0]),d[10]=c.i64.cast([0,0]),c.forEach(c.filter(c.db.table(9).fetch([[[d[3]]]]),function(b){return c.i64.eq(b.threadKey,d[3])&&c.i64.lt(b.authorityLevel,a[2])}),function(a){return a["delete"]()})},function(b){return c.db.table(9).add({threadKey:d[3],mailboxType:c.i64.cast([0,4096]),threadType:a[0],folderName:d[4],lastActivityTimestampMs:c.i64.cast([-1,4294967295]),lastReadWatermarkTimestampMs:c.i64.cast([-1,4294967295]),removeWatermarkTimestampMs:c.i64.cast([-1,4294967295]),ongoingCallState:c.i64.cast([0,0]),parentThreadKey:d[5],authorityLevel:a[2],capabilities:d[6],capabilities2:d[7],capabilities3:d[8],capabilities4:d[9],capabilities5:d[10],unsendLimitMs:c.i64.cast([-1,4294967295]),syncGroup:c.i64.cast([0,95]),isHidden:!0,clientThreadKey:d[3]})},function(a){return d[2]=d[3]}])},function(a){return e[0]=d[2]}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxVerifyE2EEMetadataThreadExistsV2StoredProcedure";a.__tables__=["threads"];e.exports=a}),null);
__d("LSVerifyE2EEMetadataThreadExistsV2StoredProcedure",["LSSynchronousPromise","LSVerifyE2EEMetadataThreadExistsV2","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSVerifyE2EEMetadataThreadExistsV2"),e.threadType,e.threadKey,e.authorityLevel);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("MAWSetupWorkerAuxStateForLogging",["nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h=[],i=3,j={getWorkerAge:function(){if(j.workerStartTime!=null)return Math.floor((Date.now()-c("nullthrows")(j.workerStartTime))/1e3)},restartMessageTypes:[],restartReasons:[],workerStartTime:null,workerTerminatedPermanently:!1};function a(){j.workerStartTime=Date.now()}function b(a){h.push(a),h.length>i&&h.shift()}function d(){return h.join(",")}g.HEART_BEAT_HISTORY=h;g.WorkerLifeCycleState=j;g.resetWorkerCreationTime=a;g.addWorkerHeartbeatToHistory=b;g.getHeartbeatHistoryAsString=d}),98);
__d("MAWTrackPendingOccamadilloThreads",["Deferred","LSDatabaseSingleton","LSInitSyncCompleteSubscription","LSIntEnum","LSPlatformLsInitLog","MAWMIC","MAWMICSchema","QuickPerformanceLogger","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=(h={},h[d("MAWMICSchema").ANNOTATIONS.occamadilloBatchesSentToWorker]=0,h[d("MAWMICSchema").ANNOTATIONS.occamadilloPendingThreadsAfterInitSync]=0,h[d("MAWMICSchema").ANNOTATIONS.occamadilloDuplicateThreads]=0,h);(function(){Object.keys(l).forEach(function(a){d("MAWMIC").addIntAnnotation(a,0)})})();function m(a){d("MAWMIC").addIntAnnotation(a,++l[a])}function a(){return l.occamadilloBatchesSentToWorker}var n=new(c("Deferred"))(),o=new Set(),p=new Set(),q=new Set(),r=new Set();function b(a){a=a.callingSource;r.add((k||(k=d("LSIntEnum"))).toNumber(a));d("MAWMIC").addIntArrayAnnotation(d("MAWMICSchema").ANNOTATIONS.occamadilloCallingSources,Array.from(r))}function e(a){d("MAWMIC").addPoint(d("MAWMICSchema").POINTS.thread_mapping_start);if(o.has(a)){m(d("MAWMICSchema").ANNOTATIONS.occamadilloDuplicateThreads);return}p.add(a);d("LSPlatformLsInitLog").LsSync.isRunning()&&q.add(a);(i||(i=c("QuickPerformanceLogger"))).currentTimestamp();o.add(a);d("MAWMIC").addIntAnnotation("occamadilloThreadCount",o.size);d("LSPlatformLsInitLog").LsSync.hasEnded()&&m(d("MAWMICSchema").ANNOTATIONS.occamadilloPendingThreadsAfterInitSync)}function f(){d("MAWMIC").addBoolAnnotation("threadMappingAcked",!0)}async function s(a){if(c("gkx")("2661"))await n.getPromise();else{var b=await (j||(j=d("LSDatabaseSingleton"))).LSDatabaseSingleton;await d("LSInitSyncCompleteSubscription").maybeWaitForSyncGroup(b,(k||(k=d("LSIntEnum"))).ofNumber(95))}p.delete(a);q.delete(a);d("MAWMIC").addIntAnnotation("occamadilloCompleteThreadCount",o.size-p.size);u()}function t(){n.resolve(),u()}function u(){d("MAWMIC").addIntAnnotation("occamadilloThreadCount",o.size);if(d("LSPlatformLsInitLog").LsSync.hasEnded()&&q.size===0){d("MAWMIC").addPoint(d("MAWMICSchema").POINTS.thread_mapping_end);return}p.size===0&&d("MAWMIC").addPoint(d("MAWMICSchema").POINTS.thread_mapping_end)}g.incrementCounter=m;g.getBatchesSentNumber=a;g.markThreadPassedToNativeOp=b;g.addPendingThread=e;g.markBridgeCallAcked=f;g.removePendingThread=s;g.completeSync=t;g.maybeEndOccamadilloThreadMapping=u}),98);
__d("MAWInitError",[],(function(a,b,c,d,e,f){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(b,c){var d;d=a.call(this,b)||this;d.error=void 0;d.name="MAWInitError";d.message=b;d.error=c;return d}return b}(babelHelpers.wrapNativeSuper(Error));f.MAWInitError=a}),66);
__d("MAWInit",["MAWCurrentUser","MAWInitError","MAWMIC","MWQPLJoinId","MultipleTabsLogger","QPLUserFlow","QuickPerformanceLogger","WAGetStorageQplAnnotations","gkx","qpl","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("qpl")._(25310776,"6155"),j=!1,k=[],l=[],m=!1;function n(){if(m)return;m=!0;c("QPLUserFlow").addAnnotations(i,{bool:{armadillo_init_sync_api_improvements:c("gkx")("24025"),isArmadilloPublicLaunchUser:c("gkx")("23405"),isTlcPublicUser:d("MAWCurrentUser").isTlcPublicUser(),useSharedWorker:d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()}})}var o=!1,p=function(){return document.visibilityState!==void 0?document.visibilityState==="hidden":document.hidden},q=function(){r("visibility_change_"+(p()?"hidden":"visible"))};function a(){if(o)return;d("MAWMIC").addPoint("maw_init_start");o=!0;c("QPLUserFlow").start(i,babelHelpers.extends({annotations:{bool:{initiallyHidden:p()},string:{hostname:window.location.hostname}},cancelOnUnload:!0},d("MWQPLJoinId").allowJoinId?{joinOptions:{joinId:d("MWQPLJoinId").MWQPLJoinId}}:{}));c("QPLUserFlow").addAlignmentPointForJoin(i,0,{requestId:d("MWQPLJoinId").MWQPLJoinId});d("MultipleTabsLogger").addAnnotationToQPLEvent(i);void d("WAGetStorageQplAnnotations").getStorageQplAnnotations().then(function(a){c("QPLUserFlow").addAnnotations(i,a)});n();document.addEventListener("visibilitychange",q);k.forEach(function(a){return a()});l.forEach(function(a){return a()});k.splice(0,k.length);l.splice(0,l.length)}function r(a,b){if(!o||j){if(!o&&(b==null?void 0:b.allowEarlyLogPoints)){var d=(h||(h=c("QuickPerformanceLogger"))).currentTimestamp();l.push(function(){c("QPLUserFlow").addPoint(i,a,{timestamp:d})})}return}n();c("QPLUserFlow").addPoint(i,a)}function b(a,b,d){if(!o||j){!o&&(d==null?void 0:d.allowEarlyAnnotations)&&k.push(function(){var d;c("QPLUserFlow").addAnnotations(i,{bool:(d={},d[a]=b,d)})});return}c("QPLUserFlow").addAnnotations(i,{bool:(d={},d[a]=b,d)})}function e(a,b,d){if(!o||j){!o&&(d==null?void 0:d.allowEarlyAnnotations)&&k.push(function(){var d;c("QPLUserFlow").addAnnotations(i,{string:(d={},d[a]=b,d)})});return}c("QPLUserFlow").addAnnotations(i,{string:(d={},d[a]=b,d)})}function f(a,b,d){if(!o||j){!o&&(d==null?void 0:d.allowEarlyAnnotations)&&k.push(function(){var d;c("QPLUserFlow").addAnnotations(i,{string_array:(d={},d[a]=b,d)})});return}c("QPLUserFlow").addAnnotations(i,{string_array:(d={},d[a]=b,d)})}function s(a,b,d){if(!o||j){!o&&(d==null?void 0:d.allowEarlyAnnotations)&&k.push(function(){var d;c("QPLUserFlow").addAnnotations(i,{int:(d={},d[a]=b,d)})});return}c("QPLUserFlow").addAnnotations(i,{int:(d={},d[a]=b,d)})}function t(){n(),j=!0,m=!1,document.removeEventListener("visibilitychange",q)}function u(a,b){t();b=b instanceof d("MAWInitError").MAWInitError&&b.error?b.error:b;c("QPLUserFlow").addAnnotations(i,{string:{errorDescription:b==null?void 0:b.message}});c("QPLUserFlow").endFailure(i,a,{error:b});d("MAWMIC").fail(a,b)}function v(a,b){t(),c("QPLUserFlow").addAnnotations(i,{string:{cancelReason:a}}),b&&c("QPLUserFlow").markError(i,"maw_init_cancel_with_error",{error:b}),c("QPLUserFlow").endCancel(i),d("MAWMIC").addStringAnnotation("mawInitCancelReason",a),d("MAWMIC").cancel("maw_init_cancel",b),c("QPLUserFlow").addAnnotations(c("qpl")._(29818881,"6702"),{string:{maw_cancel_reason:a,maw_error_message:b==null?void 0:b.message}})}function w(a){if(j)return;t();d("MAWMIC").addStringAnnotation("mawInitDropReason",a);(h||(h=c("QuickPerformanceLogger"))).markerDrop(i)}function x(){t(),c("QPLUserFlow").endSuccess(i),d("MAWMIC").addPoint("maw_init_end")}async function y(a,b){var c=a+"_start";a=a+"_end";r(c);c=await b();r(a);return c}var z={isCompleted:function(){return j}};b={addBoolAnnotation:b,addIntAnnotation:s,addStringAnnotation:e,addStringArrayAnnotation:f,cancel:v,drop:w,endSuccess:x,fail:u,logPoint:r,measurePerformance:y,start:a};g.MAWInitState=z;g.MAWInit=b}),98);
__d("MAWStartupLoggingUtils",["FBLogger","MAWInit","MAWMIC","getErrorSafe"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e){var f;f=(f=b==null?void 0:b.message)!=null?f:"";f.indexOf("Failed to execute 'importScripts'")>=0?d("MAWInit").MAWInit.fail("import_scripts_failure",c("getErrorSafe")(b)):d("MAWInit").MAWInit.fail("worker_error",c("getErrorSafe")(b));c("FBLogger")("messenger_web").mustfix("[MAWWebWorkerSingletonAsync: "+a+"]: %s:%s:%s:%s:%s:%s:%s",JSON.stringify(b==null?void 0:b.message),b==null?void 0:b.lineno,b==null?void 0:b.colno,b==null?void 0:b.filename,JSON.stringify(b,window.Object.getOwnPropertyNames(b)),b==null?void 0:b.name,e)}function b(a){var b=function b(d){d=d==null?void 0:d.data;if(typeof d==="object")if((d==null?void 0:d.type)==="importScripts_error"){var e,f;a.removeEventListener("message",b);var g=c("FBLogger")("messenger_web");g=g.addMetadata("FBLOGGER","ERROR_STACK",(e=typeof (d==null?void 0:d.stack)==="string"?d==null?void 0:d.stack:JSON.stringify(d==null?void 0:d.stack))!=null?e:"no_stack");e=d!=null?d:{};var h=e.error_code,i=e.error_msg,j=e.error_name;e=e.source;f=(f=d==null?void 0:d.perfEntry)!=null?f:{};var k=f.duration,l=f.encodedBodySize,m=f.responseStatus;f=f.transferSize;g.mustfix("[MAWWebWorkerSingletonAsync Script Import Error Details]: %s:%s:%s || errCode:%s || respStatus:%s || encBodySize:%s || duration:%s || transferSize:%s",e!=null&&JSON.stringify(e)||"no_source",j!=null&&JSON.stringify(j)||"no_name",i!=null&&JSON.stringify(i)||"no_msg",h!=null&&JSON.stringify(h)||"none",(g=JSON.stringify(m))!=null?g:"none",(e=JSON.stringify(l))!=null?e:"none",(j=JSON.stringify(k))!=null?j:"none",(i=JSON.stringify(f))!=null?i:"none")}else(d==null?void 0:d.type)==="importScripts_success"&&a.removeEventListener("message",b)};a.addEventListener("message",b)}var h=new Set(["worker_connection_established","worker_init_point_hsdp_end","worker_init_point_hblp_end","get_worker_rev_ack_received","old_worker_shutdown_end","old_worker_shutdown_start"]);function e(a){var b=a.data.annotations;if(b!=null){var c={allowEarlyAnnotations:!0};Object.keys(b).forEach(function(a){var e;e=(e=b[a])!=null?e:{};Object.entries(e).forEach(function(b){var e=b[0];b=b[1];e="workerInit"+e.charAt(0).toUpperCase()+e.substring(1);a==="int"&&typeof b==="number"?(d("MAWInit").MAWInit.addIntAnnotation(e,b,c),d("MAWMIC").addIntAnnotation(e,b)):a==="string"&&typeof b==="string"?(d("MAWInit").MAWInit.addStringAnnotation(e,b,c),d("MAWMIC").addStringAnnotation(e,b)):a==="bool"&&typeof b==="boolean"&&(d("MAWInit").MAWInit.addBoolAnnotation(e,b,c),d("MAWMIC").addBoolAnnotation(e,b))})})}var e={allowEarlyLogPoints:!0};if(a.type==="point"){if(h.has(a.data.event)){var f="worker_"+a.data.event;d("MAWInit").MAWInit.logPoint(f,e);d("MAWMIC").addPoint(f)}}else a.type==="end"&&(a.data.cancel===!0?d("MAWInit").MAWInit.logPoint("worker_creation_cancel",e):a.data.errorName!=null&&(d("MAWInit").MAWInit.addStringAnnotation("errorDescription",a.data.errorName,{allowEarlyAnnotations:!0}),d("MAWInit").MAWInit.logPoint("worker_creation_fail",e)))}g.logWorkerError=a;g.setImportScriptsErrorListener=b;g.logSharedWorkerQPLEvents=e}),98);
__d("MAWWorkerWatchdogRecovery",[],(function(a,b,c,d,e,f){"use strict";var g=null;function a(a){g=a}function b(){return g}f.setRecoveryForWatchdog=a;f.getWorkerRecoveryForWatchdog=b}),66);
__d("SharedWorkerDevChangeManager",["gkx"],(function(a,b,c,d,e,f,g){"use strict";var h=!1,i=new Set();function a(a,b){var c=b.storageWorkerResource;b=b.tabResource;if(!h)return!0;if(i.has(a))return!0;if(new URLSearchParams(window.location.search).has("force_shared_worker_updates"))return!1;if(c.version===2&&b.version===2&&c.sandboxOnlyChecksum!=null)return c.sandboxOnlyChecksum===b.sandboxOnlyChecksum;return c.version===2&&c.rsrcBundleUrl==null||b.version===2&&b.getJSModuleBundleResource().url==null?!1:c.rsrcBundleUrl===b.getJSModuleBundleResource().url}function b(a){if(!h)return!1;if(i.has(a))return!1;return new URLSearchParams(window.location.search).has("force_shared_worker_updates")?!0:!1}function c(a){h&&i.add(a)}g.shouldUseStorageWorkerForDev=a;g.shouldUpgradeWorkerForDevExperimental=b;g.trackCreatedWorker=c}),98);
__d("SharedWorkerEventManager",["FBLogger"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){var d=function(a){var d;if(typeof a.data==="object"&&((d=a.data)==null?void 0:d.type)==="console"&&typeof ((d=a.data)==null?void 0:d.response)==="object"&&((d=a.data)==null?void 0:d.response)!=null){d=a.data.response;a=d.method;d=d.args;if(typeof a!=="string"||!["log","error","info","debug","warn"].includes(a)){c("FBLogger")("worker").mustfix("Unexpected console method: %s",String(a));return}if(!Array.isArray(d)){c("FBLogger")("worker").mustfix('Expected console args "%s" to be an array',JSON.stringify(d));return}b({method:a,args:d})}},e=a.port;e.addEventListener("message",d);return function(){return e.removeEventListener("message",d)}}function i(a,b){var c=function(a){var c;if(typeof a.data==="object"&&((c=a.data)==null?void 0:c.type)==="sw-uncaught-error"){a=typeof ((c=a.data)==null?void 0:c.e)==="object"?(c=a.data.e)!=null?c:{}:{};c=a.error;var d=a.lineno,e=a.colno,f=a.filename;a=a.message;b({error:c instanceof Error?c:null,errorObject:{lineno:typeof d==="number"?d:null,colno:typeof e==="number"?e:null,filename:typeof f==="string"?f:null,message:typeof a==="string"?a:null}})}},d=a.port;d.addEventListener("message",c);return function(){return d.removeEventListener("message",c)}}function a(a,b,d){var e=function(a){var e;if(typeof a.data==="object"&&((e=a.data)==null?void 0:e.type)==="sw-get-rev"&&typeof a.data.response==="object"){b==null?void 0:b.markPoint("get_worker_rev_ack_received");a=typeof a.data==="object"&&typeof ((e=a.data)==null?void 0:e.response)==="object"?(e=a.data)==null?void 0:e.response:{};e=a==null?void 0:a.workerRevision;var f=a==null?void 0:a.spinTime;a=a==null?void 0:a.workerChecksum;if(e==null||typeof e!=="number"){b==null?void 0:b.addAnnotations({string:{malformedData:"rev is non-number"}});c("FBLogger")("worker").mustfix("Expected worker rev to be non-null number, but instead received: %s",String(e));return}if(f==null||typeof f!=="number"){b==null?void 0:b.addAnnotations({string:{malformedData:"spin_time is non-number"}});c("FBLogger")("worker").mustfix("Expected worker spin time to be non-null number, but instead received: %s",String(f));return}d({rev:e,spinTime:f,workerChecksum:typeof a==="string"?a:void 0})}},f=a.port;f.addEventListener("message",e);return function(){return f.removeEventListener("message",e)}}function b(a,b,c){var d=function d(e){var f;if(typeof e.data==="object"&&((f=e.data)==null?void 0:f.type)==="sw-shutdown"&&typeof e.data.response==="object"){var g,h;f=typeof ((f=e.data.response)==null?void 0:f.reason)==="string"?(f=e.data.response)==null?void 0:f.reason:null;g=typeof ((g=e.data.response)==null?void 0:g.workerID)==="string"?(g=e.data.response)==null?void 0:g.workerID:null;e=typeof ((h=e.data.response)==null?void 0:h.isInitialized)==="boolean"?(h=e.data.response)==null?void 0:h.isInitialized:null;b({reason:f,workerID:g,isInitialized:e});(c==null?void 0:c.once)===!0&&a.port.removeEventListener("message",d)}},e=a.port;e.addEventListener("message",d);return function(){return e.removeEventListener("message",d)}}function d(a,b){a.port.addEventListener("message",function(a){var c;typeof a.data==="object"&&((c=a.data)==null?void 0:c.type)==="sw-uptime-tracking"&&typeof ((c=a.data)==null?void 0:c.response)==="object"&&typeof ((c=a.data)==null?void 0:(c=c.response)==null?void 0:c.trackerID)==="number"&&b({trackerID:a.data.response.trackerID})})}function e(a,b,d){var e=function(a){var e;if(typeof a.data==="object"&&((e=a.data)==null?void 0:e.type)==="execute-worker-ack"&&typeof ((e=a.data)==null?void 0:e.response)==="object"){e=typeof a.data==="object"&&typeof ((e=a.data)==null?void 0:e.response)==="object"?(a=(e=a.data)==null?void 0:e.response)!=null?a:{}:{};a=e.workerRevision;var f=e.spinMode,g=e.spinTime,h=e.firstInit,i=e.errorGettingSiteData;e=e.error;if(typeof h!=="boolean"){b==null?void 0:b.addAnnotations({string:{malformedData:"firstInit is non-boolean"}});c("FBLogger")("worker").mustfix("Expected firstInit to be a boolean, but instead received: %s",String(h));return}i=i!=null?i:e;if(typeof i==="string")return d({err:i,isFirstInit:h});if(typeof a==="number"&&typeof f==="number"&&typeof g==="number")return d({workerRev:a,workerSpinTime:g,workerSpinMode:f,isFirstInit:h});else b==null?void 0:b.addAnnotations({string:{malformedData:"workerRevision, spinMode, and/or spinTime are non-numbers"}}),c("FBLogger")("worker").mustfix("Expected workerRevision, spinMode, and spinTime to be non-null number, but instead received: %s %s %s",String(a),String(f),String(g))}},f=a.port;f.addEventListener("message",e);return function(){return f.removeEventListener("message",e)}}function f(a,b,d,e){var f=function f(g){var h;if(typeof g.data==="object"&&((h=g.data)==null?void 0:h.type)==="execute-worker-imports"&&typeof ((h=g.data)==null?void 0:h.response)==="object"){(e==null?void 0:e.once)===!0&&a.port.removeEventListener("message",f);b==null?void 0:b.markPoint("bundle_imports_ack");h=typeof g.data==="object"&&typeof ((h=g.data)==null?void 0:h.response)==="object"?(g=(h=g.data)==null?void 0:h.response)!=null?g:{}:{};g=h.err;h=h.attempts;if(g!=null&&typeof g!=="string"){b==null?void 0:b.addAnnotations({string:{malformedData:"err is neither null or a string"}});c("FBLogger")("worker").mustfix("Expected err to be null or a string, but instead receieved: %s",String(g));return}if(h!=null&&typeof h!=="number"){b==null?void 0:b.addAnnotations({string:{malformedData:"attempts is neither null or a number"}});c("FBLogger")("worker").mustfix("Expected attempts to be a number or null, but instead receieved: %s",String(h));return}d({err:g,attempts:h})}},g=a.port;g.addEventListener("message",f);return function(){return g.removeEventListener("message",f)}}function j(a,b,d){var e=function(a){var e;if(typeof a.data==="object"&&((e=a.data)==null?void 0:e.type)==="ww-hrp-init"){b==null?void 0:b.markEventEnd("hrp_init");e=typeof a.data==="object"&&typeof ((e=a.data)==null?void 0:e.response)==="object"?(a=(e=a.data)==null?void 0:e.response)!=null?a:{}:{};a=e.err;if(a!=null&&typeof a!=="string"){b==null?void 0:b.addAnnotations({string:{malformedData:"err is neither null or a string"}});c("FBLogger")("worker").mustfix("Expected err to be null or a string, but instead receieved: %s",String(a));return}d({err:a})}},f=a.port;f.addEventListener("message",e);return function(){return f.removeEventListener("message",e)}}function k(a,b){var c=function(a){var c;if(typeof a.data==="object"&&((c=a.data)==null?void 0:c.type)==="worker-init-mark"&&typeof ((c=a.data)==null?void 0:c.response)==="object"&&typeof ((c=a.data)==null?void 0:(c=c.response)==null?void 0:c.point)==="string"){b((c=a.data)==null?void 0:(a=c.response)==null?void 0:a.point)}},d=a.port;d.addEventListener("message",c);return function(){return d.removeEventListener("message",c)}}function l(a,b,c){var d=function d(e){var f;if(typeof e.data==="object"&&((f=e.data)==null?void 0:f.type)==="self-terminate"&&typeof ((f=e.data)==null?void 0:f.response)==="object"&&typeof ((f=e.data)==null?void 0:(f=f.response)==null?void 0:f.from)==="string"){var g,h,i;f=(f=e.data)==null?void 0:(f=f.response)==null?void 0:f.from;g=typeof ((g=e.data)==null?void 0:(g=g.response)==null?void 0:g.reason)==="string"?(g=e.data)==null?void 0:(g=g.response)==null?void 0:g.reason:"unknown";h=typeof ((h=e.data)==null?void 0:(h=h.response)==null?void 0:h.workerID)==="string"?(h=e.data)==null?void 0:(h=h.response)==null?void 0:h.workerID:"unknown";i=typeof ((i=e.data)==null?void 0:(i=i.response)==null?void 0:i.error)==="string"?(i=e.data)==null?void 0:(e=i.response)==null?void 0:e.error:void 0;(c==null?void 0:c.once)===!0&&a.port.removeEventListener("message",d);b(f,g,h,i)}},e=a.port;e.addEventListener("message",d);return function(){return e.removeEventListener("message",d)}}function m(a,b){b=b!=null?b:{};var c=b.reason;b=b.upgrade;a.port.postMessage({type:"sw-shutdown",args:[{reason:c,upgrade:b}]})}function n(a){a.port.postMessage({type:"sw-get-rev",args:[]})}function o(a,b){b=b!=null?b:{};var c=b.jsModuleResource;b=b.isDev;a.port.postMessage({type:"execute-worker",args:[c!=null?c:{},b]})}var p=["no-hrp","initialized","processed"];function q(a,b,c){var d=function d(e){var f;if(typeof e.data==="object"&&((f=e.data)==null?void 0:f.type)==="connection-ack"&&typeof ((f=e.data)==null?void 0:f.response)==="object"&&typeof ((f=e.data)==null?void 0:(f=f.response)==null?void 0:f.from)==="string"){var g;f=typeof ((f=e.data)==null?void 0:(f=f.response)==null?void 0:f.workerID)==="string"?(f=e.data)==null?void 0:(f=f.response)==null?void 0:f.workerID:void 0;g=typeof ((g=e.data)==null?void 0:(g=g.response)==null?void 0:g.hrpStatus)==="string"?(g=e.data)==null?void 0:(g=g.response)==null?void 0:g.hrpStatus:void 0;b((e=e.data)==null?void 0:(e=e.response)==null?void 0:e.from,f,g!=null&&p.includes(g)?g:void 0);(c==null?void 0:c.once)===!0&&a.port.removeEventListener("message",d)}},e=a.port;e.addEventListener("message",d);return function(){return e.removeEventListener("message",d)}}function r(a,b){var c=function(a){b(a.data)},d=a.port;d.addEventListener("message",c);return function(){return d.removeEventListener("message",c)}}function s(a,b){a.port.postMessage({type:"ww-connection-ack"}),b==null?void 0:b.markPoint("worker_connection_ack_requested")}function t(a,b,c){c=b.isDev;var d=b.hrp;b=b.js_env;a.port.postMessage({type:"ww-hrp-init",hrp:d,is_dev:c,js_env:b,tiered:!0})}function u(a,b){b=b.trackerID;a.port.postMessage({type:"sw-uptime-tracking",args:{trackerID:b}})}function v(a){var b=h(a,function(a){var b,c=a.args;a=a.method;(b=console)[a].apply(b,c)}),d=i(a,function(a){var b=a.error;a=a.errorObject;b!=null?c("FBLogger")("worker").catching(b).mustfix("Shared Worker uncaught error."):c("FBLogger")("worker").mustfix("Shared Worker uncaught error with no Error object. %s:%d:%d:%s",a.message,a.lineno,a.colno,a.filename)});return function(){b(),d()}}g.registerLogFowardingListener=h;g.registerUncaughtErrorForwardingListener=i;g.registerGetWorkerRevListener=a;g.registerWorkerShutdownListener=b;g.registerUptimeTrackerListener=d;g.registerExecuteWorkerAckListener=e;g.registerExecuteWorkerImportsListener=f;g.registerHrpInitListener=j;g.registerWorkerInitPointsListener=k;g.registerWorkerSelfTerminationListener=l;g.emitWorkerShutdown=m;g.emitGetRev=n;g.emitExecuteWorker=o;g.registerConnectionAckListener=q;g.registerAnyMessageListener=r;g.emitConnectionAckRequest=s;g.emitHrpInit=t;g.emitUptimeTracking=u;g.registerForwardListeners=v}),98);
__d("WebStorageLockManager",["FBLogger","LocalStorageWrapper","LockManager","Run","clearInterval","err","promiseDone","setInterval","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";function h(a){c("FBLogger")("messenger_web").mustfix(a)}function a(a,b){var e="Failed to execute 'request' on 'LockManager'",f="Lock broken by another request with the 'steal' option.",g=function(a,b,c){var d=a.get(b);if(d!=null)return d;d=c();a.set(b,d);return d};try{var i=d("LocalStorageWrapper").getStorage(h),j=function(a,c){d("LocalStorageWrapper").setItemGuarded(i,a,c,h,b==null?void 0:b.onQuotaExceeded)},k=function(a){d("LocalStorageWrapper").removeItemGuarded(i,a,h)},l=function(a){return d("LocalStorageWrapper").getItemGuarded(i,a,h)},m=function(){function a(a,b){this.lockName=a,this.tabId=b,this.lockA=this.lockName+"-a",this.lockB=this.lockName+"-b"}var b=a.prototype;b.run=function(a){return this.$1(a,0)};b.$1=function(a,b){var d=this,e=function(c){return window.requestAnimationFrame(function(){return d.$1(a,b+1).then(c)})},f=function(a){return l(a)==null};j(this.lockA,this.tabId);return new Promise(function(g){var h=function(){try{a(),g()}finally{k(d.lockB),k(d.lockA)}};f(d.lockB)||b>10?(b>10&&c("FBLogger")("messenger_web").warn("web-lock polyfill: Had to steal lock"),j(d.lockB,d.tabId),l(d.lockA)===d.tabId?h():window.requestAnimationFrame(function(){l(d.lockB)===d.tabId?h():e(g)})):e(g)})};return a}(),n=function(){function a(b){this.tabId=b,this.lock=new m(a.tabsKey,b),c("promiseDone")(this.$1()),this.$2(),this.keepOnlyTabs(function(b){return a.isAlive(b)})}a.isAlive=function(b){b=l(a.$3(b));return b==null?!1:Date.now()-parseFloat(b)<1e3};var b=a.prototype;b.keepOnlyTabs=async function(b){await this.lock.run(function(){var c;c=JSON.parse((c=l(a.tabsKey))!=null?c:"[]").filter(b);c.length>0?j(a.tabsKey,JSON.stringify(c)):k(a.tabsKey)})};b.$2=function(){var b=a.$3(this.tabId);j(b,Date.now().toString());var e=c("setInterval")(function(){j(b,Date.now().toString())},500);d("Run").onUnload(function(){c("clearInterval")(e),k(b)})};b.$1=async function(){var b=this;await this.lock.run(function(){var c;c=JSON.parse((c=l(a.tabsKey))!=null?c:"[]");j(a.tabsKey,JSON.stringify([].concat(c,[b.tabId])))});d("Run").onUnload(function(){return c("promiseDone")(b.keepOnlyTabs(function(a){return a!==b.tabId}))})};a.$3=function(a){return"$navigator.heartbeat-"+a};return a}();n.tabsKey="$navigator.heartbeat-tabs";var o=function(){function a(b,e){var f=this;this.requests=new Map();this.name=b;this.tabId=e;this.queueKey=a.storagePrefix+"-"+b+"-q";this.currentOwnerKey=a.storagePrefix+"-"+b+"-o";this.lock=new m(a.storagePrefix+"-"+b,this.tabId);d("Run").onUnload(function(){c("promiseDone")(f.keepOnlyRequests(function(a){return(a==null?void 0:a.t)!==f.tabId}))})}var b=a.prototype;b.enqueue=async function(b,d,a){var e=this,f=c("uuidv4")().toString(),g={t:this.tabId,u:f},h=function(){b(null),e.markRequestReleased(f)},i=function(){b(f),e.markRequestReleased(f)};this.requests.set(f,[function(){return b(f)},function(){d(),e.markRequestReleased(f)}]);if((a==null?void 0:a.signal)!=null){a.signal.onabort=function(){c("promiseDone")(e.keepOnlyRequests(function(a){return(a==null?void 0:a.u)!==f})),i()};if(a.signal.aborted)return i()}await this.lock.run(function(){var b=e.getOwner();(a==null?void 0:a.steal)===!0&&e.$1(b==null?void 0:b.u);if(b==null||(a==null?void 0:a.steal)===!0||!n.isAlive(b.t))e.$2(e.currentOwnerKey,babelHelpers.extends({},g,{},(a==null?void 0:a.steal)===!0?{s:!0}:{})),e.$3(f);else if((a==null?void 0:a.ifAvailable)!==!0){b=e.getQueue();b.push(g);e.$2(e.queueKey,b)}else h()})};b.dequeue=async function(b){var c=this,d,e=null;await this.lock.run(function(){var d=c.getOwner();if((d==null?void 0:d.t)!==c.tabId||(d==null?void 0:d.u)!==b)return;d=c.getQueue();d=a.getNextOwner(d);var f=d[0];d=d[1];e=f;c.$2(c.currentOwnerKey,f);c.$2(c.queueKey,d)});this.$3((d=e)==null?void 0:d.u)};b.storageChangedOnOtherTab=async function(a,b){var c=this;a==="o"&&await this.lock.run(function(){var a=c.getOwner();if(a==null)return;c.$3(a==null?void 0:a.u);if(a.s===!0){a=b==null?void 0:b.oldValue;if(a!=null){a=JSON.parse(a);a.t===c.tabId&&c.$1(a.u)}}})};b.getQueue=function(){var a;return(a=this.$4(this.queueKey))!=null?a:[]};b.getOwner=function(){return this.$4(this.currentOwnerKey)};a.getQueueNameAndStorageType=function(b){if(!b.startsWith(a.storagePrefix))return null;var d=b.slice(a.storagePrefix.length+1,b.length-2),e=b.charAt(b.length-1);switch(e){case"q":case"o":case"a":case"b":break;default:throw c("err")("Queue was stored with a suffix other than q or o. This is either a bug in the web lock api polyfill code, or it means that something overwrote localStorage with a weird key. Key: "+b)}return[d,e]};a.getNextOwner=function(a){for(var b=0;b<a.length;b+=1)if(n.isAlive(a[b].t))return[a[b],a.slice(b+1)];return[null,[]]};b.$4=function(a){a=l(a);return a!=null?JSON.parse(a):null};b.$2=function(a,b){b=b==null||Array.isArray(b)&&b.length===0?null:JSON.stringify(b);b==null?k(a):j(a,b)};b.keepOnlyRequests=async function(b){var c=this;await this.lock.run(function(){var d=c.getOwner(),e=c.getQueue().filter(b);if(b(d))c.$2(c.queueKey,e);else{d=a.getNextOwner(e);e=d[0];d=d[1];c.$2(c.currentOwnerKey,e);c.$2(c.queueKey,d)}})};b.markRequestReleased=function(a){a!=null&&this.requests.delete(a)};b.$3=function(a){if(a!=null){a=this.requests.get(a);if(a!=null){a=a[0];a()}}};b.$1=function(a){if(a!=null){a=this.requests.get(a);if(a!=null){a[0];a=a[1];a()}}};return a}();o.storagePrefix="$navigator.locks";var p=function(){function a(a){this.$1=new Map(),this.storage=d("LocalStorageWrapper").getStorage(h),this.tabId=a,new n(this.tabId),c("promiseDone")(this.$2()),this.$3()}var b=a.prototype;b.request=function(){var a=this;for(var b=arguments.length,g=new Array(b),h=0;h<b;h++)g[h]=arguments[h];return new Promise(function(b,h){c("promiseDone")(async function(i){var j=g[0],b=g.length===3?g[1]:null,k=g.length===2?g[1]:g[2];if(j.startsWith("-"))throw new DOMException("Names cannot start with '-'.",e);if((b==null?void 0:b.ifAvailable)===!0&&(b==null?void 0:b.signal)!=null)throw new DOMException("The 'signal' and 'ifAvailable' options cannot be used together.",e);var l=a.$4(j),m=await new Promise(function(a){c("promiseDone")(l.enqueue(a,function(){h(new DOMException(f,e))},b))});if((b==null?void 0:(i=b.signal)==null?void 0:i.aborted)===!0)throw new DOMException("The request was aborted.",e);try{await k(m!=null?{mode:(i=b==null?void 0:b.mode)!=null?i:d("LockManager").LockMode.Exclusive,name:j}:null)}finally{m!=null&&await l.dequeue(m),l.markRequestReleased(m)}}(),b,h)})};b.query=function(){var a=[],b=[];for(var c of this.$5())if(c!=null){var e={mode:d("LockManager").LockMode.Exclusive,name:c.name};if(c.getOwner()!=null)a.push(e);else for(var f of c.getQueue())b.push(e)}return Promise.resolve({held:a,pending:b})};b.$4=function(a){var b=this;return g(this.$1,a,function(){return new o(a,b.tabId)})};b.$3=function(){var a=this;window.addEventListener("storage",function(b){var d=b.key;if(b.storageArea!==a.storage||d==null)return;d=o.getQueueNameAndStorageType(d);if(d==null)return;var e=d[0];d=d[1];c("promiseDone")((e=a.$4(e))==null?void 0:e.storageChangedOnOtherTab(d,b))})};b.$2=async function(){await Promise.all(this.$5().map(function(a){return a==null?void 0:a.keepOnlyRequests(function(a){return a==null?!1:n.isAlive(a.t)})}))};b.$5=function(){var a=this;return i==null?[]:Object.keys(i).map(function(b){b=o.getQueueNameAndStorageType(b);if(b==null)return;b=b[0];return a.$4(b)})};return a}();return new p(a)}catch(a){return null}}g.make=a}),98);
__d("supportsNativeWebLock",[],(function(a,b,c,d,e,f){"use strict";function a(){return self.LockManager!=null&&self.navigator.locks instanceof self.LockManager}f["default"]=a}),66);
__d("SharedWorkerLockManager",["Deferred","FBLogger","WebStorageLockManager","emptyFunction","pageID","promiseDone","setTimeout","supportsNativeWebLock"],(function(a,b,c,d,e,f,g){"use strict";var h="shared_worker_mutex",i=6e5;function j(a){var b;b=(b=window)==null?void 0:(b=b.navigator)==null?void 0:b.locks;if(b!=null)return b;var e=d("WebStorageLockManager").make(c("pageID"));if(e!=null){a==null?void 0:a.addAnnotations({bool:{fallback_lock_manager:!0}});return{request:function(a,b){return e.request(a,b)}}}return null}function k(a,b,d){c("setTimeout")(function(){a.isSettled()||(b==null?void 0:b.endFailure("lock_timeout"),c("FBLogger")("worker").warn("[SharedWorkerLockManager]: lock timed out in %s ms",i),a.resolve(),d==null?void 0:d())},i)}function a(a,b){var d=b.workerQPLLogger,e=b.onLockTimeout;b=b.onLockFail;var f=j(d);d==null?void 0:d.addAnnotations({bool:{native_locks:f!=null?c("supportsNativeWebLock")():null}});if(f==null){d==null?void 0:d.markPoint("no_lock_manager");c("FBLogger")("worker").warn("Unable to initialize lock manager");a(c("emptyFunction"));return}d==null?void 0:d.markPoint("lock_requested");var g=new(c("Deferred"))();c("promiseDone")(f.request(h,function(){d==null?void 0:d.markPoint("lock_obtained");k(g,d,e);a(function(){d==null?void 0:d.markPoint("lock_released"),g.resolve()});return g.getPromise()}),void 0,b)}g.withWorkerLock=a}),98);
__d("SharedWorkerLoggingUtils",["ErrorSerializer","FBLogger","ODS","QPLUserFlow","getErrorSafe","pageID","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c,e){(h||(h=d("ODS"))).bumpEntityKey(6653,"shared_worker_infra","worker_self_termination."+b+"."+a),i(a,b,c,e,!0)}function i(a,b,d,e,f){f===void 0&&(f=!1);var g=c("qpl")._(931600201,"1438");c("QPLUserFlow").start(g);c("QPLUserFlow").endSuccess(g,{annotations:{string:{workerName:a,workerID:e,reason:d,location:b,pageID:c("pageID")},bool:{isSelfTermination:f}}})}function b(a,b,c,d,e,f){a==null?void 0:a.markEventEnd("execute_worker"),a==null?void 0:a.addAnnotations({"int":{runningWorkerRev:e,runningWorkerSpinTime:b,runningWorkerSpinMode:f},string:{executeWorkerErr:c},bool:{isFirstInit:d}})}function e(a,b,d){var e;e=c("getErrorSafe")((e=b instanceof ErrorEvent&&(b==null?void 0:b.error))!=null?e:b);c("FBLogger")("worker").catching(e).warn("Worker %s onerror: %s type, %s message",d,String(b.type),c("ErrorSerializer").toReadableMessage(e));a==null?void 0:a.addAnnotations({string_array:{onErrorHandler:[(a=JSON.stringify((d=e==null?void 0:e.message)!=null?d:b==null?void 0:b.message))!=null?a:"undefined",String((d=b==null?void 0:b.lineno)!=null?d:e==null?void 0:e.lineno),String((a=b==null?void 0:b.colno)!=null?a:e==null?void 0:e.colno),String((d=b==null?void 0:b.filename)!=null?d:e==null?void 0:e.filename)]}})}g.logSelfTermination=a;g.logShutdown=i;g.logExecuteAck=b;g.logSharedWorkerError=e}),98);
__d("validateSharedWorkerReference",["ConstUriUtils","isRelativeURL","isSameOrigin","memoize"],(function(a,b,c,d,e,f,g){"use strict";var h=c("memoize")(function(){return d("ConstUriUtils").getUri(window.location.href)});function i(a){var b=h(),e=d("ConstUriUtils").getUri(a);e=b!=null&&e!=null?c("isSameOrigin")(e,b):!1;return e||c("isRelativeURL")(a)}function a(a){if(a==null||typeof a!=="object")return null;var b=a.rev,c=a.spin_time,d=a.url,e=a.version,f=a.rsrcBundleUrl;a=a.sandboxOnlyChecksum;return typeof b!=="number"||typeof c!=="number"||e!=null&&e!==1&&e!==2||!Number.isInteger(b)||!Number.isInteger(c)||typeof d!=="string"||!i(d)||f!=null&&typeof f!=="string"||a!=null&&typeof a!=="string"?null:{rev:b,spin_time:c,url:d,version:e!=null?e:1,rsrcBundleUrl:f,sandboxOnlyChecksum:a}}g["default"]=a}),98);
__d("SharedWorkerStorageManager",["Deferred","FBLogger","Promise","WebAsyncStorage","validateSharedWorkerReference"],(function(a,b,c,d,e,f,g){"use strict";var h,i="__swbundle__",j={};function k(a){return""+i+a}function l(a){var b=new(c("Deferred"))();c("WebAsyncStorage").removeItem(k(a),function(c){if(c)return b.reject(c);j[a]=null;b.resolve()});return b.getPromise()}function m(a,b){var d=new(c("Deferred"))();c("WebAsyncStorage").setItem(k(a),b,function(c){if(c!=null)return d.reject(c);j[a]=b;d.resolve()});return d.getPromise()}function n(a){var b=new(c("Deferred"))();c("WebAsyncStorage").getItem(k(a),function(c,d){if(c)return b.reject(c);j[a]=d;b.resolve(d)});return b.getPromise()}function a(){return j}function d(a,b){return n(a).then(function(a){a=c("validateSharedWorkerReference")(a);return a==null?null:a})["catch"](function(d){c("FBLogger")("worker").catching(d).mustfix("Failed to getSharedWorkerReference for bundleName %s",a);b==null?void 0:b.addAnnotations({bool:{failedToGetSharedWorkerResource:!0}});throw d})}function e(a,b){return l(a)["catch"](function(d){c("FBLogger")("worker").catching(d).mustfix("Failed to removeSharedWorkerReference for bundleName %s",a);b==null?void 0:b.addAnnotations({bool:{failedToDeleteSharedWorkerResource:!0}});throw d})}function f(a,d,e){var f=c("validateSharedWorkerReference")(d);if(f==null){c("FBLogger")("worker").mustfix('Failed to save worker reference for bundle "%s". Invalid reference: %s',a,JSON.stringify(d));return(h||(h=b("Promise"))).resolve()}return m(a,f)["catch"](function(b){c("FBLogger")("worker").catching(b).mustfix("Failed to saveSharedWorkerReference for bundleName %s",a);e==null?void 0:e.addAnnotations({bool:{failedToSaveSharedWorkerResource:!0}});throw b})}function o(a,b,d){var e=new(c("Deferred"))();c("WebAsyncStorage").upsertAndSaveAtomic(k(a),function(a){a=c("validateSharedWorkerReference")(a);return b(a)},function(b,f){if(b){d==null?void 0:d.addAnnotations({bool:{failedToGetOrUpdateSharedWorkerResource:!0}});c("FBLogger")("worker").catching(b).mustfix("Failed to getOrUpdateWorkerReference for bundleName %s",a);return e.reject(b)}j[a]=f;e.resolve(f)});return e.getPromise()}g.SHARED_WORKER_STORAGE_KEY_BASE=i;g.getDebugState=a;g.getSharedWorkerReference=d;g.removeSharedWorkerReference=e;g.saveSharedWorkerReference=f;g.getOrUpdateWorkerReference=o}),98);
__d("createSharedWorkerV2BundleUrlExperimental",["XCometFBMultiSiteWebWorkerV2InitScriptControllerRouteBuilder","nullthrows","supportsModuleWorker"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=c("supportsModuleWorker")(!0);return c("nullthrows")((b=c("XCometFBMultiSiteWebWorkerV2InitScriptControllerRouteBuilder").buildUri({worker_type:b?"MODULE":"CLASSIC",name:a}))==null?void 0:b.toString())}g["default"]=a}),98);
__d("SharedWorkerMigrationUtils",["ConstUriUtils","Deferred","FBLogger","SharedWorkerEventManager","SharedWorkerStatusLock","SharedWorkerStorageManager","TrustedTypesWebWorkerScriptURLPolicy","clearTimeout","createSharedWorkerV2BundleUrlExperimental","err","justknobx","setTimeout","supportsModuleWorker","supportsNativeWebLock"],(function(a,b,c,d,e,f,g){"use strict";async function h(a){if(!c("supportsNativeWebLock")())return!0;var b=await self.navigator.locks.query();return b.held.some(function(b){return b.name===d("SharedWorkerStatusLock").getDynamicStringInitLockName(a)})}function a(){return c("supportsNativeWebLock")()}async function i(a){if(!c("supportsNativeWebLock")())return!0;var b=await self.navigator.locks.query();return b.held.some(function(b){return b.name===d("SharedWorkerStatusLock").getStatusLockName(a)})}async function b(a,b){if(!c("supportsNativeWebLock")())return!0;var e=await self.navigator.locks.query();return e.held.some(function(c){return c.name===d("SharedWorkerStatusLock").getWorkerIdStatusLockName(a,b)})}var j={SharedWorkerBundle:c("justknobx")._("2852"),MAWMainWebWorkerV2Bundle:c("justknobx")._("2920")};function e(a){return(a=j[a])!=null?a:!1}async function f(a){if(!await h(a))return!1;var b=new(c("Deferred"))(),e=c("createSharedWorkerV2BundleUrlExperimental")(a);e=c("TrustedTypesWebWorkerScriptURLPolicy").createScriptURL(e);e=c("supportsModuleWorker")(!0)?new SharedWorker(e,{name:a,type:"module"}):new SharedWorker(e,a);d("SharedWorkerEventManager").registerWorkerShutdownListener(e,function(a){b.resolve(!0)},{once:!0});d("SharedWorkerEventManager").emitWorkerShutdown(e,{upgrade:!1,reason:"dynamic_string_worker_rollback"});e.port.start();return b.getPromise()}function k(a){a=d("ConstUriUtils").getUri(a);return a!=null&&a.getQueryParam("hash")!=null}async function l(a){var b=a.name,e=a.logger;try{a=await Promise.all([i(b),h(b)]);var f=a[0];a=a[1];if(!f||c("supportsNativeWebLock")()&&a){e.markPoint("legacy_termination_skipped");e.addAnnotations({bool:{dynamicStringWorkerAlreadyRunning:a,workerAlreadyRunning:f,native_locks:c("supportsNativeWebLock")()}});return}a=await d("SharedWorkerStorageManager").getSharedWorkerReference(b);e.markPoint("storage_read");e.addAnnotations({bool:{storageResourceSet:a!=null}});if(a==null)return;try{await d("SharedWorkerStorageManager").removeSharedWorkerReference(b),e.markPoint("storage_cleaned")}catch(a){e.markPoint("storage_error"),e.addAnnotations({string:{storageError:a.toString()}}),c("FBLogger")("worker").catching(a).mustfix("Failed to remove reference from storage.")}f=k(a.url);e.markPoint(f?"legacy_termination_start":"termination_skipped");if(f){var g=new(c("Deferred"))();f=c("TrustedTypesWebWorkerScriptURLPolicy").createScriptURL(a.url);a=c("supportsModuleWorker")(!0)?new SharedWorker(f,{name:b,type:"module"}):new SharedWorker(f,b);f=function(){e.markPoint("legacy_termination_end"),g.resolve(!0)};d("SharedWorkerEventManager").registerWorkerShutdownListener(a,f,{once:!0});d("SharedWorkerEventManager").registerWorkerSelfTerminationListener(a,f,{once:!0});a.port.start();d("SharedWorkerEventManager").emitWorkerShutdown(a,{upgrade:!1,reason:"maw-request-refresh"});b=c("setTimeout")(function(){e.markPoint("legacy_termination_timeout"),g.reject(c("err")("Failed to close Shared Web Worker properly. SelfTerminationTimeout was exceeded."))},1e3);await g.getPromise();c("clearTimeout")(b)}}catch(a){e.markPoint("legacy_check_and_termination_error"),e.addAnnotations({string:{legacyCheckError:a.toString()}}),c("FBLogger")("worker").catching(a).mustfix("Failed to check storage and possibly terminate legacy worker.")}}g.isDynamicStringWorkerRunning=h;g.supportsNativeWebLocks=a;g.isStatusLockHeld=i;g.isWorkerIdStatusLockHeld=b;g.shouldCheckForDynamicStringWorker=e;g.maybeTerminateDynamicStringWorker=f;g.isLegacyWorkerURL=k;g.checkStorageAndTerminateLegacyWorker=l}),98);
__d("SharedWorkerUptimeTracker",["FBLogger","ODS","SharedWorkerEventManager","clearInterval","performanceNow","setInterval","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=1e4,k=45e3,l=new Map();function m(a){return Math.floor(((i||(i=c("performanceNow")))()-a)/1e3)}function n(a,b){var e=0,f={};d("SharedWorkerEventManager").registerUptimeTrackerListener(a,function(a){a=a.trackerID;var c=f[a];if(c==null)return;(h||(h=d("ODS"))).bumpFraction(6653,"shared_worker_infra","worker_uptime."+b,1,0);h.bumpEntityKey(6653,"shared_worker_infra","worker_uptime_elapsed_time_to_response_sec."+m(c.createdMs)+"."+b);delete f[a]});return c("setInterval")(function(){var g=e++;c("setTimeout")(function(){var a=f[g];if(a==null)return;delete f[g]},k);f[g]={createdMs:(i||(i=c("performanceNow")))()};(h||(h=d("ODS"))).bumpFraction(6653,"shared_worker_infra","worker_uptime."+b,0,1);d("SharedWorkerEventManager").emitUptimeTracking(a,{trackerID:g})},j)}function a(a,b){if(l.has(b)){c("FBLogger")("worker").mustfix('Uptime tracking for worker "%s" already started.',b);return}l.set(b,{intervalID:n(a,b)})}function b(a){var b=l.get(a);b!=null&&(c("clearInterval")(b.intervalID),l["delete"](a))}g.startUptimeTracking=a;g.stopUptimeTracking=b}),98);
__d("buildSharedWorkerInitQPLLogger",["QPLUserFlow","SiteData","checkForIndexedDbSupported","pageID","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h=c("qpl")._(931595918,"2062"),i=0;function a(a){var b=!1,d=!1,e=i++;function f(f){var g=f.version,i=f.workerName,j=f.callReason,k=f.experimental_init;f=f.migrationEnabled;if(b||d)return;b=!0;g={"int":{version:g,clientRev:c("SiteData").client_revision},bool:{isDev:!1,supportsIDB:c("checkForIndexedDbSupported")(),experimental_init:k!=null?k:!1,migrationEnabled:f!=null?f:!1},string:{workerName:i,hostname:window.location.hostname,callReason:j,pageID:c("pageID")}};c("QPLUserFlow").start(h,{onFlowTimeout:function(){c("QPLUserFlow").addAnnotations(h,{bool:{setupTimeout:!0}},{instanceKey:e}),d=!0},cancelOnUnload:!0,annotations:g,timeoutInMs:66e4,instanceKey:e});a==null?void 0:a({type:"start",data:{annotations:g}})}function g(f,g){f=f+"_start";a==null?void 0:a({type:"point",data:{annotations:g,event:f}});if(!b||d)return;c("QPLUserFlow").addPoint(h,f,{data:g,instanceKey:e})}function j(f,g){f=f+"_end";a==null?void 0:a({type:"point",data:{annotations:g,event:f}});if(!b||d)return;c("QPLUserFlow").addPoint(h,f,{data:g,instanceKey:e});a==null?void 0:a({type:"point",data:{annotations:g,event:f}})}function k(f,g){a==null?void 0:a({type:"point",data:{annotations:g,event:f}});if(!b||d)return;c("QPLUserFlow").addPoint(h,f,{data:g,instanceKey:e})}function l(f){a==null?void 0:a({type:"end",data:{annotations:f}});if(!b||d)return;c("QPLUserFlow").endSuccess(h,{annotations:f,instanceKey:e});d=!0}function m(f,g){a==null?void 0:a({type:"end",data:{errorName:f,annotations:g}});if(!b||d)return;c("QPLUserFlow").endFailure(h,f,{annotations:g,instanceKey:e});d=!0}function n(f){a==null?void 0:a({type:"end",data:{annotations:f,cancel:!0}});if(!b||d)return;c("QPLUserFlow").endCancel(h,{annotations:f,instanceKey:e});d=!0}function o(f){a==null?void 0:a({type:"annotate",data:{annotations:f}});if(!b||d)return;c("QPLUserFlow").addAnnotations(h,f,{instanceKey:e})}return{start:f,endFailure:m,addAnnotations:o,endSuccess:l,endCancel:n,markEventStart:g,markEventEnd:j,markPoint:k}}g["default"]=a}),98);
__d("buildSharedWorkerTerminateQPLLogger",["QPLUserFlow","SiteData","pageID","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h=c("qpl")._(931600201,"1438"),i=0;function a(a){var b=!1,d=!1,e=i++;function f(f){var g=f.workerName;f=f.callReason;if(b||d)return;b=!0;g={"int":{clientRev:c("SiteData").client_revision},bool:{isDev:!1},string:{workerName:g,hostname:window.location.hostname,callReason:f,pageID:c("pageID")}};c("QPLUserFlow").start(h,{onFlowTimeout:function(){c("QPLUserFlow").addAnnotations(h,{bool:{setupTimeout:!0}},{instanceKey:e}),d=!0},cancelOnUnload:!0,annotations:g,timeoutInMs:3e4,instanceKey:e});a==null?void 0:a({type:"start",data:{annotations:g}})}function g(f,g){if(!b||d)return;f=f+"_start";c("QPLUserFlow").addPoint(h,f,{data:g,instanceKey:e});a==null?void 0:a({type:"point",data:{annotations:g,event:f}})}function j(f,g){if(!b||d)return;f=f+"_end";c("QPLUserFlow").addPoint(h,f,{data:g,instanceKey:e});a==null?void 0:a({type:"point",data:{annotations:g,event:f}})}function k(f,g){if(!b||d)return;c("QPLUserFlow").addPoint(h,f,{data:g,instanceKey:e});a==null?void 0:a({type:"point",data:{annotations:g,event:f}})}function l(f){if(!b||d)return;c("QPLUserFlow").endSuccess(h,{annotations:f,instanceKey:e});a==null?void 0:a({type:"end",data:{annotations:f}});d=!0}function m(f,g){if(!b||d)return;c("QPLUserFlow").endFailure(h,f,{annotations:g,instanceKey:e});a==null?void 0:a({type:"end",data:{errorName:f,annotations:g}});d=!0}function n(f){if(!b||d)return;c("QPLUserFlow").endCancel(h,{annotations:f,instanceKey:e});a==null?void 0:a({type:"end",data:{annotations:f,cancel:!0}});d=!0}function o(f){if(!b||d)return;c("QPLUserFlow").addAnnotations(h,f,{instanceKey:e});a==null?void 0:a({type:"annotate",data:{annotations:f}})}return{start:f,endFailure:m,addAnnotations:o,endSuccess:l,endCancel:n,markEventStart:g,markEventEnd:j,markPoint:k}}g["default"]=a}),98);
__d("XCometFBMultiSiteSharedWorkerStaticInitScriptControllerRouteBuilder",["jsRouteBuilder"],(function(a,b,c,d,e,f,g){a=c("jsRouteBuilder")("/static_resources/sharedworker/init_script/",Object.freeze({}),void 0);b=a;g["default"]=b}),98);
__d("getSharedWorkerHash",["uuidv4"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("uuidv4")()}g["default"]=a}),98);
__d("createSharedWorkerBundleUrl",["XCometFBMultiSiteSharedWorkerStaticInitScriptControllerRouteBuilder","getSharedWorkerHash","getWorkerInitScriptSPINParams","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a;return c("nullthrows")((a=c("XCometFBMultiSiteSharedWorkerStaticInitScriptControllerRouteBuilder").buildUri({hash:c("getSharedWorkerHash")()}).addQueryParams(c("getWorkerInitScriptSPINParams")()))==null?void 0:a.toString())}g["default"]=a}),98);
__d("createSharedWorkerV2BundleUrl",["BootloaderDocumentInserter","BootloaderPreloader","TrustedTypesWebWorkerScriptURLPolicy","XCometFBMultiSiteWebWorkerV2InitScriptControllerRouteBuilder","getSharedWorkerHash","getWorkerInitScriptSPINParams","gkx","justknobx","nullthrows","qex","supportsModuleWorker"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=c("supportsModuleWorker")(!0),b=c("getWorkerInitScriptSPINParams")();b.set("hash",c("getSharedWorkerHash")());b.set("use_broadcast",c("justknobx")._("4177"));b.set("worker_id_in_terminate",c("gkx")("12766"));b.set("with_worker_id_lock",c("qex")._("4412"));return c("nullthrows")((a=c("XCometFBMultiSiteWebWorkerV2InitScriptControllerRouteBuilder").buildUri({worker_type:a?"MODULE":"CLASSIC"}))==null?void 0:(a=a.addQueryParams(b))==null?void 0:a.toString())}var i=c("gkx")("13019")?h():null;a=function(){if(i==null)return;var a=c("TrustedTypesWebWorkerScriptURLPolicy").createScriptURL(i);d("BootloaderDocumentInserter").batchDOMInsert(function(b){d("BootloaderPreloader").preloadResource({type:"js",src:a.toString(),nc:1},b)})};b=function(){var a=i;if(a!=null){i=null;return a}return h()};g.maybePreloadSharedWorkerV2BundleUrl=a;g.createSharedWorkerV2BundleUrl=b}),98);
__d("handleWorkerWriteError",["FBLogger","WebStorageCleanupReason"],(function(a,b,c,d,e,f,g){"use strict";function a(a){if(a instanceof Error){c("FBLogger")("worker").catching(a).mustfix("Error occured checking in shared worker reference");return}if(a==="writes disabled"){var b;c("FBLogger")("worker").warn("Writes to WebAsyncStorage is disabled. Unable to save shared worker reference. Reason: %s",(b=d("WebStorageCleanupReason").getLastCleanupReason())!=null?b:"n/a");return}c("FBLogger")("worker").mustfix("Error occured checking in shared worker reference: %s",JSON.stringify(a))}g["default"]=a}),98);
__d("SharedWorkerInitFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("4266");b=d("FalcoLoggerInternal").create("shared_worker_init",a);e=b;g["default"]=e}),98);
__d("logSharedWorkerInitStep",["SharedWorkerInitFalcoEvent","SiteData","gkx","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h=c("uuidv4")();function a(a,b,d,e){if(!c("gkx")("21115"))return;c("SharedWorkerInitFalcoEvent").log(function(){return{client_id:h,bundle_name:a,client_rev:String(c("SiteData").client_revision),local_shared_worker_ref:b!=null?{bundle_url:b.url,rev:String(b.rev),spin_time:String(b.spin_time)}:null,new_shared_worker_ref:d!=null?{bundle_url:d}:null,init_step:e}})}g["default"]=a}),98);
__d("SharedWorkerBundleResource",["BootloaderPreloader","BrowserLockManager","Deferred","FBLogger","SharedWorkerDevChangeManager","SharedWorkerEventManager","SharedWorkerLockManager","SharedWorkerLoggingUtils","SharedWorkerMigrationUtils","SharedWorkerStatusLock","SharedWorkerStorageManager","SharedWorkerUptimeTracker","SharedWorkerV2ResourceExperimental","SiteData","StaticSiteData","TrustedTypesWebWorkerScriptURLPolicy","WebWorkerV2DynamicData","buildSharedWorkerInitQPLLogger","buildSharedWorkerTerminateQPLLogger","createSharedWorkerBundleUrl","createSharedWorkerV2BundleUrl","createSharedWorkerV2BundleUrlExperimental","err","getErrorSafe","gkx","handleWorkerWriteError","justknobx","logSharedWorkerInitStep","pageID","promiseDone","qex","setTimeout","supportsModuleWorker","supportsNativeWebLock"],(function(a,b,c,d,e,f,g){"use strict";var h=5e3,i="shared_worker_broadcast_channel";d("createSharedWorkerV2BundleUrl").maybePreloadSharedWorkerV2BundleUrl();var j=function(b){babelHelpers.inheritsLoose(a,b);function a(a){var c;c=b.call(this)||this;c.name="SelfTerminationError";c.message="Worker self terminated with the reason: "+a;c.reason=a;return c}return a}(babelHelpers.wrapNativeSuper(Error));function k(a,b,e,f){f==null?void 0:f.markEventStart("shared_worker_construct");var g=new SharedWorker(c("TrustedTypesWebWorkerScriptURLPolicy").createScriptURL(a),b);f==null?void 0:f.markEventEnd("shared_worker_construct");g.addEventListener("error",function(a){d("SharedWorkerLoggingUtils").logSharedWorkerError(f,a,b)});var h=new Set();d("SharedWorkerEventManager").registerWorkerSelfTerminationListener(g,function(a,c,e){d("SharedWorkerLoggingUtils").logSelfTermination(b,a,c,e)},{once:!0});var i=0;d("SharedWorkerEventManager").registerConnectionAckListener(g,function(a,b){i++;if(h.has("worker_connection_established")){f==null?void 0:f.addAnnotations({int:{connectionAckNum:i}});return}h.add("worker_connection_established");f==null?void 0:f.addAnnotations({string:{connectedFrom:a,workerID:b}});f==null?void 0:f.markPoint("worker_connection_established")});d("SharedWorkerEventManager").registerWorkerInitPointsListener(g,function(a){if(h.has(a))return;h.add(a);f==null?void 0:f.markPoint("worker_init_point_"+a)});g.port.start();d("SharedWorkerEventManager").registerExecuteWorkerImportsListener(g,f,function(a){var b=a.err;a=a.attempts;f==null?void 0:f.addAnnotations({string:{importsError:b},int:{importAttempts:a}});f==null?void 0:f.markPoint(b==null?"bundle_imports_success":"bundle_imports_failure")});var j=new(c("Deferred"))();d("SharedWorkerEventManager").registerExecuteWorkerAckListener(g,f,function(a){var b=a.workerSpinTime,e=a.err,g=a.isFirstInit,h=a.workerRev;a=a.workerSpinMode;d("SharedWorkerLoggingUtils").logExecuteAck(f,b,e,g,h,a);e!=null||b==null||h==null?j.reject(c("err")(e!=null?e:"no worker rev or spin time")):j.resolve({rev:h,spinTime:b})});f==null?void 0:f.markEventStart("execute_worker");d("SharedWorkerEventManager").emitExecuteWorker(g,{jsModuleResource:e,isDev:!1});return j.getPromise().then(function(a){var b=a.rev;a=a.spinTime;return{worker:g,rev:b,spinTime:a}})}function l(a,b,d){a=c("TrustedTypesWebWorkerScriptURLPolicy").createScriptURL(a);b=c("supportsModuleWorker")(!0)?new SharedWorker(a,{name:b,type:"module"}):new SharedWorker(a,b);d==null?void 0:d.markPoint("shared_worker_construct_done");d==null?void 0:d.addAnnotations({string:{workerUrl:a.toString()}});return b}function m(a,b,c){var e=[],f=new Set();e.push(d("SharedWorkerEventManager").registerWorkerInitPointsListener(a,function(a){if(f.has(a))return;f.add(a);c==null?void 0:c.markPoint("worker_init_point_"+a)}));e.push(d("SharedWorkerEventManager").registerHrpInitListener(a,c,function(){}));var g=function(a){d("SharedWorkerLoggingUtils").logSharedWorkerError(c,a,b)};a.addEventListener("error",g);e.push(function(){return a.removeEventListener("error",g)});return e}function n(a,b,e,f){d("SharedWorkerMigrationUtils").shouldCheckForDynamicStringWorker(b)&&(f==null?void 0:f.markEventStart("dynamic_string_worker_check"),c("promiseDone")(d("SharedWorkerMigrationUtils").maybeTerminateDynamicStringWorker(b),function(a){f==null?void 0:f.markEventEnd("dynamic_string_worker_check",{bool:{didTerminateDynamicStringWorker:a}})}));var g=l(a,b,f);d("SharedWorkerEventManager").registerConnectionAckListener(g,function(a,b,c){f==null?void 0:f.addAnnotations({string:{connectedFrom:a,workerID:b,hrpStatus:c}}),f==null?void 0:f.markPoint("worker_connection_established")});var h=new(c("Deferred"))();d("SharedWorkerEventManager").registerWorkerSelfTerminationListener(g,function(a,c,e,g){f==null?void 0:f.addAnnotations({string:{selfTerminationError:g}}),d("SharedWorkerLoggingUtils").logSelfTermination(b,a,c,e),h.reject(new j(c))},{once:!0});m(g,b,f);g.port.start();d("SharedWorkerEventManager").emitConnectionAckRequest(g,f);f==null?void 0:f.markPoint("read_dynamic_data");c("promiseDone")(z(e,!1,f).then(function(a){a=a.hrp;f==null?void 0:f.markEventStart("hrp_init");d("SharedWorkerEventManager").emitHrpInit(g,{hrp:a.hrp,js_env:a.js_env,isDev:!1},f)},function(a){a=c("getErrorSafe")(a);f==null?void 0:f.addAnnotations({string:{hrpInitErr:a.toString()}})}));d("SharedWorkerEventManager").registerExecuteWorkerAckListener(g,f,function(a){var b=a.workerSpinTime,e=a.err,g=a.isFirstInit,i=a.workerRev;a=a.workerSpinMode;d("SharedWorkerLoggingUtils").logExecuteAck(f,b,e,g,i,a);e!=null||i==null||b==null?h.reject(c("err")(e!=null?e:"no worker rev or spin time")):h.resolve({rev:i,spinTime:b})});f==null?void 0:f.markEventStart("execute_worker");d("SharedWorkerEventManager").emitExecuteWorker(g);return h.getPromise().then(function(a){var b=a.rev;a=a.spinTime;return{worker:g,rev:b,spinTime:a}})}function o(a,b,e,f,g,h){var i=new(c("Deferred"))();d("SharedWorkerEventManager").registerGetWorkerRevListener(a,h,function(a){var j=a.rev;a=a.spinTime;c("promiseDone")(d("SharedWorkerStorageManager").saveSharedWorkerReference(e,{url:b,rev:j,spin_time:a,version:g.version,rsrcBundleUrl:g.getJSModuleBundleResource().url,sandboxOnlyChecksum:g.sandboxOnlyChecksum},h).then(function(){return d("SharedWorkerStorageManager").getSharedWorkerReference(e,h)}).then(function(a){c("logSharedWorkerInitStep")(e,a,g.resourceUrlForLogging,"after_worker_reference_save")}),function(){h.markEventEnd("get_worker_rev",{bool:{successfullySavedWorkerRef:!0}}),i.resolve(),f()},function(a){h.markEventEnd("get_worker_rev",{bool:{successfullySavedWorkerRef:!1}}),i.reject(a),c("handleWorkerWriteError")(a),f()})});h.markEventStart("get_worker_rev");d("SharedWorkerEventManager").emitGetRev(a);return i.getPromise()}function p(a,b,e,f){f===void 0&&(f=null);var g=[],h=function(c,a,f){g.forEach(function(a){return a()}),b(c,a,f),d("SharedWorkerUptimeTracker").stopUptimeTracking(e)};g.push(d("SharedWorkerEventManager").registerForwardListeners(a));g.push(d("SharedWorkerEventManager").registerWorkerShutdownListener(a,function(a){var b=a.reason;a=a.workerID;d("SharedWorkerLoggingUtils").logShutdown(e,null,b,a);b=b==="dynamic_string_worker_rollback"?"requested-upgrade":b;h(b,a,"sw-shutdown")}));g.push(d("SharedWorkerEventManager").registerWorkerSelfTerminationListener(a,function(b,c,a){h(c,a,"self-terminate")}));c("qex")._("4410")&&c("supportsNativeWebLock")()&&f!=null&&g.push(C(e,f,function(){h("worker-id-lock-release",f,"self-terminate")}));c("qex")._("4411")&&self.BroadcastChannel!=null&&f!=null&&g.push(B(e,function(a){h(a,f,"broadcast")}));d("SharedWorkerDevChangeManager").trackCreatedWorker(e);d("SharedWorkerUptimeTracker").startUptimeTracking(a,e);c("logSharedWorkerInitStep")(e,null,null,"create_worker_end")}async function q(a,b,e,f,g,h){h.addAnnotations({string:{initFlow:"use_existing_ref"}});c("logSharedWorkerInitStep")(a,null,null,"using_existing_worker_ref");var i=d("SharedWorkerMigrationUtils").isLegacyWorkerURL(b.url),j=await (b.version===2?i?n(b.url,a,e.getJSModuleBundleResource(),h):d("SharedWorkerV2ResourceExperimental").startV2Worker(b.url,a,e.getJSModuleBundleResource(),h):k(b.url,a,e.getJSModuleBundleResource(),h));j=j.worker;f();b.version===2&&!i&&void o(j,b.url,a,f,e,h);p(j,g,a);return j}async function r(a,b,e,f){var g=new(c("Deferred"))(),h=d("SharedWorkerMigrationUtils").isStatusLockHeld(a);if(await d("SharedWorkerMigrationUtils").isDynamicStringWorkerRunning(a)&&c("supportsNativeWebLock")()&&f===!1)g.resolve(),e.addAnnotations({string:{oldWorkerShutdown:"not_needed_for_dynamic_string"}});else if(self.BroadcastChannel!=null&&c("gkx")("13712")){var i=y(a);i.postMessage({type:"terminate",reason:"requested-upgrade",pageID:c("pageID")});g.resolve();e.addAnnotations({string:{oldWorkerShutdown:"broadcast"}})}else if(await h){b.version===2&&c("supportsModuleWorker")(!0)?i=new SharedWorker(b.url,{name:a,type:"module"}):i=new SharedWorker(b.url,a);d("SharedWorkerEventManager").registerWorkerShutdownListener(i,function(a){var b=a.workerID,h=a.isInitialized;f?c("setTimeout")(function(){e.markEventEnd("old_worker_shutdown",{string:{oldWorkerID:b},bool:{oldWorkerWasInitialized:h}}),g.resolve()},d("SharedWorkerV2ResourceExperimental").DELAY_FOR_WORKER_SHUTDOWN_MS):(e.markEventEnd("old_worker_shutdown",{string:{oldWorkerID:b},bool:{oldWorkerWasInitialized:h}}),g.resolve());e.addAnnotations({string:{oldWorkerShutdown:"success"}})},{once:!0});e.markEventStart("old_worker_shutdown");i.port.start();d("SharedWorkerEventManager").emitWorkerShutdown(i,{upgrade:!0})}else g.resolve(),e.addAnnotations({string:{oldWorkerShutdown:"not_needed"}});f===!0?await g.getPromise():g.resolve()}async function s(a,b,c,d,e,f,g){f.addAnnotations({string:{initFlow:"upgrade_worker_ref"}});await r(a,b,f,g);return u(a,c,d,e,f,"upgrading_worker_ref")}function t(a,b,c,d,e){e.addAnnotations({string:{initFlow:"new_worker_ref"}});return u(a,b,c,d,e,"new_worker_ref")}async function u(a,b,e,f,g,h){c("logSharedWorkerInitStep")(a,null,null,h);await d("SharedWorkerMigrationUtils").isStatusLockHeld(a)&&c("FBLogger")("worker").info("Trying to create a worker %s while old one is still running",a);var i=await b.createSharedWorker(),j=i[0];i=i[1].worker;h==="upgrading_worker_ref"&&await d("SharedWorkerStorageManager").removeSharedWorkerReference(a,g);await o(i,j,a,e,b,g);p(i,f,a);return i}function v(a,b){var e=d("SharedWorkerDevChangeManager").shouldUseStorageWorkerForDev(a.name,{storageWorkerResource:b,tabResource:a}),f=b.spin_time,g=b.version;b=b.rev;return b>=c("SiteData").client_revision&&(a.version===g||f>=c("SiteData")[c("StaticSiteData").spin_time_key])&&e}async function w(a,b,e,f,g){f.markEventStart("create_worker");var h=a.name;d("SharedWorkerUptimeTracker").stopUptimeTracking(h);f.addAnnotations({bool:{workerAlreadyRunning:c("supportsNativeWebLock")()?await d("SharedWorkerMigrationUtils").isStatusLockHeld(h):null}});var i=c("supportsNativeWebLock")()?await d("SharedWorkerMigrationUtils").isStatusLockHeld(h):!0;if(!g&&a.version===2&&c("gkx")("13712"))return E(a,b,e,f);var j=await d("SharedWorkerStorageManager").getSharedWorkerReference(h,f);c("logSharedWorkerInitStep")(h,j,a.resourceUrlForLogging,"create_worker_start");var k=j!=null&&d("SharedWorkerMigrationUtils").isLegacyWorkerURL(j==null?void 0:j.url);i=g&&i===!1&&k;if(j==null||i)return t(h,a,b,e,f);k=j.spin_time;i=j.version;var l=j.rev;f.addAnnotations({int:{storageWorkerSpinTime:k,storageWorkerVersion:i,storageWorkerRev:l}});if(v(a,j))return q(h,j,a,b,e,f);else return s(h,j,a,b,e,f,g)}function a(a,b,e){e=e!=null?e:{};var f=e.onQPLEvent;e=e.reason;var g=a.name,h=c("buildSharedWorkerInitQPLLogger")(f);h.start({version:1,workerName:g,callReason:e});var i=new(c("Deferred"))();d("SharedWorkerLockManager").withWorkerLock(function(d){var e;c("promiseDone")(w({name:g,version:1,resourceUrlForLogging:(e=a.url)!=null?e:"",getJSModuleBundleResource:function(){return a},createSharedWorker:async function(){var b=c("createSharedWorkerBundleUrl")();return[b,await k(b,g,a,h)]}},d,b,h,!1),function(a){h.markEventEnd("create_worker"),h.endSuccess(),i.resolve(a)},function(a){a=typeof a==="string"?c("err")(a):a;h.endFailure("worker_init_failure",{string:{workerInitFailureReason:a.message,errorName:a.name}});i.reject(a);d()})},{workerQPLLogger:h,onLockTimeout:function(){return i.reject(c("err")("Worker lock timeout"))}});return i.getPromise()}function x(a,b,e,f){f===void 0&&(f=0);var g=a.name,h=e!=null?e:{},i=h.onQPLEvent;h=h.reason;var k=c("buildSharedWorkerInitQPLLogger")(i);k.start({version:2,workerName:g,callReason:h,experimental_init:e==null?void 0:e.useDynamicStringInit});k.addAnnotations({bool:{usingModuleWorker:c("supportsModuleWorker")(!0)}});var l=new(c("Deferred"))();i=(e==null?void 0:e.useDynamicStringInit)!==!0&&c("qex")._("4050")===!0;h=function(f){c("promiseDone")(w({name:g,version:2,getJSModuleBundleResource:function(){return a},sandboxOnlyChecksum:a.sandboxOnlyChecksum,createSharedWorker:(e==null?void 0:e.useDynamicStringInit)===!0?async function(){var b=c("createSharedWorkerV2BundleUrlExperimental")(g);return[b,await d("SharedWorkerV2ResourceExperimental").startV2Worker(b,g,a,k)]}:async function(){var b=d("createSharedWorkerV2BundleUrl").createSharedWorkerV2BundleUrl();return[b,await n(b,g,a,k)]}},f,b,k,(e==null?void 0:e.useDynamicStringInit)===!0),function(a){k.markEventEnd("create_worker"),k.endSuccess(),l.resolve(a)},function(a){a=typeof a==="string"?c("err")(a):a;l.reject(a);f()})};i?h(function(){}):d("SharedWorkerLockManager").withWorkerLock(h,{workerQPLLogger:k,onLockTimeout:function(){return l.reject(c("err")("Worker lock timeout"))},onLockFail:function(a){l.reject(a)}});return l.getPromise().catch(function(d){if(d instanceof j&&f<2){k.endCancel({string:{workerInitCancelReason:d.message},int:{workerInitRetry:f}});return new Promise(function(d,g){c("setTimeout")(function(){c("promiseDone")(x(a,b,e,f+1),d,g)},f===0?200:500)})}k.endFailure("worker_init_failure",{string:{workerInitFailureReason:d.message,errorName:d.name}});throw d})}async function b(a,b,e){var f=b!=null?b:a.name,g=new(c("Deferred"))(),i=c("buildSharedWorkerTerminateQPLLogger")();i.start({workerName:f});c("promiseDone")(c("supportsNativeWebLock")()?d("SharedWorkerMigrationUtils").isStatusLockHeld(f):Promise.resolve(void 0),function(a){return i.addAnnotations({bool:{workerAlreadyRunning:a}})});i.addAnnotations({string:{reason:e,terminatingPageId:c("pageID")}});if(self.BroadcastChannel!=null&&c("gkx")("13712")){b=y(f);b.postMessage({type:"terminate",reason:e,pageID:c("pageID")});c("promiseDone")(d("SharedWorkerStorageManager").removeSharedWorkerReference(f,i).then(function(){i.endSuccess(),g.resolve()}));return g.getPromise()}d("SharedWorkerLockManager").withWorkerLock(function(b){c("promiseDone")(d("SharedWorkerStorageManager").getSharedWorkerReference(f,i).then(function(b){i.markPoint("read_worker_reference",{int:{storageWorkerVersion:b==null?void 0:b.version},bool:{storageReferenceExists:b!=null}});if(b!=null){var e=d("SharedWorkerMigrationUtils").isLegacyWorkerURL(b.url);i.addAnnotations({bool:{isLegacy:e}});var g=b.version===2?e?n(b.url,f,a,void 0).then(function(a){a=a.worker;return a}):d("SharedWorkerV2ResourceExperimental").startV2Worker(b.url,f,a,void 0).then(function(a){a=a.worker;return a}):k(b.url,f,a).then(function(a){a=a.worker;return a});e=c("justknobx")._("3569")?Promise.resolve(null):d("SharedWorkerStorageManager").removeSharedWorkerReference(f,i);return e.then(function(){return g})}i.markPoint("storage_resource_empty");return null}),function(a){try{b();d("SharedWorkerUptimeTracker").stopUptimeTracking(f);if(a==null){i.endSuccess();g.resolve();return}d("SharedWorkerEventManager").registerWorkerShutdownListener(a,function(a){var b=a.workerID;a=a.isInitialized;i.markPoint("worker_shut_down",{string:{workerID:b},bool:{wasInitialized:a}});b=c("justknobx")._("3569")?d("SharedWorkerStorageManager").removeSharedWorkerReference(f,i):Promise.resolve(null);c("promiseDone")(b,function(){return i.endSuccess()},function(a){i.endFailure("failed_to_remove_worker_reference",{string:{errorDescription:a.toString()}})});g.resolve()},{once:!0});d("SharedWorkerEventManager").emitWorkerShutdown(a,{reason:e})}catch(a){i.endFailure("terminate_worker_failure",{string:{workerTerminateFailReason:a.message}}),g.reject(a.message)}},function(a){c("FBLogger")("worker").catching(c("getErrorSafe")(a)).mustfix("Failed to terminate worker"),i.endFailure("connect_to_worker_failure",{string:{workerTerminateFailReason:a.message}}),g.reject(a.message),b()})},{workerQPLLogger:i});c("setTimeout")(function(){return g.reject()},h);return g.getPromise()}function y(a){return new self.BroadcastChannel(i+"_"+a)}async function e(a){a=await d("SharedWorkerStorageManager").getSharedWorkerReference(a.name);return a!=null}async function z(a,b,e){b=await d("WebWorkerV2DynamicData").readDynamicDataForWorker(a,b);var f=b.data;b=b.time;try{var g=c("justknobx")._("1979");g&&d("BootloaderPreloader").preloadWorkerJSFromHRP(f.hrp);e==null?void 0:e.addAnnotations({bool:{prefetchWorkerScripts:g}})}catch(b){g=c("getErrorSafe")(b);e==null?void 0:e.addAnnotations({string:{hrpInitErr:g.toString()}});c("FBLogger")("worker").catching(b).warn("Failed to preload worker %s JS from HRP",a.name)}return{hrp:f,time:b,rev:(e=f.hrp.hsrp)==null?void 0:(g=e.hblp)==null?void 0:(a=g.consistency)==null?void 0:a.rev}}function A(b,a,c){return d("SharedWorkerStorageManager").getOrUpdateWorkerReference(b.name,function(d){if(d==null)return a;if(v(b,d))return d;void r(b.name,d,c,!1);return a})}function B(a,b){if(self.BroadcastChannel!=null){var d=y(a),e=function(a){a=a.data;if(typeof a==="object"&&(a==null?void 0:a.type)==="terminate"){var d=typeof a.reason==="string"?a.reason:"unknown";a=typeof a.pageID==="string"?a.pageID:null;if(a!=null&&a===c("pageID")&&d==="requested-upgrade")return;b(d)}};d.addEventListener("message",e);return function(){return d.removeEventListener("message",e)}}return function(){}}function C(a,b,e){var f=new AbortController();void (c("BrowserLockManager")==null?void 0:c("BrowserLockManager").request(d("SharedWorkerStatusLock").getWorkerIdStatusLockName(a,b),{signal:f.signal},function(a){a!=null&&e()}));return function(){f.abort()}}function D(a,b,e,f){var g=new(c("Deferred"))();void d("SharedWorkerStorageManager").getOrUpdateWorkerReference(a,function(a){if(a==null||a.url!==b){g.resolve("url-was-changed");return a}return a.rev!==e||a.spin_time!==f?babelHelpers.extends({},a,{rev:e,spin_time:f}):a}).then(function(){g.resolve("success")});return g.getPromise()}async function E(a,b,e,f){if(a.version!==2)throw c("err")("Worker version must be 2");var g=a.name,h=await z(a.getJSModuleBundleResource(),!1,f),i=h.rev;if(i==null)throw c("err")("HRP rev or spin time is null");i={url:d("createSharedWorkerV2BundleUrl").createSharedWorkerV2BundleUrl(),rev:i,spin_time:h.time,version:a.version,rsrcBundleUrl:a.getJSModuleBundleResource().url,sandboxOnlyChecksum:a.sandboxOnlyChecksum};var k=new(c("Deferred"))(),n=new(c("Deferred"))(),o=[];try{var q,r=function(a){n.reject(a),k.reject(a)};o.push(B(g,function(a){r(new j("broadcast-"+a))}));var s=await A(a,i,f);f.addAnnotations({string:{initFlow:"connect_to_worker"}});var t=l(s.url,g,f);o.push((q=d("SharedWorkerEventManager")).registerConnectionAckListener(t,function(a,b,c){f==null?void 0:f.addAnnotations({string:{connectedFrom:a,workerID:b}}),f==null?void 0:f.markPoint("worker_connection_established"),k.resolve({hrpStatus:c!=null?c:"no-hrp",workerID:b})}));o.push(q.registerWorkerSelfTerminationListener(t,function(a,b,c,e){f==null?void 0:f.addAnnotations({string:{selfTerminationError:e}}),d("SharedWorkerLoggingUtils").logSelfTermination(g,a,b,c),r(new j(b))},{once:!0}));o.push(q.registerWorkerShutdownListener(t,function(a){var b=a.reason;a=a.workerID;d("SharedWorkerLoggingUtils").logShutdown(g,null,b,a);r(new j(b!=null?b:"sw-shutdown-unknown"))}));o.push.apply(o,m(t,g,f));t.port.start();q.emitConnectionAckRequest(t,f);q=await k.getPromise();var u=q.hrpStatus;q=q.workerID;c("qex")._("4410")&&c("supportsNativeWebLock")()&&q!=null&&o.push(C(g,q,function(){r(new j("worker-id-lock-release"))}));if(u==="no-hrp"){f==null?void 0:f.markPoint("read_dynamic_data");u=i.rev>=s.rev;i=u?Promise.resolve(h):z(a.getJSModuleBundleResource(),!0,f);c("promiseDone")(i.then(function(a){f==null?void 0:f.markEventStart("hrp_init"),d("SharedWorkerEventManager").emitHrpInit(t,{hrp:a.hrp.hrp,js_env:a.hrp.js_env,isDev:!1},f)},function(a){a=c("getErrorSafe")(a);f==null?void 0:f.addAnnotations({string:{hrpInitErr:a.toString()}});r(a)}))}o.push(d("SharedWorkerEventManager").registerExecuteWorkerAckListener(t,f,function(a){var b=a.workerSpinTime,e=a.err,g=a.isFirstInit,h=a.workerRev;a=a.workerSpinMode;d("SharedWorkerLoggingUtils").logExecuteAck(f,b,e,g,h,a);e!=null||b==null||h==null?n.reject(c("err")(e!=null?e:"no worker rev or spin time")):n.resolve({workerRev:h,workerSpinTime:b})}));f==null?void 0:f.markEventStart("execute_worker");d("SharedWorkerEventManager").emitExecuteWorker(t);u=await n.getPromise();h=u.workerRev;a=u.workerSpinTime;i=await D(g,s.url,h,a);if(i==="url-was-changed"){d("SharedWorkerEventManager").emitWorkerShutdown(t,{reason:"url-was-changed"});throw new j("url-was-changed")}b();p(t,e,g,q);return t}finally{o.forEach(function(a){return a()})}}g.SHARED_WORKER_BROADCAST_CHANNEL=i;g.SelfTerminationError=j;g.createPushSafeSharedWebWorkerAsync=a;g.createPushSafeSharedWebWorkerV2Async=x;g.terminateSharedWorker=b;g.doesSharedWorkerReferenceExist=e}),98);
__d("SharedWorkerV2ResourceExperimental",["Deferred","SharedWorkerBundleResource","SharedWorkerDevChangeManager","SharedWorkerEventManager","SharedWorkerLoggingUtils","SharedWorkerMigrationUtils","SharedWorkerUptimeTracker","SiteData","StaticSiteData","TrustedTypesWebWorkerScriptURLPolicy","buildSharedWorkerInitQPLLogger","buildSharedWorkerTerminateQPLLogger","createSharedWorkerV2BundleUrlExperimental","justknobx","pageID","promiseDone","setTimeout","supportsModuleWorker","supportsNativeWebLock"],(function(a,b,c,d,e,f,g){"use strict";var h=50,i=5e3,j=2e3;function k(a,b,e,f){return d("SharedWorkerDevChangeManager").shouldUpgradeWorkerForDevExperimental(a)&&!f?!0:b<c("SiteData").client_revision&&e<c("SiteData")[c("StaticSiteData").spin_time_key]}async function a(a,b,e){var f=a.name,g=c("buildSharedWorkerInitQPLLogger")(e==null?void 0:e.onQPLEvent);g.start({version:2,workerName:f,experimental_init:!0,callReason:e==null?void 0:e.reason,migrationEnabled:!0});g.markEventStart("create_worker");c("supportsNativeWebLock")()&&c("promiseDone")(d("SharedWorkerMigrationUtils").isStatusLockHeld(f).then(function(a){g.addAnnotations({bool:{workerAlreadyRunning:a}})}));(e==null?void 0:e.migratedWorker)===!0&&await d("SharedWorkerMigrationUtils").checkStorageAndTerminateLegacyWorker({name:f,logger:g});e=await l(a,g);var i=e.worker,j=e.needsUpgrade;return new Promise(function(e,k){var m=function(a){return e(n(a,f,g,b))};j?(d("SharedWorkerEventManager").registerWorkerShutdownListener(i,function(b){var d=b.workerID;b=b.isInitialized;g.markEventEnd("old_worker_shutdown",{string:{oldWorkerID:d},bool:{oldWorkerWasInitialized:b}});c("setTimeout")(function(){return l(a,g).then(function(a){a=a.worker;return m(a)})},h)},{once:!0}),g.markEventStart("old_worker_shutdown"),d("SharedWorkerEventManager").emitWorkerShutdown(i,{upgrade:!0})):m(i)})}function l(a,b){var e=a.name,f=c("createSharedWorkerV2BundleUrlExperimental")(e);f=c("TrustedTypesWebWorkerScriptURLPolicy").createScriptURL(f);var g=c("supportsModuleWorker")(!0)?"module":"classic",h=new SharedWorker(f,{name:e,type:g}),i=new Set();d("SharedWorkerEventManager").registerWorkerInitPointsListener(h,function(a){if(i.has(a))return;i.add(a);b==null?void 0:b.markPoint("worker_init_point_"+a)});var j=new(c("Deferred"))();d("SharedWorkerEventManager").registerGetWorkerRevListener(h,b,function(c){var d=c.rev,f=c.spinTime;c=c.workerChecksum;c=k(e,d,f,a.sandboxOnlyChecksum===c);j.resolve(c);c?b.addAnnotations({int:{oldWorkerRev:d,oldWorkerSpinTime:f}}):b.addAnnotations({int:{workerRev:d,workerSpinTime:f}})});m(h,e,b);h.port.start();d("SharedWorkerEventManager").emitConnectionAckRequest(h,b);return j.getPromise().then(function(a){return{worker:h,needsUpgrade:a}})}function m(a,b,c,e){a.addEventListener("error",function(a){d("SharedWorkerLoggingUtils").logSharedWorkerError(c,a,b)});d("SharedWorkerEventManager").registerForwardListeners(a);d("SharedWorkerEventManager").registerWorkerSelfTerminationListener(a,function(a,b,d,e){c.endFailure("worker_init_failure",{string:{selfTerminationError:e,selfTerminationReason:b}})},{once:!0});d("SharedWorkerEventManager").registerConnectionAckListener(a,function(a,b){c==null?void 0:c.addAnnotations({string:{connectedFrom:a,workerID:b}}),c==null?void 0:c.markPoint("worker_connection_established")},{once:!0});return a}function n(a,b,e,f){d("SharedWorkerEventManager").registerWorkerShutdownListener(a,function(a){var e=a.reason,g=a.workerID;d("SharedWorkerLoggingUtils").logShutdown(b,null,e,g);e==="requested-upgrade"?c("setTimeout")(function(){return f==null?void 0:f(e,g)},1e3):e==="dynamic_string_worker_rollback"?f==null?void 0:f("maw_request_refresh",g):f==null?void 0:f(e,g);d("SharedWorkerUptimeTracker").stopUptimeTracking(b)});e.markEventEnd("create_worker");e.endSuccess();d("SharedWorkerUptimeTracker").startUptimeTracking(a,b);d("SharedWorkerDevChangeManager").trackCreatedWorker(b);return a}function o(a,b,e,f,g){g===void 0&&(g=0);var h=e.name,i=c("TrustedTypesWebWorkerScriptURLPolicy").createScriptURL(a),k=c("supportsModuleWorker")(!0)?"module":"classic",l=new SharedWorker(i,{name:h,type:k});f==null?void 0:f.markPoint("shared_worker_construct_done");f==null?void 0:f.addAnnotations({string:{workerUrl:i.toString()}});var m=new(c("Deferred"))(),n=[];n.push(d("SharedWorkerEventManager").registerConnectionAckListener(l,function(a,b){f==null?void 0:f.addAnnotations({string:{connectedFrom:a,workerID:b}}),f==null?void 0:f.markPoint("worker_connection_established"),m.resolve()},{once:!0}));n.push(d("SharedWorkerEventManager").registerWorkerInitPointsListener(l,function(a){f==null?void 0:f.markPoint("worker_init_point_"+a)}));n.push(d("SharedWorkerEventManager").registerForwardListeners(l));d("SharedWorkerEventManager").emitConnectionAckRequest(l,f);l.addEventListener("error",function(a){d("SharedWorkerLoggingUtils").logSharedWorkerError(f,a,b)});var p=new(c("Deferred"))();n.push(d("SharedWorkerEventManager").registerGetWorkerRevListener(l,f,function(a){var b=a.rev;a=a.spinTime;f==null?void 0:f.addAnnotations({int:{initialWorkerRev:b,initialSpinTime:a}});p.resolve({worker:l,rev:b,spinTime:a})}));n.push(d("SharedWorkerEventManager").registerWorkerSelfTerminationListener(l,function(a,c,e,g){f==null?void 0:f.addAnnotations({string:{selfTerminationError:g}}),d("SharedWorkerLoggingUtils").logSelfTermination(b,a,c,e),p.reject(new(d("SharedWorkerBundleResource").SelfTerminationError)(c))},{once:!0}));n.push(d("SharedWorkerEventManager").registerWorkerShutdownListener(l,function(a){var c=a.reason;a=a.workerID;f==null?void 0:f.addAnnotations({string:{shutdownReason:c}});d("SharedWorkerLoggingUtils").logShutdown(b,null,c,a);p.reject(new(d("SharedWorkerBundleResource").SelfTerminationError)(c!=null?c:"unknownShutdown"))},{once:!0}));l.port.start();g===0&&c("justknobx")._("1707")&&void Promise.race([m.getPromise().then(function(){return"success"}),new Promise(function(a){c("setTimeout")(function(){a("timeout")},j)})]).then(function(c){if(c==="timeout"){c=l;var d=o(a,b,e,f,g+1);void d.then(function(a){return p.resolve(a)});n.forEach(function(a){return a()});c.port.close()}});return p.getPromise()}async function b(a,b){var e=a.name,f=new(c("Deferred"))();a=await d("SharedWorkerMigrationUtils").isStatusLockHeld(e);var g=c("buildSharedWorkerTerminateQPLLogger")();if(!a){g.start({workerName:e});g.markPoint("no_worker_running");g.endSuccess();return}g.start({workerName:e});g.addAnnotations({string:{reason:b,terminatingPageId:c("pageID")}});a=c("createSharedWorkerV2BundleUrlExperimental")(e);a=c("TrustedTypesWebWorkerScriptURLPolicy").createScriptURL(a);var h=c("supportsModuleWorker")(!0)?"module":"classic";a=new SharedWorker(a,{workerName:e,type:h});g.markPoint("worker_created");d("SharedWorkerEventManager").registerWorkerShutdownListener(a,function(a){a=a.workerID;g.markPoint("worker_shut_down",{string:{workerID:a}});g.endSuccess();d("SharedWorkerUptimeTracker").stopUptimeTracking(e);f.resolve()},{once:!0});a.port.start();d("SharedWorkerEventManager").emitWorkerShutdown(a,{reason:b});c("setTimeout")(function(){return f.reject()},i);return f.getPromise()}g.DELAY_FOR_WORKER_SHUTDOWN_MS=h;g.createPushSafeSharedWebWorkerV2Async=a;g.startV2Worker=o;g.terminateSharedWorker=b}),98);
__d("MAWWebWorkerSingleton",["Deferred","MAWInit","MAWMIC","MAWStartupLoggingUtils","MAWWaitForBackendSetup","MAWWorkerWatchdogRecovery","Promise","SharedWorkerBundleResource","SharedWorkerMigrationUtils","SharedWorkerV2ResourceExperimental","WAResolvable","WebWorkerV2Resource","clearTimeout","cr:6600","err","gkx","promiseDone","setTimeout","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h,i=null,j=function(a){i=a},k=function(){return i},l=f,m=new(d("WAResolvable").Resolvable)(),n=null;function a(){return d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()?d("SharedWorkerMigrationUtils").isStatusLockHeld(b("cr:6600").name):(h||(h=b("Promise"))).resolve(n!==null)}function e(){var a={isSharedWorker:d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker(),nativeLocksSupported:d("SharedWorkerMigrationUtils").supportsNativeWebLocks(),workerCreationPromiseExists:n!==null};if(a.isSharedWorker!==!0)return(h||(h=b("Promise"))).resolve(a.workerCreationPromiseExists===!0?{data:a,tag:"dedicated_exists"}:{data:a,tag:"dedicated_not_exists"});if(a.nativeLocksSupported!==!0)return(h||(h=b("Promise"))).resolve({data:a,tag:"shared_unknown_locks_not_supported"});var c=d("MAWWaitForBackendSetup").getCurrentWorkerID();return(h||(h=b("Promise"))).all([d("SharedWorkerMigrationUtils").isStatusLockHeld(b("cr:6600").name),c!=null?d("SharedWorkerMigrationUtils").isWorkerIdStatusLockHeld(b("cr:6600").name,c):(h||(h=b("Promise"))).resolve(!1)]).then(function(b){var c=b[0];b=b[1];a.sharedLockHeld=c;a.workerIdLockHeld=b;if(c&&b)return{data:a,tag:"shared_exists_and_connected"};if(c)return{data:a,tag:"shared_exists_not_connected"};return b?{data:a,tag:"shared_only_unique_lock_held"}:{data:a,tag:"shared_not_exists"}})}function f(){n=null}function o(a){if(n){d("MAWMIC").addPoint(a+"_wait_on_worker_creation");d("MAWInit").MAWInit.logPoint(a+"_wait_on_worker_creation");return n}d("MAWInit").MAWInit.logPoint(a+"_create_worker_start");d("MAWMIC").addPoint(a+"_create_worker_start");n=(d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()?p(a):q().then(function(a){return{worker:a,workerID:"dedicated"}})).then(function(b){var c=b.worker;b=b.workerID;d("MAWMIC").addPoint(a+"_create_worker_end");d("MAWInit").MAWInit.logPoint(a+"_create_worker_end");return{worker:c,workerID:b}},function(a){n=null;throw a});return n}function p(a){var e=function(a,b,d){c("promiseDone")(m.promise.then(function(){return l(a,b,d)}))};d("MAWWorkerWatchdogRecovery").setRecoveryForWatchdog(e);var f=new(c("Deferred"))(),g=c("gkx")("7313");d("MAWMIC").addBoolAnnotation("migrationEnabled",g);g=g?d("SharedWorkerV2ResourceExperimental").createPushSafeSharedWebWorkerV2Async(b("cr:6600"),e,{migratedWorker:!0,onQPLEvent:d("MAWStartupLoggingUtils").logSharedWorkerQPLEvents,reason:a}):d("SharedWorkerBundleResource").createPushSafeSharedWebWorkerV2Async(b("cr:6600"),e,{onQPLEvent:d("MAWStartupLoggingUtils").logSharedWorkerQPLEvents,reason:a,useDynamicStringInit:c("gkx")("8737")});return g.then(function(a){j(a);d("MAWMIC").addPoint("shared_worker_bundle_created");var b=c("setTimeout")(function(){d("MAWMIC").addPoint("shared_worker_connection_ack_timeout"),f.reject(c("err")("Worker connection ack timeout"))},1e4),e=function(a){var e;if(typeof a.data==="object"&&((e=a.data)==null?void 0:e.type)==="connection-ack"&&typeof ((e=a.data)==null?void 0:e.response)==="object"&&typeof ((e=a.data)==null?void 0:(e=e.response)==null?void 0:e.from)==="string"){e=typeof ((e=a.data)==null?void 0:(e=e.response)==null?void 0:e.workerID)==="string"?(e=a.data)==null?void 0:(a=e.response)==null?void 0:a.workerID:void 0;e!=null?(d("MAWMIC").addPoint("shared_worker_workerID_received"),d("MAWMIC").addStringAnnotation("workerID",e),b!=null&&c("clearTimeout")(b),f.resolve(e)):(d("MAWMIC").addPoint("shared_worker_null_workerID_received"),d("MAWMIC").addStringAnnotation("workerID","unknown"))}};a.port.addEventListener("message",e);a.port.postMessage({type:"ww-connection-ack"});a.addEventListener("error",function(a){d("MAWStartupLoggingUtils").logWorkerError("Shared Worker",a,"")});return f.getPromise().then(function(b){return{worker:a.port,workerID:b}})})}function q(){return(h||(h=b("Promise"))).resolve(d("WebWorkerV2Resource").createDedicatedV2WebWorker(b("cr:6600"))).then(function(a){var b=a.url;a=a.worker;a.onerror=function(a){return d("MAWStartupLoggingUtils").logWorkerError("Dedicated Worker",a,b)};d("MAWStartupLoggingUtils").setImportScriptsErrorListener(a);return a})}function r(a){l=a,m.resolve()}g.getSharedWorkerInstance__TEST_ONLY=k;g.doesWorkerExist=a;g.getWorkerHealthStatus=e;g.resetWorkerCreation=f;g.createWorkerIfNone=o;g.setOnCloseForWorkerInstance=r}),98);
__d("MAWWaitForBackendSetup",["ErrorSerializer","MAWInit","MAWInitError","MAWMIC","MAWSetupWorkerAuxStateForLogging","MAWWebWorkerSingleton","Promise","err","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=new(h||(h=b("Promise")))(function(a,b){i=a,j=b}),l=!1,m=!1,n=!1,o=!1,p=null,q=i,r=j;function s(a){return new(h||(h=b("Promise")))(function(b,e){k.then(b)["catch"](function(b){var f=a+" rejected because backend setup failed: "+b.message+".";b=b instanceof d("MAWInitError").MAWInitError?b.error:null;b!=null&&(f=f.concat(" More error detail: "+c("ErrorSerializer").toReadableMessage(b)));e(c("err")(f))})})}function a(a,b){c("promiseDone")(s(b).then(function(){a()}))}function t(){if(!o)return;k=new(h||(h=b("Promise")))(function(a,b){i=a,j=b});o=!1;l=!1;q=i;r=j;m=!0;n=!1}function e(a){l=!0,o=!0,n=!1,q==null?void 0:q(a)}function f(a){l=!1,o=!0,n=!1,r==null?void 0:r(a)}function u(){return l}function v(){return o}function w(){return m}function x(a){a!=null&&p!==a&&d("MAWSetupWorkerAuxStateForLogging").resetWorkerCreationTime(),p=a}function y(a){if(p==null||p!==a)return;z()}function z(){p=null,d("MAWWebWorkerSingleton").resetWorkerCreation(),t(),d("MAWInit").MAWInit.logPoint("reset_current_worker"),d("MAWMIC").addPoint("reset_current_worker")}function A(){return p}function B(){n=!0}function C(){return n}g.waitForBackendSetup=s;g.runAfterBackendSetup=a;g.resetBackendSetup=t;g.resolveBackendSetup=e;g.rejectBackendSetup=f;g.isBackendSetupSuccessful=u;g.isBackendSetupSettled=v;g.wasBackendSetupReset=w;g.setCurrentWorker=x;g.resetCurrentWorkerWithId=y;g.resetCurrentWorkerSkipIdCheck=z;g.getCurrentWorkerID=A;g.markBackendSetupStarted=B;g.isBackendSetupInProgress=C}),98);
__d("MAWWorkerEvent",["FBLogger","MAWMIC","MAWReliabilityMonitor","MAWSetupWorkerAuxStateForLogging","MAWTrackPendingOccamadilloThreads","MAWWaitForBackendSetup","MultipleTabsLogger","QPLUserFlow","pageID","performanceNow","promiseDone","qpl","requireDeferred","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("MAWBridgeObserver").__setRef("MAWWorkerEvent"),j=c("requireDeferred")("MAWWebWorkerSingleton").__setRef("MAWWorkerEvent"),k=new Set(),l=new Set(["addEbUploadTrackingWorkerQPL","ackWithInstanceKey","addMediaDownloadQpl","searchGetFTSRestoreSessionId","none"]),m=new Set(["bulkCreateThread","bulkCreateOrUpdateThread","bulkMaybeCreateOrUpdateThread","createThread","createOrUpdateThread"]),n=new Map(),o=function(a){switch(a){case"sendAndReceive":return 1e4;case"fireAndForget":return 4e3;case"waitUntilCompleted":return 1e4;case"waitUntilPersisted":return 1e4;default:return 1e4}},p=function(a,b,d){d=window.setTimeout(function(){v(a,"ack_timeout"),c("promiseDone")(i.load().then(function(a){a.notifyUnackedEvent({route:b,timestamp:(h||(h=c("performanceNow")))()})}))},o(d));n.set(a,d);return d},q=function(a){var b=n.get(a);b!=null&&(window.clearTimeout(b),c("promiseDone")(i.load().then(function(a){a.resetUnackedMessages()})),n["delete"](a))};function a(a,b,e){if(k.has(e)||l.has(b))return;k.add(e);c("QPLUserFlow").start(c("qpl")._(1056842055,"807"),{annotations:{bool:{duringMIC:d("MAWMIC").duringMIC(),useSharedWorker:d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker(),workerTerminatedPermanently:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.workerTerminatedPermanently},"int":{key:e},string:{callType:a,event:b,pageID:c("pageID"),workerHeartbeatsOnStart:d("MAWSetupWorkerAuxStateForLogging").getHeartbeatHistoryAsString(),workerID:d("MAWWaitForBackendSetup").getCurrentWorkerID()},string_array:{worker_restart_msgs:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartMessageTypes,worker_restart_reasons:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartReasons}},instanceKey:e});void d("MultipleTabsLogger").hasMultipleTabs().then(function(a){c("QPLUserFlow").addAnnotations(c("qpl")._(1056842055,"807"),{bool:{isMultiTabs:a}},{instanceKey:e})});void j.load().then(function(a){return a.getWorkerHealthStatus().then(function(a){c("QPLUserFlow").addAnnotations(c("qpl")._(1056842055,"807"),{string:{workerHealthStatusOnStart:a.tag}})})})}function b(a){if(!k.has(a))return;k["delete"](a);c("QPLUserFlow").endSuccess(c("qpl")._(1056842055,"807"),{instanceKey:a})}function e(a,b){if(!k.has(a))return;k["delete"](a);c("QPLUserFlow").endFailure(c("qpl")._(1056842055,"807"),"fail",{annotations:{bool:{workerTerminatedPermanently:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.workerTerminatedPermanently},string:{error:b},string_array:{worker_restart_msgs:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartMessageTypes,worker_restart_reasons:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartReasons}},instanceKey:a})}function f(a,b,e){if(!k.has(a))return;k["delete"](a);c("QPLUserFlow").endFailure(c("qpl")._(1056842055,"807"),"timeout",{annotations:{bool:{workerTerminatedPermanently:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.workerTerminatedPermanently},string:{error:b,workerHealthStatus:e.tag},string_array:{worker_restart_msgs:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartMessageTypes,worker_restart_reasons:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartReasons}},instanceKey:a})}function r(a,b){if(!k.has(a))return;c("QPLUserFlow").addAnnotations(c("qpl")._(1056842055,"807"),b,{instanceKey:a})}function s(a,b){if(!k.has(a))return;try{if(Array.isArray(b)){var e=b.every(function(a){return typeof a==="object"&&a!=null&&"state"in a&&a.state===d("MAWReliabilityMonitor").HealthReportState.OK.valueOf()});b=b.reduce(function(a,b){typeof b==="object"&&b!=null&&"state"in b&&"identifier"in b&&"reason"in b&&b.state!==d("MAWReliabilityMonitor").HealthReportState.OK.valueOf()&&typeof b.state==="string"&&typeof b.reason==="string"&&typeof b.identifier==="string"&&a.push([b.identifier,b.state,b.reason].join(":"));return a},[]);r(a,{bool:{workerHealthStatus:e},string:{error:(a=b[0])!=null?a:void 0},string_array:{errors:b}})}}catch(a){c("FBLogger")("messenger_web").catching(a).mustfix("Failed to log ack result annotations");return!1}}function t(a,b,c){if(typeof c==="object"&&typeof (c==null?void 0:c.timestamp)==="number"){c=c.payload;q(a);v(a,"ack");s(a,c);m.has(b)&&d("MAWTrackPendingOccamadilloThreads").markBridgeCallAcked()}}function u(a,b,c){l.has(b)||p(a,b,c),v(a,"send")}function v(a,b,d){if(!k.has(a))return;c("QPLUserFlow").addPoint(c("qpl")._(1056842055,"807"),b,{instanceKey:a,timestamp:d})}g.getUnackedEventTimeout=o;g.logStart=a;g.logSuccess=b;g.logFailure=e;g.logTimeoutFailure=f;g.logAnnotations=r;g.logAck=t;g.logSend=u}),98);
__d("MAWBridgeLoggingUtils",["MAWWorkerEvent","ODS","Random","WAHashStringToNumber"],(function(a,b,c,d,e,f,g){"use strict";var h,i=3185,j="armadillo_worker_runtime",k="getWorkerHeartbeat",l=10,m=new Array(l);function n(a,b,c){(h||(h=d("ODS"))).bumpEntityKey(i,j,a+"_"+b+"_"+c)}function a(a){return d("WAHashStringToNumber").hashStringToNumber(a+Math.round(d("Random").random()*1e4)+1e4)}function b(a,b,c,e){n(b,c,"start");if(c===k)return;(h||(h=d("ODS"))).bumpEntityKey(i,j,"route_start");d("MAWWorkerEvent").logStart(a,c,e);m.length===l&&m.shift();m.push(b+"_"+c)}function o(a){m.filter(Boolean).forEach(function(b){(h||(h=d("ODS"))).bumpEntityKey(i,j,b+a)})}function c(a,b,c){n(a,b,"success");if(b===k)return;(h||(h=d("ODS"))).bumpEntityKey(i,j,"route_success");d("MAWWorkerEvent").logSuccess(c)}function e(a,b,c,e){n(a,b,"fail");if(b===k)return;(h||(h=d("ODS"))).bumpEntityKey(i,j,"route_fail");d("MAWWorkerEvent").logFailure(e,c)}function f(a,b,c,e){n(a,b,"timeout");if(b===k)return;(h||(h=d("ODS"))).bumpEntityKey(i,j,"route_timeout");d("MAWWorkerEvent").logTimeoutFailure(c,"Route timeout",e)}function p(){o("_before_unresponsive"),m.fill(null)}g.CAT_ID=i;g.ENT=j;g.HEARTBEAT_ROUTE=k;g.RECENT_ROUTES_NUM=l;g.getBridgeEventInstanceKey=a;g.routeStart=b;g.logRecentRoutes=o;g.routeSuccess=c;g.routeFail=e;g.routeTimeoutFail=f;g.logRecentBridgeEvents=p}),98);
__d("WACustomError",[],(function(a,b,c,d,e,f){"use strict";var g=Object.create(Error.prototype,{constructor:{value:void 0,writable:!0,configurable:!0}});function a(a,b,c){b===void 0&&(b=!0);function d(c){var d=Error.call(this,c);this.message=c;d.name=a;this.name=a;b&&(this.stack=d.stack)}d.prototype=Object.create(c?c.prototype:g);d.prototype.constructor=d;return d}function h(a){if(a.length===0)return"No errors";return a.length===1?a[0].message:a.map(function(a){return"- "+a.message}).join("\n")}e=function(a){babelHelpers.inheritsLoose(b,a);function b(b,c){c=c!=null&&c.length>0?c:h(b);c=a.call(this,c)||this;c.errors=b;return c}return b}(a("AggregateError",!0));var i=function(b){babelHelpers.inheritsLoose(a,b);function a(){return b.apply(this,arguments)||this}return a}(a("TimeoutError",!1)),j=function(b){babelHelpers.inheritsLoose(a,b);function a(a,c){a=b.call(this,a)||this;a.code=c;return a}return a}(a("HttpError",!1)),k=function(b){babelHelpers.inheritsLoose(a,b);function a(){return b.apply(this,arguments)||this}return a}(a("UnimplementedMethod")),l=!1;function b(a){if(a==null||a.name!=="QuotaExceededError")throw a;l=!0}function c(){return l}function d(a){return JSON.stringify(a,Object.getOwnPropertyNames(a))}var m=function(b){babelHelpers.inheritsLoose(a,b);function a(a,c){a=b.call(this,a)||this;a.inner=c;return a}return a}(babelHelpers.wrapNativeSuper(Error));f.customError=a;f.AggregateError=e;f.TimeoutError=i;f.HttpError=j;f.UnimplementedMethod=k;f.supressQuotaExceededError=b;f.hasSupressedQuotaExceededError=c;f.obtainErrorSummary=d;f.WrappedError=m}),66);
__d("WAAbortError",["WACustomError"],(function(a,b,c,d,e,f,g){"use strict";b=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}return b}(d("WACustomError").customError("AbortError"));var h="AbortError";function a(a){return function(b){if(b.name===h)return a(b);else throw b}}g.AbortError=b;g.ABORT_ERROR=h;g.catchAbort=a}),98);
__d("WAPromiseDelays",["Promise","WAAbortError"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,c){return new(h||(h=b("Promise")))(function(b,e){if(c==null?void 0:c.aborted)throw new(d("WAAbortError").AbortError)();var f=setTimeout(g,a);c==null?void 0:c.addEventListener("abort",h);function g(){c==null?void 0:c.removeEventListener("abort",h),b()}function h(){c==null?void 0:c.removeEventListener("abort",h),clearTimeout(f),e(new(d("WAAbortError").AbortError)())}})}function c(a,c,d){return new(h||(h=b("Promise")))(function(b,e){var f=setTimeout(function(){try{b(d())}catch(a){e(a)}},c);a.then(function(a){clearTimeout(f),b(a)},function(a){clearTimeout(f),e(a)})})}g.delayMs=a;g.withTimeout=c}),98);
__d("MAWMaybeWithTimeout",["MAWODSProxy","WAOdsEnums","WAPromiseDelays"],(function(a,b,c,d,e,f,g){"use strict";function h(){return!0}function a(a,b,c,e){return h()?d("WAPromiseDelays").withTimeout(a.then(function(a){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_NON_TIMEOUT,key:e!=null?e:"unknown"});return a}),b,function(){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_TIMEOUT,key:e!=null?e:"unknown"});return c()}):a}g.maybeWithTimeout=a}),98);
__d("MAWTimedBridge",["MAWBridgeLoggingUtils","MAWMaybeWithTimeout","MAWWaitForBackendSetup","MAWWebWorkerSingleton","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["route.",""]);h=function(){return a};return a}var i=17e4;function a(a,b,c,e,f){f===void 0&&(f=i);return d("MAWWaitForBackendSetup").waitForBackendSetup(c).then(function(){return d("MAWMaybeWithTimeout").maybeWithTimeout(a(),f,function(){return d("MAWWebWorkerSingleton").getWorkerHealthStatus().then(function(a){d("MAWBridgeLoggingUtils").routeTimeoutFail(b,c,e,a);d("WALogger").COUNT(h(),c).tags("bridge_timeout");throw new j("Bridge route "+c+" timed out, WorkerHealthStatus: "+a.tag)})},c)})}var j=function(b){babelHelpers.inheritsLoose(a,b);function a(a){var c;c=b.call(this,a)||this;c.name="BridgeTimeoutError";c.message=a;return c}return a}(babelHelpers.wrapNativeSuper(Error));g.DEFAULT_MAW_BRIDGE_TIMEOUT_MS=i;g.bridgeTimeout=a;g.MAWBridgeTimeoutError=j}),98);
__d("MAWBridgeSendAndReceive",["MAWBridge","MAWBridgeLoggingUtils","MAWTimedBridge","MAWWorkerEvent"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e){var f=d("MAWBridgeLoggingUtils").getBridgeEventInstanceKey(b),g=(e==null?void 0:e.isLoggingDisabled)!==!0,h=d("MAWTimedBridge").bridgeTimeout(function(){g&&d("MAWBridgeLoggingUtils").routeStart("sendAndReceive",a,b,f);return d("MAWBridge").getBridge().sendAndReceive(a,b,c,e==null?void 0:e.isLoggingDisabled,{onAck:function(a){g&&d("MAWWorkerEvent").logAck(f,b,a)},onSend:function(a){var c=a.queueMsgs;a=a.queueSize;g&&(d("MAWWorkerEvent").logSend(f,b,"sendAndReceive"),d("MAWWorkerEvent").logAnnotations(f,{"int":{bridgeSize:a},string_array:{bridgeMsgs:c}}))}},{bridgeQPLInstanceKey:f}).then(function(c){g&&d("MAWBridgeLoggingUtils").routeSuccess(a,b,f);return c})["catch"](function(c){g&&d("MAWBridgeLoggingUtils").routeFail(a,b,c.message,f);throw c})},a,b,f,e==null?void 0:e.timeoutMs);return h}g.sendAndReceive=a}),98);
__d("WAShiftTimer",["err"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){var b=this;this.$2=0;this.$3=0;this.ts=0;this.$4=0;this.$5=0;this.$6=0;this.$7=void 0;this.$8=function(){var a=b.$7,c=b.$1;b.$3=0;b.$2=0;b.ts=0;b.$4=0;b.$5=0;b.$6=0;b.$7=void 0;c(a)};this.onOrBefore=function(a,c){h(a);var d=Date.now();d=d+a;var e=b.$5;if(e!==0&&e<d)return;e=b.$6;if(e!==0&&d<e)return;b.$5=d;!b.$3&&(!b.$2||d<b.ts)&&b.$9(d,a,c)};this.forceRunNow=function(a){b.$2&&clearTimeout(b.$2),b.$3&&cancelAnimationFrame(b.$3),b.$7=a,b.$8()};this.cancel=function(){b.$2&&clearTimeout(b.$2),b.$3&&cancelAnimationFrame(b.$3),b.$2=0,b.$3=0,b.ts=0,b.$4=0,b.$5=0,b.$6=0,b.$7=void 0};this.$1=a}var b=a.prototype;b.onOrBeforeRepaint=function(a){if(this.$3)return;var b=Date.now(),c=this.$6;if(c!==0&&b<c)return;c=this.$5;(c===0||b<c)&&(this.$5=b);this.$2&&(clearTimeout(this.$2),this.$2=0);(!this.ts||this.ts>b)&&(this.ts=b);this.$7=a;this.$3=requestAnimationFrame(this.$8)};b.onOrAfter=function(a,b){h(a);var c=Date.now();c=c+a;var d=this.$6;if(d!==0&&c<d)return;d=this.$5;if(d!==0&&d<c)return;this.$6=c;(!this.$2||this.ts<c)&&this.$9(c,a,b)};b.debounce=function(a,b){h(a),this.$10(Date.now(),a,b)};b.debounceAndCap=function(a,b,c){h(a);h(b);var d=Date.now();b=d+b;var e=this.$6,f=this.$5;(e===0||e<=b)&&(f===0||b<f)&&(this.$5=b);this.$10(d,a,c)};b.forceRunNowIfScheduled=function(){this.$2?(clearTimeout(this.$2),this.$8()):this.$3&&(cancelAnimationFrame(this.$3),this.$8())};b.isScheduled=function(){return this.$2!==0||this.$3!==0};b.$10=function(a,b,c){var d=a+b,e=this.$6;if(e!==0&&d<e)return;e=this.ts;var f=this.$5;f!==0&&f<d?e<f&&this.$9(f,f-a,c):e<d&&this.$9(d,b,c)};b.$9=function(a,b,c){this.$3&&(cancelAnimationFrame(this.$3),this.$3=0);this.$7=c;this.ts=a;if(this.$2){c=a-this.$4;if(-16<c&&c<16)return;clearTimeout(this.$2)}this.$2=setTimeout(this.$8,b);this.$4=a};return a}();function h(a){if(!(a>=0))throw c("err")("ShiftTimer must be given delayMs >= 0")}g.ShiftTimer=a}),98);
__d("WABridgeBatcher",["WAShiftTimer"],(function(a,b,c,d,e,f,g){"use strict";var h=20,i=1e3;a=function(){function a(a,b,c){var e=this;this.$1=null;this.$6=Date.now();this.$7=new(d("WAShiftTimer").ShiftTimer)(function(){var a=e.$1;if(a==null)return;e.$1=null;e.$2(a)});this.$2=b;this.$3=a;this.$5=c!=null?c:h;this.$4=this.$5}var b=a.prototype;b.addEvent=function(a){var b=this.$1;this.$1=b?this.$3(b,a):[a];if(this.$7.isScheduled())return;b=this.$4;if(b<1){a=Date.now();var c=Math.max(a-this.$6,0)/i;b=Math.min(b+c,this.$5);this.$4=b;this.$6=a}b>=1?(c=0,this.$4=b-1):(c=Math.ceil(i*(1-b)),this.$4=0);this.$7.onOrBefore(c)};b.cancel=function(){this.$1=null,this.$7.cancel()};return a}();g.BridgeBatcher=a}),98);
__d("WALruCache",["WALogger","WAShiftTimer","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Blob size is larger than the limit of the whole store."]);h=function(){return a};return a}var i=function(a,b){this.key=a,this.value=b,this.prev=null,this.next=null};a=function(){function a(a){var b=this,e;this.$2=new Map();this.purgeNow=function(){for(var a=b.$6.prev;b.$4>b.$3&&a!==b.$5;a=a?a.prev:null){if(a==null)throw c("err")("The linked list is not constructed properly.");var d=a,e=d.key;d=d.value;if(!b.$9(e,d))continue;b["delete"](e);b.$10&&b.$10(e,d)}b.$8&&b.$8(b.$2)};this.$3=a.sizeLimit;this.$7=a.getSize;this.$8=a.onPurge;this.$9=(e=a.shouldEvict)!=null?e:function(){return!0};this.$10=a.onEvict;this.$11=a.onAdd;this.$12=a.onDelete;this.$4=0;this.$5=new i("placeholder-head",null);this.$6=new i("placeholder-tail",null);this.$5.next=this.$6;this.$6.prev=this.$5;this.$1=new(d("WAShiftTimer").ShiftTimer)(function(){return b.purgeNow()})}var b=a.prototype;b.get=function(a){if(!this.$2.has(a))return null;a=this.$2.get(a);if(a==null)return null;var b=a.prev,d=a.next;b&&(b.next=d);d&&(d.prev=b);d=this.$5.next;if(d==null)throw c("err")("The linked list is not constructed properly.");this.$5.next=a;d.prev=a;a.prev=this.$5;a.next=d;return a.value};b.has=function(a){return this.$2.has(a)};b.touch=function(a){this.get(a)};b.put=function(a,b){if(this.$3===0)return;if(this.$7(b)>this.$3){d("WALogger").WARN(h());return}this["delete"](a);this.$14(a,b);this.schedulePurge()};b.$14=function(a,b){var d=new i(a,b);this.$2.set(a,d);var e=this.$5.next;if(e==null)throw c("err")("The linked list is not constructed properly.");this.$5.next=d;e.prev=d;d.prev=this.$5;d.next=e;this.$4+=this.$7(b);this.$11&&this.$11(a,b)};b["delete"]=function(a){if(!this.$2.has(a))return;var b=this.$2.get(a);if(b==null)return;this.$4-=this.$7(b.value);var c=b.prev,d=b.next;c&&(c.next=d);d&&(d.prev=c);this.$2["delete"](a);this.$12&&this.$12(a,b.value)};b.clear=function(){this.$2.clear(),this.$4=0,this.$5.next=this.$6,this.$6.prev=this.$5,this.$13&&this.$13()};b.schedulePurge=function(){this.$1.onOrBefore(1e3)};b.getCurrentSize=function(){return this.$4};b.getPlaceholderHead=function(){return this.$5};b.forEach=function(a){if(this.$4===0)return;var b=this.$6.prev;if(b==null)throw c("err")("The linked list is not constructed properly.");while(b!=null&&b!==this.$5)a(b.value),b=b.prev};return a}();g.LruCache=a}),98);
__d("WACrossWorkerPortal",["Promise","WABridgeBatcher","WALogger","WALruCache","WAPromiseManagement","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["absorbPortal: transferring request #",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to execute onAck: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bridge unexpected result to cast: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bridge unrecognized result ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bridge "," response of ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bridge "," not intended for client ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bridge "," request for ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bridge queuing "," msgs"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bridge sending "," across (delayed)"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bridge received msg on old port"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bridge updating port"]);s=function(){return a};return a}var t=function(){function a(a,b,c,e,f){var g=this;this.port=null;this.$2=1;this.openRequests=new Map();this.listeners=new Set();if((f==null?void 0:f.useLRUCache)===!0){var h,i=new(d("WALruCache").LruCache)({sizeLimit:(h=f.portalCacheSize)!=null?h:100,getSize:function(){return 1}});this.processedRequests={has:function(a){return i.has(a)},add:function(a){i.put(a,!0)}}}else{var j=new Set();this.processedRequests={has:function(a){return j.has(a)},add:function(a){j.add(a)}}}this.$1=a;this.clientId=e;this.config=f;this.sendStream=new(d("WABridgeBatcher").BridgeBatcher)(b,function(a){g.$3(a)},(h=this.config)==null?void 0:h.bridgeBatcherMaxTokens);c.forEach(function(b){a.setNamespaceHandler(b,g.$4(b))})}var e=a.prototype;e.$5=function(){var a=this.clientId!=null?this.clientId+"_":"";return""+a+this.$2++};e.$6=function(a){a=a.split("_");return a.length!==2?null:a[0]};e.addListener=function(a){var b=this;this.listeners.add(a);return function(){return b.listeners["delete"](a)}};e.setPort=function(a){var b=this;d("WALogger").LOG(s());this.port=a;this.sendStream.cancel();a.onmessage=function(c){if(b.port!==a){d("WALogger").WARN(r()).devConsole(c.data);return}c=c.data;if(!c||!Array.isArray(c))return;c.forEach(function(c){b.$7(c,"incoming"),b.$8(a,c)})};this.openRequests.forEach(function(a){a=a.request;d("WALogger").DEV(q(),a.name);b.sendStream.addEvent({type:"request",content:a})})};e.getBridge=function(){return this.$1};e.$4=function(a){var b=this;return function(c,d,e,f,g,h){b.$9(a,c,d,e,f,g,h)}};e.$9=function(a,b,c,d,e,f,g){var h,i=this.$5();h=babelHelpers["extends"]({fromClientId:(h=this.clientId)!=null?h:void 0},g);g={requestId:i,expectsResponse:!!d,namespace:a,name:b,arg:c,silentLog:e,opts:h};this.openRequests.set(i,{request:g,resolver:d,eventCallbacks:f});this.sendStream.addEvent({type:"request",content:g})};e.$10=function(a,b){if(a!==this.port)return;this.sendStream.addEvent({type:"result",content:b})};e.$3=function(a){var b=this,c=this.port;if(!c){d("WALogger").DEV(p(),a.length);return}c.postMessage(a);var e=a.map(function(a){var b;b=(b=(b=a.content.arg)==null?void 0:b.type)!=null?b:"";return""+((a=a.content.name)!=null?a:"")+(b?":"+b:"")}).filter(Boolean);a.forEach(function(c){var d;b.$7(c,"outgoing");c=b.openRequests.get(c.content.requestId);(c==null?void 0:(d=c.eventCallbacks)==null?void 0:d.onSend)!=null&&c.eventCallbacks.onSend({queueSize:a.length,queueMsgs:e})})};e.$7=function(a,b){this.listeners.forEach(function(c){return c(a,b)})};e.$8=function(a,e){var f=this;if(e.type==="request"){var g=e.content,i=g.namespace,p=g.name,q=g.requestId,r=g.arg,s=g.expectsResponse,t=g.silentLog,u=g.opts;t||d("WALogger").LOG(o(),q,p);if((u==null?void 0:u.toClientId)!=null&&u.toClientId!==this.clientId){t||d("WALogger").LOG(n(),q,this.clientId);return}g=this.$1;var v={type:"result",content:{requestId:q,type:"handled",result:{payload:g.getAckPayoad(),timestamp:Date.now()},silentLog:t,opts:u}};this.$7(v,"outgoing");a.postMessage([v]);if(s){v=g.sendAndReceive(i,p,r,t,void 0,u).then(function(b){f.$10(a,{requestId:q,type:"success",result:b,silentLog:t,opts:u})},function(b){f.$10(a,{requestId:q,type:"error",result:String(b),silentLog:t,opts:u})});d("WAPromiseManagement").preventGarbageCollection(v)}else g.fireAndForget(i,p,r,t,void 0,u)}else{e.type;s=e.content;v=s.requestId;g=s.type;i=s.result;p=s.silentLog;p||d("WALogger").DEV(m(),v,g);r=this.$6(v);if(r!==this.clientId||this.processedRequests.has(v))return;e=this.openRequests.get(v);if(!e){d("WALogger").WARN(l(),v);return}switch(g){case"success":case"error":this.openRequests["delete"](v);this.processedRequests.add(v);s=e.resolver;s?s(g==="success"?i:(h||(h=b("Promise"))).reject(c("err")(i!=null?i:""))):d("WALogger").ERROR(k(),i);break;case"handled":try{(p=e.eventCallbacks)==null?void 0:p.onAck==null?void 0:p.onAck(i)}catch(a){d("WALogger").ERROR(j(),a.message)}e.resolver||(this.openRequests["delete"](v),this.processedRequests.add(v));break}}};return a}();function a(a,b,c,d,e){return new t(a,c,b,d,e)}function e(a){var b;(b=a.port)==null?void 0:b.close();a.port=null;a.sendStream.cancel();b=a.openRequests;a.openRequests=new Map();var c=a.getBridge();b.forEach(function(a){var b=a.request;a=a.resolver;var e=b.namespace,f=b.name,g=b.arg,h=b.silentLog;d("WALogger").LOG(i(),b.requestId);a?a(c.sendAndReceive(e,f,g,h)):c.fireAndForget(e,f,g,h)})}g.CrossWorkerPortal=t;g.attachPortal=a;g.killPortalAndSendPendingToBridge=e}),98);
__d("MAWCrossWorkerPortal",["FBLogger","WACrossWorkerPortal","pageID"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,e,f){if(h!=null)return h;h=d("WACrossWorkerPortal").attachPortal(a,b,e,c("pageID"),f);return h}function b(){if(h==null){c("FBLogger")("messenger_web").warn("Trying to kill portal before its setup");return}d("WACrossWorkerPortal").killPortalAndSendPendingToBridge(h)}g.getOrCreateCrossWorkerPortal=a;g.killPortalWhenWorkerTerminating=b}),98);
__d("WAPubSub",["err"],(function(a,b,c,d,e,f,g){"use strict";var h=function(){function a(){this.$1=new Set()}var b=a.prototype;b.publish=function(a){this.$1.forEach(function(b){return b(a)})};b.subscribe=function(a){var b=this;this.$1.add(a);return function(){b.$1["delete"](a)}};return a}();b=function(){function a(){this.$1=new Map()}var b=a.prototype;b.publish=function(a,b){a=this.$2(a);a.forEach(function(a){return a(b)})};b.$2=function(a){(!this.$1.has(a)||this.$1.get(a)==null)&&this.$1.set(a,new Set());a=this.$1.get(a);if(a==null)throw c("err")("Key space should not be null");return a};b.subscribe=function(a,b){var c=this.$2(a);c.add(b);return function(){c["delete"](b)}};return a}();function a(){return new h()}g.WAPubSub=h;g.WAKeyedPubSub=b;g.simplePubSub=a}),98);
__d("WAGenericStateManager",["Promise","WAPubSub"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){function a(a){this.$2=d("WAPubSub").simplePubSub(),this.$1=a}var c=a.prototype;c.onSet=function(a){return this.$2.subscribe(a)};c.set=function(a){this.$1=a;this.$2.publish(a);return this.$1};c.get=function(){return this.$1};c.waitForValue=function(a){var c=this;return this.$1===a?(h||(h=b("Promise"))).resolve():new(h||(h=b("Promise")))(function(b){var d=c.onSet(function(c){c===a&&(d(),b())})})};return a}();g.WAGenericStateManager=a}),98);
__d("MAWEBEnabledStateManager",["WAGenericStateManager"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.call(this,!1)||this}var c=b.prototype;c.isEnabled=function(){return this.get()};c.waitForEBEnabled=function(){return this.waitForValue(!0)};return b}(d("WAGenericStateManager").WAGenericStateManager);g.MAWEBEnabledStateManager=a}),98);
__d("MAWEBSwitch",["EBGating","ExecutionEnvironment","MAWEBEnabledStateManager","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h;a=c("requireDeferred")("EBIsEbEnabledSubscriber").__setRef("MAWEBSwitch");var i=new(d("MAWEBEnabledStateManager").MAWEBEnabledStateManager)();((h||(h=c("ExecutionEnvironment"))).isInMainThread===!0||d("EBGating").isEBSMv2Phase1Enabled())&&void a.load().then(function(a){return a.subscribeToEbChanges(function(a){i.set(a)})});b=i;g["default"]=b}),98);
__d("MAWMiActGetMappingWithMawTypes",["I64","MAWJids","WAJids"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){var c=(h||(h=d("I64"))).to_string(a.jid);b=b?d("WAJids").toGroupJid(c):d("MAWJids").toUserJid(c);return{clientThreadPk:a.clientThreadPk,jid:b,serverThreadKey:a.serverThreadKey}}g["default"]=a}),98);
__d("MAWMiActThreadLifecycleState",[],(function(a,b,c,d,e,f){"use strict";a={AUTHORITATIVE_THREAD_MISSING_MAPPING_ROW:"AUTHORITATIVE_THREAD_MISSING_MAPPING_ROW",AUTHORITATIVE_THREAD_ONLY:"AUTHORITATIVE_THREAD_ONLY",CLIENT_PARTIAL_MI_THREAD:"CLIENT_PARTIAL_MI_THREAD",CLIENT_PARTIAL_MI_THREAD_WITH_ACT:"CLIENT_PARTIAL_MI_THREAD_WITH_ACT",JID_MISSING_MAPPING_ROW:"JID_MISSING_MAPPING_ROW",JID_MISSING_MI_THREAD:"JID_MISSING_MI_THREAD",MI_AND_ACT_THREAD_COMPLETE:"MI_AND_ACT_THREAD_COMPLETE",OPTIMISTIC_THREAD_NO_ACT:"OPTIMISTIC_THREAD_NO_ACT",OPTIMISTIC_THREAD_WITH_ACT:"OPTIMISTIC_THREAD_WITH_ACT",SERVER_PARTIAL_MI_THREAD:"SERVER_PARTIAL_MI_THREAD",THREAD_KEY_ONLY:"THREAD_KEY_ONLY"};f.MiActThreadStatesEnum=a}),66);
__d("MWLogSendToSentFailedError",["FBLogger","QuickPerformanceLogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,d,e,f){var g=a.qplEventType;a=a.qplInstanceKey;g=(h||(h=c("QuickPerformanceLogger"))).getMarker(g,a);a=g==null?void 0:(a=g.annotations)==null?void 0:(a=a.bool)==null?void 0:a.is_secure;c("FBLogger")("messenger_web_messaging","send_to_sent_failed").blameToPreviousFrame().blameToPreviousFrame().warn("send_to_sent failed with reason: %s. Caught error message: %s. Additional description: %s. Secure? %s. Error Code: %s. Application Error: %s.",b,(b=d==null?void 0:d.message)!=null?b:"",(g=(d=g==null?void 0:(d=g.annotations)==null?void 0:(b=d.string)==null?void 0:b.error_description)!=null?d:g==null?void 0:(b=g.annotations)==null?void 0:(d=b.string)==null?void 0:d.errorType)!=null?g:"",a===!0?"secure":a===!1?"open":"unknown",(b=e==null?void 0:e.toString())!=null?b:"",(d=f==null?void 0:f.toString())!=null?d:"")}g["default"]=a}),98);
__d("MWMsgMediaTypeLogUtils",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";var g=b("$InternalEnum")({Application:"application",Audio:"audio",Avatar:"avatar",HotEmoji:"hot_emoji",File:"file",Gif:"gif",Image:"image",Link:"link",None:"none",Poll:"poll",Reaction:"reaction",Sticker:"sticker",Video:"video",Share:"share",NoteReply:"note_reply"});function a(a){var b=a.hasFile;b=b===void 0?!1:b;var c=a.hasGif;c=c===void 0?!1:c;var d=a.hasHotEmoji;d=d===void 0?!1:d;var e=a.hasImage;e=e===void 0?!1:e;var f=a.hasLinks;f=f===void 0?!1:f;var h=a.hasNoteReply;h=h===void 0?!1:h;var i=a.hasShare;i=i===void 0?!1:i;var j=a.hasSticker;j=j===void 0?!1:j;var k=a.hasVideo;k=k===void 0?!1:k;a=a.hasVoiceClip;a=a===void 0?!1:a;var l=g.None;e?l=g.Image:k?l=g.Video:d?l=g.HotEmoji:j?l=g.Sticker:c?l=g.Gif:a?l=g.Audio:b?l=g.File:i?l=g.Share:f?l=g.Link:h&&(l=g.NoteReply);return l}f.AttachmentType=g;f.getAttachmentType=a}),66);
__d("MWGetOriginalEntrypoint",["I64","InteractionTracingMetrics","MWChatInteraction"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){var b,e=d("MWChatInteraction").get((h||(h=d("I64"))).to_string(a));e=e!=null?c("InteractionTracingMetrics").get(e):null;e=(b=e==null?void 0:(b=e.annotations.string)==null?void 0:b.inboxEntrypoint)!=null?b:e==null?void 0:(b=e.annotations.string)==null?void 0:b.entrypoint;if(e!=null&&e!=="unknown")return e;b=d("MWChatInteraction").get("inbox_init");if(b!=null&&(h||(h=d("I64"))).equal(a,(h||(h=d("I64"))).of_string(b)))return"initInbox";e=d("MWChatInteraction").get(d("MWChatInteraction").MW_AUTO_CHAT_TAB_OPEN);b=e!=null?(b=c("InteractionTracingMetrics").get(e))==null?void 0:(e=b.annotations.string)==null?void 0:e.thread_id:null;return b===(h||(h=d("I64"))).to_string(a)?"auto_open":"unknown"}g["default"]=a}),98);
__d("MWMsgActionLogUtils",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";var g=b("$InternalEnum")({Send:"send",Reaction:"reaction",Reply:"reply",Forward:"forward",Share:"share",StoryReply:"story-reply",Unsend:"unsend",GroupInvite:"group-invite",SenderKeyDistribution:"sender-key-distribution",EphemeralSetting:"ephemeral-setting",Edit:"edit",Bump:"bump",Retry:"retry"});function a(a){var b=a.hasEphemeralSetting;b=b===void 0?!1:b;var c=a.hasGroupInvite;c=c===void 0?!1:c;var d=a.hasReaction;d=d===void 0?!1:d;var e=a.hasReply;e=e===void 0?!1:e;var f=a.hasSenderKeyDistribution;f=f===void 0?!1:f;var h=a.hasStoryReply;h=h===void 0?!1:h;var i=a.isBump;i=i===void 0?!1:i;var j=a.isEdit;j=j===void 0?!1:j;var k=a.isForward;k=k===void 0?!1:k;var l=a.isRetry;l=l===void 0?!1:l;a=a.isUnsend;a=a===void 0?!1:a;var m=g.Send;e?m=g.Reply:h?m=g.StoryReply:a?m=g.Unsend:d?m=g.Reaction:c?m=g.GroupInvite:b?m=g.EphemeralSetting:f?m=g.SenderKeyDistribution:j?m=g.Edit:k?m=g.Forward:i?m=g.Bump:l&&(m=g.Retry);return m}f.ActionType=g;f.getActionType=a}),66);
__d("MWHasLinksUtil",["URLMatcher","isStringNullOrEmpty"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return c("isStringNullOrEmpty")(a)?!1:c("URLMatcher").match(a)!=null}g.getHasLinks=a}),98);
__d("MWVersion",["I64"],(function(a,b,c,d,e,f,g){"use strict";var h;a=(h||d("I64")).of_string("2");g.v2=a}),98);
__d("MWSharedS2SBaseAnnotations",["$InternalEnum","I64","LSMessagingThreadAttributionType","LSMessagingThreadTypeUtil","MWHasLinksUtil","MWMsgActionLogUtils","MWMsgMediaTypeLogUtils","MWPreloadableQueries","MWVersion","MultipleTabsLogger","ReQL","gkx","isStringNullOrEmpty","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h,i=b("$InternalEnum")({Text:"text",NonText:"non-text"});async function a(a,b,e,f){var g=a.hasAttachment;g=g===void 0?!1:g;var k=a.hasEphemeralSetting,l=a.hasGroupInvite,m=a.hasReaction,n=a.hasReply,o=a.hasSenderKeyDistribution,p=a.hasStoryReply,q=a.hasText;q=q===void 0?!1:q;var r=a.isBump,s=a.isEdit,t=a.isForward,u=a.isRetry,v=a.isUnsend;a=babelHelpers.objectWithoutPropertiesLoose(a,["hasAttachment","hasEphemeralSetting","hasGroupInvite","hasReaction","hasReply","hasSenderKeyDistribution","hasStoryReply","hasText","isBump","isEdit","isForward","isRetry","isUnsend"]);k=d("MWMsgActionLogUtils").getActionType({hasEphemeralSetting:k,hasGroupInvite:l,hasReaction:m,hasReply:n,hasSenderKeyDistribution:o,hasStoryReply:p,isBump:r,isEdit:s,isForward:t,isRetry:u,isUnsend:v});l=d("MWMsgMediaTypeLogUtils").getAttachmentType(a);m=q&&(!l||l===d("MWMsgMediaTypeLogUtils").AttachmentType.None)?i.Text:i.NonText;n=f!=null?parseInt(f,10):void 0;isNaN(n)&&(n=void 0);return{bool:{has_attachment:g,has_sticker:a.hasSticker,has_text:q,is_attachments_grouped:a.isAttachmentsGrouped,is_pdb:Boolean(c("gkx")("8483")),is_tlc_public_user:c("gkx")("24028"),use_maw_shared_worker:d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()},int:{number_of_attachments:a.numberOfAttachments,number_of_grouped_attachments:a.numberOfGroupedAttachments,offline_threading_id:n},string:{action_type:k,attachment_type:l,entrypoint:j(b),message_type:m,multipleTabs:await d("MultipleTabsLogger").getMultipleTabsAnnotation(),mw_version:(h||(h=d("I64"))).to_string(d("MWVersion").v2),offline_threading_id:f,root_component:e}}}function j(a){var b;return(b=Object.keys(c("LSMessagingThreadAttributionType")).find(function(b){return c("LSMessagingThreadAttributionType")[b]===a}))!=null?b:"UNKNOWN"}async function e(a){var b=a.db,c=a.threadKey;a=babelHelpers.objectWithoutPropertiesLoose(a,["db","threadKey"]);b=b!=null&&c!=null?await d("ReQL").toArrayAsync(d("MWPreloadableQueries").getMediaStagingQuery(b,c)):[];return{mediaStagings:b,messageTypeParams:k(babelHelpers.extends({},a,{mediaStagings:b}))}}function k(a){var b=a.externalAttachmentUrl,e=a.hotEmojiSize,f=a.isBump,g=a.isEdit,h=a.isEphemeralSetting,i=a.isForward,j=a.isGroupInvite,k=a.isReaction,l=a.isRetry,m=a.isSenderKeyDistribution,n=a.isUnsend,o=a.mediaGroupInfo,p=a.mediaStagings,q=a.messageText,r=a.reply,s=a.sentFromShareSheet,t=a.stickerId,u=a.threadType;a=a.voiceClip;var v=!c("isStringNullOrEmpty")(q);q=d("MWHasLinksUtil").getHasLinks(q);var w=!1;a=a!=null;a?w=!0:b!=null&&(w=!0);var x=!1,y=!1,z=!1,A=0,B=0,C;if(p!=null&&p.length>0){w=!0;for(var D of p){var E=D.mimeType;E.indexOf("image")!==-1&&(x=!0);E.indexOf("video")!==-1&&(y=!0);E.indexOf("application")!==-1&&(z=!0)}if(x&&u!=null){E=d("LSMessagingThreadTypeUtil").isArmadilloSecure(u);C=!E}A=p.length}o!=null&&(C=!0,B=o.messagesAndAttachments.length);D=e!=null;u=r!=null;E=r!=null;p=t!=null&&!D;o=!p&&b!=null;e=s===!0;r=k===!0;t=j===!0;b=h===!0;s=m===!0;return{hasAttachment:w,hasEphemeralSetting:b,hasFile:z,hasGif:o,hasGroupInvite:t,hasHotEmoji:D,hasImage:x,hasLinks:q,hasReaction:r,hasReply:u,hasSenderKeyDistribution:s,hasShare:e,hasSticker:p,hasStoryReply:E,hasText:v,hasVideo:y,hasVoiceClip:a,isAttachmentsGrouped:C,isBump:f!=null?f:!1,isEdit:g!=null?g:!1,isForward:i!=null?i:!1,isRetry:l!=null?l:!1,isUnsend:n!=null?n:!1,numberOfAttachments:A,numberOfGroupedAttachments:B}}g.MsgType=i;g.getSendToSentBaseAnnotations=a;g.getEntrypointAnnotation=j;g.queryMediaStagingAndGetMessageTypeParams=e;g.getMessageTypeParams=k}),98);
__d("MWSharedMsgLogUtils",["$InternalEnum","I64","IGDInteractionTraceAnnotations","LSIntEnum","LSMessagingThreadTypeUtil","MAWEBSwitch","MWGetOriginalEntrypoint","MWMsgActionLogUtils","MWMsgMediaTypeLogUtils","MWSharedS2SBaseAnnotations","MultipleTabsLogger","cr:6985","gkx","isArmadillo","promiseDone","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=b("$InternalEnum")({Text:"text",NonText:"non-text"});async function a(a,e,f,g,i){var j=b("cr:6985")!=null?await b("cr:6985").isCutoverThreadKey(a.threadKey):!1;e=await d("MWSharedS2SBaseAnnotations").getSendToSentBaseAnnotations(e,f,g,i);return{bool:babelHelpers.extends({},e.bool,{},d("IGDInteractionTraceAnnotations").getInstamadilloBooleanAnnotations(a),{is_community_event:a.eventStartTimestampMs!=null,is_cutover:c("isArmadillo")()&&j,is_message_request:d("LSMessagingThreadTypeUtil").isMessageRequest(a),is_secure:d("LSMessagingThreadTypeUtil").isArmadilloSecure(a.threadType)}),int:babelHelpers.extends({},e.int),string:babelHelpers.extends({},e.string,{consistent_thread_fbid:a.consistentThreadFbid!=null?(h||(h=d("I64"))).to_string(a.consistentThreadFbid):null,original_entrypoint:c("MWGetOriginalEntrypoint")(a.threadKey),thread_id:(h||(h=d("I64"))).to_string(a.threadKey),thread_subtype:a.threadSubtype!=null?(h||(h=d("I64"))).to_string(a.threadSubtype):null,thread_type:h.to_string(a.threadType)})}}function e(a,b,e,f){k(a,b,c("MWGetOriginalEntrypoint")(e.threadKey),e.threadKey,e.consistentThreadFbid,e.threadType,e.threadSubtype,f),d("IGDInteractionTraceAnnotations").addInstamadilloAnnotationsToInteractionTrace(e,a)}function k(a,e,f,g,i,k,l,m){var n=e.hasEphemeralSetting;n=n===void 0?!1:n;var o=e.hasFile;o=o===void 0?!1:o;var p=e.hasGif;p=p===void 0?!1:p;var q=e.hasGroupInvite;q=q===void 0?!1:q;var r=e.hasHotEmoji;r=r===void 0?!1:r;var s=e.hasImage;s=s===void 0?!1:s;var t=e.hasLinks;t=t===void 0?!1:t;var u=e.hasReaction;u=u===void 0?!1:u;var v=e.hasReply;v=v===void 0?!1:v;var w=e.hasSenderKeyDistribution;w=w===void 0?!1:w;var x=e.hasShare;x=x===void 0?!1:x;var y=e.hasSticker;y=y===void 0?!1:y;var z=e.hasStoryReply;z=z===void 0?!1:z;var A=e.hasText;A=A===void 0?!1:A;var B=e.hasVideo;B=B===void 0?!1:B;var C=e.hasVoiceClip;C=C===void 0?!1:C;var D=e.isAttachmentsGrouped,E=e.isBump;E=E===void 0?!1:E;var F=e.isEdit;F=F===void 0?!1:F;var G=e.isForward;G=G===void 0?!1:G;var H=e.isRetry;H=H===void 0?!1:H;var I=e.isUnsend;I=I===void 0?!1:I;var J=e.numberOfAttachments;J=J===void 0?0:J;e=e.numberOfGroupedAttachments;e=e===void 0?0:e;n=d("MWMsgActionLogUtils").getActionType({hasEphemeralSetting:n,hasGroupInvite:q,hasReaction:u,hasReply:v,hasSenderKeyDistribution:w,hasStoryReply:z,isBump:E,isEdit:F,isForward:G,isRetry:H,isUnsend:I});q=d("MWMsgMediaTypeLogUtils").getAttachmentType({hasFile:o,hasGif:p,hasHotEmoji:r,hasImage:s,hasLinks:t,hasShare:x,hasSticker:y,hasVideo:B,hasVoiceClip:C,numberOfAttachments:J,numberOfGroupedAttachments:e});u=A&&(!q||q===d("MWMsgMediaTypeLogUtils").AttachmentType.None)?j.Text:j.NonText;d("MultipleTabsLogger").addAnnotationWithInteractionUuid(a.getTraceId());a.addAnnotation("attachment_type",q);a.addAnnotation("action_type",n);a.addAnnotation("message_type",u);a.addAnnotation("original_entrypoint",f);m!=null&&a.addAnnotation("root_component",m);a.addAnnotationInt("number_of_attachments",J);D!=null&&a.addAnnotationBoolean("is_attachments_grouped",D);a.addAnnotation("thread_id",(h||(h=d("I64"))).to_string(g));i!=null&&a.addAnnotation("consistent_thread_fbid",(h||(h=d("I64"))).to_string(i));a.addAnnotation("thread_type",h.to_string(k));l!=null&&a.addAnnotation("thread_subtype",(h||(h=d("I64"))).to_string(l));b("cr:6985")!=null&&c("promiseDone")(b("cr:6985").isCutoverThreadKey(g),function(b){a.addAnnotationBoolean("is_cutover",b)});a.addAnnotationBoolean("is_secure",d("LSMessagingThreadTypeUtil").isArmadilloSecure(k));a.addAnnotationBoolean("is_eb_enabled",c("MAWEBSwitch").isEnabled());a.addAnnotationBoolean("use_maw_shared_worker",d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker());a.addAnnotationBoolean("is_pdb",Boolean(c("gkx")("8483")))}function f(a){if((h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(2)))return"media";else if((h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(4)))return"audio";else if((h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(4096))||(h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(134217728)))return"sticker";else if((h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(16384)))return"gif";else if((h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(64)))return"file";else if((h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(1)))return"text";else if((h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(1024))||(h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(536870912)))return"XMA";else return"unknown"}g.MsgType=j;g.getSendToSentAnnotations=a;g.addSendMessageMetadataForInteractionTrace=e;g.addSendMessageMetadataForInteractionTraceWithThreadMetadata=k;g.getMessageTypeFromDisplayedContentType=f}),98);
__d("sendToSentQPLLogger",["LSDatabaseSingleton","LSIntEnum","MAWMIC","MAWSetupWorkerAuxStateForLogging","MAWWaitForBackendSetup","MWLogSendToSentFailedError","MWMsgMediaTypeLogUtils","MWSharedMsgLogUtils","MWSharedS2SBaseAnnotations","Network","QPLEvent","QPLUserFlow","QuickPerformanceLogger","Random","ReQL","WAExceededStorageQuota","WAGetSafeQPLError","WAGetStorageQplAnnotations","gkx","interaction-tracing","justknobx","mergeDeep","pageID","performance","promiseDone","qpl","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m=c("requireDeferred")("MAWWebWorkerSingleton").__setRef("sendToSentQPLLogger"),n=c("qpl")._(25313175,"1551"),o=new Map();function p(a,b){c("QPLUserFlow").addAnnotations(n,b,{instanceKey:a})}function a(a,b){c("QPLUserFlow").endCancel(n,{annotations:b!=null?b:{},instanceKey:a}),u(a)}function b(a,b,e,f){b=f!=null?f.type:b;c("MWLogSendToSentFailedError")({qplEventType:n,qplInstanceKey:a},b,e,f==null?void 0:f.errorCode,f==null?void 0:f.applicationErrorCode);c("QPLUserFlow").endFailure(n,b,{annotations:{bool:{exceededStorageQuota:d("WAExceededStorageQuota").getExceededStorageQuota(),useSentBytesCache:c("gkx")("33008"),wasBackendSetupReset:d("MAWWaitForBackendSetup").wasBackendSetupReset(),workerTerminatedPermanently:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.workerTerminatedPermanently},string:{errorDescription:d("WAGetSafeQPLError").getSafeQPLErrorMessage(e)},string_array:{worker_restart_msgs:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartMessageTypes,worker_restart_reasons:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartReasons}},error:e,instanceKey:a});u(a)}function q(a,b,d,e){a!=null&&c("QPLUserFlow").addPoint(n,b,{data:e,debugInfo:d,instanceKey:a})}function r(a){(k||(k=c("QuickPerformanceLogger"))).markerEnd(n,160,a),u(a)}function s(a,b){q(a,b?"network_connection_online":"network_connection_offline"),b||r(a)}function t(a){var b=c("interaction-tracing").NetworkStatusTracker.onChange(function(b){b=b.online;s(a,b)});o.set(a,b);s(a,c("interaction-tracing").NetworkStatusTracker.isOnline());if(c("Network").containsNetworkInformation()){b=c("Network").getRTT();b!=null&&p(a,{int:{network_rtt:b}});b=c("Network").getEffectiveType();b!=null&&p(a,{string:{network_effective_type:String(b)}});var d=c("Network").getBandwidth();d!=null&&p(a,{int:{network_bandwidth:d}});d=c("Network").getType();d!=null&&p(a,{string:{network_connectivity_type:String(b)}})}}function u(a){var b;(b=o.get(a))==null?void 0:b.remove();o.delete(a)}function v(a){window.navigator&&window.navigator.hardwareConcurrency&&p(a,{int:{hardware_concurrency:window.navigator.hardwareConcurrency}})}function w(a,b){a===void 0&&(a=!0);var e=Date.now()+(Math.round(d("Random").random()*1e4)+1e4);c("QPLUserFlow").start(x(b),{annotations:{bool:{backendSetupReady:d("MAWWaitForBackendSetup").isBackendSetupSuccessful(),wasBackendSetupReset:d("MAWWaitForBackendSetup").wasBackendSetupReset(),workerTerminatedPermanently:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.workerTerminatedPermanently},int:{timeMsSinceSessionStart:(l||(l=c("performance"))).now()},string:{hostname:window.location.hostname,pageID:c("pageID"),workerHeartbeatsOnStart:d("MAWSetupWorkerAuxStateForLogging").getHeartbeatHistoryAsString(),workerID:d("MAWWaitForBackendSetup").getCurrentWorkerID()},string_array:{worker_restart_msgs:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartMessageTypes,worker_restart_reasons:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartReasons}},instanceKey:e});c("promiseDone")(d("MAWMIC").getState().then(function(a){p(e,{string:{mic_state:a}})}));a&&c("promiseDone")(d("WAGetStorageQplAnnotations").getStorageQplAnnotations().then(function(a){p(e,a)}));c("promiseDone")((h||(h=d("LSDatabaseSingleton"))).LSDatabaseSingleton.then(function(a){return d("ReQL").firstAsync(d("ReQL").fromTableDescending(a.tables.connectivity_status)).then(function(a){if(!a)return;p(e,{int:{connection_state_ls_transport:(i||(i=d("LSIntEnum"))).toNumber(a.internetConnectionState)}})})}));c("promiseDone")(m.load().then(function(a){return a.getWorkerHealthStatus().then(function(a){p(e,{string:{workerHealthStatusOnStart:a.tag}})})}));t(e);v(e);return e}function x(a){if((j||(j=d("QPLEvent"))).getSamplingMethod(n)!==1)return n;if(!y(a))return n;a=(j||(j=d("QPLEvent"))).getSampleRate(n);var b=c("justknobx")._("3946");b=Math.max(1,Math.min(b,a));return{i:j.getMarkerId(n),m:j.getSamplingMethod(n),r:b}}function y(a){return a===d("MWMsgMediaTypeLogUtils").AttachmentType.Application||a===d("MWMsgMediaTypeLogUtils").AttachmentType.Audio||a===d("MWMsgMediaTypeLogUtils").AttachmentType.File||a===d("MWMsgMediaTypeLogUtils").AttachmentType.Gif||a===d("MWMsgMediaTypeLogUtils").AttachmentType.Image||a===d("MWMsgMediaTypeLogUtils").AttachmentType.Link||a===d("MWMsgMediaTypeLogUtils").AttachmentType.Sticker||a===d("MWMsgMediaTypeLogUtils").AttachmentType.Video||a===d("MWMsgMediaTypeLogUtils").AttachmentType.Share}function e(a){c("QPLUserFlow").endSuccess(n,{annotations:{bool:{exceededStorageQuota:d("WAExceededStorageQuota").getExceededStorageQuota()}},instanceKey:a}),u(a)}function f(a,b,e,f,g,h){g===void 0&&(g=!0);var i=w(g);if(a==null)return i;g=d("MWSharedS2SBaseAnnotations").getMessageTypeParams(babelHelpers.extends({},b,{threadType:a.threadType}));c("promiseDone")(d("MWSharedMsgLogUtils").getSendToSentAnnotations(a,g,e,void 0,h),function(a){a=c("mergeDeep")(a,f);p(i,a)});return i}var z=async function(a,b,d){var e=a+"_start";a=a+"_end";c("QPLUserFlow").addPoint(n,e,{instanceKey:b});e=await d();c("QPLUserFlow").addPoint(n,a,{instanceKey:b});return e};g.addSendToSentAnnotations=p;g.markSendToSentCancel=a;g.markSendToSentFail=b;g.markSendToSentPoint=q;g.markSendToSentStart=w;g.markSendToSentSuccess=e;g.markSendToSentStartWithAnnotation=f;g.measureSendToSentPerformance=z}),98);
__d("MAWThreadMappingQPL",["I64","JSResourceForInteraction","LSIntEnum","MAWLoggerUtils","MAWMiActMappingTableAPI","MAWQplProxy","MAWThreadMappingState","QPLUserFlow","Random","ReQL","WAJids","promiseDone","qpl","sendToSentQPLLogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=new Map(),k=new Set();function a(a){k.add(a)}function l(a,b){var c=a.actState;a=a.miState;return!k.has(b)?!1:c===d("MAWThreadMappingState").ActState.READY&&a===d("MAWThreadMappingState").MiState.OPTIMISTIC}var m=c("JSResourceForInteraction")("MAWWaitForBackendSetup").__setRef("MAWThreadMappingQPL"),n=c("qpl")._(1056836502,"2778"),o=c("qpl")._(25313175,"1551"),p=null;function b(a){return d("MAWLoggerUtils").getInstanceKeyFromId(a)}function q(a){return d("MAWLoggerUtils").getInstanceKeyFromId((h||(h=d("I64"))).to_string(a)+d("Random").random().toString())}function e(a,b,c){var e=j.get((h||(h=d("I64"))).to_string(a.jid));if(e!=null){s("continue_thread_mapping_after_tpq",e);c!=null&&u({bool:babelHelpers.extends({},c)},e);j.delete((h||(h=d("I64"))).to_string(a.jid));return e}e=(e=a.instanceKey)!=null?e:q(a.fbid);c=c!=null?c:{};var f=c.hasMappingRowAlready,g=c.hasPlaceholderRowInserted,i=c.isExistingRowPlaceholder;c=c.isExpectedThreadMissingInLsdb;var k=a.jid;r({hasMappingRowAlready:f,hasPlaceholderRowInserted:g,instanceKey:e,isExistingRowPlaceholder:i,isExpectedThreadMissingInLsdb:c,jid:a.isGroupThread?d("WAJids").toGroupJid((h||(h=d("I64"))).to_string(k)):d("WAJids").toMsgrUserJid((h||(h=d("I64"))).to_string(k)),threadKey:a.fbid,trigger:b});return e}function r(a){var b=a.instanceKey,e=a.s2sInstanceKey,f=babelHelpers.objectWithoutPropertiesLoose(a,["instanceKey","s2sInstanceKey"]);p=e;d("sendToSentQPLLogger").markSendToSentPoint(e,"thread_mapping_start",void 0,{string:{thread_state:a.threadState}});c("QPLUserFlow").start(n,{annotations:E(f),instanceKey:b});c("promiseDone")(m.load(),function(a){a=a.runAfterBackendSetup;a(function(){return s("maw_backend_available",b)},"bulkCreateOrUpdateThread")})}function f(a){var b=a.instanceKey;a.s2sInstanceKey;a=babelHelpers.objectWithoutPropertiesLoose(a,["instanceKey","s2sInstanceKey"]);d("MAWQplProxy").startQplUserFlow(n,E(a),{providedInstanceKey:b})}function s(a,b){c("QPLUserFlow").addPoint(n,a,{instanceKey:b}),p!=null&&c("QPLUserFlow").addPoint(o,"thread_mapping_"+a,{instanceKey:p})}function t(a,b){s("handle_existing_thread_fail",a);var c=b==null?"no_thread":"not_authoritative";b=b==null?void 0:(i||(i=d("LSIntEnum"))).toNumber(b.authorityLevel);u({int:{insufficientAuthorityLevel:b},string:{handleExistingThreadFailReason:c}},a)}function u(a,b){c("QPLUserFlow").addAnnotations(n,a,{instanceKey:b})}var v=async function(a,b,d){var e=a+"_start";a=a+"_end";c("QPLUserFlow").addPoint(n,e,{instanceKey:b});e=await d();c("QPLUserFlow").addPoint(n,a,{instanceKey:b});return e},w=function(a,b,c){return b==null?c():v(a,b,c)};function x(a,b){u({bool:{isResultVerified:!0},string:{finalActState:b.actState.toString(),finalMiState:b.miState.toString()}},a),d("sendToSentQPLLogger").markSendToSentPoint(p,"thread_mapping_end"),d("MAWThreadMappingState").isReady(b)||l(b,a)?c("QPLUserFlow").endSuccess(n,{instanceKey:a}):z("thread_state_not_ready",a)}async function y(a){var b,c=a.instanceKey,e=a.intJid,f=a.tables;a=a.threadKey;if(a==null&&e==null){z("no_thread_key_nor_jid",c);return}e=await F(f,{intJid:e,threadKey:a});b=(b=e==null?void 0:e.serverThreadKey)!=null?b:a;a=b==null?null:await d("ReQL").firstAsync(d("ReQL").fromTableAscending(f.threads).getKeyRange(b));x(c,await d("MAWThreadMappingState").getMappingStateForDbRows(a,e))}function z(a,b){d("sendToSentQPLLogger").markSendToSentPoint(p,"thread_mapping_fail",void 0,{string:{threadMappingFailReason:a}}),c("QPLUserFlow").endFailure(n,a,{instanceKey:b})}function A(a,b){d("sendToSentQPLLogger").markSendToSentPoint(p,"thread_mapping_fail",void 0,{string:{threadMappingFailReason:a.message}}),c("QPLUserFlow").endFailure(n,"error_thrown",{annotations:{string:{errorMessage:a.message}},instanceKey:b})}function B(a,b,c){d("MAWQplProxy").sendQPLFailThroughBridge(n,a,c,b)}function C(a,b){s(a,b),c("QPLUserFlow").endCancel(n,{instanceKey:b})}function D(a,b){d("MAWQplProxy").sendQPLCancelThroughBridge(n,{string:{cancelInWorkerReason:a}},b)}function E(a){var b=a.hasMappingRowAlready,c=a.hasPlaceholderRowInserted,e=a.isExistingRowPlaceholder,f=a.isExpectedThreadMissingInLsdb,g=a.jid,i=a.threadKey,j=a.threadState;a=a.trigger;return{bool:{hasMappingRowAlready:b,hasPlaceholderRowInserted:c,isExistingRowPlaceholder:e,isExpectedThreadMissingInLsdb:f},string:{initJid:g,initThreadKey:i==null?null:(h||(h=d("I64"))).to_string(i),initThreadState:j==null?void 0:j.toString(),trigger:a}}}async function F(a,b){var c=b.intJid;b=b.threadKey;b=await d("MAWMiActMappingTableAPI").getMappingRowForThreadKey(a,b);return b!=null?b:d("MAWMiActMappingTableAPI").getMappingRowForIntJid(a,c)}g.pendingThreadCreationOnServer=j;g.allowToSkipUpgradingOptimisticThreadInMI=a;g.getInstanceKeyForJidInWorker=b;g.getInstanceKeyForThreadKey=q;g.startOrContinueForMiActMappingParams=e;g.start=r;g.startInWorker=f;g.addPoint=s;g.handleExistingThreadFail=t;g.addAnnotations=u;g.measurePerformance=v;g.measurePerformanceForNullableInstanceKey=w;g.endForThreadState=x;g.end=y;g.endFailure=z;g.endFailureError=A;g.endFailureInWorker=B;g.endCancel=C;g.endCancelInWorker=D}),98);
__d("MAWThreadMappingState",["I64","LSAuthorityLevel","LSIntEnum","MAWJids","MAWMiActMappingTableAPI","MAWThreadMappingQPL","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j={MISSING:"MISSING",OPTIMISTIC:"OPTIMISTIC",PARTIAL:"PARTIAL",READY:"READY"},k={IN_PROGRESS:"IN_PROGRESS",MISSING:"MISSING",READY:"READY"};async function l(a,b){b=await d("MAWMiActMappingTableAPI").getMappingRowForChatJid(a,b);if(b==null)return{mappingState:{actState:k.MISSING,miState:j.MISSING},threadKey:null};a=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(b.serverThreadKey));return{mappingState:m(a,b),threadKey:b.serverThreadKey}}async function a(a,b){a=await l(a,b);b=a.mappingState;return b}async function b(a,b){a=await Promise.all([d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(b)),d("MAWMiActMappingTableAPI").getMappingRowForThreadKey(a,b)]);b=a[0];a=a[1];return m(b,a)}function m(a,b){return{actState:n(b),miState:o(a)}}function e(a){return a.miState===j.READY&&a.actState===k.READY}function n(a){return a==null?k.MISSING:p(a.clientThreadPk)?k.IN_PROGRESS:k.READY}function o(a){if(a==null)return j.MISSING;a=(h||(h=d("LSIntEnum"))).toNumber(a.authorityLevel);if(a===c("LSAuthorityLevel").AUTHORITATIVE)return j.READY;return a===c("LSAuthorityLevel").OPTIMISTIC?j.OPTIMISTIC:j.PARTIAL}async function f(a,b,c){await a.mi_act_mapping_table.put({clientThreadPk:(i||(i=d("I64"))).neg(b),jid:c,serverThreadKey:b})}function p(a){return(i||(i=d("I64"))).lt(a,i.zero)}async function q(a,b,c){var e=b.jid;b=b.threadKey;c===void 0&&(c=null);await r(a,{intJid:d("MAWJids").convertChatJidToIntJid(e),threadKey:b},c)}async function r(a,b,c){var e=b.intJid;b=b.threadKey;c===void 0&&(c=null);c!=null&&d("MAWThreadMappingQPL").addPoint("insert_mapping_row",c);await a.mi_act_mapping_table.put({clientThreadPk:e,jid:e,serverThreadKey:b})}function s(a,b){return l(a,b).then(function(a){var b=a.mappingState;a=a.threadKey;return b.miState===j.MISSING?null:a})}g.MiState=j;g.ActState=k;g.genMappingStateAndThreadKeyFromJid=l;g.genMappingStateFromJid=a;g.genMappingState=b;g.getMappingStateForDbRows=m;g.isReady=e;g.getActState=n;g.getMiState=o;g.markActThreadMappingAsInProgress=f;g.markActThreadMappingAsCompletedForJid=q;g.markActThreadMappingAsCompleted=r;g.getThreadKeyIfMiThreadNotMissing=s}),98);
__d("MAWMiActGetThreadLifecycleState",["FBLogger","I64","LSAuthorityLevel","LSIntEnum","LSMessagingThreadTypeUtil","MAWMiActGetMappingWithMawTypes","MAWMiActMappingTableAPI","MAWMiActThreadLifecycleState","MAWThreadMappingState","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,b,e){var f=(h||(h=d("LSIntEnum"))).toNumber(a.authorityLevel);if(f===c("LSAuthorityLevel").OPTIMISTIC)if(b!=null)return babelHelpers.extends({},c("MAWMiActGetMappingWithMawTypes")(b,d("LSMessagingThreadTypeUtil").isGroup(a.threadType)),{type:d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.OPTIMISTIC_THREAD_WITH_ACT});else return{serverThreadKey:a.threadKey,thread:a,type:d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.OPTIMISTIC_THREAD_NO_ACT};if(f===c("LSAuthorityLevel").CLIENT_PARTIAL)return b!=null?babelHelpers.extends({},c("MAWMiActGetMappingWithMawTypes")(b,d("LSMessagingThreadTypeUtil").isGroup(a.threadType)),{type:d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.CLIENT_PARTIAL_MI_THREAD_WITH_ACT}):{serverThreadKey:a.threadKey,type:d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.CLIENT_PARTIAL_MI_THREAD};if(f===c("LSAuthorityLevel").SERVER_PARTIAL)return{serverThreadKey:a.threadKey,type:d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.SERVER_PARTIAL_MI_THREAD};if(f===c("LSAuthorityLevel").AUTHORITATIVE){if(b==null)return{serverThreadKey:a.threadKey,thread:a,type:d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.AUTHORITATIVE_THREAD_MISSING_MAPPING_ROW};var g=d("MAWThreadMappingState").getActState(b)===d("MAWThreadMappingState").ActState.IN_PROGRESS;if(!g)return babelHelpers.extends({},c("MAWMiActGetMappingWithMawTypes")(b,d("LSMessagingThreadTypeUtil").isGroup(a.threadType)),{type:d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.MI_AND_ACT_THREAD_COMPLETE});else if(g){g=c("MAWMiActGetMappingWithMawTypes")(b,d("LSMessagingThreadTypeUtil").isGroup(a.threadType));return{jid:g.jid,jidInt64:b.jid,serverThreadKey:g.serverThreadKey,thread:a,type:d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.AUTHORITATIVE_THREAD_ONLY}}}throw c("FBLogger")("messenger_web").mustfixThrow("[MiActMapping] Unknown thread lifecycle state for threadKey: %s, authorityLevel: %s, thread action: %s",(i||(i=d("I64"))).to_string(a.threadKey),f,e)}async function k(a,b,c){var e=await d("MAWMiActMappingTableAPI").getMappingRowForIntJid(a,b);if(e==null)return{jidInt64:b,type:d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.JID_MISSING_MAPPING_ROW};a=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(e.serverThreadKey));return a==null?{jidInt64:b,type:d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.JID_MISSING_MI_THREAD}:j(a,e,c)}async function a(a,b,c){var e;e=await Promise.all([(e=d("ReQL")).firstAsync(e.fromTableAscending(a.threads).getKeyRange(b)),e.firstAsync(e.fromTableAscending(a.mi_act_mapping_table).getKeyRange(b))]);a=e[0];e=e[1];return a==null?{mappingRow:e,miActThreadState:{serverThreadKey:b,type:d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.THREAD_KEY_ONLY},thread:a}:{mappingRow:e,miActThreadState:j(a,e,c),thread:a}}async function l(a,b,c){var e;e=await Promise.all([(e=d("ReQL")).firstAsync(e.fromTableAscending(a.threads).getKeyRange(b)),e.firstAsync(e.fromTableAscending(a.mi_act_mapping_table).getKeyRange(b))]);a=e[0];e=e[1];return a==null?{serverThreadKey:b,type:d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.THREAD_KEY_ONLY}:j(a,e,c)}async function b(a,b,c,e){b=await k(a,b,e);if(b.type===d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.JID_MISSING_MAPPING_ROW&&c!=null)return l(a,(i||(i=d("I64"))).of_string(c),"MAWBridgeOccamadilloVerifyThreadExistsHandler");else return b}g.getThreadLifecycleStateByJid=k;g.getThreadLifecycleStateAndMappingRowAndThread=a;g.getThreadLifecycleStateByThreadKey=l;g.getThreadLifecycleStateByJidOrThreadKey=b}),98);
__d("MAWMiActOnActThreadReadyInstrumentation",["QPLUserFlow","Random","WAHashStringToNumber","isOfflineThreadingId","qpl"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("WAHashStringToNumber").hashStringToNumber(a+Math.round(d("Random").random()*1e4)+1e4)}function b(a,b,d,e){c("QPLUserFlow").start(c("qpl")._(1056846543,"1530"),{annotations:{bool:{is_otid:c("isOfflineThreadingId")(d)},string:{apiName:e,description:b}},instanceKey:a})}function e(a,b){c("QPLUserFlow").addPoint(c("qpl")._(1056846543,"1530"),b,{instanceKey:a})}function f(a,b){c("QPLUserFlow").addAnnotations(c("qpl")._(1056846543,"1530"),b,{instanceKey:a})}function h(a){c("QPLUserFlow").endSuccess(c("qpl")._(1056846543,"1530"),{instanceKey:a})}function i(a,b){c("QPLUserFlow").endFailure(c("qpl")._(1056846543,"1530"),b,{instanceKey:a})}g.getOnActThreadReadyInstanceKey=a;g.startQPL=b;g.addPointQPL=e;g.addAnnotationsQPL=f;g.endSuccessQPL=h;g.endFailureQPL=i}),98);
__d("MAWVerifyThreadExistsUtils",["FBLogger","I64","LSAuthorityLevel","LSIntEnum","LSVerifyE2EEMetadataThreadExistsV2StoredProcedure","isOfflineThreadingId"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=new Map(),k=6e4,l=1e4;function m(a){if(j.size>l){c("FBLogger")("messenger_web").mustfix("MAWVerifyThreadExistsUtils: requestedThreadKeys size exceeded limit");return}j.has(a)&&(window.clearTimeout(j.get(a)),j["delete"](a));j.set(a,window.setTimeout(function(){j["delete"](a)},k))}function a(a){return j.has(a)}function b(a,b,e){var f=b.threadKey;f!=null&&m((h||(h=d("I64"))).to_string(f));f!=null&&c("isOfflineThreadingId")(f)&&(h||(h=d("I64"))).equal(b.authorityLevel,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))&&c("FBLogger")("messenger_web").warn("MAWVerifyThreadExistsUtils: runVerifyThreadExistsSproc called with offline thread key - callsite: %s",e);return c("LSVerifyE2EEMetadataThreadExistsV2StoredProcedure")(a,b)}g.isThreadRequested=a;g.runVerifyThreadExistsSproc=b}),98);
__d("MWFBLogger",["FBLogger"],(function(a,b,c,d,e,f,g){"use strict";b=(a=c("FBLogger"))("messenger_web");d=a("messenger_web_media");e=a("messenger_web_sharing");f=a("messenger_web_calling");c=a("mps");g.MWLogger=b;g.MWMediaLogger=d;g.MWSharingLogger=e;g.MWCallingLogger=f;g.MPSLogger=c}),98);
__d("MAWMiActOnActThreadReadyQueue",["ExecutionEnvironment","I64","LSPlatformLsInitLog","MAWInit","MAWMIC","MAWMiActOnActThreadReadyInstrumentation","MAWThreadMappingQPL","MAWVerifyThreadExistsUtils","MWChatInteraction","MWFBLogger","clearTimeout","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error executing callback on ACT thread ready: ",", original threadState: ",", threadKey: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Executing queued "," for threadKey: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Took longer than "," ms to execute: "," in threadState: "," for threadKey: ",", onActThreadReady"]);l=function(){return a};return a}var m=d("MWFBLogger").MWLogger.tags(["MiActMapping","UIActions","ThreadReady"]),n=new Map(),o=3e4;function a(a,b,e,f,g,j){var k;if(!(i||(i=c("ExecutionEnvironment"))).isInBrowser)return;d("MAWMiActOnActThreadReadyInstrumentation").addPointQPL(j,"enqueue_by_thread_key_start");var p=(h||(h=d("I64"))).to_string(a);k=(k=n.get(p))!=null?k:[];var q=c("setTimeout")(function(){var b=d("MWChatInteraction").getInteractionTraceForThreadKey((h||(h=d("I64"))).to_string(a));b==null?void 0:b.addMarkerPoint("timeout_when_waiting_for_act_thread","AppTiming");b==null?void 0:b.addAnnotation("callsite_waiting_for_act_thread",f);b==null?void 0:b.addAnnotation("initial_thread_state",g);b==null?void 0:b.addAnnotationBoolean("is_mi_thread_requested",d("MAWVerifyThreadExistsUtils").isThreadRequested(p));d("MAWMiActOnActThreadReadyInstrumentation").addAnnotationsQPL(j,{bool:{during_mic:d("MAWMIC").duringMIC(),is_thread_requested:d("MAWVerifyThreadExistsUtils").isThreadRequested(p),ls_sync_has_ended:d("LSPlatformLsInitLog").LsSync.hasEnded(),maw_init_completed:d("MAWInit").MAWInitState.isCompleted()}});d("MAWMiActOnActThreadReadyInstrumentation").endFailureQPL(j,"enqueue_by_thread_key_timeout");m.MUSTFIX(l(),o,f,g,p);e(g)},o);k.push({callback:b,description:f,telemetryInstanceKey:j,threadState:g,timeoutId:q});n.set(p,k)}function b(a,b,c,e){if(a==null&&b==null)return;var f=a!=null?b!=null?"both":"clientThreadKey":"authoritativeThreadKey";a=a==null?0:(a=(a=n.get(a))==null?void 0:a.length)!=null?a:0;b=b==null?0:(b=(b=n.get(b))==null?void 0:b.length)!=null?b:0;d("MAWThreadMappingQPL").addAnnotations({int:{authorativeThreadKeyCallbacksNum:b,clientThreadKeyCallbacksNum:a},string:{flushBasedOnKey:f,flushReason:e}},c);d("MAWThreadMappingQPL").addPoint("flush_awaiting_callbacks",c)}async function e(a,b,e,f){var g=(h||(h=d("I64"))).to_string(a),i=n.get(g);if(i==null||i.length===0)return;while(i.length!==0){var l=i.shift();if(l==null)continue;var o=l.callback,p=l.description,q=l.telemetryInstanceKey,r=l.threadState;l=l.timeoutId;d("MAWMiActOnActThreadReadyInstrumentation").addPointQPL(q,"enqueue_by_thread_key_end");d("MAWMiActOnActThreadReadyInstrumentation").addAnnotationsQPL(q,{string:{caller_identifier:e,processed_based_on_key:f}});try{m.DEBUG(k(),p,g),d("MAWMiActOnActThreadReadyInstrumentation").endSuccessQPL(q),await o(a,b),c("clearTimeout")(l)}catch(a){c("clearTimeout")(l),d("MAWMiActOnActThreadReadyInstrumentation").endFailureQPL(q,"process_queue_on_act_thread_ready_failure"),m.catching(a).MUSTFIX(j(),p,r,g)}}n.delete(g)}g.enqueueByThreadKey=a;g.logOnFlushQueue=b;g.processQueueOnActThreadReady=e}),98);
__d("WAMsgType",[],(function(a,b,c,d,e,f){"use strict";a="Text";b="Futureproof";c="Ciphertext";d="Unavailable";e="Image";var g="Video",h="Ptt",i="Admin",j="Revoked",k="Gif",l="Sticker",m="DocumentFile",n="ExpiredEphemeral",o="EphemeralSettingAdmin",p="EphemeralSyncResponse",q="DeleteForMe",r="EphemeralSettingChangeFromCurrentDevice",s="AlertICDC",t="GroupInvite",u="NoteReply",v="Reaction",w="SenderKeyDistribution",x="EditAction",y="ReceiverFetch",z="Raven",A="GroupPollCreate",B="GroupPollUpdate",C={ADMIN:i,CIPHERTEXT:c,DELETE_FOR_ME:q,DOCUMENT_FILE:m,EDIT_ACTION:x,EPHEMERAL_SETTING_ADMIN:o,EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE:r,EPHEMERAL_SYNC_RESPONSE:p,EXPIRED_EPHEMERAL:n,FUTUREPROOF:b,GIF:k,GROUP_INVITE:t,ICDC_ALERT:s,IMAGE:e,PTT:h,REACTION:v,REVOKED:j,SK_DISTRIBUTION:w,STICKER:l,TEXT:a,UNAVAILABLE:d,VIDEO:g,RECEIVER_FETCH:y,RAVEN:z,GROUP_POLL_CREATE:A,GROUP_POLL_UPDATE:B};f.TEXT=a;f.FUTUREPROOF=b;f.CIPHERTEXT=c;f.UNAVAILABLE=d;f.IMAGE=e;f.VIDEO=g;f.PTT=h;f.ADMIN=i;f.REVOKED=j;f.GIF=k;f.STICKER=l;f.DOCUMENT_FILE=m;f.EXPIRED_EPHEMERAL=n;f.EPHEMERAL_SETTING_ADMIN=o;f.EPHEMERAL_SYNC_RESPONSE=p;f.DELETE_FOR_ME=q;f.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE=r;f.ICDC_ALERT=s;f.GROUP_INVITE=t;f.NOTE_REPLY=u;f.REACTION=v;f.SK_DISTRIBUTION=w;f.EDIT_ACTION=x;f.RECEIVER_FETCH=y;f.RAVEN=z;f.GROUP_POLL_CREATE=A;f.GROUP_POLL_UPDATE=B;f.MSG_TYPE=C}),66);
__d("MAWMsgType",["WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return k.has(a)};var h=function(a){return l.has(a)||k.has(a)};b=function(a){return h(a)||m.has(a)};c="EphemeralScreenshotAction";e="Raven";f="RavenAction";var i="XMA",j="BumpExistingMessage";d=babelHelpers["extends"]({},d("WAMsgType").MSG_TYPE,{BUMP_EXISTING_MESSAGE:j,EPHEMERAL_SCREENSHOT_ACTION:c,RAVEN:e,RAVEN_ACTION:f,XMA:i});var k=new Set([d.IMAGE,d.VIDEO,d.PTT,d.GIF,d.STICKER,d.XMA,d.RAVEN,d.DOCUMENT_FILE,d.RECEIVER_FETCH]),l=new Set([d.TEXT,d.REVOKED,d.XMA,d.BUMP_EXISTING_MESSAGE,d.GROUP_POLL_CREATE]),m=new Set([d.FUTUREPROOF]),n=new Set([d.TEXT,d.IMAGE,d.VIDEO,d.PTT,d.GIF,d.STICKER,d.DOCUMENT_FILE,d.UNAVAILABLE,d.EXPIRED_EPHEMERAL,d.REVOKED,d.XMA,d.RAVEN,d.RECEIVER_FETCH]);j=function(a){return n.has(a)};g.isMAWSupportedMediaType=a;g.isEBSupportedMsgType=h;g.isProtobufUploadSupportedMsgType=b;g.EPHEMERAL_SCREENSHOT_ACTION=c;g.MSG_TYPE=d;g.mawSupportedMediaTypes=k;g.isQuotedMsgType=j}),98);
__d("MAWWormOdsLogger",["WABridge","WAOdsEnums"],(function(a,b,c,d,e,f,g){"use strict";a={log:function(a){return d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.WORM,key:a})}};g.wormOdsWorkerLogger=a}),98);
__d("ReQLTable",[],(function(a,b,c,d,e,f){"use strict";async function a(a,b,c){var d=await a.get.apply(a,b);c=c(d);await a.upsert(b,c)}f.update=a}),66);
__d("WABaseProto",[],(function(a,b,c,d,e,f){"use strict";a="__tu";f.TAGGED_UNION_TAG=a}),66);
__d("WADevToolMessageChannel",[],(function(a,b,c,d,e,f){"use strict";var g=new MessageChannel(),h;a=function(){g=new MessageChannel();h(g);return g};b=function(){return g};c=function(a){h=a,h(g)};f.createNewChannel=a;f.getMostRecentChannel=b;f.onCreateNewChannel=c}),66);
__d("WALongInt",["WAHex","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(['"','" is over 64 bits']);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(['"','" is not a valid decimal string']);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose([""," is not a safe integer"]);j=function(){return a};return a}function k(a){if(typeof a!=="number"){d("WALogger").LOG(j(),a).color("red");throw new Error("numberOrThrowIfTooLarge is given a non-safe integer")}return a}f=function(a){return a==null?a:k(a)};function a(a){return a==null||typeof a!=="number"?null:a}function b(a,b){if(typeof a==="number"&&typeof b==="number")return a>b;a=typeof a==="number"?d("WAHex").hexLongFromNumber(a):a;b=typeof b==="number"?d("WAHex").hexLongFromNumber(b):b;return d("WAHex").isBiggerHexLong(a,b)}function c(a){if(typeof a==="number")return a.toString(10);var b=d("WAHex").hexLongToHex(a),c=[0],e=0;for(var f=0;f<b.length;f++){e=d("WAHex").hexAt(b,f);for(var g=0;g<c.length;g++)c[g]=c[g]*16+e,e=c[g]/10|0,c[g]%=10;while(e>0)c.push(e%10),e=e/10|0}g=c.reverse().join("");return d("WAHex").hexLongIsNegative(a)?"-"+g:g}function e(a){if(!/^-?\d+$/.test(a)){d("WALogger").LOG(i(),a).color("red");throw new Error("decimalStringToLongInt is given an invalid decimal string")}var b=a[0]==="-",c=a.replace(/^-?0*/,""),e=c.length;if(e<16||e===16&&c<="9007199254740991")return b?-Number(c):Number(c);if(e>20||e===20&&c>"18446744073709551615"||b&&(e>19||e===19&&c>"9223372036854775807")){d("WALogger").LOG(h(),a).color("red");throw new Error("decimalStringToHexLong is given value over 64 bits")}a=0;var f=0;for(var g=0;g<e;g++)a=a*10+Number(c[g]),f=f*10+Math.floor(a/4294967296),a=a%4294967296;return d("WAHex").createHexLongFrom32Bits(f,a,b)}g.numberOrThrowIfTooLarge=k;g.maybeNumberOrThrowIfTooLarge=f;g.maybeNumber=a;g.isBiggerLongInt=b;g.longIntToDecimalString=c;g.decimalStringToLongInt=e}),98);
__d("decodeProtobuf",["WABaseProto","WABinary","WAHasProperty","WAHex","WAProtoCompile","WAProtoConst","WAProtoUtils","WAProtoValidate"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){b=new(d("WABinary").Binary)(b);b=n(a,b,void 0,!1,!1);d("WAProtoValidate").checkRequirements(a,b);return b}function b(a,b){b=new(d("WABinary").Binary)(b);b=n(a,b,void 0,!1,!0);d("WAProtoValidate").checkRequirements(a,b);return b}function e(a,b){b=new(d("WABinary").Binary)(b);b=n(a,b,void 0,!0,!1);d("WAProtoValidate").checkRequirements(a,b);return b}function f(a){return c("WAHasProperty")(a,"$$unsafeUnknownFields")?a.$$unsafeUnknownFields:null}function h(a,b,c){if(a!==d("WAProtoUtils").typeToEncType(b))throw new Error("FormatError: "+c+" encoded with wire type "+a)}function i(a,b,c){switch(b){case d("WAProtoConst").TYPES.INT32:return j(c,-2147483648,2147483648,a,d("WABinary").parseInt64OrThrow);case d("WAProtoConst").TYPES.INT64:return c.readVarInt(k);case d("WAProtoConst").TYPES.UINT32:return j(c,0,4294967296,a,d("WABinary").parseUint64OrThrow);case d("WAProtoConst").TYPES.UINT64:return c.readVarInt(l);case d("WAProtoConst").TYPES.SINT32:b=j(c,0,4294967296,a,d("WABinary").parseInt64OrThrow);return b&1?~(b>>>1):b>>>1;case d("WAProtoConst").TYPES.SINT64:return c.readVarInt(m);case d("WAProtoConst").TYPES.BOOL:return!!j(c,0,2,a,d("WABinary").parseUint64OrThrow);case d("WAProtoConst").TYPES.ENUM:return c.readVarInt(d("WABinary").parseInt64OrThrow);case d("WAProtoConst").TYPES.FIXED64:return c.readLong(l,!0);case d("WAProtoConst").TYPES.SFIXED64:return c.readLong(k,!0);case d("WAProtoConst").TYPES.DOUBLE:return c.readFloat64(!0);case d("WAProtoConst").TYPES.STRING:return c.readString(c.readVarInt(d("WABinary").parseUint64OrThrow));case d("WAProtoConst").TYPES.BYTES:return c.readBuffer(c.readVarInt(d("WABinary").parseUint64OrThrow));case d("WAProtoConst").TYPES.FIXED32:return c.readUint32(!0);case d("WAProtoConst").TYPES.SFIXED32:return c.readInt32(!0);case d("WAProtoConst").TYPES.FLOAT:return c.readFloat32(!0)}}function j(a,b,c,d,e){a=a.readVarInt(e);if(a<b||a>=c)throw new Error("FormatError: "+d+" encoded with out-of-range value "+a);return a}function k(a,b){var c=d("WABinary").longFitsInDouble(!0,a,b);if(c){c=o(b);return a*4294967296+c}else{c=a<0;var e;c?e=b===0?-a:~a:e=a;a=c?-b:b;return d("WAHex").createHexLongFrom32Bits(e,a,c)}}function l(a,b){var c=d("WABinary").longFitsInDouble(!1,a,b);if(c){c=o(a);var e=o(b);return c*4294967296+e}else return d("WAHex").createHexLongFrom32Bits(a,b)}function m(a,b){var c=a>>>1;a=a<<31|b>>>1;b&1&&(c=~c,a=~a);return k(c,a)}function n(a,b,c,e,f){var g=d("WAProtoCompile").compileSpec(a),k=g.names,l=g.fields,m=g.types,o=g.meta,p=g.oneofToFields,q=g.fieldToOneof,r=g.reservedTags,s=g.reservedFields;g=a.internalDefaults;var t=c||babelHelpers["extends"]({},g)||{};t.$$unknownFieldCount=(a=c==null?void 0:c.$$unknownFieldCount)!=null?a:0;for(g=0;g<k.length;g++)m[g]&d("WAProtoConst").FLAGS.REPEATED?t[k[g]]=[]:m[g]===(d("WAProtoConst").TYPES.MAP&d("WAProtoConst").TYPE_MASK)&&(t[k[g]]=new Map());var u=0;c=l.length>0;a=l[0];while(b.size()){g=j(b,0,4294967296,"field and enc type",d("WABinary").parseInt64OrThrow);var v=g&7,w=g>>>3;if(c&&w!==a){g=u;do++u===l.length&&(u=0),a=l[u];while(w!==a&&u!==g)}if(c&&w===a)(function(){var a=k[u],c=m[u];h(v,c,a);var g=c&d("WAProtoConst").TYPE_MASK,l=o[u];if(c&d("WAProtoConst").FLAGS.PACKED){var x=b.readVarInt(d("WABinary").parseUint64OrThrow);x=b.readBinary(x);while(x.size()){var y=i(a,g,x);(g!==d("WAProtoConst").TYPES.ENUM||l[y]||(l.cast==null?void 0:l.cast(y))!==void 0)&&t[a].push(y)}}else if(g===d("WAProtoConst").TYPES.MESSAGE){y=b.readVarInt(d("WABinary").parseUint64OrThrow);x=b.readBinary(y);if(c&d("WAProtoConst").FLAGS.REPEATED)t[a].push(n(l,x,void 0,e,f));else{y=t[a];t[a]=n(l,x,y,e,f)}}else if(g===d("WAProtoConst").TYPES.MAP){x=b.readVarInt(d("WABinary").parseUint64OrThrow);y=b.readBinary(x);var z,A;for(x=0;x<o[u].length;x++){var B=j(y,0,4294967296,"map field and enc type",d("WABinary").parseInt64OrThrow),C=B&7;B=B>>>3;var D=void 0;switch(C){case d("WAProtoConst").ENC.VARINT:D=y.readVarInt(d("WABinary").parseInt64OrThrow);break;case d("WAProtoConst").ENC.BIT64:D=y.readBinary(8);break;case d("WAProtoConst").ENC.BINARY:C=l[x];if(C===d("WAProtoConst").TYPES.BYTES||C===d("WAProtoConst").TYPES.STRING)D=i(a,C,y);else{var E=y.readVarInt(d("WABinary").parseUint64OrThrow);E=y.readBinary(E);D=n(C,E,void 0,e,f)}break;case d("WAProtoConst").ENC.BIT32:D=y.readBinary(4);break}B===1?z=D:A=D}t[a].set(z,A)}else{C=i(a,g,b);(g!==d("WAProtoConst").TYPES.ENUM||l[C]||(l.cast==null?void 0:l.cast(C))!==void 0)&&(c&d("WAProtoConst").FLAGS.REPEATED?t[a].push(C):t[a]=C)}E=q[a];E&&typeof t[a]!=="undefined"&&E.forEach(function(b){var c=p[b].filter(function(b){return b!==a});c.forEach(function(a){delete t[a]});if(f){t[b]=(c={type:a,value:t[a]},c[d("WABaseProto").TAGGED_UNION_TAG]=!0,c);delete t[a]}});(r[w]||s[a])&&delete t[a]})();else{t.$$unknownFieldCount++;if(e){t.$$unsafeUnknownFields||(t.$$unsafeUnknownFields={});g=void 0;switch(v){case d("WAProtoConst").ENC.VARINT:g=b.readVarInt(d("WABinary").parseInt64OrThrow);break;case d("WAProtoConst").ENC.BIT64:g=b.readBinary(8);break;case d("WAProtoConst").ENC.BINARY:g=b.readBinary(b.readVarInt(d("WABinary").parseUint64OrThrow));break;case d("WAProtoConst").ENC.BIT32:g=b.readBinary(4);break}t.$$unsafeUnknownFields[w]=g}else v===d("WAProtoConst").ENC.VARINT?b.readVarInt(d("WABinary").parseInt64OrThrow):v===d("WAProtoConst").ENC.BIT64?b.advance(8):v===d("WAProtoConst").ENC.BINARY?b.advance(b.readVarInt(d("WABinary").parseUint64OrThrow)):v===d("WAProtoConst").ENC.BIT32&&b.advance(4)}}return t}function o(a){return a>=0?a:4294967296+a}g.decodeProtobuf=a;g.decodeProtobufWithTaggedUnions=b;g.decodeProtobufWithUnknowns=e;g.getUnknownFields=f}),98);/*FB_PKG_DELIM*/
__d("EBMainThreadListeners",["EBReenrollmentTriggerListener","LSDatabaseSingleton"],(function(a,b,c,d,e,f,g){"use strict";var h;async function a(){var a=await (h||(h=d("LSDatabaseSingleton"))).LSDatabaseSingleton;d("EBReenrollmentTriggerListener").initEBReenrollmentTriggerListener(a)}g.initEBListeners=a}),98);
__d("useFDSProgressRingSvg.react",["FDSProgressRingUtils","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react"));b=h;b.useMemo;var j=b.useRef,k=2;function a(a){var b=d("react-compiler-runtime").c(50),c=a.color,e=a.isHidden;a=a.size;var f=j(null),g=j(null),h=j(null),l;b[0]!==c?(l=d("FDSProgressRingUtils").getRingColor(c),b[0]=c,b[1]=l):l=b[1];c=l;l=c.backgroundColor;c=c.foregroundColor;var m=(a-k)*Math.PI,n;b[2]===Symbol["for"]("react.memo_cache_sentinel")?(n={className:"x1ey2m1c x9f619 xtijo5x x1o0tod x10l6tqk x13vifvy"},b[2]=n):n=b[2];var o="0 0 "+a+" "+a,p=a/2,q=a/2,r=(a-k)/2,s;b[3]!==l||b[4]!==p||b[5]!==q||b[6]!==r?(s=i.jsx("circle",{cx:p,cy:q,fill:"none","non-scaling-stroke":"non-scaling-stroke",r:r,stroke:l,strokeLinecap:"round",strokeWidth:k}),b[3]=l,b[4]=p,b[5]=q,b[6]=r,b[7]=s):s=b[7];b[8]!==a||b[9]!==o||b[10]!==s?(l=i.jsx("svg",babelHelpers["extends"]({},n,{height:a,ref:f,viewBox:o,width:a,children:s})),b[8]=a,b[9]=o,b[10]=s,b[11]=l):l=b[11];b[12]===Symbol["for"]("react.memo_cache_sentinel")?(p={className:"x1ey2m1c xtijo5x xbudbmw x6ikm8r x10wlt62 x10l6tqk x13vifvy"},q={className:"x1ey2m1c x9f619 xtijo5x xyj9dbu x10l6tqk x13vifvy x1jpgh95"},b[12]=p,b[13]=q):(p=b[12],q=b[13]);r="0 0 "+a+" "+a;n=a/2;o=a/2;s=(a-k)/2;var t=m/2,u=3*m/4,v=e?"hidden":void 0,w;b[14]!==v?(w={visibility:v},b[14]=v,b[15]=w):w=b[15];b[16]!==c||b[17]!==n||b[18]!==o||b[19]!==s||b[20]!==t||b[21]!==u||b[22]!==w?(v=i.jsx("circle",{cx:n,cy:o,fill:"none","non-scaling-stroke":"non-scaling-stroke",r:s,stroke:c,strokeDasharray:t,strokeDashoffset:u,strokeWidth:k,style:w}),b[16]=c,b[17]=n,b[18]=o,b[19]=s,b[20]=t,b[21]=u,b[22]=w,b[23]=v):v=b[23];b[24]!==a||b[25]!==r||b[26]!==v?(n=i.jsx("div",babelHelpers["extends"]({},p,{children:i.jsx("svg",babelHelpers["extends"]({},q,{height:a,ref:g,viewBox:r,width:a,children:v}))})),b[24]=a,b[25]=r,b[26]=v,b[27]=n):n=b[27];b[28]===Symbol["for"]("react.memo_cache_sentinel")?(o={className:"x1ey2m1c x1dkd41z x1o0tod x6ikm8r x10wlt62 x10l6tqk x13vifvy"},s={className:"x1ey2m1c x9f619 x1h4o2ik x1o0tod x10l6tqk x13vifvy x1jpgh95"},b[28]=o,b[29]=s):(o=b[28],s=b[29]);t="0 0 "+a+" "+a;u=a/2;w=a/2;p=(a-k)/2;q=m/2;r=m/4;v=e?"hidden":void 0;b[30]!==v?(m={visibility:v},b[30]=v,b[31]=m):m=b[31];b[32]!==c||b[33]!==u||b[34]!==w||b[35]!==p||b[36]!==q||b[37]!==r||b[38]!==m?(e=i.jsx("circle",{cx:u,cy:w,fill:"none","non-scaling-stroke":"non-scaling-stroke",r:p,stroke:c,strokeDasharray:q,strokeDashoffset:r,strokeWidth:k,style:m}),b[32]=c,b[33]=u,b[34]=w,b[35]=p,b[36]=q,b[37]=r,b[38]=m,b[39]=e):e=b[39];b[40]!==a||b[41]!==t||b[42]!==e?(v=i.jsx("div",babelHelpers["extends"]({},o,{children:i.jsx("svg",babelHelpers["extends"]({},s,{height:a,ref:h,viewBox:t,width:a,children:e}))})),b[40]=a,b[41]=t,b[42]=e,b[43]=v):v=b[43];b[44]!==n||b[45]!==v||b[46]!==l?(c=i.jsxs(i.Fragment,{children:[l,n,v]}),b[44]=n,b[45]=v,b[46]=l,b[47]=c):c=b[47];u=c;w=u;b[48]!==w?(p={backgroundRef:f,leftCircleRef:h,progressRing:w,rightCircleRef:g},b[48]=w,b[49]=p):p=b[49];return p}g["default"]=a}),98);
__d("FDSProgressRingDeterminate.react",["BaseLoadingStateElement.react","react","useFDSProgressRingSvg.react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react")),j=h.useEffect,k={rootDiv:{position:"x1n2onr6",$$css:!0},rootSizing:function(a){return[{height:a==null?null:"x1f5funs",width:a==null?null:"x1bl4301",$$css:!0},{"--height":function(a){return typeof a==="number"?a+"px":a!=null?a:void 0}(a),"--width":function(a){return typeof a==="number"?a+"px":a!=null?a:void 0}(a)}]}};function a(a){var b=a.color,d=a.percentage,e=a.size,f=a["aria-label"];a=a["aria-labelledby"];b=c("useFDSProgressRingSvg.react")({color:b,isHidden:!1,size:e});var g=b.leftCircleRef,h=b.progressRing,l=b.rightCircleRef;j(function(){var a=l.current,b=g.current;if(a==null||b==null)return;if(!(a instanceof SVGSVGElement)||!(b instanceof SVGSVGElement))return;var c=Math.max(0,Math.min(100,d))/100*360;a.style.transform="rotate("+Math.min(c,180)+"deg)";b.style.transform="rotate("+Math.max(c-180,0)+"deg)"},[g,d,l]);return i.jsx(c("BaseLoadingStateElement.react"),{"aria-label":f,"aria-labelledby":a,progress:d,xstyle:[k.rootDiv,k.rootSizing(e)],children:h})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("LSGetThreadDataFromTam.nop",["I64","LSMessagingThreadTypeUtil","LSResult","LSShape","LSVec","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h;a=async function(a,b,e){b=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.threads).filter(function(a){a=a.threadType;return d("LSMessagingThreadTypeUtil").isArmadilloSecure(a)}).take((h||(h=d("I64"))).to_int32(e)));a=b.map(function(a,b){var c=a.lastActivityTimestampMs,e=a.lastReadWatermarkTimestampMs,f=a.threadKey;a=a.threadType;return d("LSShape").ofRecord({client_thread_pk:f,display_timestamp_ms:c,is_group_thread:d("LSMessagingThreadTypeUtil").isGroup(a),last_activity_timestamp_ms:c,last_read_watermark_timestamp_ms:e,server_thread_key:f,sort_order:(h||(h=d("I64"))).of_int32(b)})});return c("LSResult")(c("LSVec").ofArray(a))};a.__nop_name__="LSGetThreadDataFromTam";g.default=a}),98);
__d("LSScheduleOccamThreadsIntegrityChecker",["LSGetCursor","LSGetThreadDataFromTam.nop","LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(a){return c.storedProcedure(b("LSGetCursor"),c.i64.cast([0,95])).then(function(a){return a=a,d[0]=a[0],a})},function(b){return d[1]=c.createArray(),d[2]=c.createArray(),c.i64.neq(a[1],void 0)?d[3]=a[1]:d[3]=c.i64.cast([0,20]),c.forEach(c.db.table(220).fetch([[[c.i64.cast([0,95]),c.i64.cast([0,0])]]]),function(a){a=a.item;return d[10]=a.minLastActivityTimestampMs,d[9]=new c.Map(),d[9].set("has_more_before",a.hasMoreBefore),d[9].set("is_loading_before",a.isLoadingBefore),d[9].set("min_last_activity_timestamp_ms",d[10]),d[9].set("min_thread_key",a.minThreadKey),d[9].set("parent_thread_key",c.i64.cast([0,0])),d[11]=(d[2].push(d[9]),d[2]),c.forEach(c.islc(c.filter(c.db.table(9).fetch([[[{gte:d[10]}]],"lastActivityTimestampMs"]),function(a){return c.i64.ge(a.lastActivityTimestampMs,d[10])&&c.i64.eq(a.syncGroup,c.i64.cast([0,95]))&&c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),0,c.i64.to_float(d[3])),function(a){a=a.item;return d[11]=new c.Map(),d[11].set("authority_level",a.authorityLevel),d[11].set("folder_name",a.folderName),d[11].set("last_activity_timestamp_ms",a.lastActivityTimestampMs),d[11].set("last_read_watermark_timestamp_ms",a.lastReadWatermarkTimestampMs),d[11].set("thread_key",a.threadKey),d[12]=(d[1].push(d[11]),d[1])})})},function(a){return d[4]=c.createArray(),c.nativeOperation(b("LSGetThreadDataFromTam.nop"),d[3]).then(function(a){return a=a,d[5]=a[0],a})},function(a){return d[6]=c.createArray(),d[7]=new c.Map(),d[7].set("cursor",d[0]),d[7].set("mi_act_mapping_columns_for_integrity_check",d[6]),d[7].set("occam_threads_columns_for_integrity_check",d[1]),d[7].set("threads_ranges_columns_for_integrity_check",d[2]),d[7].set("tam_threads_columns_for_integrity_check",d[5]),d[8]=c.toJSON(d[7]),c.storedProcedure(b("LSIssueNewTask"),"occam-threads-integrity-check",c.i64.cast([0,701]),d[8],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxScheduleOccamThreadsIntegrityCheckerStoredProcedure";a.__tables__=["sync_group_threads_ranges","threads"];e.exports=a}),null);
__d("LSScheduleOccamThreadsIntegrityCheckerStoredProcedure",["LSScheduleOccamThreadsIntegrityChecker","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){e===void 0&&(e={});a=a.storedProcedure(c("LSScheduleOccamThreadsIntegrityChecker"),e.delayMs,e.maxThreadCount);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("MessengerWaitForEvent",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;function a(a,c,d){var e,f=d;return new(g||(g=b("Promise")))(function(b){f?e=function(){f.apply(this,arguments)&&b.apply(this,arguments)}:e=b,a==null?void 0:a.addEventListener==null?void 0:a.addEventListener(c,e)})["finally"](function(){a==null?void 0:a.removeEventListener==null?void 0:a.removeEventListener(c,e)})}f.waitForEvent=a}),66);
__d("LocalStorageMutex",["FBLogger","MessengerWaitForEvent","Promise","QPLUserFlow","emptyFunction","pageID","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i=null,j=1e3,k=c("qpl")._(1056847375,"584");a=function(){function a(a){var b=this,d=a.mutexKey,e=a.localTakeoverKey,f=a.log,g=a.logError,h=a.getStorage,i=a.setItemGuarded,k=a.mutexTimeoutMs;k=k===void 0?j:k;a=a.mutexTimeoutCallback;this.mutexFilter=function(a){if(a.key!==b.$1)return!1;a=a.newValue||"";return!a.includes(c("pageID"))};this.$1=d;this.$2=e;this.$5=h;this.$6=i;this.$3=f;this.$4=g;this.$7=k;this.$8=a}var e=a.prototype;e.init=function(){c("QPLUserFlow").start(k);this.$3("APPMUTEX - this tab is "+c("pageID"));var a=this.getMutex();if(a===c("pageID")){this.$3("APPMUTEX - WE ALREADY HAVE THE MUTEX LOCK WITHIN INIT");c("QPLUserFlow").endSuccess(k);return(h||(h=b("Promise"))).resolve(!0)}if(a!=null){this.$3("APPMUTEX - initiating localTAKEOVER");return this.localTakeover()}else{this.$3("APPMUTEX - NO1 ELSE IS ALIVE, GET THE MUTEX");a=this.$9(c("pageID"));var d=this.$10(c("pageID"));if(!a.success||!d.success){c("QPLUserFlow").addAnnotations(k,{bool:{setMutexResult:d.success,setTakeoverResult:a.success},string:{setMutexError:d.error,setTakeoverError:a.error}});c("QPLUserFlow").endFailure(k,"fail_to_set_takeover_or_mutex");return(h||(h=b("Promise"))).resolve(!1)}c("QPLUserFlow").endSuccess(k);return(h||(h=b("Promise"))).resolve(!0)}};e.localTakeover=function(){var a,e=this,f=this.$9(c("pageID"));if(!f.success){c("QPLUserFlow").addAnnotations(k,{string:{initTakeoverError:f.error}});c("QPLUserFlow").endFailure(k,"local_takeover_init_takeover_failure");return(h||(h=b("Promise"))).resolve(!1)}var g,i=function(){g!=null&&clearTimeout(g)};f=d("MessengerWaitForEvent").waitForEvent(window,"storage",this.mutexFilter);var l=(a=this.$7)!=null?a:j;return(h||(h=b("Promise"))).race([f,new h(function(a){g=setTimeout(function(){a()},l)}),this.$8?this.$8():new(h||(h=b("Promise")))(c("emptyFunction"))]).then(function(a){if(a==null){e.$3("AppMutex - Forcefully took the mutex and takeover lock");var b=e.$9(c("pageID")),d=e.$10(c("pageID"));if(!b.success||!d.success){c("QPLUserFlow").addAnnotations(k,{string:{setMutexError:d.error,setTakeoverError:b.error}});c("QPLUserFlow").endFailure(k,"local_takeover_forcefully_takeover_failure");return!1}c("QPLUserFlow").endSuccess(k);return!0}e.$3("APPMUTEX - GOT MUTEX STORAGE EVENT CHANGE FROM ANOTHER TAB");d=e.$11(a.newValue);if(!d&&e.hasTakeoverPermission()){e.$3("APPMUTEX - setting mutex on localtakeover");b=e.$10(c("pageID"));if(!b.success){c("QPLUserFlow").addAnnotations(k,{string:{setMutexError:b.error}});c("QPLUserFlow").endFailure(k,"local_takeover_set_mutex_failure");return!1}c("QPLUserFlow").endSuccess(k);return!0}else{e.hasTakeoverPermission()&&e.$12();c("QPLUserFlow").endFailure(k,"local_takeover_no_takeover_permission");return!1}}).then(function(a){i();return a})["catch"](function(a){i();e.$4("AppMutex - localTakeover error no permission - "+a);c("QPLUserFlow").endFailure(k,"local_takeover_general_failure");return!1})};e.onMutexDeath=function(){var a=this.getMutex();a!=null&&a===c("pageID")&&(this.$3("APPMUTEX - removing mutex on death"),this.$13(),this.hasTakeoverPermission()&&this.$12())};e.takeoverFilter=function(a){if(a.key!==this.$2)return!1;a=a.newValue||"";return!a.includes(c("pageID"))};e.$14=function(){if(!i){var a=this.$5();if(!a)throw c("FBLogger")("messenger_web").mustfixThrow("Could not get localStorage");i=a}return i};e.getMutex=function(){i=this.$14();return i.getItem(this.$1)};e.$10=function(a){i=this.$14();return this.$6(i,this.$1,a)};e.$13=function(){i=this.$14(),i.removeItem(this.$1)};e.getTakeover=function(){i=this.$14();return i.getItem(this.$2)};e.$9=function(a){i=this.$14();return this.$6(i,this.$2,a)};e.$12=function(){i=this.$14(),i.removeItem(this.$2)};e.$11=function(a){return a!=null?a:""};e.hasTakeoverPermission=function(){var a=this.getTakeover();return a!=null&&a===c("pageID")};return a}();g.THIS_TAB=c("pageID");g.LocalStorageMutex=a}),98);
__d("MAWAppMutex",["LocalStorageMutex","MAWLocalStorage","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h="armadillo_msgr_mutex",i="armadillo_msgr_local_takeover",j=null;function a(){j==null&&(j=new(d("LocalStorageMutex").LocalStorageMutex)({getStorage:d("MAWLocalStorage").getStorage,localTakeoverKey:i,log:function(a){d("WALogger").LOG([a])},logError:function(a){d("WALogger").ERROR([a])},mutexKey:h,setItemGuarded:d("MAWLocalStorage").setItemGuarded}));return j}g.MAW_MUTEX_KEY=h;g.MAW_LOCALTAKEOVER_KEY=i;g.use=a}),98);
__d("MAWBridgeGetMinosEpochDataForUser",["LSDatabaseSingleton","ReQL","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;async function a(){if(!c("gkx")("14827"))return Promise.resolve();var a=await (h||(h=d("LSDatabaseSingleton"))).getLSDatabaseSingletonPromiseOrValue();a=await a.runInTransaction(function(a){return d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.secure_encrypted_backups_epochs))},"readonly",void 0,void 0,f.id+":24");return a}g.getMinosEpochDataForUser=a}),98);
__d("MAWBridgeRunMediaStorageShadowTestHandler",["Promise","WAErrorMessage","WAMediaWasmWorkerClient","WAResultOrError","cr:17340"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return b("cr:17340")!=null?d("WAMediaWasmWorkerClient").runMediaStorageShadowTestWasmWorker(a.file_bytes,a.storage_type).then(function(a){if(a.success)return a;else return d("WAResultOrError").makeError({errorMessage:a.error.errorMessage,errorName:a.error.errorName})})["catch"](function(a){return d("WAResultOrError").makeError({errorMessage:d("WAErrorMessage").maybeGetMessageFromError(a),errorName:"runtime-error"})}):(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeError({errorName:"gk-inconsistency"}))}g.fetchMediaStorageResults=a}),98);
__d("MAWBridgeUIEventHandlerDeferred",["requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("MAWBridgeUIEventHandler").__setRef("MAWBridgeUIEventHandlerDeferred");a=function(a,b){void h.load().then(function(c){c.handleEvents(a,b)})};b=function(a,b,c){return h.load().then(function(d){return d.handleShimEvent(a,b,c)})};g.handleEvents=a;g.handleShimEvent=b}),98);
__d("MAWCommonBackendSetup",["EARInitType","MAWAppMutex","MAWEncryptionIndexedDbV2","MAWInit","MAWInitError","MAWIssueNewUserVisibleErrors","MAWLocalStorage","MAWLoggerUtils","MAWSetupWorker","MAWVaultMaterialsStorage","MAWWorkerReboot","MWSetupDBEncryption","gkx","requireDeferredForDisplay","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferredForDisplay")("MAWMainThreadLogger").__setRef("MAWCommonBackendSetup"),i=function(a,b){if(b)return Promise.resolve(!0);else return a.measurePerformance("acquire_mutex",function(){return d("MAWAppMutex").use().init()})};async function a(a,b,e,f,g,j){await a.measurePerformance("prepare_logger",async function(){var a=h.load();(await a).setupMainWaLogger()});d("MAWLoggerUtils").initMessengerWebLogging();var k=d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker();k||await a.measurePerformance("detection_support",function(){if(!d("MAWLocalStorage").isLocalStorageAvailable())throw new(d("MAWInitError").MAWInitError)("localstorage_not_supported");return Promise.resolve()});var l=a.measurePerformance("setup_vault_materials",function(){return d("MAWVaultMaterialsStorage").setupVaultMaterials()});k=await i(a,k);var m=await a.measurePerformance("main_ear_setup",async function(){if(c("gkx")("12397"))return Promise.resolve({success:!0});d("MWSetupDBEncryption").setPerformanceMeasurementTool(d("MAWInit").MAWInit.measurePerformance);var a=await d("MWSetupDBEncryption").init(c("EARInitType").MAW_INIT);d("MAWEncryptionIndexedDbV2").maybeSetEncryptionDbOnVersionChange(function(){var a;(a=d("MAWIssueNewUserVisibleErrors")).issueError(a.MAWLegacyUserErrorMsgBody,a.MAWLegacyUserErrorMsgTitle,a.MAWUserVisibleErrorPresentationType.BANNER)});return a});if(!m.success){a.logPoint("keychain_setup_failure");throw new(d("MAWInitError").MAWInitError)("keychain_setup_failure",m.payload)}if(!k){a.logPoint("maw_appmutex_no_permission");throw new(d("MAWInitError").MAWInitError)("maw_appmutex_no_permission")}var n=await l;await a.measurePerformance("setup_worker",function(){return d("MAWSetupWorker").getOrSetupWorker(n,b,e,f,g,j).catch(function(c){a.logPoint("reboot_worker_on_backend_setup_failure");a.addStringAnnotation("backend_setup_failure_reason",c.message);return d("MAWWorkerReboot").rebootWorker(n,b,e,f,"backend_setup_failure",j).catch(function(a){throw new(d("MAWInitError").MAWInitError)("worker_setup_error",a)})})})}g.getMutexPermission=i;g.setupArmadilloBackend=a}),98);
__d("useMWEncryptedBackupsProcessBackupIdsDeferred",["promiseDone","react","react-compiler-runtime","requireDeferred","useAsyncReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(h||d("react")).useEffect,j=c("requireDeferred")("MWEncryptedBackupsProcessBackupIdsDEPRECATED").__setRef("useMWEncryptedBackupsProcessBackupIdsDeferred");function a(a){var b=d("react-compiler-runtime").c(4),e=c("useAsyncReStore")(),f,g;b[0]!==e||b[1]!==a?(f=function(){var b,d=!1;j.onReadyImmediately(function(f){c("promiseDone")(e,function(c){d||(b=f.subscribeToEncryptedBackupsRow(c,a))})});return function(){d=!0,b==null?void 0:b()}},g=[e,a],b[0]=e,b[1]=a,b[2]=f,b[3]=g):(f=b[2],g=b[3]);i(f,g)}g["default"]=a}),98);
__d("MAWCommonSetup",["EBMainThreadEBDBApiDeferred","EBMainThreadListeners","ExecutionEnvironment","MAWBridgeFireAndForget","MAWCommonBackendSetup","MAWEncryptedBackupsStateManager","MAWInit","MAWInitError","MAWIsIDBOperational","MAWIssueNewUserVisibleErrors","MAWJobDefinitions","MAWLoggerUtils","MAWMIC","MAWStateContext.react","MAWUIJob","MAWWaitForBackendSetup","WABridge","WADynamicRouterSync","WAJobOrchestratorTypes","WALogger","cr:10250","cr:10458","cr:13007","cr:17068","cr:19609","cr:9939","getErrorSafe","gkx","performance","promiseDone","react","react-compiler-runtime","requireDeferred","shouldDisableWorkerOnAppsSubdomain","useMWEncryptedBackupsProcessBackupIdsDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Armadillo is disabled on apps subdomain"]);k=function(){return a};return a}e=j||d("react");var l=e.useContext,m=e.useEffect,n=c("requireDeferred")("FBLogger").__setRef("MAWCommonSetup"),o=b("cr:10250")||b("cr:10458"),p=b("cr:19609")!=null?b("cr:19609")==null?void 0:b("cr:19609").MAWInitialiseMAWDbInUI:b("cr:13007")==null?void 0:b("cr:13007").MAWInitialiseMAWDbInUI;c("requireDeferred")("MAWTimedJob").__setRef("MAWCommonSetup");var q=!1,r=function(){return(h||(h=c("performance"))).now()},s=function(a){c("gkx")("12414")||(d("MAWEncryptedBackupsStateManager").setEncryptedBackupsState(a),d("MAWBridgeFireAndForget").fireAndForget("backend","setEncryptedBackupsState",{newState:a}))};function t(){d("MAWBridgeFireAndForget").fireAndForget("backend","resendEBLSInWorkerEbEnabledState")}function u(){d("MAWBridgeFireAndForget").fireAndForget("backend","resendWorkerStateManagerValuesToMainThread")}function a(a){var b=d("react-compiler-runtime").c(8);d("MAWLoggerUtils").initMessengerWebLogging();var e=l(d("MAWStateContext.react").MAWDispatchContext),f=d("MAWIsIDBOperational").useIsIDBOperational(),g,h;b[0]!==e||b[1]!==f||b[2]!==a?(g=function(){f&&(i||(i=c("ExecutionEnvironment"))).isInBrowser&&c("promiseDone")(v(e,a))},h=[a,e,f],b[0]=e,b[1]=f,b[2]=a,b[3]=g,b[4]=h):(g=b[3],h=b[4]);m(g,h);b[5]!==f?(g=function(){f&&c("promiseDone")(d("EBMainThreadListeners").initEBListeners())},h=[f],b[5]=f,b[6]=g,b[7]=h):(g=b[6],h=b[7]);m(g,h);c("useMWEncryptedBackupsProcessBackupIdsDeferred")(s);t();u()}async function v(a,e){var f=e.logout,g=e.reregisterDevice,h=e.rotateCryptoAuthToken,j=e.setupBridge;if(q){void n.load().then(function(a){a("messenger_web").warn("Armadillo already setup - return")});return}if(c("shouldDisableWorkerOnAppsSubdomain")()){d("WALogger").LOG(k());return}q=!0;d("MAWMIC").startMAWMICFlow();d("MAWInit").MAWInit.start();b("cr:9939")!=null&&(i||(i=c("ExecutionEnvironment"))).isInBrowser&&await b("cr:9939").getOrSetupMAWCacheDB();p!=null&&(i||(i=c("ExecutionEnvironment"))).isInBrowser&&c("promiseDone")(p(a),function(){},function(a){return n.load().then(function(b){return b("messenger_web").catching(a).mustfix("UI Dexie initialisation failed: %s",a.message)})});b("cr:17068")!=null&&c("promiseDone")(b("cr:17068").getDeviceAge());d("WABridge").makeWABridge(new(d("WADynamicRouterSync").DynamicRouterSync)());try{d("MAWIssueNewUserVisibleErrors").deleteAllErrors(),await d("MAWCommonBackendSetup").setupArmadilloBackend(d("MAWInit").MAWInit,function(b){return j({dispatch:a,logout:f,reregisterDevice:g,rotateCryptoAuthToken:h,worker:b})},function(){a({tag:"InitOfflineQueueSyncComplete",value:void 0}),a({tag:"IsDbMigrating",value:!1}),d("MAWMIC").onConnectToExistingWorker()},function(){a({tag:"InitOfflineQueueSyncComplete",value:void 0}),a({tag:"IsDbMigrating",value:!1})},"mawInit",function(a){}),d("MAWUIJob").UIJobStarters.fireAndForget(d("MAWJobDefinitions").jobSerializers.handleFutureproofMsg({priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW})),d("MAWInit").MAWInit.addIntAnnotation("endTimePageRelative",r()),d("MAWInit").MAWInit.endSuccess()}catch(a){var l,m=c("getErrorSafe")(a);e=m instanceof d("MAWInitError").MAWInitError?m.message:"maw_init_failure";m.message=(l=m.message)!=null?l:"Unknown";l=m.message==="maw_appmutex_no_permission"&&document.visibilityState!=="visible";l?d("MAWInit").MAWInit.cancel(e,m):(d("MAWWaitForBackendSetup").rejectBackendSetup(m),d("MAWInit").MAWInit.fail(e,m));d("MAWIssueNewUserVisibleErrors").issueError(d("MAWIssueNewUserVisibleErrors").MAWGeneralErrorMsgBody,d("MAWIssueNewUserVisibleErrors").MAWGeneralErrorMsgTitle,d("MAWIssueNewUserVisibleErrors").MAWUserVisibleErrorPresentationType.BANNER,m.message);m&&void n.load().then(function(a){a("messenger_web").catching(m).mustfix("MAW backend setup failed -- %s",m.message)});throw m}void d("EBMainThreadEBDBApiDeferred").startListeningDeviceRegistrations();o!=null&&void o.initializeMinosDb()}g.useArmadillo=a}),98);
__d("MAWDBUsageMetrics",["FBLogger","WebStorageEstimator","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("WebStorageManagerEstimatesFalcoEvent").__setRef("MAWDBUsageMetrics");async function a(){try{var a=await d("WebStorageEstimator").estimateStorage();h.onReady(function(b){c("FBLogger")("messenger_web").debug("Sending storage manager estimates falco event, quota: %s, usage: %s, usage_details: %s",a==null?void 0:a.quota,a==null?void 0:a.usage,JSON.stringify(a==null?void 0:a.usageDetails)),b.log(function(){var b;return{quota:String((b=a==null?void 0:a.quota)!=null?b:0),usage:String((b=a==null?void 0:a.usage)!=null?b:0),usage_details:{caches:String((b=a==null?void 0:(b=a.usageDetails)==null?void 0:b.caches)!=null?b:0),indexedDB:String((b=a==null?void 0:(b=a.usageDetails)==null?void 0:b.indexedDB)!=null?b:0),serviceWorkerRegistrations:String((b=a==null?void 0:(b=a.usageDetails)==null?void 0:b.serviceWorkerRegistrations)!=null?b:0)}}})})}catch(a){c("FBLogger")("messenger_web").warn("Error while getting the storage manager estimate: %s",a);return}}g.logMAWDBUsageMetrics=a}),98);
__d("toMsgrUserJid",["MAWJids"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=d("MAWJids").toUserJid}),98);
__d("MAWFetchContacts",["I64","LSContactTypeExact","LSIntEnum","MAWContactRelationshipType","ReQL","WAJids","requireDeferred","toMsgrUserJid"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=c("requireDeferred")("LSDatabaseSingletonLazyWrapper").__setRef("MAWFetchContacts");async function k(a){var b=await j.load();b=await b();var e=new Set(a.map(function(a){return d("WAJids").extractUserId(a)}));return d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(b.tables.contacts).filter(function(a){return e.has((h||(h=d("I64"))).to_string(a.id))})).then(function(a){return new Map(a.map(function(a){return[c("toMsgrUserJid")((h||(h=d("I64"))).to_string(a.id)),a]}))})}function a(a){return k(a).then(function(a){var b=new Map();a.forEach(function(a,c){b.set(c,d("MAWContactRelationshipType").getContactRelationshipType(a))});return b})}function b(a){return k(a).then(function(a){var b=new Map();a.forEach(function(a,e){a=a.contactTypeExact!=null&&(h||(h=d("I64"))).equal(a.contactTypeExact,(i||(i=d("LSIntEnum"))).ofNumber(c("LSContactTypeExact").MESSENGER_ONLY_NOT_ALLOWED_ON_FB));b.set(e,a)});return b})}g.fetchContacts=k;g.fetchContactsRelationships=a;g.fetchContactsIsMsplit=b}),98);
__d("MWXProgressRing.react",["cr:4145","cr:6783","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){var c=d("react-compiler-runtime").c(8),e=a.color,f=a.percentage;a=a.size;if(b("cr:4145")!=null){var g=e!=null?e:"light",h=f!=null?f:0,j=a!=null?a:16,k;c[0]!==g||c[1]!==h||c[2]!==j?(k=i.jsx(b("cr:4145"),{color:g,percentage:h,size:j}),c[0]=g,c[1]=h,c[2]=j,c[3]=k):k=c[3];return k}if(b("cr:6783")!=null){c[4]!==e||c[5]!==f||c[6]!==a?(g=i.jsx(b("cr:6783"),{color:e,percentage:f,size:a}),c[4]=e,c[5]=f,c[6]=a,c[7]=g):g=c[7];return g}return null}g["default"]=a}),98);
__d("mwReplaceToast",["BaseToasterStateManager","MWXToast.react","err","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react"),j=c("BaseToasterStateManager").getInstance();function a(a){var b=a.body,d=a.icon,e=a.startAddOn;e=e===void 0?null:e;var f=a.supressCloseButton;f=f===void 0?!1:f;var g=a.title,h=a.toastId;if(h==null){c("err")("toastId or toasterStateManager is not provided");return}j.replace(h,i.jsx(c("MWXToast.react"),{body:b,icon:d,onDismiss:function(){return j.expire(h)},startAddOn:e,supressCloseButton:f,title:g}))}g.mwReplaceToast=a}),98);
__d("MAWLoadingSpinner.react",["BaseToasterStateManager","MWXIconCheckmarkCircle","MWXIconStrict.react","MWXProgressRing.react","MWXSpinner.react","mwPushToast","mwReplaceToast","react","react-compiler-runtime","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react"));b=h;var j=b.useEffect,k=b.useLayoutEffect,l=b.useRef,m=c("BaseToasterStateManager").getInstance();function n(a,b,d,e){e===void 0&&(e=0);if(a==="spinner")return{icon:{comet:i.jsx(c("MWXSpinner.react"),{color:b?"light":"dark",size:24})},startAddOn:{type:"spinner"},title:d};else if(a==="progressRing")return{icon:{comet:i.jsx(c("MWXProgressRing.react"),{color:b?"light":"dark",size:24})},startAddOn:{source:e,type:"progressRing"},title:d};else return{icon:{comet:i.jsx(c("MWXSpinner.react"),{color:b?"light":"dark",size:24})},startAddOn:{type:"spinner"},title:d}}function o(a,b){d("mwReplaceToast").mwReplaceToast({icon:{comet:i.jsx(c("MWXIconStrict.react"),{icon:c("MWXIconCheckmarkCircle"),size:24}),mds:c("MWXIconCheckmarkCircle").component},title:b,toastId:a})}function a(a,b,e,f,g,h){var i=d("react-compiler-runtime").c(10),p=l(),q,r;i[0]!==f||i[1]!==b||i[2]!==h||i[3]!==e||i[4]!==g||i[5]!==a?(q=function(){if(g)p.current==null?p.current=d("mwPushToast").mwPushToast(n(a,b,e,h),Number.MAX_SAFE_INTEGER):d("mwReplaceToast").mwReplaceToast(babelHelpers["extends"]({},n(a,b,e,h),{toastId:p.current}));else if(p.current!=null){var i=p.current;o(i,f);c("setTimeout")(function(){m.expire(i),p.current=void 0},2750)}},r=[g,b,a,e,h,f],i[0]=f,i[1]=b,i[2]=h,i[3]=e,i[4]=g,i[5]=a,i[6]=q,i[7]=r):(q=i[6],r=i[7]);k(q,r);i[8]===Symbol["for"]("react.memo_cache_sentinel")?(q=function(){return function(){p.current!=null&&m.expire(p.current)}},r=[],i[8]=q,i[9]=r):(q=i[8],r=i[9]);j(q,r)}g.useMAWLoadingSpinner=a}),98);
__d("MAWLoadingStateSpinnerUtils",["fbt"],(function(a,b,c,d,e,f,g,h){"use strict";b=function(a){return h._(/*BTDS*/"{restoredPercentage}\u0025 of chats loaded...",[h._param("restoredPercentage",a.toFixed(0).toString())])};c=h._(/*BTDS*/"All chats loaded.");function a(a,b,c){if(c===0)return 100;a=50*(a/c);b=50*(b/c);return Math.min(100,b+a)}g.getProgressMessage=b;g.completedMessage=c;g.getPercentage=a}),226);
__d("MAWLoadingStateToastSelectors",[],(function(a,b,c,d,e,f){"use strict";a=function(a){return a.offlineQueueCount};b=function(a){return a.offlineQueueProgressDownloaded};c=function(a){return a.offlineQueueProgressProcessed};f.offlineQueueCountSelector=a;f.offlineQueueProgressCountSelector=b;f.offlineQueueConsumerProgressCountSelector=c}),66);
__d("useMAWOfflineQueueLoadingIndicator",["Int64Hooks","MAWLoadingStateOutstandingOfflineQueueSelector","MAWStateContext.react","react-compiler-runtime","useCometRouterState","useMAWOfflineQueueLoadingIndicatorThreadJid"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e){var f=d("react-compiler-runtime").c(4);a=a===void 0?!1:a;var g=e===void 0?d("MAWLoadingStateOutstandingOfflineQueueSelector").outstandingOfflineQueueSelector:e,h=c("useMAWOfflineQueueLoadingIndicatorThreadJid")(b==null?void 0:b.threadKey,b==null?void 0:b.threadType);e=c("useCometRouterState")();var i;f[0]!==g||f[1]!==h?(b=function(){return g(h)},i=[g,h],f[0]=g,f[1]=h,f[2]=b,f[3]=i):(b=f[2],i=f[3]);f=d("Int64Hooks").useMemoInt64(b,i);b=d("MAWStateContext.react").useMAWSelector(f);i=e==null?void 0:e.main.route.tabKey;return b&&(i==="messenger"||!a)}g["default"]=a}),98);
__d("MAWLoadingStateSpinner.react",["CometDarkModeContext","MAWLoadingSpinner.react","MAWLoadingStateSpinnerUtils","MAWLoadingStateToastSelectors","MAWStateContext.react","cr:19625","react","react-compiler-runtime","useMAWOfflineQueueLoadingIndicator"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react"));e=h;f=e.memo;var j=e.useContext;function k(){var a=d("react-compiler-runtime").c(5),b=j(c("CometDarkModeContext")).currentSetting==="ENABLED",e=c("useMAWOfflineQueueLoadingIndicator")(!0),f=d("MAWStateContext.react").useMAWSelector(d("MAWLoadingStateToastSelectors").offlineQueueCountSelector),g=d("MAWStateContext.react").useMAWSelector(d("MAWLoadingStateToastSelectors").offlineQueueProgressCountSelector),h=d("MAWStateContext.react").useMAWSelector(d("MAWLoadingStateToastSelectors").offlineQueueConsumerProgressCountSelector),i,k;a[0]!==g||a[1]!==f||a[2]!==h?(i=d("MAWLoadingStateSpinnerUtils").getPercentage(g,h,f),k=d("MAWLoadingStateSpinnerUtils").getProgressMessage(i),a[0]=g,a[1]=f,a[2]=h,a[3]=i,a[4]=k):(i=a[3],k=a[4]);g=k;d("MAWLoadingSpinner.react").useMAWLoadingSpinner("progressRing",b,g,d("MAWLoadingStateSpinnerUtils").completedMessage,e,i);return null}function a(){var a=d("react-compiler-runtime").c(1),c;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(c=b("cr:19625")!=null?i.jsx(b("cr:19625"),{}):i.jsx(k,{}),a[0]=c):c=a[0];return c}e=f(a);g["default"]=e}),98);
__d("MAWLoadingStateSpinnerWithQueueState",["CometDarkModeContext","MAWLoadingSpinner.react","MAWLoadingStateSpinnerUtils","MAWSharedProtocolQueueConst","react","react-compiler-runtime","useMAWOfflineQueueLoadingIndicatorShown","useMAWOfflineQueueState"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react")),j=h.useContext;function k(a){var b=d("react-compiler-runtime").c(5);a=a.shouldDisplayLoadingIndicatorOnMessengerRoute;var e=j(c("CometDarkModeContext")).currentSetting==="ENABLED",f=d("useMAWOfflineQueueState").useMAWOfflineQueueState(),g=f.offlineQueueCount,h=f.offlineQueueProgressDownloaded,i=f.offlineQueueProgressProcessed;f=g>0&&f.offlineQueueSyncState!==d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete;f=f&&a;var k;b[0]!==h||b[1]!==g||b[2]!==i?(a=d("MAWLoadingStateSpinnerUtils").getPercentage(h,i,g),k=d("MAWLoadingStateSpinnerUtils").getProgressMessage(a),b[0]=h,b[1]=g,b[2]=i,b[3]=a,b[4]=k):(a=b[3],k=b[4]);h=k;d("MAWLoadingSpinner.react").useMAWLoadingSpinner("progressRing",e,h,d("MAWLoadingStateSpinnerUtils").completedMessage,f,a);return null}function a(){var a=d("react-compiler-runtime").c(2),b=c("useMAWOfflineQueueLoadingIndicatorShown")(!0),e;a[0]!==b?(e=b?i.jsx(k,{shouldDisplayLoadingIndicatorOnMessengerRoute:b}):null,a[0]=b,a[1]=e):e=a[1];return e}g["default"]=a}),98);
__d("MAWMainThreadEBDeps",["EBDeps","LSDatabaseSingleton"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){d("EBDeps").setDeps({getLSDB:function(){return(h||(h=d("LSDatabaseSingleton"))).LSDatabaseSingleton}},"MAW MainThread")}g.initEBDeps=a}),98);
__d("MAWOccamadilloOnMutexChange",["I64","LSDefaultSyncGroups","LSIntEnum","LSSyncGroupsUtils","Promise","WALogger","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] Resetting sync cursor and network request"]);k=function(){return a};return a}function l(a){var c=d("LSDefaultSyncGroups").e2eeMetadataSyncGroup;if(c!=null)return a.sync_groups.put(babelHelpers["extends"]({},d("LSSyncGroupsUtils").defaultSyncGroup,{groupId:(j||(j=d("LSIntEnum"))).ofNumber(c.groupId)}));else return(h||(h=b("Promise"))).resolve()}function m(a){return a.network_requests.put({epochId:void 0,failureCount:(i||(i=d("I64"))).zero,lastDelayedRequestTimestampMs:void 0,lastSentTimestampMs:i.zero,lastSyncRequestTimestampMs:i.zero,networkTaskIdentifier:void 0,syncDatabaseId:(j||(j=d("LSIntEnum"))).ofNumber(95),taskQueueName:""})}function a(a){d("WALogger").LOG(k()),c("promiseDone")(a.runInTransaction(function(a){return(h||(h=b("Promise"))).all([l(a),m(a)])},"readwrite",void 0,void 0,f.id+":53"))}g.onOccamadilloMutexChange=a}),98);
__d("MAWPreloadSecureMessagesDeferred",["requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("MAWPreloadSecureMessages").__setRef("MAWPreloadSecureMessagesDeferred");a=function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return h.load().then(function(a){return a.preloadSecureMessagesByThreadKey.apply(a,b)})};g.preloadSecureMessagesByThreadKey=a}),98);
__d("MAWReinit",["ExecutionEnvironment","MAWCurrentUser","QPLUserFlow","QuickPerformanceLogger","WAGetStorageQplAnnotations","gkx","qpl","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=c("qpl")._(25310984,"169");function a(a){var b=a!=null?{instanceKey:a}:void 0,e=!1,f=!1;function g(){if(f)return;f=!0;c("QPLUserFlow").start(j,babelHelpers.extends({cancelOnUnload:!0,onFlowTimeout:function(){e=!0},timeoutInMs:(h||(h=c("ExecutionEnvironment"))).canUseDOM?6e4:0},b));void d("WAGetStorageQplAnnotations").getStorageQplAnnotations().then(function(a){c("QPLUserFlow").addAnnotations(j,a)});s()}function k(a){if(!f||e)return;s();c("QPLUserFlow").addPoint(j,a,b)}function l(a,b){var d;if(!f||e)return;c("QPLUserFlow").addAnnotations(j,{bool:(d={},d[a]=b,d)})}function m(a,b){var d;if(!f||e)return;c("QPLUserFlow").addAnnotations(j,{string:(d={},d[a]=b,d)})}function n(a,b){var d;if(!f||e)return;c("QPLUserFlow").addAnnotations(j,{string_array:(d={},d[a]=b,d)})}function o(a,b){var d;if(!f||e)return;c("QPLUserFlow").addAnnotations(j,{int:(d={},d[a]=b,d)})}function p(a){s(),e=!0,c("QPLUserFlow").addAnnotations(j,{string:{failReason:a}},b),c("QPLUserFlow").endFailure(j,"maw_init_fail",b),r=!1}function q(a){s(),e=!0,r=!1,c("QPLUserFlow").addAnnotations(j,{string:{dropReason:a}},b),(i||(i=c("QuickPerformanceLogger"))).markerDrop(j)}var r=!1;function s(){if(r)return;r=!0;c("QPLUserFlow").addAnnotations(j,{bool:{armadillo_init_sync_api_improvements:c("gkx")("24025"),isArmadilloPublicLaunchUser:c("gkx")("23405"),isTlcPublicUser:d("MAWCurrentUser").isTlcPublicUser(),useSharedWorker:d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()}})}function t(a){s(),e=!0,c("QPLUserFlow").addAnnotations(j,{string:{cancelReason:a}},b),c("QPLUserFlow").endCancel(j,b),r=!1}function u(){s(),e=!0,c("QPLUserFlow").endSuccess(j,b),r=!1}async function v(a,b){var c=a+"_start";a=a+"_end";k(c);c=await b();k(a);return c}return{addBoolAnnotation:l,addIntAnnotation:o,addStringAnnotation:m,addStringArrayAnnotation:n,cancel:t,drop:q,endSuccess:u,fail:p,logPoint:k,measurePerformance:v,start:g}}g.getMAWReinit=a}),98);
__d("MAWReinitWorker",["MAWCommonBackendSetup","MAWOccamadilloOnMutexChange","MAWReinit"],(function(a,b,c,d,e,f,g){"use strict";async function a(a){var b=a.allTablesPersisted,c=a.db,e=a.dispatch,f=a.dispatchClearEphemeralSettings,g=a.instanceKey,h=a.logout,i=a.reregisterDevice,j=a.rotateCryptoAuthToken,k=a.setupBridge;a=a.workerCreateReason;g=d("MAWReinit").getMAWReinit(g);g.start();var l=function(){e({tag:"InitOfflineQueueSyncComplete",value:void 0})};await d("MAWCommonBackendSetup").setupArmadilloBackend(g,function(a){a=k({dispatch:e,logout:h,reregisterDevice:i,rotateCryptoAuthToken:j,worker:a});b||d("MAWOccamadilloOnMutexChange").onOccamadilloMutexChange(c);return a},l,l,a,function(a){});g.endSuccess();f()}g.default=a}),98);
__d("MAWSetupBridgeOfflineConsumer",["InteractionTracingMetrics","MAWBridgeInitOfflineQueueSyncCompleteHandler","MAWMIC","MAWOfflineQueueStatus","MAWSharedProtocolQueueConst","MWChatInteraction","MWFBLogger","WAMediaWasmWorkerClient","cr:17068","interaction-tracing","justknobx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Stats failed: expected: ",", processed: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Stats end: expected: ",", processed: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Stats: expected: ",", processed: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Stats start: ",""]);k=function(){return a};return a}var l=d("MWFBLogger").MWLogger.tags(["ServerRPC","OfflineConsumer"]),m="has_pending_or_inprogress_oq_threads";async function n(a){await a;d("WAMediaWasmWorkerClient").prewarmMediaWasmWorker("mp4RepairMux");d("WAMediaWasmWorkerClient").prewarmMediaWasmWorker("progressiveJpegEncode");return d("MAWBridgeInitOfflineQueueSyncCompleteHandler").call()}function o(a){d("MAWMIC").addIntAnnotation("offlineQueueSize",a);var b=d("MWChatInteraction").get(d("MWChatInteraction").MW_AUTO_CHAT_TAB_OPEN);b!=null&&c("InteractionTracingMetrics").addAnnotationInt(b,"offlineQueueSize",a)}function p(a,b){var e=d("MWChatInteraction").get(d("MWChatInteraction").MW_AUTO_CHAT_TAB_OPEN);e!=null&&c("InteractionTracingMetrics").addSubspan(e,"offline_queue","LONGTASK",a,b,{})}function q(){c("justknobx")._("3496")&&c("interaction-tracing").InteractionTracingCore.getPendingInteractions().forEach(function(a){a.addMarkerPoint("offline_queue_start","AppTiming"),a.addAnnotationBoolean(m,!0)})}function r(){c("justknobx")._("3496")&&c("interaction-tracing").InteractionTracingCore.getPendingInteractions().forEach(function(a){a.addMarkerPoint("offline_queue_end","AppTiming"),a.addAnnotationBoolean(m,!1)})}function a(a,e){return function(f){var g=f.chatJidStatus,m=f.status,s=f.timestamp,t=f.totalExpectedCount,u=f.totalProcessedCount;switch(m){case d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Initializing:q();l.DEBUG(k(),t);o(t);b("cr:17068")&&b("cr:17068").setEstimatedOQSize(t);e({tag:"InitOfflineQueueSyncStart",value:t});d("MAWOfflineQueueStatus").markThreadWithOfflineQueueStatus(g,d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Initializing);d("MAWMIC").addPoint("process_offline_queue_start",s);d("MAWOfflineQueueStatus").resetOfflineQueueState();return;case d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Processing:l.DEBUG(j(),t,u);e({tag:"InitOfflineQueueConsumerSyncProgress",value:{chatJidStatus:g,processed:u}});d("MAWOfflineQueueStatus").markThreadWithOfflineQueueStatus(g,d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Processing);return;case d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete:l.DEBUG(i(),t,u);f.startTime!=null&&p(f.startTime,s);r();e({tag:"InitOfflineQueueSyncComplete",value:g});c("promiseDone")(n(a));d("MAWOfflineQueueStatus").markThreadWithOfflineQueueStatus(g,d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete);d("MAWMIC").addPoint("process_offline_queue_end",s);d("MAWOfflineQueueStatus").markOfflineQueueComplete();return;case d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Failed:l.DEBUG(h(),t,u);d("MAWMIC").addPoint("process_offline_queue_failed",s);e({tag:"InitOfflineQueueSyncComplete",value:void 0});c("promiseDone")(n(a));d("MAWOfflineQueueStatus").markThreadWithOfflineQueueStatus(g,d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Failed);d("MAWOfflineQueueStatus").markOfflineQueueComplete();return}}}g.default=a}),98);
__d("MAWSetupBridgeOfflineSnapshot",["InteractionTracingMetrics","MAWMIC","MWChatInteraction","MWFBLogger","WAOfflineUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["WA infra offline connection lost"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Stats end: "," / ",", messages: "," / ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Progress: "," / ",", messages: "," / ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Stats start: ",", messages: ",""]);k=function(){return a};return a}var l=d("MWFBLogger").MWLogger.tags(["ServerRPC","Offline"]);function m(a){d("MAWMIC").addIntAnnotation("offlineQueueSize",a);var b=d("MWChatInteraction").get(d("MWChatInteraction").MW_AUTO_CHAT_TAB_OPEN);b!=null&&c("InteractionTracingMetrics").addAnnotationInt(b,"offlineQueueSize",a)}a=function(a){return async function(b){var c=b.downloaded,e=b.expected,f=b.status;b=b.timestamp;switch(f){case d("WAOfflineUtils").WAClientInfraOfflineProgress.Initializing:l.DEBUG(k(),e.count,e.message);m(e.count);a({tag:"InitOfflineQueueSyncStart",value:e.count});d("MAWMIC").addPoint("download_offline_queue_start",b);return;case d("WAOfflineUtils").WAClientInfraOfflineProgress.Processing:l.DEBUG(j(),c.count,e.count,c.message,e.message);a({tag:"InitOfflineQueueSyncProgress",value:c.count});return;case d("WAOfflineUtils").WAClientInfraOfflineProgress.Complete:l.DEBUG(i(),c.count,e.count,c.message,e.message);d("MAWMIC").addIntAnnotation("offlineQueueDownloadedCount",c.count);a({tag:"InitOfflineQueueSyncProgress",value:e.count});d("MAWMIC").addPoint("download_offline_queue_end",b);return;case d("WAOfflineUtils").WAClientInfraOfflineProgress.Failed:l.DEBUG(h());d("MAWMIC").addPoint("download_offline_queue_failed",b);return}}};b=a;g.default=b}),98);
__d("MWWorkerOwnedDbKeychain",["Deferred","MAWCryptoConsts","MWFBLogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleEARKeyChange"]);h=function(){return a};return a}c={accountKey:null,databaseEncryptionKeys:new Map(),dbReady:new(c("Deferred"))(),latestVersion:d("MAWCryptoConsts").VERSION};var i=babelHelpers["extends"]({},c),j="uninitialized",k=d("MWFBLogger").MWLogger.tags(["MWWorkerOwnedDbKeychain"]);function a(){return i}function b(a){k.DEBUG(h()),j="initialized",i=a}function e(){return j==="initialized"}function f(){return i.latestVersion}g.getEARKey=a;g.handleEARKeyChange=b;g.isInitialised=e;g.getLatestVersion=f}),98);
__d("MAWSetupBridge",["DTSG","EBDBMetricsConsistencyOperationEnum","EBMainThreadEBDBApiDeferred","LSDatabaseSingleton","LSGetLatestThreadIds.nop","LSInitSyncCompleteSubscription","LSPlatformGraphQLLightspeedRequest","MAWAbPropsClient","MAWBridgeGetMinosEpochDataForUser","MAWBridgeReceivedChatStateHandler","MAWBridgeRunMediaStorageShadowTestHandler","MAWBridgeUIEventHandlerDeferred","MAWBridgeUpdateClientMediaStatusHandler","MAWCommonSetupBridge","MAWEBFrontendQPLLogger","MAWEBLSInWorkerSwitch","MAWFetchContacts","MAWGetEphemeralSettings","MAWSetupBridgeOfflineConsumer","MAWSetupBridgeOfflineSnapshot","MAWStateManagerSyncToMainThread","MAWUnrecoverableDbErrors","MWWorkerOwnedDbKeychain","Run","Visibility","WAExceededStorageQuota","cr:3411","promiseDone","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("ArmadilloCutoverClientFalcoEvent").__setRef("MAWSetupBridge"),j=c("requireDeferred")("MAWBridgeUpdateDYIStatusV2").__setRef("MAWSetupBridge"),k=c("requireDeferred")("MAWBridgeUploadMessageByBatchGQLHandler").__setRef("MAWSetupBridge"),l=(h||(h=d("LSDatabaseSingleton"))).LSDatabaseSingleton.then(d("LSInitSyncCompleteSubscription").use).then(function(){return(h||(h=d("LSDatabaseSingleton"))).LSDatabaseSingleton}),m=function(a){i.loadImmediately(function(b){b=b.log;return b(function(){return{armadillo_thread_id:a.armadilloThreadId,domain:a.domain,event:a.event,event_details:a.eventDetails,open_thread_id:a.openThreadId,success:a.success,trace_id:a.traceId}})})};function a(a){var e=a.dispatch,g=a.logout,i=a.reregisterDevice,n=a.rotateCryptoAuthToken,o=a.worker;function p(){o.postMessage({type:"force-flush-data"})}d("Run").onUnload(p);d("Run").onBeforeUnload(p,!1);c("Visibility").addListener(c("Visibility").HIDDEN,function(){o.postMessage({type:"force-flush-logs-only"})});return d("MAWCommonSetupBridge").initBridge({customizeEventHandlers:{abPropsUpdated:function(a){d("MAWAbPropsClient").rewrite(a.abProps)},earKeyChange:function(a){d("MWWorkerOwnedDbKeychain").handleEARKeyChange(a)},executeGraphQLLightSpeedRequest:function(a){a=a.args;return c("LSPlatformGraphQLLightspeedRequest").apply(void 0,a)},getDTSGToken:function(){return Promise.resolve(d("DTSG").getToken())},getLSDBEphemeralSetting:function(a){return d("MAWGetEphemeralSettings").getEphemeralSetting(a.chatJid)},getLSDBLatestThreadIds:async function(a){var b=await (h||(h=d("LSDatabaseSingleton"))).LSDatabaseSingleton;return b.runInTransaction(function(b){return c("LSGetLatestThreadIds.nop")(b,0,"",a.numThreads,a.miActMappingFilteredThreads)},"readonly",void 0,void 0,f.id+":125")},getLSDBUsersIsMsplit:function(a){return d("MAWFetchContacts").fetchContactsIsMsplit(a.users)},getLSDBUsersRelationships:function(a){return d("MAWFetchContacts").fetchContactsRelationships(a.users)},getMediaStorageResult:function(a){return d("MAWBridgeRunMediaStorageShadowTestHandler").fetchMediaStorageResults(a)},getMinosEpochDataForUser:function(){return d("MAWBridgeGetMinosEpochDataForUser").getMinosEpochDataForUser()},isDbMigrating:function(a){e({tag:"IsDbMigrating",value:!1})},logCutoverEvent:m,logout:g,offlineConsumerProgress:function(){return c("MAWSetupBridgeOfflineConsumer")(l,e).apply(void 0,arguments)},offlineSnapshot:c("MAWSetupBridgeOfflineSnapshot")(e),receivedChatState:async function(a){var b=await l;await b.runInTransaction(function(b){return d("MAWBridgeReceivedChatStateHandler").call(b,a)},"readwrite",void 0,void 0,f.id+":160")},reregisterDevice:i,resignCdnUrl:function(){return Promise.resolve()},rotateCryptoAuthToken:n,storageQuota:function(a){a=a.exceededStorageQuota;d("WAExceededStorageQuota").setExceededStorageQuota(a)},trackEbConsistency:function(a){void d("EBMainThreadEBDBApiDeferred").trackConsistency(d("EBDBMetricsConsistencyOperationEnum").EBConsistencyOperation.Upload,a.workerDeviceId)},uiUpdate:function(a){a=a.events;e&&a.forEach(function(a){return e(a)});b("cr:3411")==null?void 0:b("cr:3411").recordBridgeUIEvent(a);d("MAWBridgeUIEventHandlerDeferred").handleEvents(l,a)},unrecoverableDbError:function(a){a=a.error;d("MAWUnrecoverableDbErrors").setError(a)},updateDYIStatus:function(a){var b=a.qplEvent,d=a.qplInstanceKeyE2E,e=a.status;c("promiseDone")(j.load().then(function(a){return a.call({qplEvent:b,qplInstanceKeyE2E:d,status:e})}))},updateEBLSInWokerStateInMainThread:function(a){c("MAWEBLSInWorkerSwitch").set(a.ebEnabled)},updateMediaStatus:async function(a){var b=await l;return d("MAWBridgeUpdateClientMediaStatusHandler").call(b,a)},updateStateManagerStateInMainThread:function(a){d("MAWStateManagerSyncToMainThread").updateStateManagerInMainThreadFromBridgeCall(a.stateManagerKey,a.value)},uploadMessagesToBackupV2:async function(a){d("MAWEBFrontendQPLLogger").addPointForUploadMessageArray(a.messages,"bridge_entry");var b=await l;d("MAWEBFrontendQPLLogger").addPointForUploadMessageArray(a.messages,"load_gql_handler_module_start");var c=await k.load();d("MAWEBFrontendQPLLogger").addPointForUploadMessageArray(a.messages,"load_gql_handler_module_end");return c.call(b,a)},uploadOpenMessages:function(){return Promise.reject("this bridge should not be used for msgr")}},worker:o})}g.setupBridge=a}),98);
__d("MAWSetupMutex",["LocalStorageMutex","MAWAppMutex","MAWBridge","MAWInit","MAWIssueNewUserVisibleErrors","MAWLocalStorage","MAWMIC","MAWReinitWorker","MAWSetupWorker","MAWStateContext.react","MAWWaitForBackendSetup","MAWWebWorkerSingleton","MWFBLogger","QPLUserFlow","Run","isInstamadillo","promiseDone","qpl","react","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i;b=i||d("react");var j=b.useCallback,k=b.useEffect,l=b.useMemo,m=d("MWFBLogger").MWLogger.tags(["MAWInit"]),n=!1,o=0;async function p(a){if(document.visibilityState!=="visible")return!1;var b=window.indexedDB!=null,c=d("MAWLocalStorage").isLocalStorageAvailable();if(a){m.debug("AppMutex - Shouldn't reinitialize, worker already exists");return!1}return!b||!c?!1:!0}function a(a,b){var e=a.logout,f=a.reregisterDevice,g=a.rotateCryptoAuthToken,i=a.setupBridge,q=l(function(){return d("MAWAppMutex").use()},[]),r=(h||(h=c("useReStore")))(),s=d("MAWStateContext.react").useDispatchClearEphemeralSettings(),t=r.persistenceTypes.includes("indexeddb"),u=j(async function(a){var b=q.takeoverFilter(a);if(!b||a.newValue===d("LocalStorageMutex").THIS_TAB||a.newValue==="")return;!t&&!c("isInstamadillo")()&&d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"DropAllSecureThreads",value:void 0}]});await d("MAWSetupWorker").terminateDedicatedWorker("MAWSetupMutexV2:handleStoreChange");d("MAWWaitForBackendSetup").resetBackendSetup();d("MAWMIC").cancel("workerMutexLost");d("MAWInit").MAWInit.cancel("workerMutexLost");q.onMutexDeath()},[q,t]),v=j(function(){q.onMutexDeath(),c("promiseDone")(d("MAWSetupWorker").terminateDedicatedWorker("MAWSetupMutexV2:handleUnload"))},[q]),w=j(async function(){var a=await d("MAWWebWorkerSingleton").doesWorkerExist();a=await p(a);if(!a||n)return;n=!0;o++;try{await c("MAWReinitWorker")({allTablesPersisted:t,db:r,dispatch:b,dispatchClearEphemeralSettings:s,instanceKey:o,logout:e,reregisterDevice:f,rotateCryptoAuthToken:g,setupBridge:i,workerCreateReason:"mawReinitSetupMutex"}),d("MAWIssueNewUserVisibleErrors").deleteUserVisibleErrorByJSErrorMessage("maw_appmutex_no_permission")}catch(a){m.catching(a).mustfix("AppMutex - failed to reinitialize worker"),c("QPLUserFlow").endFailure(c("qpl")._(25310984,"169"),"failed_to_reinitialize_worker",{annotations:{string:{error:a.message.concat(": ",a.error)}},error:a,instanceKey:o})}finally{n=!1}},[t,r,b,s,e,f,g,i]);k(function(){window.addEventListener("storage",u);var a=d("Run").onBeforeUnload(v,!1),b=d("Run").onUnload(v);window.addEventListener("visibilitychange",w);return function(){window.removeEventListener("storage",u),a.remove(),b.remove(),window.removeEventListener("visibilitychange",w)}},[u,v,w])}g.useMutex=a}),98);
__d("MAWSetupMutex.react",["MAWSetupMutex"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.dispatch;a=a.platformSetupUtils;d("MAWSetupMutex").useMutex(a,b);return null}g["default"]=a}),98);
__d("MWChatFetchThreadMessageCounts",[],(function(a,b,c,d,e,f){"use strict";async function a(a){return{}}async function b(a,b){return 0}f.fetchArmadilloThreadMessageCounts=a;f.fetchArmadilloThreadMessageCount=b}),66);
__d("globalCryptoSubtle",[],(function(a,b,c,d,e,f){"use strict";b=a.crypto.subtle;c=b;f["default"]=c}),66);
__d("useDataLossStatisticsStorageListener",["LSDatabaseSingleton","MWChatFetchThreadMessageCounts","Visibility","WebStorage","promiseDone","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=(i||d("react")).useEffect,l="armadillo_msgr_data_loss_stats";function a(){var a=d("react-compiler-runtime").c(1),b;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(b=[],a[0]=b):b=a[0];k(m,b)}function m(){var a;window.setTimeout(function(){a=c("Visibility").addListener(c("Visibility").HIDDEN,n)},3e4);return function(){var b;(b=a)==null?void 0:b.remove()}}function n(){c("promiseDone")((j||(j=d("LSDatabaseSingleton"))).LSDatabaseSingleton.then(o))}function o(a){return d("MWChatFetchThreadMessageCounts").fetchArmadilloThreadMessageCounts(a).then(p)}function p(a){(h||(h=c("WebStorage"))).setItemGuarded(h.getLocalStorage(),l,JSON.stringify(a))}g.DATA_LOSS_STATISTICS_STORAGE_KEY=l;g.useDataLossStatisticsStorageListener=a}),98);
__d("MWChatDataLossCheckerUtil",["FBLogger","I64","MWChatFetchThreadMessageCounts","QuickPerformanceLogger","WebStorage","gkx","globalCryptoSubtle","promiseDone","qpl","useDataLossStatisticsStorageListener"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(a){a=Array.from(new Uint8Array(a));return a.map(function(a){return a.toString(16).padStart(2,"0")}).join("")}async function l(a){try{if(c("gkx")("24059"))return a;var b=new TextEncoder();b=b.encode(a).buffer;a=await c("globalCryptoSubtle").digest("SHA-256",b);return k(a)}catch(a){return a}}async function m(a){var b=a.currentIDBCnt,d=a.currentMsgCnt,e=a.logThreadId,f=a.prevMsgCnt,g=a.qplEvent;a=a.threadId;if(e!=null&&e){e=await l(a);b!=null?((i||(i=c("QuickPerformanceLogger"))).markerStartFromNavStart(g),i.markerAnnotate(g,{int:{current_idb_count:b,current_msg_count:d,prev_msg_count:f},string:{encrypted_threadId:e}}),i.markerEnd(g,2)):((i||(i=c("QuickPerformanceLogger"))).markerStartFromNavStart(g),i.markerAnnotate(g,{int:{current_msg_count:d,prev_msg_count:f},string:{encrypted_threadId:e}}),i.markerEnd(g,2))}else b!=null?((i||(i=c("QuickPerformanceLogger"))).markerStartFromNavStart(g),i.markerAnnotate(g,{int:{current_idb_count:b,current_msg_count:d,prev_msg_count:f}}),i.markerEnd(g,2)):((i||(i=c("QuickPerformanceLogger"))).markerStartFromNavStart(g),i.markerAnnotate(g,{int:{current_msg_count:d,prev_msg_count:f}}),i.markerEnd(g,2))}function n(a){var b=a.currentMsgCnt,c=a.logThreadId,d=a.prevMsgCnt,e=a.qplEvent;a=a.threadId;return m({currentMsgCnt:b,logThreadId:c,prevMsgCnt:d,qplEvent:e,threadId:a})}async function a(a,b){try{a=await d("MWChatFetchThreadMessageCounts").fetchArmadilloThreadMessageCount(a,b);var e=(j||(j=c("WebStorage"))).getAllowlistedKeyFromLocalStorage(d("useDataLossStatisticsStorageListener").DATA_LOSS_STATISTICS_STORAGE_KEY);if(e==null)return{isThreadMissingMessages:!1};e=JSON.parse(e);b=(e=e[(h||(h=d("I64"))).to_string(b)])!=null?e:null;if(b==null)return{isThreadMissingMessages:!1};return b>0&&a===0?{currCount:a,isThreadMissingMessages:!0,prevCount:b}:{isThreadMissingMessages:!1}}catch(a){c("FBLogger")("labyrinth").catching(a).warn("Failed to check for data loss");return{isThreadMissingMessages:!1}}}function b(a){a=d("MWChatFetchThreadMessageCounts").fetchArmadilloThreadMessageCounts(a);a.then(function(a){var b=(j||(j=c("WebStorage"))).getAllowlistedKeyFromLocalStorage(d("useDataLossStatisticsStorageListener").DATA_LOSS_STATISTICS_STORAGE_KEY);if(b==null)return Promise.resolve(null);b=JSON.parse(b);return Promise.resolve({current:a,previous:b})}).then(function(a){if(a==null)return Promise.resolve();var b=a.current;a=a.previous;return o(a,b)}).catch(function(a){return c("FBLogger")("labyrinth").catching(a).warn("Failed to check for data loss")});return a.then(function(){})}async function o(a,b){var d=[];for(var e in a)Object.prototype.hasOwnProperty.call(b,e)&&d.push(e);e=[];for(var f=0;f<d.length;f++){var g=d[f],h={currentMsgCnt:b[g],prevMsgCnt:a[g],threadId:g};a[g]>0&&b[g]===0?(e.push(n(babelHelpers.extends({},h,{qplEvent:c("qpl")._(717553665,"1183")}))),e.push(n(babelHelpers.extends({},h,{logThreadId:!0,qplEvent:c("qpl")._(717562243,"1358")})))):(e.push(n(babelHelpers.extends({},h,{qplEvent:c("qpl")._(717553666,"1184")}))),e.push(n(babelHelpers.extends({},h,{logThreadId:!0,qplEvent:c("qpl")._(717556541,"1361")}))))}await Promise.all(e)}function e(a){var b=function(b){c("promiseDone")(l(b).then(function(d){(i||(i=c("QuickPerformanceLogger"))).markerStartFromNavStart(c("qpl")._(717567419,"1383")),i.markerAnnotate(c("qpl")._(717567419,"1383"),{string:{encryptedThreadId:d,msg_count:a[b].toString()}}),i.markerEnd(c("qpl")._(717567419,"1383"),2)}))};for(var d in a)b(d)}g.qplLog=n;g.checkIsThreadMissingMessages=a;g.fetchCountsAndLogDataLoss=b;g.logThreadCompleteDataLoss=o;g.logLocalStatistics=e}),98);
__d("useOnMawSetupComplete.react",["emptyFunction","promiseDone","react","waitForMAWMIC"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(h||d("react")).useEffect;function a(a,b,e){b===void 0&&(b=c("emptyFunction")),i(function(){var e=!1;c("promiseDone")(d("waitForMAWMIC").promise.then(function(){if(e)return;a()})["catch"](function(){if(e)return;b()}));return function(){e=!0}},e)}g.useOnMawSetupComplete=a}),98);
__d("useDataLossChecker",["FBLogger","I64","LSDatabaseSingleton","LSFactory","LSScheduleOccamThreadsIntegrityCheckerStoredProcedure","MWChatDataLossCheckerUtil","gkx","justknobx","promiseDone","react-compiler-runtime","useDataLossStatisticsStorageListener","useOnMawSetupComplete.react"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(){var a=d("react-compiler-runtime").c(2);d("useDataLossStatisticsStorageListener").useDataLossStatisticsStorageListener();var b,c;a[0]===Symbol.for("react.memo_cache_sentinel")?(b=l(),c=[],a[0]=b,a[1]=c):(b=a[0],c=a[1]);d("useOnMawSetupComplete.react").useOnMawSetupComplete(j,b,c)}function j(){c("promiseDone")(k()),l()}async function k(){var a=await (h||(h=d("LSDatabaseSingleton"))).LSDatabaseSingleton;await d("MWChatDataLossCheckerUtil").fetchCountsAndLogDataLoss(a)}function l(){try{var a=c("gkx")("24061"),b=c("justknobx")._("1683");a&&b&&c("promiseDone")(async function(){var a=await (h||(h=d("LSDatabaseSingleton"))).LSDatabaseSingleton;return a.runInTransaction(function(a){return c("LSScheduleOccamThreadsIntegrityCheckerStoredProcedure")(c("LSFactory")(a),{delayMs:(i||(i=d("I64"))).of_int32(6e4),maxThreadCount:i.of_int32(20)})},"readonly",void 0,void 0,f.id+":61")}())}catch(a){c("FBLogger")("labyrinth_web").warn("Error running thread integrity checker",a)}}g.default=a}),98);
__d("useLegacyUserWatchdog",["MAWIssueNewUserVisibleErrors","clearTimeout","react","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(h||d("react")).useEffect;b=24*60*60*1e3;var j=5*b;function a(){i(k,void 0)}function k(){var a=c("setTimeout")(l,j);return function(){return c("clearTimeout")(a)}}function l(){var a;(a=d("MAWIssueNewUserVisibleErrors")).issueError(a.MAWLegacyUserErrorMsgBody,a.MAWLegacyUserErrorMsgTitle,a.MAWUserVisibleErrorPresentationType.BANNER)}g["default"]=a}),98);
__d("useMAWReregisterDeviceOnError",["LSPersistedDbGating","MAWIssueNewUserVisibleErrors","MAWLoggerUtils","MAWReinitWorker","MAWSetupWorker","MAWStateContext.react","MAWWaitForBackendSetup","ODS","WABridgedAPI","WATagsLogger","promiseDone","react","useAsyncReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unable to reinit worker ",""]);j=function(){return a};return a}b=h||d("react");var k=b.useCallback,l=b.useContext,m=!1,n=typeof window!=="undefined"?window:self;function o(){m=!0,c("promiseDone")(d("MAWSetupWorker").terminateWorkerPermanently(),function(){(i||(i=d("ODS"))).bumpEntityKey(3185,"armadillo_forced_reregister_fail",n.location.hostname),d("MAWIssueNewUserVisibleErrors").issueError(d("MAWIssueNewUserVisibleErrors").MAWLegacyUserErrorMsgBody,d("MAWIssueNewUserVisibleErrors").MAWLegacyUserErrorMsgTitle,d("MAWIssueNewUserVisibleErrors").MAWUserVisibleErrorPresentationType.BANNER)})}function a(a){var b=a.rotateCryptoAuthToken,e=a.setupBridge,f=c("useAsyncReStore")(),g=d("MAWStateContext.react").useDispatchClearEphemeralSettings(),h=l(d("MAWStateContext.react").MAWDispatchContext);return k(async function(){if(m)return;(i||(i=d("ODS"))).bumpEntityKey(3185,"armadillo_forced_deregister",n.location.hostname);await c("WABridgedAPI").removeCurrentDevice();await d("MAWSetupWorker").terminateWorker("useMAWReregisterDeviceOnError");d("MAWWaitForBackendSetup").resetBackendSetup();try{var a=await f;await c("MAWReinitWorker")({allTablesPersisted:d("LSPersistedDbGating").allTablesPersisted,db:a,dispatch:h,dispatchClearEphemeralSettings:g,logout:o,reregisterDevice:o,rotateCryptoAuthToken:b,setupBridge:e,workerCreateReason:"mawReinitReregDevice"})}catch(b){d("MAWWaitForBackendSetup").rejectBackendSetup(b);a=b.description||b.message||b;d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.DeviceRegistration,d("MAWLoggerUtils").Tag.LogoutHandler,d("MAWLoggerUtils").Tag.WorkerSetup,d("MAWLoggerUtils").Tag.MAWWorker,d("MAWLoggerUtils").Tag.MAWInit]).ERROR(j(),a);d("MAWIssueNewUserVisibleErrors").issueError(d("MAWIssueNewUserVisibleErrors").MAWLegacyUserErrorMsgBody,d("MAWIssueNewUserVisibleErrors").MAWLegacyUserErrorMsgTitle,d("MAWIssueNewUserVisibleErrors").MAWUserVisibleErrorPresentationType.BANNER)}},[f,h,g,b,e])}g.default=a}),98);
__d("useStorageUsageMetricsLogger",["cr:20551","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(h||d("react")).useEffect;function a(){var a=d("react-compiler-runtime").c(1),b;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(b=[],a[0]=b):b=a[0];i(j,b)}function j(){b("cr:20551")==null?void 0:b("cr:20551").logMAWDBUsageMetrics()}g["default"]=a}),98);
__d("MAWSetupImpl.react",["BaseHeadingContext","CometRelay","MAWCommonSetup","MAWCryptoAuthToken","MAWSetupMutex.react","MAWStateContext.react","cr:6159","cr:6160","cr:8800","promiseDone","react","react-compiler-runtime","shouldUseMAWSharedWorker","useDataLossChecker","useLegacyUserWatchdog","useMAWReregisterDeviceOnError","useStorageUsageMetricsLogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react"));e=h;e.useCallback;var j=e.useContext;e.useMemo;window.XPlatTesting=b("cr:6159");window.XPlatTestingGroups=b("cr:6160");window.XPlatMockServer=b("cr:8800");function a(a){var b=d("react-compiler-runtime").c(24),e=a.children,f=a.fbid,g=a.logout;a=a.setupBridge;var h=j(d("MAWStateContext.react").MAWDispatchContext),k=d("CometRelay").useRelayEnvironment(),l;b[0]!==k?(l=function(){return d("MAWCryptoAuthToken").fetchFreshCAT(k)},b[0]=k,b[1]=l):l=b[1];l=l;var m;b[2]!==l||b[3]!==a?(m={rotateCryptoAuthToken:l,setupBridge:a},b[2]=l,b[3]=a,b[4]=m):m=b[4];var n=c("useMAWReregisterDeviceOnError")(m);b[5]!==g||b[6]!==n?(m=g!=null?g:function(){return c("promiseDone")(n())},b[5]=g,b[6]=n,b[7]=m):m=b[7];b[8]!==n?(g=function(){return c("promiseDone")(n())},b[8]=n,b[9]=g):g=b[9];var o;b[10]!==l||b[11]!==a||b[12]!==m||b[13]!==g?(o={logout:m,reregisterDevice:g,rotateCryptoAuthToken:l,setupBridge:a},b[10]=l,b[11]=a,b[12]=m,b[13]=g,b[14]=o):o=b[14];l=o;a=l;d("MAWCommonSetup").useArmadillo(a);c("useLegacyUserWatchdog")();c("useDataLossChecker")();c("useStorageUsageMetricsLogger")();m=j(c("BaseHeadingContext"));g=!d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker();o=m+1;b[15]!==h||b[16]!==k||b[17]!==f||b[18]!==a?(l=g?i.jsx(c("MAWSetupMutex.react"),{dispatch:h,environment:k,fbId:f,platformSetupUtils:a}):null,b[15]=h,b[16]=k,b[17]=f,b[18]=a,b[19]=l):l=b[19];b[20]!==e||b[21]!==o||b[22]!==l?(m=i.jsxs(c("BaseHeadingContext").Provider,{value:o,children:[e,l]}),b[20]=e,b[21]=o,b[22]=l,b[23]=m):m=b[23];return m}g["default"]=a}),98);
__d("MAWSetup.react",["CometPlaceholder.react","CometRelay","CurrentUser","MAWMainThreadEBDeps","MAWOembedIframeContainer.react","MAWSetupBridge","MAWSetupImpl.react","cr:6809","cr:8510","deferredLoadComponent","isGroupInvitesEnabled","promiseDone","react","react-compiler-runtime","requireDeferredForDisplay"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react")),j=h.useEffect,k=b("cr:6809")!=null?b("cr:6809").CometLogoutProvider:function(a){a=a.children;return i.jsx(i.Fragment,{children:a})},l=c("deferredLoadComponent")(c("requireDeferredForDisplay")("MAWLoadingStateSpinner.react").__setRef("MAWSetup.react"));c("isGroupInvitesEnabled")();function a(a){var e=d("react-compiler-runtime").c(10);a=a.children;var f;e[0]===Symbol["for"]("react.memo_cache_sentinel")?(f=[],e[0]=f):f=e[0];j(m,f);var g=d("CometRelay").useRelayEnvironment(),h;e[1]!==g?(f=function(){b("cr:8510")&&c("promiseDone")(b("cr:8510").initOhaiWebClient(g))},h=[g],e[1]=g,e[2]=f,e[3]=h):(f=e[2],h=e[3]);j(f,h);d("MAWMainThreadEBDeps").initEBDeps();e[4]===Symbol["for"]("react.memo_cache_sentinel")?(f=c("CurrentUser").getID(),e[4]=f):f=e[4];e[5]!==a?(h=i.jsx(c("MAWSetupImpl.react"),{fbid:f,logout:void 0,setupBridge:d("MAWSetupBridge").setupBridge,children:a}),e[5]=a,e[6]=h):h=e[6];e[7]===Symbol["for"]("react.memo_cache_sentinel")?(f=i.jsx(c("CometPlaceholder.react"),{fallback:null,name:"MAWSetup.LoadingState",children:i.jsx(l,{})}),e[7]=f):f=e[7];e[8]!==h?(a=i.jsxs(k,{children:[h,f]}),e[8]=h,e[9]=a):a=e[9];return a}function m(){var a=d("MAWOembedIframeContainer.react").createMAWOembedIframeContainer();return function(){a==null?void 0:a.stopListening()}}g["default"]=a}),98);
__d("QPLE2ESessionMarkers",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum")({NONE:"none",START:"start",END:"end"});c=a;f["default"]=c}),66);
__d("QPLE2E",["QuickPerformanceLogger"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){function a(){}var b=a.prototype;b.logPointDeprecated=function(a,b,d,e){var f,g;e===void 0&&(e={});f=(f=e.timestamp)!=null?f:(h||(h=c("QuickPerformanceLogger"))).currentTimestamp();var i=babelHelpers["extends"]({},e.pointData);g=(g=e.action)!=null?g:12524;e.secondaryOrder!=void 0&&(i.string||(i.string={}),i.string.qpl_e2e__secondary_order=e.secondaryOrder);if(e.sessionMarker&&e.sessionMarker!=="none"){var j;i.bool||(i.bool={});i.bool=babelHelpers["extends"]({},i.bool,(j={},j.qpl_e2e__session_marker_start_point=e.sessionMarker==="start",j.qpl_e2e__session_marker_end_point=e.sessionMarker==="end",j))}(h||(h=c("QuickPerformanceLogger"))).markerStart(a,void 0,f,{samplingBasis:d});h.markerPoint(a,b,{data:i,timestamp:f*2});e.annotations&&(h||(h=c("QuickPerformanceLogger"))).markerAnnotate(a,e.annotations);h.markerAnnotate(a,{string:(j={},j.join_id=d,j.qpl__source="client",j),bool:(b={},b.qpl_e2e__align_points=!0,b)});h.markerEnd(a,g,void 0,f)};return a}();b=new a();g["default"]=b}),98);
__d("MWCMChatTabNotificationsQPLLoggingUtils",["QPLE2E","QPLUserFlow","Random","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h=c("qpl")._(25298296,"1725"),i=c("qpl")._(25304846,"1726");function a(){var a=d("Random").uint32();return{logCancel:function(b){c("QPLUserFlow").endCancel(i,{annotations:{string:{cancelReason:b}},instanceKey:a})},logEventStreamReceived:function(b){b!=null&&c("QPLE2E").logPointDeprecated(h,"client:receive_event_stream",b,{action:2}),c("QPLUserFlow").start(i,{instanceKey:a})},logOpenChatTab:function(){c("QPLUserFlow").addPoint(i,"open_chat_tab",{instanceKey:a})},logOpenChatTabSuccess:function(){c("QPLUserFlow").endSuccess(i,{instanceKey:a})},logThreadLoaded:function(){c("QPLUserFlow").addPoint(i,"thread_loaded",{instanceKey:a})}}}g.createChatTabQPLLogger=a}),98);
__d("MWChatBadgeCountUpdater.react",["CometRelay","LSIntEnum","MWChatBadgeCountUpdates.react","react","react-compiler-runtime","recoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(h||d("react")).useEffect;function a(){var a=d("react-compiler-runtime").c(6),b=d("CometRelay").useRelayEnvironment(),e;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(e=(i||(i=d("LSIntEnum"))).ofNumber(0),a[0]=e):e=a[0];var f=d("MWChatBadgeCountUpdates.react").useUnseenThreadCount(e),g=f==null,h;a[1]!==f||a[2]!==b||a[3]!==g?(e=function(){var a={suppress_xac_groups:!1};b.commitUpdate(function(b){b=b.getRoot();if(b==null){c("recoverableViolation")("A store root must be present to move forward.","messenger_web_entrypoints");return}b=b.getOrCreateLinkedRecord("viewer","Viewer");b=b.getOrCreateLinkedRecord("message_threads","ViewerMessageThreadsConnection");if(f!=null){var d=b.getValue("unseen_count",a);(d===null||d!==f)&&b.setValue(f,"unseen_count",a)}d=b.getValue("is_loading_client_threads");(d==null||d!==g)&&b.setValue(g,"is_loading_client_threads")})},h=[b,f,g],a[1]=f,a[2]=b,a[3]=g,a[4]=e,a[5]=h):(e=a[4],h=a[5]);j(e,h);return null}g["default"]=a}),98);
__d("MWChatBadgeCountUpdaterCond.react",["cr:21414"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=b("cr:21414")}),98);
__d("MWChatConfig",["CurrentEnvironment","bx"],(function(a,b,c,d,e,f,g){"use strict";a=c("CurrentEnvironment").messengerdotcom?c("bx").getURL(c("bx")("273041")):c("bx").getURL(c("bx")("273022"));b=c("CurrentEnvironment").messengerdotcom?c("bx").getURL(c("bx")("273042")):c("bx").getURL(c("bx")("273023"));g.soundNotifMp3Url=a;g.soundNotifOggUrl=b}),98);
__d("MWChatEncryptedBackupsHandleRestoreWrapperDeferred.react",["CometErrorBoundary.react","CometPlaceholder.react","HeroInteractionIgnoreWithDiv.react","deferredLoadComponent","react","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react"),j=c("deferredLoadComponent")(c("requireDeferred")("MWChatEncryptedBackupsHandleRestoreWrapper.react").__setRef("MWChatEncryptedBackupsHandleRestoreWrapperDeferred.react"));function a(a){return i.jsx(c("HeroInteractionIgnoreWithDiv.react"),{children:i.jsx(c("CometErrorBoundary.react"),{fallback:function(){return null},children:i.jsx(c("CometPlaceholder.react"),{fallback:null,name:"EncryptedBackupsHandleRestoreWrapper",children:i.jsx(j,babelHelpers["extends"]({},a))})})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWChatStateV2IsComposeTab",["MWChatStateV2Types"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=a.tabType;return a.type===d("MWChatStateV2Types").MWChatStateTabType.ComposeTab}g.isComposeTab=a}),98);
__d("MWChatStateV2HeadGroups",["MWChatStateV2CompareTabs","MWChatStateV2IsComposeTab","MWChatStateV2IsMinimized"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e){c=Array.from(c.values()).filter(function(b){return d("MWChatStateV2IsMinimized").isMinimized(a,b)}).sort(function(a,b){var c=d("MWChatStateV2CompareTabs").byMostRecentMinimized(a,b);return c===0?d("MWChatStateV2CompareTabs").byMostRecentOpened(a,b):c});b=b.filter(function(a){return!d("MWChatStateV2IsComposeTab").isComposeTab(a)}).concat(c);return[b.slice(0,e),b.slice(e,b.length)]}g.getHeadGroups=a}),98);
__d("MWChatTabsNotificationSubscription_MessengerChatTabsNotificationSubscription_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="23885219097739619"}),null);
__d("MWChatTabsNotificationSubscription_MessengerChatTabsNotificationSubscription.graphql",["MWChatTabsNotificationSubscription_MessengerChatTabsNotificationSubscription_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"input"}],c=[{alias:null,args:[{kind:"Variable",name:"data",variableName:"input"}],concreteType:"MessengerChatTabsNotificationSubscribeResponsePayload",kind:"LinkedField",name:"messenger_chat_tabs_notification_subscribe",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"message_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"message_timestamp",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"thread_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"qpl_join_id",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"MWChatTabsNotificationSubscription_MessengerChatTabsNotificationSubscription",selections:c,type:"Subscription",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"MWChatTabsNotificationSubscription_MessengerChatTabsNotificationSubscription",selections:c},params:{id:b("MWChatTabsNotificationSubscription_MessengerChatTabsNotificationSubscription_facebookRelayOperation"),metadata:{subscriptionName:"messenger_chat_tabs_notification_subscribe"},name:"MWChatTabsNotificationSubscription_MessengerChatTabsNotificationSubscription",operationKind:"subscription",text:null}}}();e.exports=a}),null);
__d("MWChatTabsNotificationSubscription",["CometRelay","MWChatTabsNotificationSubscription_MessengerChatTabsNotificationSubscription.graphql"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h!==void 0?h:h=b("MWChatTabsNotificationSubscription_MessengerChatTabsNotificationSubscription.graphql");function a(a,b){return d("CometRelay").requestSubscription(a,{onNext:b,subscription:i,variables:{input:{}}})}g.subscribe=a}),98);
__d("MWChatThreadPingCounter",[],(function(a,b,c,d,e,f){"use strict";var g=new Map();function h(a){a=g.get(a);return a!=null?a:0}function a(a){g.set(a,h(a)+1)}function b(){g.clear()}f.getCount=h;f.incrementCount=a;f.clear=b}),66);
__d("MWFallbackWithTimeout.react",["FBLogger","react","react-compiler-runtime","useTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h;h||(h=d("react"));var i=h.useEffect;function a(a){var b=d("react-compiler-runtime").c(4),e=a.children,f=a.message;a=c("useTimeout")(1e4);var g=a.pending,h;b[0]!==f||b[1]!==g?(a=function(){g||c("FBLogger")("messenger_web_entrypoints","fallback_timeout").warn(f)},h=[f,g],b[0]=f,b[1]=g,b[2]=a,b[3]=h):(a=b[2],h=b[3]);i(a,h);return e}g["default"]=a}),98);
__d("MWGetCurrentThreadIDForLSThread",["I64","LSIntEnum","mwCMIsAnyCMThread","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b,e){if(e)return{NAME:"Page",VAL:(h||(h=d("I64"))).to_string(a)};else if((h||(h=d("I64"))).equal(b,(i||(i=d("LSIntEnum"))).ofNumber(7))||(h||(h=d("I64"))).equal(b,(i||(i=d("LSIntEnum"))).ofNumber(15))||(h||(h=d("I64"))).equal(b,(i||(i=d("LSIntEnum"))).ofNumber(16)))return{NAME:"UserSecret",VAL:(h||(h=d("I64"))).to_string(a)};else if((h||(h=d("I64"))).equal(b,(i||(i=d("LSIntEnum"))).ofNumber(1))||(h||(h=d("I64"))).equal(b,(i||(i=d("LSIntEnum"))).ofNumber(13))||(h||(h=d("I64"))).equal(b,(i||(i=d("LSIntEnum"))).ofNumber(201)))return{NAME:"User",VAL:(h||(h=d("I64"))).to_string(a)};else if((h||(h=d("I64"))).equal(b,(i||(i=d("LSIntEnum"))).ofNumber(2))||(h||(h=d("I64"))).equal(b,(i||(i=d("LSIntEnum"))).ofNumber(5))||c("mwCMIsAnyCMThread")(b)||(h||(h=d("I64"))).equal(b,(i||(i=d("LSIntEnum"))).ofNumber(150))||(h||(h=d("I64"))).equal(b,(i||(i=d("LSIntEnum"))).ofNumber(151))||(h||(h=d("I64"))).equal(b,(i||(i=d("LSIntEnum"))).ofNumber(154))||(h||(h=d("I64"))).equal(b,(i||(i=d("LSIntEnum"))).ofNumber(155))||(h||(h=d("I64"))).equal(b,(i||(i=d("LSIntEnum"))).ofNumber(152))||(h||(h=d("I64"))).equal(b,(i||(i=d("LSIntEnum"))).ofNumber(153))||(h||(h=d("I64"))).equal(b,(i||(i=d("LSIntEnum"))).ofNumber(26)))return{NAME:"Group",VAL:(h||(h=d("I64"))).to_string(a)};throw c("unrecoverableViolation")("Unsupported MWMessagingThreadType "+(h||(h=d("I64"))).to_string(b),"messenger_web_messaging")}g.get=a}),98);
__d("MWNotificationRenderer.react",["fbt","I64","LSIntEnum"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j;function a(a,b,c,e,f){if((i||(i=d("I64"))).equal(a.senderId,b))return h._(/*BTDS*/"New message");f=(b=(a=f.nickname)!=null?a:e.firstName)!=null?b:e.name;a=c.threadName;if(a!=null)return h._(/*BTDS*/"{senderName} messaged {groupName}",[h._param("senderName",f),h._param("groupName",a)]);else if((i||(i=d("I64"))).equal(c.threadType,(j||(j=d("LSIntEnum"))).ofNumber(2)))return h._(/*BTDS*/"{name} messaged your group",[h._param("name",f)]);else return h._(/*BTDS*/"{name} messaged you",[h._param("name",f)])}g.renderDocumentTitle=a}),226);
__d("MWLSChatPopperCommon",["CometSetBlinkingTitleMessageContext","CurrentEnvironment","CurrentUser","I64","MWChatConfig","MWChatSettingsQuery","MWNotificationRenderer.react","MWPIsThreadUnread","MessengerWebEventsFalcoEvent","ReQL","gkx","react","requireDeferred","useCometRouterState","useMWShowOpenInMessengerToast","useMatchViewport"],(function(a,b,c,d,e,f,g){"use strict";var h,i;e=h||d("react");var j=e.useCallback,k=e.useContext,l=c("requireDeferred")("Sound").__setRef("MWLSChatPopperCommon");function m(a){var b=(i||(i=d("I64"))).to_string(a.senderId)!==c("CurrentUser").getID();b&&l.onReady(function(b){b.play([d("MWChatConfig").soundNotifOggUrl,d("MWChatConfig").soundNotifMp3Url],(i||(i=d("I64"))).to_float(a.timestampMs),!1)})}function a(a,b,e){var f=k(c("CometSetBlinkingTitleMessageContext")),g=c("useMatchViewport")("max","width",320),h=c("useCometRouterState")();h=h==null?void 0:(h=h.main)==null?void 0:h.route;var l=(h==null?void 0:h.tabKey)==="messenger",m=c("useMWShowOpenInMessengerToast")();return j(function(h,j,k,n){k=d("MWNotificationRenderer.react").renderDocumentTitle(h,b,j,k,n);g&&c("CurrentEnvironment").facebookdotcom&&!l&&c("gkx")("15812")&&m((i||(i=d("I64"))).to_string(j.threadKey),k);e.contents!=null&&e.contents();e.contents=d("ReQL").fromTableAscending(a.tables.threads).getKeyRange(j.threadKey).subscribe(function(a,b){if(b.operation==="add"||b.operation==="put"){a=b.value;if(d("MWPIsThreadUnread").isThreadUnread(a))return;e.contents!=null&&e.contents();e.contents=void 0;f(null,(i||(i=d("I64"))).to_float(a.lastReadWatermarkTimestampMs))}});f(k,(i||(i=d("I64"))).to_float(h.timestampMs))},[b,g,l,e,a.tables.threads,f,m])}function b(a){d("MWChatSettingsQuery").areChatTabsSoundsOn(function(b){if(b!=null&&b)return m(a);else c("MessengerWebEventsFalcoEvent").log(function(){return{event_name:"suppress_new_message_sound"}})})}g.useUpdateDocumentTitle=a;g.playChatTabSound=b}),98);
__d("MWLSChatTabPolicy",["$InternalEnum","I64","LSContactBlockedByViewerStatus","LSIntEnum","MWCMThreadTypes.react","MWChatSettingsQuery","MessagingFolderTag","MessengerWebEventsFalcoEvent","emptyFunction","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=b("$InternalEnum")({ALLOW:0,DENY:1});function k(a,b,c){if(c===j.ALLOW)return a(b)}var l=function(a){return c("MessengerWebEventsFalcoEvent").log(function(){return{event_name:"suppress_new_message",extra_data:{reason:a}}})},m=function(a){a(j.ALLOW)},n=function(a,b,c){(h||(h=d("I64"))).equal(b.senderId,c)?(l("message_outgoing"),a(j.DENY)):a(j.ALLOW)},o=function(a,b,e){if(c("gkx")("23433"))a(j.ALLOW);else{d("MWChatSettingsQuery").areChatTabsTurnedOff(function(c){c!=null&&c?(l("turn_off_chat_tab"),b!=null&&d("MWCMThreadTypes.react").isJoinedCMThread(b.threadType)&&e!=null&&e.logCancel("turn_off_chat_tab"),a(j.DENY)):a(j.ALLOW)});return}},p=function(a,b,c){var e=(h||(h=d("I64"))).to_float(b.muteExpireTimeMs);e>Date.now()||e<0?(l("mention_muted"),d("MWCMThreadTypes.react").isJoinedCMThread(b.threadType)&&c!=null&&c.logCancel("mention_muted"),a(j.DENY)):a(j.ALLOW)},q=function(a,b){b.isAdminMessage?(l("message_non_user_generated"),a(j.DENY)):a(j.ALLOW)},r=function(a,b){b.folderName===c("MessagingFolderTag").INBOX||(h||(h=d("I64"))).equal(b.parentThreadKey,(i||(i=d("LSIntEnum"))).ofNumber(-10))?a(j.ALLOW):(l("message_no_inbox"),a(j.DENY))},s=function(a,b){!(h||(h=d("I64"))).equal(b.blockedByViewerStatus,(i||(i=d("LSIntEnum"))).ofNumber(c("LSContactBlockedByViewerStatus").UNBLOCKED))?(l("message_blocked_participants"),a(j.DENY)):a(j.ALLOW)},t=function(a,b){d("MWCMThreadTypes.react").isJoinedCMThread(b.threadType)?(l("community_messaging_group_blocked"),a(j.DENY)):a(j.ALLOW)},u=function(a,b){b=b.mentionTypes;b!=null&&"s".includes(b)?a(j.DENY):a(j.ALLOW)},v=function(a,b){c("gkx")("23433")&&b?a(j.DENY):a(j.ALLOW)},w=function a(b,d){if(b.length===0)return function(a){return k(d,c("emptyFunction"),a)};var e=b[0],f=b.slice(1);return function(b){return k(e,a(f,d),b)}},x=function(a,b){var c=a[0];a=a.slice(1);c(w(a,b))};function a(a,b,c,d,e,f){return x([function(){return m.apply(void 0,arguments)},function(){for(var b=arguments.length,c=new Array(b),e=0;e<b;e++)c[e]=arguments[e];return n.apply(void 0,c.concat([a,d]))},function(){return o.apply(void 0,arguments)},function(){for(var a=arguments.length,c=new Array(a),d=0;d<a;d++)c[d]=arguments[d];return p.apply(void 0,c.concat([b]))},function(){for(var b=arguments.length,c=new Array(b),d=0;d<b;d++)c[d]=arguments[d];return q.apply(void 0,c.concat([a]))},function(){for(var a=arguments.length,c=new Array(a),d=0;d<a;d++)c[d]=arguments[d];return r.apply(void 0,c.concat([b]))},function(){for(var a=arguments.length,b=new Array(a),d=0;d<a;d++)b[d]=arguments[d];return s.apply(void 0,b.concat([c]))},function(){for(var a=arguments.length,c=new Array(a),d=0;d<a;d++)c[d]=arguments[d];return t.apply(void 0,c.concat([b]))},function(){for(var b=arguments.length,c=new Array(b),d=0;d<b;d++)c[d]=arguments[d];return u.apply(void 0,c.concat([a]))},function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return v.apply(void 0,b.concat([e]))}],f)}function e(a,b,c,d){return x([function(){return m.apply(void 0,arguments)},function(){for(var c=arguments.length,d=new Array(c),e=0;e<c;e++)d[e]=arguments[e];return o.apply(void 0,d.concat([a,b]))},function(){for(var c=arguments.length,d=new Array(c),e=0;e<c;e++)d[e]=arguments[e];return p.apply(void 0,d.concat([a,b]))},function(){for(var a=arguments.length,b=new Array(a),d=0;d<a;d++)b[d]=arguments[d];return v.apply(void 0,b.concat([c]))}],d)}g.shouldMessageBeAllowed=a;g.shouldCommunityChatThreadPopup=e}),98);
__d("useMWChatOpenTabFromNewMessage",["I64","LSIntEnum","LSMessagingThreadTypeUtil","LSThreadAttributionStore","MAWStateContext.react","MWChatInteraction","MWChatStateActions","MWChatStateContext","MWChatStateV2.react","MWChatStateV2IsClosed","MWChatStateV2Types","MWChatThreadId","MessengerWebEventsFalcoEvent","ODS","cr:20187","dispatchOpenChatTabTraceLogging","gkx","justknobx","loadChatTabEntryPoint","react","setTimeout","useAsyncReStore","useCometFeedNoRoutingNavigationEventLogger","useCometRelayEntrypointContextualEnvironmentProvider","useLazyShouldShowMessagingEntrypointInCometRoot","useMWChatOpenTabTraceProvider"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;e=h||d("react");var l=e.useCallback,m=e.useContext,n=new Set();function a(a,e){e=e.withChatTabTracing;var f=e===void 0?!1:e,g=c("useCometFeedNoRoutingNavigationEventLogger")(),h=d("MWChatStateV2.react").useDispatch(),o=c("useMWChatOpenTabTraceProvider")(),p=d("MWChatStateContext").useChatState(function(a){return a.tabs}),q=c("useLazyShouldShowMessagingEntrypointInCometRoot")("CHAT"),r=c("useCometRelayEntrypointContextualEnvironmentProvider")(),s=m(d("MAWStateContext.react").MAWDispatchContext),t=c("useAsyncReStore")();return l(function(e,l,m){g(Date.now(),"","messenger");(i||(i=d("ODS"))).bumpEntityKey(3185,"mwchat_tab","open_incoming");c("MessengerWebEventsFalcoEvent").log(function(){return{event_name:"open_chat_tab_from_new_message"}});d("LSThreadAttributionStore").setSource(d("MWChatThreadId").getFBID(e),a);var u=Date.now();if(b("cr:20187")!=null&&d("LSMessagingThreadTypeUtil").isArmadilloSecure(l.threadType)){var v=c("gkx")("14315")?8:c("justknobx")._("2038");void t.then(function(a){return b("cr:20187").preloadSecureMessagesByThreadKey(a,l.threadKey,s,v)})}var w=function(a){var b={clientThreadKey:void 0,threadKey:l.threadKey,threadType:l.threadType},e=c("loadChatTabEntryPoint")(r);c("dispatchOpenChatTabTraceLogging")(a,b,"useMWChatOpenTabFromNewMessage");h(d("MWChatStateActions").openTabOrFlyout(u,{shouldFocus:!1},{threadKeyDescriptor:b,type:d("MWChatStateV2Types").MWChatStateTabType.ChatTab},e),!c("gkx")("24037"))},x=l.threadKey;e=Array.from(p.values()).find(function(a){if(a.tabType.type===d("MWChatStateV2Types").MWChatStateTabType.ChatTab){a=a.tabType.threadKeyDescriptor.threadKey;return(j||(j=d("I64"))).equal(x,a)}});var y=e!=null?d("MWChatStateV2IsClosed").isClosed(e):!1,z=n.has((j||(j=d("I64"))).to_string(x));z=f&&(e==null&&!z||e!=null&&y)&&q();z?(n.add((j||(j=d("I64"))).to_string(x)),o({entrypoint:"notificationInThreadReply",threadKey:l.threadKey,threadType:(k||(k=d("LSIntEnum"))).unwrapIntEnum(l.threadType)},function(a,b){d("MWChatInteraction").set((j||(j=d("I64"))).to_string(l.threadKey),a),b.onComplete(function(){n["delete"]((j||(j=d("I64"))).to_string(x))}),w(b)})):w();c("setTimeout")(function(){return h(d("MWChatStateActions").closeFlyout(u,l.threadKey))},3e3);return m()},[g,a,p,f,h,o,q])}g["default"]=a}),98);
__d("MWLSCommunityChatPopper",["CometRelay","GroupsCometChatsEngagementLogger","I64","MWCMChatTabNotificationsQPLLoggingUtils","MWChatTabsNotificationSubscription","MWChatThreadPingCounter","MWGetCurrentThreadIDForLSThread","MWLSChatPopperCommon","MWLSChatTabPolicy","MWPActor.react","MercuryIDs","ReQL","promiseDone","react","react-compiler-runtime","useMWChatOpenTabFromNewMessage","useMWFamilyCenterContext"],(function(a,b,c,d,e,f,g){"use strict";var h,i;b=h||d("react");var j=b.useCallback,k=b.useEffect,l={contents:void 0};function m(a,b){var e=d("MWLSChatPopperCommon").useUpdateDocumentTitle(a,b,l),f=j(function(b){c("promiseDone")(window.Promise.all([a.tables.threads.get(b.threadKey),a.tables.contacts.get(b.senderId),a.tables.participants.get(b.threadKey,b.senderId)]),function(a){var f=a[0],g=a[1];a=a[2];if(g!=null&&a!=null){e(b,f,g,a);g=c("MercuryIDs").getThreadIDFromThreadFBID((i||(i=d("I64"))).to_string(f.threadKey));if(d("MWChatThreadPingCounter").getCount(g)<3){d("MWChatThreadPingCounter").incrementCount(g);d("MWLSChatPopperCommon").playChatTabSound(b);return}}})},[a,e]);return j(function(b,e,g){var h={contents:function(){}};h.contents=d("ReQL").fromTableAscending(a.tables.messages).getKeyRange((i||(i=d("I64"))).of_string(b),i.of_string(g),e).subscribe(function(a,b){if(b.operation==="add"){a=b.value;h.contents();f(a)}});c("promiseDone")(d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.messages).getKeyRange(i.of_string(b),i.of_string(g),e)),function(a){a&&(h.contents(),f(a))})},[a,f])}function a(a){var b=d("react-compiler-runtime").c(9),e=a.storage;a=a.withChatTabTracing;a=a===void 0?!1:a;var f;b[0]!==a?(f={withChatTabTracing:a},b[0]=a,b[1]=f):f=b[1];var g=c("useMWChatOpenTabFromNewMessage")("notificationInThreadReply",f);a=d("MWPActor.react").useActor();var h=c("CometRelay").useRelayEnvironment(),j=m(e,a);f=d("useMWFamilyCenterContext").useMWFamilyCenterEnforcementsContext();var l=f.familyCenterData;b[2]!==h||b[3]!==l.hasActiveMsgrFamilyCenterEnforcement||b[4]!==g||b[5]!==e||b[6]!==j?(a=function(){var a=d("MWChatTabsNotificationSubscription").subscribe(h,function(a){a=(a==null?void 0:a.messenger_chat_tabs_notification_subscribe)||{};var b=a.message_id,f=a.message_timestamp,h=a.qpl_join_id,k=a.thread_id;if(k==null||f==null||b==null)return;var m=d("MWCMChatTabNotificationsQPLLoggingUtils").createChatTabQPLLogger();m.logEventStreamReceived(h);c("promiseDone")(d("ReQL").firstAsync(d("ReQL").fromTableAscending(e.tables.threads).getKeyRange((i||(i=d("I64"))).of_string(k))),function(a){a!=null&&(m.logThreadLoaded(),d("MWLSChatTabPolicy").shouldCommunityChatThreadPopup(a,m,l.hasActiveMsgrFamilyCenterEnforcement,function(){var c=d("MWGetCurrentThreadIDForLSThread").get(a.threadKey,a.threadType,!1);m.logOpenChatTab();g(c,a,function(){m.logOpenChatTabSuccess(),d("GroupsCometChatsEngagementLogger").log({action:"impression",event:"thread_open_auto",source:"auto_open_chat_tabs",surface:"auto_open_chat_tabs_container",thread_id:(i||(i=d("I64"))).to_string(a.threadKey)}),j(k,b,f)})}))})});return function(){a.dispose()}},f=[h,e,g,j,l.hasActiveMsgrFamilyCenterEnforcement],b[2]=h,b[3]=l.hasActiveMsgrFamilyCenterEnforcement,b[4]=g,b[5]=e,b[6]=j,b[7]=a,b[8]=f):(a=b[7],f=b[8]);k(a,f)}g.useOpenCommunityChatTabs=a}),98);
__d("MWV2ChatHeadsLayout.react",["react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){var b=d("react-compiler-runtime").c(3);a=a.children;a=a;var c;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(c={className:"x191j7n5 xdg88n9 x10l6tqk x1useyqa"},b[0]=c):c=b[0];b[1]!==a?(c=i.jsx("div",babelHelpers["extends"]({},c,{children:a})),b[1]=a,b[2]=c):c=b[2];return c}g["default"]=a}),98);
__d("MWV2ChatOptionsHead.react",["fbt","FDSDots3HorizontalFilled20Icon","MWXDeferredPopoverTrigger.react","MWXIcon_DEPRECATED.react","MWXPressable.react","MWXTooltip.react","react","react-compiler-runtime","requireDeferred"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react")),k=i.useState,l=c("requireDeferred")("MWV2ChatOptionsHeadPopover.react").__setRef("MWV2ChatOptionsHead.react"),m={head:{alignItems:"x6s0dn4",backgroundColor:"x1l31dnx",borderStartStartRadius:"x1c9tyrk",borderStartEndRadius:"xeusxvb",borderEndEndRadius:"x1pahc9y",borderEndStartRadius:"x1ertn4p",boxShadow:"x1qeybcx",display:"x78zum5",height:"xc9qbxq",justifyContent:"xl56j7k",opacity:"xg01cxk",transform:"x1f85oc2",transitionDuration:"x19bguh7",transitionProperty:"x6o7n8i",width:"x14qfxbe",":hover_boxShadow":"x19xcq9t",$$css:!0},headVisible:{opacity:"x1hc1fzr",transform:"x3oybdh",$$css:!0}},n=h._(/*BTDS*/"Options");function a(a){var b=d("react-compiler-runtime").c(11),e=a.isVisible,f=a.openTabCount,g=a.style;a=k(!1);var h=a[0],i=a[1];a=k(!1);var o=a[0],p=a[1];a=k(!1);var q=a[0];a=a[1];f=f>0;var r;b[0]!==f?(r={hasOpenTabs:f},b[0]=f,b[1]=r):r=b[1];b[2]!==o||b[3]!==h||b[4]!==q||b[5]!==e||b[6]!==g?(f=function(a,b){return j.jsx("div",{className:"x1c9tyrk xeusxvb x1pahc9y x1ertn4p xc9qbxq xrr41r3 x10l6tqk x14qfxbe",style:g,children:j.jsx("div",babelHelpers["extends"]({className:"x6s0dn4 xjbqb8w x78zum5 xnnlda6 xl56j7k x1kovpyh xhsvlbd x1dmp6jm"},{"data-testid":void 0,onMouseEnter:function(){return i(!0)},onMouseLeave:function(){return i(!1)},children:j.jsx(c("MWXPressable.react"),{label:n,onFocusChange:function(a){return p(a)},onPress:b,ref:a,testid:void 0,xstyle:function(){return[m.head,e||h||o||q?m.headVisible:!1]},children:j.jsx(c("MWXTooltip.react"),{align:"middle",position:"start",tooltip:n,children:j.jsx(c("MWXIcon_DEPRECATED.react"),{icon:c("FDSDots3HorizontalFilled20Icon")})})})}))})},b[2]=o,b[3]=h,b[4]=q,b[5]=e,b[6]=g,b[7]=f):f=b[7];b[8]!==r||b[9]!==f?(a=j.jsx(c("MWXDeferredPopoverTrigger.react"),{align:"end",onVisibilityChange:a,popoverProps:r,popoverResource:l,position:"above",children:f}),b[8]=r,b[9]=f,b[10]=a):a=b[10];return a}g["default"]=a}),226);
__d("useMWV2PreloadComposeTab",["JSResourceForInteraction","JSScheduler","react","react-compiler-runtime","useCometPreloader"],(function(a,b,c,d,e,f,g){"use strict";var h,i;(h||d("react")).useCallback;var j=c("JSResourceForInteraction")("MWV2ComposeTab.react").__setRef("useMWV2PreloadComposeTab");function a(){var a=d("react-compiler-runtime").c(3),b=k;b=c("useCometPreloader")("button",b,b);var e=b.onHoverInPreloader;b=b.onHoverOutPreloader;var f;a[0]!==e||a[1]!==b?(f=[e,b],a[0]=e,a[1]=b,a[2]=f):f=a[2];return f}function k(){(i||(i=d("JSScheduler"))).scheduleSpeculativeCallback(l)}function l(){j.preload()}g["default"]=a}),98);
__d("MWV2ComposeHead.react",["fbt","FDSComposeFilled20Icon","FDSIcon.react","LSThreadAttributionStore","MWChatInteraction","MWChatStateV2.react","MWChatStateV2Types","MWPBumpEntityKey","MWXPressable.react","MWXTooltip.react","MessengerWebUXLogger","react","react-compiler-runtime","useMWNewChatOpenTabTraceProvider","useMWV2PreloadComposeTab"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react"),k={button:{alignItems:"x6s0dn4",appearance:"xjyslct",backgroundColor:"x1l31dnx",borderStartStartRadius:"x1c9tyrk",borderStartEndRadius:"xeusxvb",borderEndEndRadius:"x1pahc9y",borderEndStartRadius:"x1ertn4p",boxShadow:"x1qeybcx",display:"x3nfvp2",height:"xsdox4t",justifyContent:"xl56j7k",position:"x1n2onr6",width:"x1useyqa",":hover_boxShadow":"x19xcq9t",$$css:!0}};function a(a){var b=d("react-compiler-runtime").c(16),e=a.onFocusChange;a=a.onHoverChange;var f=d("MWChatStateV2.react").useDispatch(),g=c("MessengerWebUXLogger").useInteractionLogger(),i=c("useMWNewChatOpenTabTraceProvider")(),k;b[0]!==f||b[1]!==g||b[2]!==i?(k=function(){i(function(a){d("MWChatInteraction").set("open_new",a);g==null?void 0:g({eventName:"create_thread"});d("LSThreadAttributionStore").setSourceForNewThread("chatheadsNewMessage");d("MWPBumpEntityKey").bumpEntityKey("comet.sidebar","compose_head_click");var b=Date.now();a=function(a){return{clientForcedMinimizeWatermark:a.clientForcedMinimizeWatermark,closeWatermark:a.closeWatermark,doNotBlockWithEBUpsell:!0,isExpanded:a.isExpanded,minimizeWatermark:a.minimizeWatermark,openFlyoutWatermark:a.openFlyoutWatermark,openWatermark:b,tabId:a.tabId,tabType:a.tabType}};var c=function(a){var c=a.openWatermark<a.closeWatermark;if(c)return{clientForcedMinimizeWatermark:a.clientForcedMinimizeWatermark,closeWatermark:a.closeWatermark,isExpanded:a.isExpanded,minimizeWatermark:a.minimizeWatermark,openFlyoutWatermark:a.openFlyoutWatermark,openWatermark:b,tabId:a.tabId,tabType:a.tabType};else return{clientForcedMinimizeWatermark:a.clientForcedMinimizeWatermark,closeWatermark:b,isExpanded:a.isExpanded,minimizeWatermark:a.minimizeWatermark,openFlyoutWatermark:a.openFlyoutWatermark,openWatermark:a.openWatermark,tabId:a.tabId,tabType:a.tabType}};return f([{inserter:a,tabConfig:{shouldFocus:!0},tabType:{initialTokens:[],secureThreadToggleEnabled:!1,type:d("MWChatStateV2Types").MWChatStateTabType.ComposeTab},type:d("MWChatStateV2Types").MWChatStateActionsType.UpsertTab,updater:c}])},"chatheadsNewMessage")},b[0]=f,b[1]=g,b[2]=i,b[3]=k):k=b[3];k=k;var m=c("useMWV2PreloadComposeTab")(),n=m[0];m=m[1];var o,p,q,r,s;b[4]===Symbol["for"]("react.memo_cache_sentinel")?(p=h._(/*BTDS*/"New message"),o=c("MWXTooltip.react"),q="middle",r="start",s=p.toString(),b[4]=o,b[5]=p,b[6]=q,b[7]=r,b[8]=s):(o=b[4],p=b[5],q=b[6],r=b[7],s=b[8]);var t;b[9]===Symbol["for"]("react.memo_cache_sentinel")?(t=j.jsx(c("FDSIcon.react"),{color:"primary",icon:c("FDSComposeFilled20Icon"),size:20}),b[9]=t):t=b[9];b[10]!==n||b[11]!==m||b[12]!==e||b[13]!==a||b[14]!==k?(o=j.jsx(o,{align:q,position:r,tooltip:s,children:j.jsx(c("MWXPressable.react"),{"aria-label":p,onFocusChange:e,onHoverChange:a,onHoverIn:n,onHoverOut:m,onPress:k,role:"button",testid:void 0,xstyle:l,children:t})}),b[10]=n,b[11]=m,b[12]=e,b[13]=a,b[14]=k,b[15]=o):o=b[15];return o}function l(){return[k.button]}g["default"]=a}),226);
__d("MWV2ChatHeads.react",["CometErrorBoundary.react","CometHeroInteractionWithDiv.react","CometPlaceholder.react","I64","JSResourceForInteraction","MWChatInteraction","MWChatStateContext","MWChatStateV2HeadGroups","MWChatStateV2TabGroups","MWChatStateV2Types","MWPActor.react","MWV2ChatHeadsLayout.react","MWV2ChatOptionsHead.react","MWV2ComposeHead.react","WebUXLoggingEntryPointContextProvider","lazyLoadComponent","react","react-compiler-runtime","useMWChatStateV2MaxTabCount"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=h||(h=d("react")),k=h.useState,l=5,m=c("lazyLoadComponent")(c("JSResourceForInteraction")("MWV2ChatHead.react").__setRef("MWV2ChatHeads.react")),n=c("lazyLoadComponent")(c("JSResourceForInteraction")("MWV2ChatOverflowHead.react").__setRef("MWV2ChatHeads.react"));function o(a){return{transform:"translateY(-"+Math.imul(a,58)+"px)"}}function p(a){return{transform:"translateY(-"+(Math.imul(a,58)-12)+"px"}}function a(a){var b=d("react-compiler-runtime").c(29);a=a.isMediaViewer;var e;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(e=d("MWPActor.react").isAPPlus(),b[0]=e):e=b[0];e=e;var f=d("MWChatStateContext").useChatState(s),g=f[0],h=f[1];f=f[2];var t;b[1]!==g?(t=Array.from(g.values()),b[1]=g,b[2]=t):t=b[2];t=c("useMWChatStateV2MaxTabCount")(f,t,a);h=d("MWChatStateV2TabGroups").getTabGroups(f,g,h,t);t=h.openExcessTabs;h=h.openTabs;a=d("MWChatStateV2HeadGroups").getHeadGroups(a?f:void 0,t,g,l);f=a[0];t=a[1];g=h.length;a=f.length;var u=t.length>0?1:0;h=k(!1);var v=h[0],w=h[1],x;h=t[0];if(t.length===1&&h.tabType.type!==d("MWChatStateV2Types").MWChatStateTabType.ComposeTab){h=h.tabType.threadKeyDescriptor;var y=(i||(i=d("I64"))).to_string(h.threadKey),z;b[3]===Symbol["for"]("react.memo_cache_sentinel")?(z=o(1),b[3]=z):z=b[3];x=j.jsx(c("CometErrorBoundary.react"),{fallback:r,children:j.jsx(c("CometPlaceholder.react"),{fallback:null,name:"MWV2ChatHeads.ExcessHeads",children:j.jsx(m,{onFocusChange:w,onHoverChange:w,style:z,tab:t[0],threadKeyDescriptor:h})})},y)}else if(t.length>1){b[4]===Symbol["for"]("react.memo_cache_sentinel")?(z=o(1),b[4]=z):z=b[4];x=j.jsx(c("CometPlaceholder.react"),{fallback:null,name:"MWV2ChatHeads.ChatOverflowHead",children:j.jsx(n,{excessHeads:t,onActiveChange:w,style:z})})}h=d("WebUXLoggingEntryPointContextProvider").WebUXLoggingEntryPointContextProvider;y="chat_heads";t=c("CometHeroInteractionWithDiv.react");z="Comet initial load to chatheads VC";var A;b[5]===Symbol["for"]("react.memo_cache_sentinel")?(A=d("MWChatInteraction").get(d("MWChatInteraction").MW_CHATHEADS_LOAD),b[5]=A):A=b[5];var B=c("MWV2ChatHeadsLayout.react"),C;b[6]!==a||b[7]!==v||b[8]!==g||b[9]!==u?(C=c("MWV2ChatOptionsHead.react")!=null&&g+a>=2?j.jsx(c("MWV2ChatOptionsHead.react"),{isVisible:v,openTabCount:g,style:p(a+u+1)}):null,b[6]=a,b[7]=v,b[8]=g,b[9]=u,b[10]=C):C=b[10];b[11]!==u||b[12]!==w?(a=function(a,b){var e=a.tabType;if(e.type===d("MWChatStateV2Types").MWChatStateTabType.ComposeTab)return null;b=b+u+1;return j.jsx(c("CometErrorBoundary.react"),{fallback:q,children:j.jsx(c("CometPlaceholder.react"),{fallback:null,name:"MWV2ChatHeads.ChatHead",children:j.jsx(m,{onFocusChange:w,onHoverChange:w,style:o(b),tab:a,threadKeyDescriptor:e.threadKeyDescriptor})})},(i||(i=d("I64"))).to_string(e.threadKeyDescriptor.threadKey))},b[11]=u,b[12]=w,b[13]=a):a=b[13];v=f.reverse().map(a);b[14]!==w?(g=!e&&j.jsx(c("MWV2ComposeHead.react"),{onFocusChange:w,onHoverChange:w}),b[14]=w,b[15]=g):g=b[15];b[16]!==B||b[17]!==x||b[18]!==C||b[19]!==v||b[20]!==g?(f=j.jsxs(B,{children:[C,v,x,g]}),b[16]=B,b[17]=x,b[18]=C,b[19]=v,b[20]=g,b[21]=f):f=b[21];b[22]!==t||b[23]!==f||b[24]!==A?(a=j.jsx(t,{interactionDesc:z,interactionUUID:A,children:f}),b[22]=t,b[23]=f,b[24]=A,b[25]=a):a=b[25];b[26]!==h||b[27]!==a?(e=j.jsx(h,{value:y,children:a}),b[26]=h,b[27]=a,b[28]=e):e=b[28];return e}function q(){return null}function r(){return null}function s(a){return[a.tabs,a.focusedTabId,a.mediaViewerOpenWatermark]}g.MAX_CHAT_HEADS=l;g.MWV2ChatHeads=a}),98);
__d("MWV2ChatTabsLayout.react",["react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){var b=d("react-compiler-runtime").c(3);a=a.children;a=a;var c;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(c={className:"xpqajaz x1ey2m1c x78zum5 x1jndppq xixxii4 x1vjfegm"},b[0]=c):c=b[0];b[1]!==a?(c=i.jsx("div",babelHelpers["extends"]({},c,{"data-testid":void 0,children:a})),b[1]=a,b[2]=c):c=b[2];return c}g["default"]=a}),98);
__d("MWV2ChatTabs.react",["CometErrorBoundary.react","CometPlaceholder.react","CometRelay","FBLogger","HeroInteractionIgnoreWithDiv.react","I64","JSResourceForInteraction","MAWEditMessageContext.react","MWChatInteraction","MWChatStateContext","MWChatStateV2CompareTabs","MWChatStateV2HeadGroups","MWChatStateV2TabGroups","MWChatStateV2Types","MWPReplyContext.react","MWV2ChatHeads.react","MWV2ChatTabLoadingWithGlimmers.react","MWV2ChatTabRoot.entrypoint","MWV2ChatTabsLayout.react","MWV2EnsureThatChatTabExists","MWV2IsTabFocusedContext.react","RelayHooks","cr:21133","cr:7101","gkx","hero-tracing","lazyLoadComponent","qex","react","react-compiler-runtime","useCometDisplayTimingTrackerForInteraction","useCometRelayEntrypointContextualEnvironmentProvider","useMWChatStateV2MaxTabCount"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=h||d("react");e=b("cr:7101")||{};var k=e.MWComposerKeyCommandFocusManager,l=e.MWComposerKeyCommandFocusManagerTabIndex,m=c("lazyLoadComponent")(c("JSResourceForInteraction")("MWV2ComposeTab.react").__setRef("MWV2ChatTabs.react")),n=c("lazyLoadComponent")(c("JSResourceForInteraction")("MWV2ChatTab.react").__setRef("MWV2ChatTabs.react"));b("cr:21133");function o(a){var b=d("react-compiler-runtime").c(13),e=a.isMinimized,f=a.tab;a=a.threadKeyDescriptor;var g=c("useCometRelayEntrypointContextualEnvironmentProvider")();d("MWV2EnsureThatChatTabExists").useMWV2EnsureThatChatTabExists(a.threadKey,a.threadType,a.clientThreadKey,"MWV2ChatTabs");var h=c("qex")._("4754");if(h===!0){h=f.tabRootEntryPointRef;if(h==null){c("FBLogger")("messenger_web").warn("Missing chat tab entrypoint ref. Loading dynamically.");var i;b[0]!==g?(i=d("CometRelay").loadEntryPoint(g,c("MWV2ChatTabRoot.entrypoint"),{}),b[0]=g,b[1]=i):i=b[1];h=i}b[2]!==e||b[3]!==f||b[4]!==a?(g={isMinimized:e,tab:f,threadKeyDescriptor:a},b[2]=e,b[3]=f,b[4]=a,b[5]=g):g=b[5];b[6]!==g||b[7]!==h?(i=j.jsx(d("RelayHooks").EntryPointContainer,{entryPointReference:h,props:g}),b[6]=g,b[7]=h,b[8]=i):i=b[8];return i}b[9]!==e||b[10]!==f||b[11]!==a?(g=j.jsx(n,{isMinimized:e,tab:f,threadKeyDescriptor:a}),b[9]=e,b[10]=f,b[11]=a,b[12]=g):g=b[12];return g}function a(a){var b=d("react-compiler-runtime").c(6);a=a.isMediaViewer;var e=d("MWChatStateContext").useChatState(s),f=e[0],g=e[1];e=e[2];var h;b[0]!==f?(h=Array.from(f.values()),b[0]=f,b[1]=h):h=b[1];h=c("useMWChatStateV2MaxTabCount")(e,h,a);h=d("MWChatStateV2TabGroups").getTabGroups(a?e:void 0,f,g,h);var i=h.minimizedTabs,n=h.openExcessTabs,u=h.openTabs;h=d("MWChatStateV2HeadGroups").getHeadGroups(a?e:void 0,n,f,d("MWV2ChatHeads.react").MAX_CHAT_HEADS);var v=h[1],w=c("useCometDisplayTimingTrackerForInteraction")("ChatMain",!0);a=i.filter(function(a){return!v.includes(a)}).filter(r);e=[].concat(u,a,n).sort(d("MWChatStateV2CompareTabs").byMostRecentOpened);f=e.map(function(a,b){var e=g===a.tabId,f=a.tabType,h,i=u.indexOf(a)===-1;f.type===d("MWChatStateV2Types").MWChatStateTabType.ComposeTab?h=j.jsx(m,{initialTokens:f.initialTokens,tab:a},f.initialTokens.map(q).join()):h=j.jsx(o,{isMinimized:i,tab:a,threadKeyDescriptor:f.threadKeyDescriptor});f=j.jsx(d("MWV2IsTabFocusedContext.react").MWV2IsTabFocusedContextProvider,{isFocused:e,children:j.jsx(d("MWPReplyContext.react").MWPReplyContextProvider,{children:j.jsx(d("MAWEditMessageContext.react").MAWEditMessageContext,{children:j.jsx(c("HeroInteractionIgnoreWithDiv.react"),{children:j.jsx(d("hero-tracing").HeroInteraction,{alwaysMarkMutationRootAsVisualChange:!0,interactionDesc:"MWV2_CHAT_TAB",interactionUUID:t(a.tabType),pageletName:"ChatTab",ref:w,children:j.jsx(c("CometPlaceholder.react"),{fallback:i?null:j.jsx(c("MWV2ChatTabLoadingWithGlimmers.react"),{tab:a}),name:"MWV2ChatTabs",children:h})})})})})});return j.jsx(c("CometErrorBoundary.react"),{fallback:p,children:l==null?f:j.jsx(l,{value:b,children:f})},String(a.tabId))});b[2]!==f?(h=k==null?f:j.jsx(k,{children:f}),b[2]=f,b[3]=h):h=b[3];b[4]!==h?(i=j.jsx(c("MWV2ChatTabsLayout.react"),{children:h}),b[4]=h,b[5]=i):i=b[5];return i}function p(){return null}function q(a){return a.id}function r(a){return!c("gkx")("12143")?!0:a.isPreloaded!==!0||a.openWatermark>0}function s(a){return[a.tabs,a.focusedTabId,a.mediaViewerOpenWatermark]}function t(a){if(a.type===d("MWChatStateV2Types").MWChatStateTabType.ComposeTab)return null;else{var b=(i||(i=d("I64"))).to_string(a.threadKeyDescriptor.threadKey),e=d("MWChatInteraction").get(b);e==null&&c("FBLogger")("messenger_web").warn("Could not find interaction UUID for thread key %s, client thread key %s",b,a.threadKeyDescriptor.clientThreadKey?(i||(i=d("I64"))).to_string(a.threadKeyDescriptor.clientThreadKey):"<empty>");return e}}g["default"]=a}),98);
__d("useMWLSChatPopperUpper",["FBLogger","I64","JSResourceForInteraction","LSContactType","LSIntEnum","MWChatMessagesOnChatTabLoadTracker","MWChatThreadPingCounter","MWGetCurrentThreadIDForLSThread","MWLSChatPopperCommon","MWLSChatTabPolicy","MWPActor.react","MWXacGating","MercuryIDs","ReQL","ServerTime","VisibilityAPI","clearInterval","isMWXacGroupThread","isMessengerPWA","justknobx","promiseDone","qex","react","react-compiler-runtime","requireDeferred","setInterval","useGlobalEventListener","useMWChatOpenTabFromNewMessage","useMWFamilyCenterContext","useMWNavigation"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;b=h||d("react");var k=b.useEffect,l=b.useRef,m=c("requireDeferred")("MWDesktopNotifications").__setRef("useMWLSChatPopperUpper"),n=c("JSResourceForInteraction")("MWV2ChatTab.react").__setRef("useMWLSChatPopperUpper"),o=c("JSResourceForInteraction")("MWV2ChatTabRoot.react").__setRef("useMWLSChatPopperUpper"),p={contents:void 0};function q(a,b,e,f,g,h,k,l,p,q,r){r===void 0&&(r=d("MWLSChatTabPolicy").shouldMessageBeAllowed);var s=d("MWGetCurrentThreadIDForLSThread").get(f.threadKey,f.threadType,(i||(i=d("I64"))).equal(g.contactType,(j||(j=d("LSIntEnum"))).ofNumber(c("LSContactType").PAGE))||(i||(i=d("I64"))).equal(g.contactType,(j||(j=d("LSIntEnum"))).ofNumber(c("LSContactType").PAGE_PERSONA)));return r(e,f,g,l,p,function(){var j=c("qex")._("4754");j===!0?c("promiseDone")(o.load()):c("promiseDone")(n.load());var l=d("MercuryIDs").getThreadIDFromThreadFBID((i||(i=d("I64"))).to_string(f.threadKey));d("MWChatMessagesOnChatTabLoadTracker").trackReceivedFor(f.threadKey);return a(s,f,function(){k(e,f,g,h);if(d("VisibilityAPI").isVisibilityHidden()===!0){var a=c("isMessengerPWA")()&&c("justknobx")._("1465");a&&c("promiseDone")(async function(){var a=await m.load();a=a.triggerLocalNotification;await a(b,e,q)}())}if(d("MWChatThreadPingCounter").getCount(l)<3){d("MWChatThreadPingCounter").incrementCount(l);d("MWLSChatPopperCommon").playChatTabSound(e);return}})})}function r(a){var b=a.actor,d=a.hasActiveMsgrFamilyCenterEnforcement,e=a.message,f=a.navigationApi,g=a.openTabFromNewMessage,h=a.shouldBeAllowed,i=a.storage,j=a.updateDocumentTitle;c("promiseDone")(window.Promise.all([i.tables.threads.get(e.threadKey),i.tables.contacts.get(e.senderId),i.tables.participants.get(e.threadKey,e.senderId)]),function(a){var k=a[0],l=a[1];a=a[2];if(k==null){c("FBLogger")("messenger_web_entrypoints").mustfix("Thread is null when receiving a new message");return}if(l!=null&&a!=null)return q(g,i,e,k,l,a,j,b,d,f,h)})}function s(a){var b=a.actor,d=a.hasActiveMsgrFamilyCenterEnforcement,e=a.message,f=a.navigationApi,g=a.openTabFromNewMessage,h=a.shouldBeAllowed,i=a.storage,j=a.updateDocumentTitle;c("promiseDone")(window.Promise.all([i.tables.threads.get(e.threadKey),i.tables.contacts.get(e.senderId),i.tables.participants.get(e.threadKey,e.senderId)]),function(a){var k=a[0],l=a[1];a=a[2];if(k!=null&&l!=null&&a!=null&&!c("isMWXacGroupThread")(k))return q(g,i,e,k,l,a,j,b,d,f,h)})}function t(a){var b=d("react-compiler-runtime").c(11),e=a.storage;a=a.withChatTabTracing;a=a===void 0?!1:a;var f;b[0]!==a?(f={withChatTabTracing:a},b[0]=a,b[1]=f):f=b[1];var g=c("useMWChatOpenTabFromNewMessage")("notificationInThreadReply",f),h=d("MWPActor.react").useActor(),j=d("MWLSChatPopperCommon").useUpdateDocumentTitle(e,h,p);b[2]===Symbol.for("react.memo_cache_sentinel")?(a=d("ServerTime").getMillis(),b[2]=a):a=b[2];var m=l(a),n=c("useMWNavigation")();f=d("useMWFamilyCenterContext").useMWFamilyCenterEnforcementsContext();var o=f.familyCenterData;b[3]!==h||b[4]!==o.hasActiveMsgrFamilyCenterEnforcement||b[5]!==n||b[6]!==g||b[7]!==e||b[8]!==j?(a=function(){return d("ReQL").fromTableAscending(e.tables.messages).subscribe(function(a,b){if(b.operation==="add"){a=b.value;if((i||(i=d("I64"))).to_float(a.timestampMs)<=m.current)return;m.current=(i||(i=d("I64"))).to_float(a.timestampMs);b=d("MWXacGating").isGroupsEnabled()?r:s;return b({actor:h,hasActiveMsgrFamilyCenterEnforcement:o.hasActiveMsgrFamilyCenterEnforcement,message:a,navigationApi:n,openTabFromNewMessage:g,storage:e,updateDocumentTitle:j})}})},f=[h,n,o.hasActiveMsgrFamilyCenterEnforcement,g,e,j],b[3]=h,b[4]=o.hasActiveMsgrFamilyCenterEnforcement,b[5]=n,b[6]=g,b[7]=e,b[8]=j,b[9]=a,b[10]=f):(a=b[9],f=b[10]);k(a,f)}function a(a){var b=d("react-compiler-runtime").c(10),e=a.storage;a=a.withChatTabTracing;a=a===void 0?!1:a;var f;b[0]!==e||b[1]!==a?(f={storage:e,withChatTabTracing:a},b[0]=e,b[1]=a,b[2]=f):f=b[2];t(f);var g=l();b[3]===Symbol.for("react.memo_cache_sentinel")?(e=function(){var a=g.current;if(a!=null){c("clearInterval")(a);return}},b[3]=e):e=b[3];var h=e;b[4]===Symbol.for("react.memo_cache_sentinel")?(a=function(){h(),g.current=c("setInterval")(u,6e5)},b[4]=a):a=b[4];f=a;b[5]===Symbol.for("react.memo_cache_sentinel")?(e=function(){d("MWChatThreadPingCounter").clear();return h()},b[5]=e):e=b[5];a=e;b[6]===Symbol.for("react.memo_cache_sentinel")?(e={},b[6]=e):e=b[6];c("useGlobalEventListener")("blur",f,e);b[7]===Symbol.for("react.memo_cache_sentinel")?(f={},b[7]=f):f=b[7];c("useGlobalEventListener")("focus",a,f);b[8]===Symbol.for("react.memo_cache_sentinel")?(e=function(){return function(){return h()}},a=[],b[8]=e,b[9]=a):(e=b[8],a=b[9]);k(e,a)}function u(){return d("MWChatThreadPingCounter").clear()}g.default=a}),98);
__d("useSubscribeToErrorTableAndShowToast",["ReQL","react","react-compiler-runtime","requireDeferred","translatedServerString","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(i||d("react")).useEffect,k=c("requireDeferred")("LSUserVisibleErrorsUtil").__setRef("useSubscribeToErrorTableAndShowToast"),l=c("requireDeferred")("mwPushToast").__setRef("useSubscribeToErrorTableAndShowToast"),m={contents:!1};function a(a){var b=d("react-compiler-runtime").c(4),e=(h||(h=c("useReStore")))(),f,g;b[0]!==e||b[1]!==a?(f=function(){if(m.contents)return;m.contents=!0;var b=d("ReQL").fromTableAscending(e.tables.user_visible_errors).subscribe(function(b,d){switch(d.operation){case"add":var f=d.value;b=f.presentationStyle;if(b!=null&&b!=="toast"&&b!=="undefined")return;l.onReady(function(b){b.mwPushErrorToast({body:f.errorBodyText!=null?c("translatedServerString")(f.errorBodyText):void 0,onDismiss:function(){k.onReady(function(a){a.removeUserVisibleErrorFromTable(e,f.errorId)})},title:c("translatedServerString")(f.errorTitleText)},a)});return;case"put":case"delete":return}});return function(){m.contents=!1;return b()}},g=[e,a],b[0]=e,b[1]=a,b[2]=f,b[3]=g):(f=b[2],g=b[3]);return j(f,g)}g["default"]=a}),98);
__d("useMWChatInit",["MWLSCommunityChatPopper","MWPGetThreadTitle","ReQL","ReQLSuspense","promiseDone","react","react-compiler-runtime","useMWLSChatPopperUpper","useReStore","useSubscribeToErrorTableAndShowToast"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(i||d("react")).useEffect;function a(){var a=d("react-compiler-runtime").c(12),b=(h||(h=c("useReStore")))(),e;a[0]!==b.tables.community_folders||a[1]!==b.tables.contacts||a[2]!==b.tables.participants||a[3]!==b.tables.pinned_threads||a[4]!==b.tables.threads?(e=function(){var a;c("promiseDone")((a=d("ReQL")).toArrayAsync(a.fromTableAscending(b.tables.threads).map(function(a){return[a,d("ReQLSuspense").toArray(d("ReQL").leftJoin(d("ReQL").fromTableAscending(b.tables.participants,[]).getKeyRange(a.threadKey),d("ReQL").fromTableAscending(b.tables.contacts)).take(d("MWPGetThreadTitle").amountToFetchForTitle),f.id+":34")]}).take(30)));c("promiseDone")(a.toArrayAsync(a.fromTableAscending(b.tables.pinned_threads.index("pinnedTimestamp"))));c("promiseDone")(a.toArrayAsync(a.fromTableAscending(b.tables.community_folders)))},a[0]=b.tables.community_folders,a[1]=b.tables.contacts,a[2]=b.tables.participants,a[3]=b.tables.pinned_threads,a[4]=b.tables.threads,a[5]=e):e=a[5];var g;a[6]!==b?(g=[b],a[6]=b,a[7]=g):g=a[7];j(e,g);c("useSubscribeToErrorTableAndShowToast")();a[8]!==b?(e={storage:b,withChatTabTracing:!0},a[8]=b,a[9]=e):e=a[9];c("useMWLSChatPopperUpper")(e);a[10]!==b?(g={storage:b,withChatTabTracing:!0},a[10]=b,a[11]=g):g=a[11];d("MWLSCommunityChatPopper").useOpenCommunityChatTabs(g)}g["default"]=a}),98);
__d("useMWIsAPPlusChannelsInbox",["useCometRouterState"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a=c("useCometRouterState")();if(a==null)return!1;var b=a.main;a=a.pushViewStack;a=a&&a.length>0?a[a.length-1]:b;return((b=a.route)==null?void 0:b.tracePolicy)==="comet.messenger.applus.inbox"}g["default"]=a}),98);
__d("useMWIsTopLevelRouteMessengerMediaViewer",["useCometRouterState"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a=c("useCometRouterState")();if(a==null)return!1;var b=a.main;a=a.pushViewStack;a=a&&a.length>0?a[a.length-1]:b;return((b=a.route)==null?void 0:b.tracePolicy)==="comet.sharedmediaviewer.media"}g["default"]=a}),98);
__d("useMWV2ChatUpdateMediaViewerOpenWatermark",["MWChatStateActions","MWChatStateV2.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h;(h||d("react")).useCallback;function a(){var a=d("react-compiler-runtime").c(2),b=d("MWChatStateV2.react").useDispatch(),c;a[0]!==b?(c=function(){var a=Date.now();b(d("MWChatStateActions").updateMediaViewerOpenWatermark(a))},a[0]=b,a[1]=c):c=a[1];return c}g["default"]=a}),98);
__d("MWV2CookieWriter",["DeferredCookie","I64","MWCMThreadTypes.react","MWChatStateV2Types","Promise","ReQL","promiseDone","recoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a){switch(Number((i||(i=d("I64"))).to_string(a))){case 2:return"g.";case 15:return"sc.";case 16:return"sg.";case 18:return"cg.";case 19:return"cgu.";case 23:return"cbj.";case 24:return"cbu.";case 21:return"cphj.";case 22:return"cphu.";case 150:return"dp.";case 151:return"dpu.";case 152:return"dpb.";case 153:return"dpbu.";case 154:return"dp2.";case 155:return"dp2u.";default:return"u."}}function a(a,e,f){var g=function(a){if(e==null)return!1;var b=e.tabType;if(b.type===d("MWChatStateV2Types").MWChatStateTabType.ComposeTab)return!1;else return(i||(i=d("I64"))).equal(b.threadKeyDescriptor.threadKey,a)},k=function(a){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(f.tables.threads).getKeyRange(a))},l={contents:void 0};a=a.map(function(a){var c=a.isOpen,e=a.threadKey,f=a.threadType,m={o:c?1:0};return k(e).then(function(a){if(a!=null)if(g(e)){d("MWCMThreadTypes.react").isJoinedCMThread(f)&&(l.contents=(i||(i=d("I64"))).to_string(a.parentThreadKey));return(h||(h=b("Promise"))).resolve()}else{m.i=j(f)+(i||(i=d("I64"))).to_string(e);d("MWCMThreadTypes.react").isJoinedCMThread(f)&&(m.p=(i||(i=d("I64"))).to_string(a.parentThreadKey));return(h||(h=b("Promise"))).resolve(m)}else{m.i=j(f)+(i||(i=d("I64"))).to_string(e);return(h||(h=b("Promise"))).resolve(m)}})});c("promiseDone")((h||(h=b("Promise"))).all(a).then(function(a){var f;if(e!=null){var g=e.tabType;if(g.type===d("MWChatStateV2Types").MWChatStateTabType.ComposeTab)f=void 0;else{g=g.threadKeyDescriptor;var k=g.threadKey;g=g.threadType;f=j(g)+(i||(i=d("I64"))).to_string(k)}}else f=void 0;g=a.filter(function(a){return a!=null});k=l.contents;a=k!=null?JSON.stringify({lm3:f,lm3p:k,t3:g,utc3:Date.now(),v:1}):JSON.stringify({lm3:f,t3:g,utc3:Date.now(),v:1});a!=null?c("DeferredCookie").addToQueue("presence","C"+a,0,"/",!1,!1,!0):c("recoverableViolation")("Failed to serialize cookie","messenger_comet");return(h||(h=b("Promise"))).resolve()}))}g.write=a}),98);
__d("useMWV2CookieWriter",["MWChatStateContext","MWChatStateV2CompareTabs","MWChatStateV2IsOpen","MWChatStateV2Types","MWV2CookieWriter","react","react-compiler-runtime","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(i||d("react")).useEffect;function a(){var a=d("react-compiler-runtime").c(4),b=d("MWChatStateContext").useChatState(n),e=(h||(h=c("useReStore")))(),f,g;a[0]!==e||a[1]!==b?(f=function(){var a=Array.from(b.values()).filter(m).sort(d("MWChatStateV2CompareTabs").byMostRecentOpened)[0],c=[];Array.from(b.values()).filter(l).sort(k).forEach(function(a){a=a.tabType;if(a.type===d("MWChatStateV2Types").MWChatStateTabType.ComposeTab)return;c.push(babelHelpers["extends"]({},a.threadKeyDescriptor,{isOpen:!1}))});d("MWV2CookieWriter").write(c,a,e)},g=[e,b],a[0]=e,a[1]=b,a[2]=f,a[3]=g):(f=a[2],g=a[3]);j(f,g)}function k(a,b){var c=d("MWChatStateV2CompareTabs").byMostRecentMinimized(a,b);if(c===0)return d("MWChatStateV2CompareTabs").byMostRecentOpened(a,b);else return c}function l(a){if(a.openWatermark>a.closeWatermark)return!0;else return a.minimizeWatermark>a.closeWatermark}function m(a){return d("MWChatStateV2IsOpen").isOpen(void 0,a)}function n(a){return a.tabs}g["default"]=a}),98);
__d("MWV2ChatTabsRoot.react",["CometContextualLayerAnchorRoot.react","CometPlaceholder.react","FocusRegion.react","MWChatStateV2.react","MWChatVisibilityOverrideContext","MWFallbackWithTimeout.react","MWLSThreadDisplayContext","MWV2ChatHeads.react","MWV2ChatTabs.react","WebUXLoggingEntryPointContextProvider","cr:17337","focusScopeQueries","react","react-compiler-runtime","useEnsureViewerContactExistAndUpdated","useMWChatInit","useMWIsAPPlusChannelsInbox","useMWIsTopLevelRouteMediaViewerExperiment","useMWIsTopLevelRouteMessengerMediaViewer","useMWV2ChatUpdateMediaViewerOpenWatermark","useMWV2CookieWriter","useShouldShowMessagingEntrypointInCometRoot"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react"));e=h;var j=e.useEffect;e.useMemo;var k=(f=b("cr:17337"))!=null?f:i.Fragment;function l(a){var b=d("react-compiler-runtime").c(16);a=a.isMediaViewer;var e=d("MWChatStateV2.react").useChatState(n),f=c("useMWIsTopLevelRouteMessengerMediaViewer")();e=Array.from(e.values()).some(m);e=e;var g;b[0]!==f?(g={0:{className:"x1ey2m1c xtijo5x xixxii4 xamhafn x1vjfegm"},1:{className:"x1ey2m1c xtijo5x xixxii4 xamhafn x1vjfegm x1s85apg"}}[!!f<<0],b[0]=f,b[1]=g):g=b[1];b[2]===Symbol["for"]("react.memo_cache_sentinel")?(f={className:"xuk3077 x78zum5 xc8icb0"},b[2]=f):f=b[2];e=e?d("focusScopeQueries").tabbableScopeQuery:void 0;var h;b[3]!==a?(h=i.jsx(c("MWV2ChatTabs.react"),{isMediaViewer:a}),b[3]=a,b[4]=h):h=b[4];var j;b[5]!==a?(j=i.jsx(k,{children:i.jsx(d("MWV2ChatHeads.react").MWV2ChatHeads,{isMediaViewer:a})}),b[5]=a,b[6]=j):j=b[6];b[7]!==h||b[8]!==j?(a=i.jsxs(i.Fragment,{children:[h,j]}),b[7]=h,b[8]=j,b[9]=a):a=b[9];b[10]!==e||b[11]!==a?(h=i.jsx(c("CometContextualLayerAnchorRoot.react"),{children:i.jsx("div",babelHelpers["extends"]({},f,{children:i.jsx(d("FocusRegion.react").FocusRegion,{containFocusQuery:e,id:"MWV2ChatTabsRootChatTabsFocusRegion",children:a})}))}),b[10]=e,b[11]=a,b[12]=h):h=b[12];b[13]!==g||b[14]!==h?(j=i.jsx(d("WebUXLoggingEntryPointContextProvider").WebUXLoggingEntryPointContextProvider,{value:"popup_chat_box",children:i.jsx(d("MWLSThreadDisplayContext").MWLSThreadDisplayContextProvider,{value:"ChatTab",children:i.jsx("div",babelHelpers["extends"]({},g,{children:h}))})}),b[13]=g,b[14]=h,b[15]=j):j=b[15];f=j;return f}function m(a){return a.openWatermark>a.closeWatermark}function n(a){return a.tabs}function o(a){a=a.children;c("useMWV2CookieWriter")();c("useMWChatInit")();return a}function a(){var a=d("react-compiler-runtime").c(10),b=c("useMWIsTopLevelRouteMediaViewerExperiment")(),e=d("MWChatVisibilityOverrideContext").useMWChatVisibilityOverride(b),f=c("useMWV2ChatUpdateMediaViewerOpenWatermark")(),g=c("useMWIsAPPlusChannelsInbox")();e=c("useShouldShowMessagingEntrypointInCometRoot")("CHAT_TABS_ROOT")&&e&&!g;var h;a[0]!==b||a[1]!==f?(g=function(){b&&f()},h=[b,f],a[0]=b,a[1]=f,a[2]=g,a[3]=h):(g=a[2],h=a[3]);j(g,h);c("useEnsureViewerContactExistAndUpdated")();a[4]===Symbol["for"]("react.memo_cache_sentinel")?(g=i.jsx(c("MWFallbackWithTimeout.react"),{message:"MWV2ChatTabsRoot suspense timeout"}),a[4]=g):g=a[4];a[5]!==b||a[6]!==e?(h=e?i.jsx(l,{isMediaViewer:b}):null,a[5]=b,a[6]=e,a[7]=h):h=a[7];a[8]!==h?(e=i.jsx(c("CometPlaceholder.react"),{fallback:g,name:"MWV2ChatTabsRoot",children:i.jsx(o,{children:h})}),a[8]=h,a[9]=e):e=a[9];g=e;return g}g["default"]=a}),98);
__d("MWV2ChatContainer.react",["MWChatEncryptedBackupsHandleRestoreWrapperDeferred.react","MWV2ChatTabsRoot.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(){var a=d("react-compiler-runtime").c(1),b;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(b=i.jsxs(i.Fragment,{children:[i.jsx(c("MWV2ChatTabsRoot.react"),{}),i.jsx(c("MWChatEncryptedBackupsHandleRestoreWrapperDeferred.react"),{})]}),a[0]=b):b=a[0];return b}g["default"]=a}),98);
__d("MWV2ChatTabBundlePreloader.react",["JSResourceForInteraction","promiseDone","qex","waitForMAWMIC"],(function(a,b,c,d,e,f,g){"use strict";var h=c("JSResourceForInteraction")("MWV2ChatTab.react").__setRef("MWV2ChatTabBundlePreloader.react"),i=c("JSResourceForInteraction")("MWV2ChatTabRoot.react").__setRef("MWV2ChatTabBundlePreloader.react");c("promiseDone")(d("waitForMAWMIC").promise,function(){var a=c("qex")._("4754");a===!0&&i.preload();h.preload()})}),34);
__d("useMWJewelStartLoadingLogger",["CometBlendedInitialLoadTraceLog","qpl","react","react-compiler-runtime","useCometInteractionTracing"],(function(a,b,c,d,e,f,g){"use strict";var h;b=h||d("react");var i=b.useEffect,j=b.useRef,k=b.useState,l=c("qpl")._(30616158,"2565");function a(){var a=d("react-compiler-runtime").c(3),b=j(!1),e=k(),f=e[0],g=e[1],h=c("useCometInteractionTracing")(l,"slower","INTERACTION"),n;a[0]!==h?(e=function(){b.current||(b.current=!0,h(function(a){c("CometBlendedInitialLoadTraceLog").logStart("mwj_badge",a.getInstanceKey(),a.getTrace()),g(a.getTraceId()),a.onVcMetricsComplete(function(b,d){c("CometBlendedInitialLoadTraceLog").logVc("mwj_badge",a.getInstanceKey(),b,d)}),a.onLog(m)},0))},n=[h],a[0]=h,a[1]=e,a[2]=n):(e=a[1],n=a[2]);i(e,n);return f}function m(a,b){c("CometBlendedInitialLoadTraceLog").log("mwj_badge",b)}g["default"]=a}),98);/*FB_PKG_DELIM*/
__d("LSCryptoUtils",["FBLogger","XPlatReactTextDecoder","XPlatReactTextEncoder"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return new Uint8Array(a)}function h(a){var b=new(d("XPlatReactTextEncoder").TextEncoder)();return b.encode(a)}function i(a){var b=new(d("XPlatReactTextDecoder").TextDecoder)();return b.decode(a)}function b(a){return i(new Uint8Array(a))}function e(a){return h(a).buffer}function f(a,b){var d=a.byteLength,e=b.byteLength;if(d!==e)throw c("FBLogger")("messenger_web").mustfixThrow("[LS] Mismatched lengths for modAdd, %d != %d",d,e);var f=new Uint8Array(d);new Uint8Array(d).reduceRight(function(c,d,e){d=a[e];var g=b[e];d=d+g+c;g=d>255?[d-256,1]:[d,0];f[e]=g[0];return g[1]},0);return f}g.bufToUint8=a;g.strToUint8=h;g.uint8ToStr=i;g.bufToStr=b;g.strToBuf=e;g.modAddBytes=f}),98);
__d("LSMaxInt32",["I64"],(function(a,b,c,d,e,f,g){"use strict";var h;a=(h||d("I64")).of_int32(2147483647);g["default"]=a}),98);
__d("WACryptoHkdfSync",["WABinary","WACryptoSha256HmacBuilder","err"],(function(a,b,c,d,e,f,g){"use strict";var h=32,i=new Uint8Array(h),j=255*h;function k(a,b){return new(d("WACryptoSha256HmacBuilder").Sha256HMacBuilder)(b!=null?b:i).update(a).finish()}function l(a,b,e){e===void 0&&(e=new Uint8Array(0));if(b<0||b>j)throw c("err")("HKDF::expand given bad length "+b);var f=Math.ceil(b/h),g=new Uint8Array(0),i=new(d("WABinary").Binary)();for(var k=1;k<=f;k++)g=new(d("WACryptoSha256HmacBuilder").Sha256HMacBuilder)(a).update(d("WABinary").Binary.build(g,e,k).readByteArrayView()).finish(),i.writeByteArray(g);return i.readByteArrayView(b)}function a(a,b,c,d){return l(k(a,b),d,c)}g.hkdf=a}),98);
__d("CreateDerivedKeys",["CryptoLogger","I64","LSCryptoUtils","LSMaxInt32","LSSynchronousPromise","LSVec","Promise","RetUtil","WACryptoHkdfSync","XPlatReactCrypto","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,e,f,g){var j=d("CryptoLogger").CryptoLogger("create_derived_keys");if(g.length<1||g.some(function(a){return(i||(i=d("I64"))).gt(a,c("LSMaxInt32"))})){j.mustfix("Invalid key lengths for derive keys");return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult(void 0))}var k=g.map((i||(i=d("I64"))).to_int32),l=g.map(i.to_int32).reduce(function(a,b){return a+b},0),m=function(a){var b=[],e=0;for(var f=0,g=k.length;f<g;++f){var h=e+k[f];b.push(a.slice(e,h).buffer);e=h}return d("RetUtil").getNullableRetResult(c("LSVec").ofArray(b))};if(c("gkx")("13860"))try{g=d("WACryptoHkdfSync").hkdf(d("LSCryptoUtils").bufToUint8(f),d("LSCryptoUtils").bufToUint8(e!=null?e:new Uint8Array(10).buffer),d("LSCryptoUtils").bufToUint8(a),l);return d("LSSynchronousPromise").makeSynchronousPromise(m(g))}catch(a){d("CryptoLogger").captureError(j,a).mustfix("hkdf failed at LSCreateDerivedKeys.nop");return d("LSSynchronousPromise").makeSynchronousPromise(d("RetUtil").getNullableRetResult())}return d("XPlatReactCrypto").subtleImportKey("raw",f,"HKDF",!1,["deriveBits"]).then(function(b){return d("XPlatReactCrypto").subtleDeriveBits({hash:"SHA-256",info:a,name:"HKDF",salt:e!=null?e:new Uint8Array(10).buffer},b,l*8)}).then(function(a){a=new Uint8Array(a);return m(a)})["catch"](function(a){j.catching(a).mustfix("Failed to create derived keys");return d("RetUtil").getNullableRetResult()})}g.CreateDerivedKeys=a}),98);
__d("LSCreateDerivedKeys.nop",["CreateDerivedKeys","LSVec"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b,e,f,g,h){return d("CreateDerivedKeys").CreateDerivedKeys(e,f,g,c("LSVec").toArray(h))};a.__nop_name__="LSCreateDerivedKeys";g["default"]=a}),98);
__d("LSGetBlobFromString.nop",["CryptoLogger","LSResult","LSSynchronousPromise","XPlatReactTextEncoder"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b,e){a=new(d("XPlatReactTextEncoder").TextEncoder)();try{b=a.encode(e).buffer;return d("LSSynchronousPromise").makeSynchronousPromise(c("LSResult")(b))}catch(b){a=d("CryptoLogger").CryptoLogger("get_blob_from_string");a.catching(b).mustfix(b.message?b.message:"Error in get blob from string.");throw b}};a.__nop_name__="LSGetBlobFromString";g["default"]=a}),98);
__d("EBEncryptMessageTypes",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}function b(a){return a}function c(a){return a}function d(a){return a}function e(a){return a}function g(a){return a}function h(a){return a}function i(a){return a}function j(a){return a}function k(a){return a}function l(a){return a}function m(a){return a}function n(a){return a}f.unsafeCastToAAD=a;f.unsafeCastToSecretKey=b;f.unsafeCastToPlaintext=c;f.unsafeCastToCiphertext=d;f.unsafeCastToMsgData=e;f.unsafeCastToMacKey=g;f.unsafeCastToHmac=h;f.unsafeCastToEBCreateDerivedKeysIkm=i;f.unsafeCastToEBCreateDerivedKeysInfo=j;f.unsafeCastToEBCreateDerivedKeysSalt=k;f.unsafeCastToEBCreateDerivedKeyLength=l;f.unsafeCastToEBDerivedKey=m;f.castEBDerivedKeyToArrayBuffer=n}),66);
__d("EncryptedBackupsSymmetricEncryptionUtils",[],(function(a,b,c,d,e,f){"use strict";a=16;b=28;c=16;d=128;f.hChaCha20SubKeyNonceLengthInBytes=a;f.totalNonceLengthInBytes=b;f.aesGcmTagLengthInBytes=c;f.aesGcmTagLength=d}),66);
__d("HChaCha20",["err"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){}a.fromHexString=function(a){var b=a.match(/[A-Fa-f0-9]{1,2}/g);if(a.length===0||a.length%2!==0||b==null)throw c("err")('The string "'+a+'" is not valid hex.');return new Uint8Array(b.map(function(a){return parseInt(a,16)}))};a.bufferToUint32Array=function(a){var b=new DataView(a),c=[];a=a.byteLength/4;for(var d=0;d<a;d++)c.push(new DataView(b.buffer.slice(d*4,d*4+4)).getInt32(0));return Uint32Array.from(c)};a.rotate=function(a,b){a=a&4294967295;b=b&31;return(a<<b|a>>>32-b)>>>0};a.quarterRound=function(b,c,d,e){b=b;c=c;d=d;e=e;b=b+c&4294967295;e=a.rotate(e^b,16);d=d+e&4294967295;c=a.rotate(c^d,12);b=b+c&4294967295;e=a.rotate(e^b,8);d=d+e&4294967295;c=a.rotate(c^d,7);return[b>>>0,c>>>0,d>>>0,e>>>0]};var b=a.prototype;b.createHCtx=function(b,d){var e=new Uint32Array(16),f=a.fromHexString("657870616e642033322d62797465206b");if(f.byteLength!==16)throw c("err")("Could not create context. Invalid constant buffer length of "+f.byteLength+". Expected a length of 16");else if(b.byteLength!==32)throw c("err")("Could not create context. Invalid key buffer length of "+b.byteLength+". Expected a length of 32");else if(d.byteLength!==16)throw c("err")("Could not create context. Invalid nonce buffer length of "+d.byteLength+". Expected a length of 16");f=a.bufferToUint32Array(f.buffer);b=a.bufferToUint32Array(b);d=a.bufferToUint32Array(d);e.set(f);e.set(b,f.length);e.set(d,f.length+b.length);return e.buffer};b.hChaCha20Bytes=function(b,c){c=new DataView(this.createHCtx(c,b));b=c.getInt32(0);var d=c.getInt32(1<<2),e=c.getInt32(2<<2),f=c.getInt32(3<<2),g=c.getInt32(4<<2),h=c.getInt32(5<<2),i=c.getInt32(6<<2),j=c.getInt32(7<<2),k=c.getInt32(8<<2),l=c.getInt32(9<<2),m=c.getInt32(10<<2),n=c.getInt32(11<<2),o=c.getInt32(12<<2),p=c.getInt32(13<<2),q=c.getInt32(14<<2);c=c.getInt32(15<<2);for(var r=0;r<10;r++){var s=a.quarterRound(b,g,k,o);b=s[0];g=s[1];k=s[2];o=s[3];s=a.quarterRound(d,h,l,p);d=s[0];h=s[1];l=s[2];p=s[3];s=a.quarterRound(e,i,m,q);e=s[0];i=s[1];m=s[2];q=s[3];s=a.quarterRound(f,j,n,c);f=s[0];j=s[1];n=s[2];c=s[3];s=a.quarterRound(b,h,m,c);b=s[0];h=s[1];m=s[2];c=s[3];s=a.quarterRound(d,i,n,o);d=s[0];i=s[1];n=s[2];o=s[3];s=a.quarterRound(e,j,k,p);e=s[0];j=s[1];k=s[2];p=s[3];s=a.quarterRound(f,g,l,q);f=s[0];g=s[1];l=s[2];q=s[3]}return Uint32Array.from([b,d,e,f,o,p,q,c]).buffer};return a}();g.HChaCha20=a}),98);
__d("SymmetricEncryptionPaddingUtils",["XPlatReactTextEncoder"],(function(a,b,c,d,e,f,g){"use strict";function h(a){if(a<10)return 10-a;var b=Math.floor(Math.log2(a)),c=Math.floor(Math.log2(b))+1;b=b-c;c=(1<<b)-1;b=a+c&(c^-1);return b-a}function i(a){var b=Uint32Array.BYTES_PER_ELEMENT,c=a.byteLength,d=h(c);d=b+c+d;d=new DataView(new ArrayBuffer(d));d.setUint32(0,c);c=new Uint8Array(d.buffer);c.set(new Uint8Array(a),b);return c.buffer}function a(a){var b=new(d("XPlatReactTextEncoder").TextEncoder)();b=b.encode(a).buffer;return i(b)}function b(a){var b=Uint32Array.BYTES_PER_ELEMENT,c=new DataView(a);if(c.byteLength<b)return;var d=a.byteLength;c=c.getUint32(0);d=d-b;if(c>=0&&c<=d)return a.slice(b,b+c)}g.getPaddingLength=h;g.padData=i;g.pad=a;g.stripPadding=b}),98);
__d("SymmetricEncryptionCreateDecryptedData",["CryptoLogger","EncryptedBackupsSymmetricEncryptionUtils","HChaCha20","Promise","RetUtil","SymmetricEncryptionPaddingUtils","XPlatReactCrypto"],(function(a,b,c,d,e,f,g){"use strict";var h,i=d("CryptoLogger").CryptoLogger("symmetric_encryption_create_decrypted_data");a=function(a,c,e){if(e.byteLength<d("EncryptedBackupsSymmetricEncryptionUtils").hChaCha20SubKeyNonceLengthInBytes+d("EncryptedBackupsSymmetricEncryptionUtils").aesGcmTagLengthInBytes){i.mustfix("cipher text is invalid");return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult())}e=new Uint8Array(e);var f=e.slice(0,d("EncryptedBackupsSymmetricEncryptionUtils").totalNonceLengthInBytes),g=new(d("HChaCha20").HChaCha20)(),j=e.slice(d("EncryptedBackupsSymmetricEncryptionUtils").totalNonceLengthInBytes).buffer;e=g.hChaCha20Bytes(f.slice(0,d("EncryptedBackupsSymmetricEncryptionUtils").hChaCha20SubKeyNonceLengthInBytes).buffer,a);return d("XPlatReactCrypto").subtleImportKey("raw",e,"AES-GCM",!1,["decrypt"]).then(function(a){return d("XPlatReactCrypto").subtleDecrypt({additionalData:c,iv:new Uint8Array(f.slice(d("EncryptedBackupsSymmetricEncryptionUtils").hChaCha20SubKeyNonceLengthInBytes).buffer),name:"AES-GCM",tagLength:d("EncryptedBackupsSymmetricEncryptionUtils").aesGcmTagLength},a,j)}).then(function(a){a=d("SymmetricEncryptionPaddingUtils").stripPadding(a);a==null&&i.mustfix("Failed to strip padding for symmetric decryption");return d("RetUtil").getNullableRetResult(a)})["catch"](function(a){d("CryptoLogger").captureError(i,a).mustfix("symmetric data decryption failed");return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult())})};g["default"]=a}),98);
__d("LSSymmetricEncryptionCreateDecryptedData.nop",["EBEncryptMessageTypes","SymmetricEncryptionCreateDecryptedData"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b,e,f,g){return c("SymmetricEncryptionCreateDecryptedData")(d("EBEncryptMessageTypes").unsafeCastToSecretKey(e),d("EBEncryptMessageTypes").unsafeCastToAAD(f),d("EBEncryptMessageTypes").unsafeCastToCiphertext(g))};a.__nop_name__="LSSymmetricEncryptionCreateDecryptedData";g["default"]=a}),98);
__d("LSSymmetricEncryptionCreateDecryptedString.nop",["Base64Utils","CryptoLogger","LSResult","LSSymmetricEncryptionCreateDecryptedData.nop","XPlatReactTextDecoder"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return c("LSResult")(a)}a=function(a,b,e,f,g){var i=d("CryptoLogger").CryptoLogger("symmetric_encryption_create_decrypted_string");g=d("Base64Utils").toArrayBuffer(g);return c("LSSymmetricEncryptionCreateDecryptedData.nop")(a,b,e,f,g).then(function(a){a=a[0];return a}).then(function(a){return a==null?h():h(new(d("XPlatReactTextDecoder").TextDecoder)().decode(a))})["catch"](function(a){d("CryptoLogger").captureError(i,a).mustfix("symmetric string decryption failed");return h()})};a.__nop_name__="LSSymmetricEncryptionCreateDecryptedString";g["default"]=a}),98);
__d("UInt8Array",["XPlatReactCrypto"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.length;if(!(b>0&&b%2===0&&/^[\da-f]+$/gi.test(a)))return;var c=[];for(var d=0,b=b/2|0;d<b;++d){var e=parseInt(a.substring(d<<1,(d<<1)+2|0),16);c.push(e)}return new Uint8Array(c)}function b(a){return d("XPlatReactCrypto").getRandomValues(new Uint8Array(a)).buffer}function c(a){a=a.filter(function(a){return a.byteLength!==0});var b=a.reduce(function(a,b){return a+b.byteLength|0},0),c=new Uint8Array(b);a.reduce(function(a,b){c.set(b,a);return a+b.byteLength|0},0);return c}g.fromHexString=a;g.getBufferWithRandomValuesFromLength=b;g.concatBytes=c}),98);
__d("LSQplAnnotateBool.nop",["EBMarkerIdToQPLEvent","Promise","QPLUserFlow","WAHashStringToNumber","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,e,f,g,i,j){try{a=c("nullthrows")(d("EBMarkerIdToQPLEvent").markerIdToQPLEvent(f));e=d("WAHashStringToNumber").hashStringToNumber(g);c("QPLUserFlow").addAnnotations(a,{bool:(f={},f[i]=j,f)},{instanceKey:e});return(h||(h=b("Promise"))).resolve()}catch(a){return(h||(h=b("Promise"))).resolve()}};a.__nop_name__="LSQplAnnotateBool";g["default"]=a}),98);
__d("LSMEBTaskCreationSource",[],(function(a,b,c,d,e,f){a=Object.freeze({UNKNOWN:-1,TEST_ONLY:0,TAM:1,MEM:2,RETROACTIVE_BACKUP:3,TAM_WEB:4,ACT_MESSAGE_DELETE:5,ACT_THREAD_DELETE:6,ACT_UPDATE_ATTACHMENT:7,TAM_PERSISTENCE_TASK:8,TAM_XMA_TOMBSTONE:9,MEM_RECEIVE:10,MEM_SEND:11,MEM_PEER_SYNC:12,MEM_RECEIVE_PROTOBUF:13,MEM_SEND_PROTOBUF:14,MEM_PEER_SYNC_PROTOBUF:15,EB_ADD_DEVICE:21,OPTIMISTIC_THREAD_CREATE_VIA_SHIM:22,ACT_THREAD_INSERT_VIA_SHIM:23,MI_THREAD_INSERT_VIA_SHIM:24,POINT_QUERY_FROM_EB:25,MESSENGER_SEARCH:26,ACT_MESSAGE_RANGE_TASK_HANDLER:27,POINT_QUERY_ON_FULLY_LOADED_THREAD:28,THREAD_CUTOVER:29,HYBRID_THREAD_VERIFY_OR_CREATE_VIA_SHIM:30,BURNER_INTERNAL_LOAD_TESTING_FRAMEWORK:31,THREAD_GALLERY_RESTORE:32,ACT_SURROUNDING_QUERY:33,EB_SNAPSHOT_RESTORE:34,PROTOBUF_RESTORE:39,FTS_INDEX_EB_MESSAGES:40,INSTAMADILLO_DYI:41,MESSENGER_MESSAGE_LIST_PAGINATION:45,DELTA_GENERIC_MESSAGE_SYNC:55,MEDIA_GALLERY_RESTORE:57,EB_PROTOBUF_RESTORE_NO_OP:58,NEW_MEMBER_EXPORT:59,THREAD_POINT_QUERY:76,EB_RESTORE_REPLIED_MESSAGES_AFTER_RANGE_RESTORE:35,REPL_TESTING:36,EB_POINT_QUERY_IN_ACT:37,EB_POINT_QUERY_RETRY_DECRYPTION_FAILURES:38,IGD_DYI:42,FTS_INDEX_EB_MESSAGES_WEB:43,BULK_QUERY_FOR_SEARCH_RESULT:44,MSGR_DYI:46,EB_RESTORE_ON_REGISTRATION:47,EB_RESTORE_ON_OFFLINE_QUEUE_COUNT_LIMIT:48,EB_POINT_QUERY_RESTORE_ON_ACK_DROP:49,EB_POINT_QUERY_RESTORE_ON_DECRYPTION_FAILURE:50,EB_POINT_QUERY_RESTORE_ON_UNAVAILABLE_DEVICE:51,EB_RANGE_QUERY_RESTORE_ON_THREAD_SESSION_ACTIVATE:52,EB_POINT_QUERY_PINNED_MESSAGES:53,EB_POINT_QUERY_RESTORE_PROTOBUF:54,EB_POINT_QUERY_IN_ACT_REACTIONS:56,EB_POINT_QUERY_BUMP_MESSAGES:60,EB_POINT_QUERY_IN_ACT_FOR_INCOMING_RETRY_RECEIPT:61,EB_POINT_QUERY_IN_ACT_FOR_REPORTING:62,EB_POINT_QUERY_IN_ACT_FOR_MESSAGE_STATUS_UPDATE:63,EB_POINT_QUERY_IN_ACT_FOR_REPL_TEST:64,EB_POINT_QUERY_IN_ACT_FOR_FACEBOOK_APP_NSE_NOTIFICATION_RENDERING:65,EB_POINT_QUERY_IN_ACT_FOR_MESSAGE_EXPORT_HANDLING:66,EB_POINT_QUERY_IN_ACT_FOR_TAM_ACT_PROXY:67,EB_POINT_QUERY_IN_ACT_FOR_REALTIME_INCOMING_MESSAGE:68,EB_POINT_QUERY_IN_ACT_FOR_REALTIME_INCOMING_AI_BOT_MESSAGE:69,EB_POINT_QUERY_IN_ACT_FOR_ENCRYPTED_BACKUPS_RESTORE_FOR_PERSISTENCE:70,EB_POINT_QUERY_IN_ACT_FOR_ENCRYPTED_BACKUPS_RESTORE_FOR_INDEXING:71,EB_POINT_QUERY_IN_ACT_FOR_ENCRYPTED_BACKUPS_RESTORE_FOR_NEW_MEMBER_HYDRATION:72,EB_POINT_QUERY_IN_ACT_FOR_ENCRYPTED_BACKUPS_RESTORE_FOR_ECHO_TO_PROTO_CONVERSION:73,EB_POINT_QUERY_IN_ACT_FOR_PENDING_MESSAGE_RECOVERY_HISTORICAL_FUTURE_PROOF:74,EB_POINT_QUERY_IN_ACT_FOR_PENDING_MESSAGE_RECOVERY_REALTIME_BLOCKED:75,EB_POINT_QUERY_TO_FETCH_SENDER_DEVICE_KEYS:77,RESONANCE_UTILS:80,MPS_RESTORE_REVERB_RESTORE:81,REPORTING:82,CLIENT_MESSAGE_TRUNCATION:83,CALLING_XMA:84,EB_ACT_ATTACHMENT_RESTORE:85,EB_MEB_ATTACHMENT_ACCESS_CONTROL_RESTORE:86});f["default"]=a}),66);
__d("MAWEBRestoreTrackingUtils",["LSIntEnum","LSMEBTaskCreationSource","MAWQplProxy","MWEBODSEntityName.enum","ODS","QPLUserFlow","WAHashStringToNumber","justknobx","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j={dyi:c("justknobx")._("467"),frontloaded:20,initial:20,paginated:c("justknobx")._("3177"),point:1,search:c("justknobx")._("2477")};function a(a,b,e,f){b!=null&&p({querySource:e,runningInWorker:f!=null?f:!1,taskSource:a,traceId:b,triggerType:"paginated"}),(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore.request.paginated")}function b(a){var b=a.querySource,e=a.runningInWorker,f=a.taskSource;a=a.traceId;a!=null&&p({querySource:b,runningInWorker:e!=null?e:!1,taskSource:f,traceId:a,triggerType:"initial"});(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore.request.initial")}function e(a,b,e){b!=null&&p({querySource:"LS",runningInWorker:e!=null?e:!1,taskSource:a,traceId:b,triggerType:"dyi"}),(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore.request.dyi")}function f(a,b,e){b!=null&&p({querySource:"LS",runningInWorker:e!=null?e:!1,taskSource:a,traceId:b,triggerType:"frontloaded"}),(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore.request.frontloaded")}function k(a,b,e,f){b!=null&&p({querySource:e,runningInWorker:f!=null?f:!1,taskSource:a,traceId:b,triggerType:"point"}),(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore.request.point")}function l(a){var b=a.querySource,e=a.runningInWorker;a=a.traceId;a!=null&&p({querySource:b,runningInWorker:e!=null?e:!1,taskSource:c("LSMEBTaskCreationSource").FTS_INDEX_EB_MESSAGES_WEB,traceId:a,triggerType:"search"});(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore.request.search")}function m(a,b){a!=null&&(b!=null&&b?d("MAWQplProxy").sendQPLSuccessThroughBridge(c("qpl")._(521476165,"2432"),void 0,d("WAHashStringToNumber").hashStringToNumber(a)):c("QPLUserFlow").endSuccess(c("qpl")._(521476165,"2432"),{instanceKey:d("WAHashStringToNumber").hashStringToNumber(a)})),(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore.decryption.success")}function n(a,b,e,f){e===void 0&&(e="restore_failure"),a!=null&&(b!=null&&b?d("MAWQplProxy").sendQPLFailThroughBridge(c("qpl")._(521476165,"2432"),e,f,d("WAHashStringToNumber").hashStringToNumber(a)):c("QPLUserFlow").endFailure(c("qpl")._(521476165,"2432"),e,{annotations:f,instanceKey:d("WAHashStringToNumber").hashStringToNumber(a)})),(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore.decryption.failure")}function o(a){u("protobuf",a)}function p(a){var b=a.querySource,e=a.runningInWorker,f=a.taskSource,g=a.traceId;a=a.triggerType;if(e!=null&&e){var h;d("MAWQplProxy").startQplUserFlow(c("qpl")._(521476165,"2432"),{bool:{runningInWorker:e!=null?e:!1},"int":{requestedMessagesCount:(h=j[a])!=null?h:10},string:{querySource:b,taskSource:v(f),traceId:g,triggerType:a}},{providedInstanceKey:d("WAHashStringToNumber").hashStringToNumber(g),providedTimeoutInMs:c("justknobx")._("2950")})}else{c("QPLUserFlow").start(c("qpl")._(521476165,"2432"),{annotations:{bool:{runningInWorker:e!=null?e:!1},"int":{requestedMessagesCount:(h=j[a])!=null?h:10},string:{querySource:b,taskSource:v(f),traceId:g,triggerType:a}},instanceKey:d("WAHashStringToNumber").hashStringToNumber(g),timeoutInMs:c("justknobx")._("2950")})}}function q(a){var b=a.pointName;a=a.traceId;c("QPLUserFlow").addPoint(c("qpl")._(521476165,"2432"),b,{instanceKey:d("WAHashStringToNumber").hashStringToNumber(a)})}function r(a){var b=a.annotations,e=a.pointName;a=a.traceId;c("QPLUserFlow").addAnnotations(c("qpl")._(521476165,"2432"),b,{instanceKey:d("WAHashStringToNumber").hashStringToNumber(a)});c("QPLUserFlow").addPoint(c("qpl")._(521476165,"2432"),e,{instanceKey:d("WAHashStringToNumber").hashStringToNumber(a)})}function s(a){var b=a.annotations,e=a.pointName;a=a.traceId;a!=null&&d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(521476165,"2432"),e,{annotations:b,instanceKey:d("WAHashStringToNumber").hashStringToNumber(a)})}function t(a){var b=a.pointName;a=a.traceId;d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(521476165,"2432"),b,{instanceKey:d("WAHashStringToNumber").hashStringToNumber(a)})}function u(a,b){b=b?(i||(i=d("LSIntEnum"))).unwrapIntEnum(b):null;(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore."+a+"."+v(b))}function v(a){return(a=a==null?void 0:a.toString())!=null?a:"unknown"}g.markEBRestorePaginated=a;g.markEBRestoreInitial=b;g.markEBRestoreDYI=e;g.markEBRestoreFrontloaded=f;g.markEBRestorePoint=k;g.markEBRestoreSearch=l;g.markEBRestoreSuccess=m;g.markEBRestoreFail=n;g.markEBRestoreProtobuf=o;g.addQPLRestorePoint=q;g.addQPLRestorePointWithAnnotations=r;g.addQPLRestorePointWithAnnotationsWorker=s;g.addQPLRestorePointWorker=t}),98);
__d("MAWJobDefinitions",["MAWExternalId","MWPBumpEntityKey","WAArmadilloXMA.pb"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return a}function b(a){return a}e={acceptGroupInvite:function(a,b,c,d,e,f){f=i(f);return{args:{chatJid:a,inviteCode:d,invitedParticipantUserId:c,inviteExpirationTs:e,inviterUserId:b},scheduleConfig:f!=null?f:void 0,type:"acceptGroupInvite"}},addGroupParticipants:function(a,b,c,d){d=i(d);return{args:{group:a,s2sInstanceKey:c,users:b},scheduleConfig:d!=null?d:void 0,type:"addGroupParticipants"}},deleteMsgsForMe:function(a,b){b=i(b);return{args:{msgIds:a},scheduleConfig:b!=null?b:void 0,type:"deleteMsgsForMe"}},demoteGroupParticipants:function(a,b,c){c=i(c);return{args:{group:a,users:b},scheduleConfig:c!=null?c:void 0,type:"demoteGroupParticipants"}},downloadAndHandleMedia:function(a,b,c,d,e,f,g,h){f=i(h);return{args:{downloadType:e,hash:b,metricInstanceKeys:g,msgType:d,protocolMsgId:a,qplEntryPoint:c},scheduleConfig:f!=null?f:void 0,type:"downloadAndHandleMedia"}},forwardMsg:function(a,b,c,e,f,g,h){h=i(h);c=c!=null?c:{};var j=c.s2sInstanceKey;c.s2sUserFlowQPLEvent;c=babelHelpers.objectWithoutPropertiesLoose(c,["s2sInstanceKey","s2sUserFlowQPLEvent"]);return{args:{args:c,chatJid:a,ephemeralSetting:e,externalId:f!=null?f:d("MAWExternalId").generateExternalId(),isFirstMsg:g,protocolMsgId:b,s2sInstanceKey:j},scheduleConfig:h!=null?h:void 0,type:"forwardMsg"}},getSpams:function(a){a=i(a);return{args:void 0,scheduleConfig:a!=null?a:void 0,type:"getSpams"}},handleFutureproofMsg:function(a){a=i(a);return{args:{},scheduleConfig:a!=null?a:void 0,type:"handleFutureproofMsg"}},handleSpamMsg:function(a){a=i(a);return{args:void 0,scheduleConfig:a!=null?a:void 0,type:"handleSpamMsg"}},igdReportUserSpam:function(a,b){var c=a.chatJid,d=a.context,e=a.frxParams,f=a.frxTags,g=a.msgs,h=a.reportedMessageId,j=a.spamFlow;a=a.userJid;b=i(b);return{args:{chatJid:c,context:d,frxParams:e,frxTags:f,msgs:g,reportedMessageId:h,spamFlow:j,userJid:a},scheduleConfig:b!=null?b:void 0,type:"igdReportUserSpam"}},igdSendMsg:function(a,b){var c=a.actorID;a=a.taskID;b=i(b);return{args:{actorID:c,taskID:a},scheduleConfig:b!=null?b:void 0,type:"igdSendMsg"}},leaveGroups:function(a,b){b=i(b);return{args:{groups:a},scheduleConfig:b!=null?b:void 0,type:"leaveGroups"}},markThreadAsRead:function(a,b,c,d,e,f){f=i(f);return{args:{chatJid:a,isBlocked:c,isReadReceiptsDisabled:e,isRestricted:d,relationship:b},scheduleConfig:f!=null?f:void 0,type:"markThreadAsRead"}},promoteGroupParticipants:function(a,b,c){c=i(c);return{args:{group:a,users:b},scheduleConfig:c!=null?c:void 0,type:"promoteGroupParticipants"}},removeGroupParticipants:function(a,b,c){c=i(c);return{args:{group:a,users:b},scheduleConfig:c!=null?c:void 0,type:"removeGroupParticipants"}},reportUserSpam:function(a,b,c,d,e,f,g,h,j,k){j=i(j);return{args:{chatJid:c,context:f,frxParams:g,frxTags:e,isIgd:d,openMsgs:k,reportedMessageId:h,spamFlow:b,userJid:a},scheduleConfig:j!=null?j:void 0,type:"reportUserSpam"}},resendWrittenAppData:function(a,b){b=i(b);return{args:{appDataExternalId:a},scheduleConfig:b!=null?b:void 0,type:"resendWrittenAppData"}},restoreMessagesFromEncryptedBackups:function(a,b,c,d,e,f,g,h,j,k,l,m,n,o,p){n=i(n);return{args:{deanonApiPayload:o,hasMoreAfter:e,hasMoreBefore:d,instanceKey:k,isMediaGalleryRestore:p,isPointQuery:f,messages:c,minMsgId:g,optimisticMsgs:l,startSortKey:j,taskSource:m,threadId:b,traceId:h,transportKey:a},scheduleConfig:n!=null?n:void 0,type:"restoreMessagesFromEncryptedBackups"}},restoreProtobufsFromEncryptedBackups:function(a,b,c,d,e,f,g,h,j,k,l,m,n,o,p,q){m=i(m);return{args:{chatJid:q,deanonApiPayload:o,echoMessages:a,hasMoreAfter:f,hasMoreBefore:e,instanceKey:l,isMediaGalleryRestore:p,isPointQuery:g,messages:d,minMsgId:h,referenceTimestamp:k,requestId:j,taskSource:n,threadId:c,transportKey:b},scheduleConfig:m!=null?m:void 0,type:"restoreProtobufsFromEncryptedBackups"}},revokeMsgs:function(a,b){b=i(b);return{args:a,scheduleConfig:b!=null?b:void 0,type:"revokeMsgs"}},sendAppData:function(a,b,c){c=i(c);return{args:{args:a,externalId:b!=null?b:d("MAWExternalId").generateExternalId()},scheduleConfig:c!=null?c:void 0,type:"sendAppData"}},sendBumpMsg:function(a,b,c,e){e=i(e);return{args:{args:b,chatJid:a,externalId:c!=null?c:d("MAWExternalId").generateExternalId()},scheduleConfig:e!=null?e:void 0,type:"sendBumpMsg"}},sendGroupInviteMsg:function(a,b,c){c=i(c);return{args:{args:a,externalId:b!=null?b:d("MAWExternalId").generateExternalId()},scheduleConfig:c!=null?c:void 0,type:"sendGroupInviteMsg"}},sendMediaMsg:function(a,b,c,e,f,g,h,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){s=i(s);return{args:{args:{duration:k,ephemeralSetting:m,filename:u,height:g,isFirstMsg:q,isForwarded:p,isPtt:l,jpegThumbnail:e,jpegThumbnailHeight:j,jpegThumbnailWidth:h,mediaGroupMetadata:x,offlineAttachmentId:v,openMessageOtid:o,quote:n,s2sInstanceKey:c,source:t,width:f},attachmentType:w,chatJid:a,externalId:r!=null?r:d("MAWExternalId").generateExternalId(),file:b},scheduleConfig:s!=null?s:void 0,type:"sendMediaMsg"}},sendMediaMsgV2:function(a,b,c,e,f,g,h,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){s=i(s);return{args:{args:{duration:k,ephemeralSetting:m,filename:u,height:g,isFirstMsg:q,isForwarded:p,isPtt:l,jpegThumbnail:e,jpegThumbnailHeight:j,jpegThumbnailWidth:h,mediaGroupMetadata:y,offlineAttachmentId:v,openMessageOtid:o,quote:n,s2sInstanceKey:w,source:t,width:f},attachmentType:x,chatJid:a,externalId:r!=null?r:d("MAWExternalId").generateExternalId(),mimeType:b,plaintext:c},scheduleConfig:s!=null?s:void 0,type:"sendMediaMsgV2"}},sendWrittenAppData:function(a,b){b=i(b);return{args:{appDataExternalId:a},scheduleConfig:b!=null?b:void 0,type:"sendWrittenAppData"}},sendXMAShareMsg:function(a,b,c,e,f,g,h,j,k,l){g.xmaMessageType===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_RECEIVER_FETCH&&k.contentRef==null&&d("MWPBumpEntityKey").bumpEntityKey("maw.sendXMAShareMsg","content_ref_null_for_rf_xma");l=i(l);return{args:{args:g,associatedMsgContent:f,associatedMsgContentExternalId:j!=null?j:d("MAWExternalId").generateExternalId(),chatJid:a,faviconFile:e,headerFile:c,previewFile:b,xmaArgs:k,xmaMsgExternalId:h!=null?h:d("MAWExternalId").generateExternalId()},scheduleConfig:l!=null?l:void 0,type:"sendXMAShareMsg"}},setGroupMemberAddMode:function(a,b,c){c=i(c);return{args:{groupJid:a,memberAddMode:b},scheduleConfig:c!=null?c:void 0,type:"setGroupMemberAddMode"}},setGroupSubject:function(a,b,c){c=i(c);return{args:{group:a,subject:b},scheduleConfig:c!=null?c:void 0,type:"setGroupSubject"}},startInstamadilloDYI:function(a,b){b=i(b);return{args:{qplInstanceKey:a},scheduleConfig:b!=null?b:void 0,type:"startInstamadilloDYI"}},updateBackupEntFbidForMedia:function(a,b,c,d){d=i(d);return{args:{backupEntFbid:b,deliveryObjectId:a,traceId:c},scheduleConfig:d!=null?d:void 0,type:"updateBackupEntFbidForMedia"}}};function c(a,b){return h(a,b)}function h(a,b){var c=b.scheduleConfig,e=babelHelpers.objectWithoutPropertiesLoose(b,["scheduleConfig"]);c={args:{},scheduleConfig:c,type:a};b.externalIdJob&&(c.args.externalId=d("MAWExternalId").generateExternalId());c.args=babelHelpers["extends"]({},c.args,{},e);b.uniqueJob&&(c.uniqKey=a);return c}function i(a){if(a==null)return;return{jobId:a.jobId,maxTimeoutMs:a.maxTimeoutMs,priority:a.priority}}g.toThreadJidPrimaryId=a;g.toEncodedEchoMessage=b;g.jobSerializers=e;g.createStartJobInfo=c;g.createStartJobInfoGeneric=h;g.serializeJobScheduledConfig=i}),98);
__d("EBAPISharedUtils",["EBAPIQPLPoints","I64","LSAuthorityLevel","LSIntEnum","MAWBridgeSafeActionsWorkerAndUI","MAWRotateDTSG","MWEBODSEntityName.enum","ODS","WALogger","handleRestoreMessagesGraphQLResponse"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Echo to protobuf conversion failed in search range restore response: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] backup_id is null during graphQL restore"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] message range info is not complete - cannot proceed with graphQL restore"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] message range info is null - cannot proceed with graphQL restore"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] server side exception during graphql restore - ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] GQL worker range restore query returned null for message response"]);p=function(){return a};return a}function a(a,b){if(a!=null){b=b.filter(function(a){return(h||(h=d("I64"))).equal(a.authorityLevel,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))}).map(function(a){return(h||(h=d("I64"))).to_string(a.epochId)});return{backupId:a.backupId,device_id:a.deviceId,locally_available_epochs:b,mailboxRootKey:a.mailboxRootKeyBlob,ocmfClientStateBlob:a.ocmfClientStateBlob}}}function b(a){var b=a==null?void 0:a.backupTenancy;a=a==null?void 0:a.authorityLevel;return b==null||a==null?!1:(h||(h=d("I64"))).equal((i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE),a)}function q(a){var b=a.backupId,c=a.devicePrivateKeyBlob,d=a.devicePublicKeyBlob,e=a.epochAuthPrivateKeyBlob,f=a.epochAuthPublicKeyBlob,g=a.epochStoragePrivateKeyBlob,h=a.epochStoragePublicKeyBlob,i=a.mailboxRootKeyBlob,j=a.obliviousValidationTokenBlob,k=a.ocmfClientStateBlob;if(b!=null&&c!=null&&d!=null&&e!=null&&f!=null&&g!=null&&h!=null&&i!=null&&j!=null&&k!=null)return{authorityLevel:a.authorityLevel,backupId:b,backupTenancy:a.backupTenancy,deviceId:a.deviceId,devicePrivateKeyBlob:c,devicePublicKeyBlob:d,encryptionVersion:a.encryptionVersion,epochAuthPrivateKeyBlob:e,epochAuthPublicKeyBlob:f,epochStoragePrivateKeyBlob:g,epochStoragePublicKeyBlob:h,mailboxRootKeyBlob:i,obliviousValidationTokenBlob:j,ocmfClientStateBlob:k,revisionVersion:a.revisionVersion}}function r(a){var b=a.authorityLevel,c=a.backupId,d=a.epochAnonIdBlob,e=a.epochId,f=a.epochRootKeyBlob;a=a.epochStatus;if(b!=null&&c!=null&&d!=null&&e!=null&&f!=null&&a!=null)return{authorityLevel:b,backupId:c,epochAnonIdBlob:d,epochId:e,epochRootKeyBlob:f,epochStatus:a}}function e(a){var b=[],c=new Set(["epochId","authorityLevel","backupId","epochAnonIdBlob","epochRootKeyBlob","epochStatus"]);a=a.get("secure_encrypted_backups_epochs");if(a==null||(a==null?void 0:a.size)===0)return b;if(a!=null){a=a.entries();for(a of a){var d=a[0];a[1];d=d;if(d instanceof Object){d=Object.values(d);d=d[1];if(d instanceof Object){var e={};for(d of Object.entries(d)){var f=d[0],g=d[1];c.has(f)&&(e[f]=g)}f=r(e);f!=null&&b.push(f)}}}}return b}function f(a){a=a.get("secure_encrypted_backups_client_state");var b={};if(a==null||(a==null?void 0:a.size)===0)return;if(a!=null){a=a.entries();for(a of a){var c=a[0];a[1];c=c;if(c instanceof Object){c=Object.values(c);c=c[1];if(c instanceof Object)for(c of Object.entries(c)){var d=c[0],e=c[1];b[d]=e}}break}}d=q(b);return d}function s(a){(j||(j=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,a)}async function t(a,b,c,e,f,g,i,j,q,r,s,t){var u;d("EBAPIQPLPoints").ebAPIAddQPLPoint(b,c,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.GRAPHQL_QUERY_END,void 0,f);if(a==null||(a==null?void 0:(u=a.viewer)==null?void 0:(u=u.encrypted_backup)==null?void 0:u.mailbox)==null){d("EBAPIQPLPoints").ebAPIEndFailure(b,c,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE,f);return{response:"invalid-graphql-response",success:!1}}a=(u=a==null?void 0:(u=a.viewer)==null?void 0:(u=u.encrypted_backup)==null?void 0:(u=u.mailbox)==null?void 0:u.messages)!=null?u:a==null?void 0:(u=a.viewer)==null?void 0:(a=u.encrypted_backup)==null?void 0:(u=a.mailbox)==null?void 0:u.messages_point_restore;if(a==null){d("WALogger").ERROR(p());d("EBAPIQPLPoints").ebAPIEndFailure(b,c,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE,f);return{response:"invalid-graphql-response",success:!1}}u=a;if((u==null?void 0:u.encrypted_messages)==null){d("EBAPIQPLPoints").ebAPIEndFailure(b,c,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NULL_MESSAGES,f);return{response:"invalid-graphql-response",success:!1}}a=u.backup_id;var v=u.encrypted_messages,w=u.epoch_derivation_set,x=u.exception_string,y=u.message_range_info;u=u.should_delete_mailbox;if(x!=null){d("WALogger").ERROR(o(),x);u===!0&&d("EBAPIQPLPoints").ebAPIAddQPLPoint(b,c,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DELETE_MAILBOX,void 0,f);d("EBAPIQPLPoints").ebAPIEndFailure(b,c,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,f,{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,exception:x}});return{response:"server-side-exception",success:!1}}d("EBAPIQPLPoints").ebAPIAddQPLPoint(b,c,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DERIVE_AND_STORE_EPOCHS_START,void 0,f);await d("handleRestoreMessagesGraphQLResponse").deriveAndStoreEpochs(w,e,g,r,b);d("EBAPIQPLPoints").ebAPIAddQPLPoint(b,c,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DERIVE_AND_STORE_EPOCHS_END,void 0,f);if(y==null){d("WALogger").ERROR(n());d("EBAPIQPLPoints").ebAPIEndFailure(b,c,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO,f);return{response:"missing-message-range-info",success:!1}}if(y!=null){u=y.has_more_after;x=y.has_more_before;w=y.next_message_timestamp_ms_after;g=y.next_message_timestamp_ms_before;if(x==null||u==null||w==null||g==null){d("WALogger").ERROR(m());d("EBAPIQPLPoints").ebAPIEndFailure(b,c,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO,f);return{response:"missing-message-range-info",success:!1}}}a==null&&(d("WALogger").WARN(l()),d("EBAPIQPLPoints").ebAPIAddQPLPoint(b,c,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.BACKUP_ID_NULL,void 0,f));d("EBAPIQPLPoints").ebAPIAddQPLPoint(b,c,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.PROCESS_AND_DECRYPT_MESSAGES_START,void 0,f);x=await d("handleRestoreMessagesGraphQLResponse").processEncryptedMessagesWithoutPersisting({backupId:a!=null?a:(h||(h=d("I64"))).to_string(t),encryptedMessages:v,messageRangeInfo:y,qplEvent:c,runningInWorker:b,sortOrderMs:s,source:q,storage:e,threadId:i,traceId:r});d("EBAPIQPLPoints").ebAPIAddQPLPoint(b,c,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.PROCESS_AND_DECRYPT_MESSAGES_END,void 0,f);if(x==null){d("EBAPIQPLPoints").ebAPIEndFailure(b,c,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.EMPTY_DECRYPTION_RESPONSE,f);return{response:"empty-decryption-response",success:!1}}if(x.echoMessages!=null){u=x;w=u.echoMessages;d("EBAPIQPLPoints").ebAPIAddQPLPoint(b,c,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.ECHO_TO_PROTOBUF_CONVERSION_START,void 0,f);try{g=await d("MAWBridgeSafeActionsWorkerAndUI").sendAndReceiveBackendWorkerAndUIShared("convertEchoMessagesToEBProtobufs",{chatJid:j,encodedEchoMessages:w});d("EBAPIQPLPoints").ebAPIAddQPLPoint(b,c,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.ECHO_TO_PROTOBUF_CONVERSION_END,void 0,f);x=babelHelpers.extends({},x,{echoMessages:void 0,protobufMessages:(x.protobufMessages||[]).concat(g)})}catch(a){d("WALogger").ERROR(k(),a.message);d("EBAPIQPLPoints").ebAPIEndFailure(b,c,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.ECHO_TO_PROTOBUF_CONVERSION_FAILURE,f);return{response:"echo-to-protobuf-conversion-error",success:!1}}}d("EBAPIQPLPoints").ebAPIEndSuccess(b,c,f,{bool:{isEcho:((a=x)==null?void 0:a.echoMessages)?((t=x)==null?void 0:t.echoMessages.length)>0:!1,isProtobuf:((v=x)==null?void 0:v.protobufMessages)?((y=x)==null?void 0:y.protobufMessages.length)>0:!1}});return{response:x,success:!0}}function u(a){return a!=null&&a.message.indexOf("1357004")!==-1?d("MAWRotateDTSG").tryRotateDTSG().then(function(a){if(a)return"token-rotation-successful";else return"token-rotation-failed"}):Promise.resolve("token-rotation-not-required")}g.getDeviceAndKeyMetadata=a;g.isBackupTenancyAuthoritative=b;g.getAvailableEpochsFromPersistedEBSM=e;g.getClientStateFromPersistedEBSM=f;g.bumpOdsRestoreKey=s;g.constructEBRestoreResponse=t;g.handleDTSGTokenRotation=u}),98);
__d("EntMessageReplyType",[],(function(a,b,c,d,e,f){a=Object.freeze({REGULAR:0,BUMP:1});f["default"]=a}),66);
__d("LSHotEmojiSize",[],(function(a,b,c,d,e,f){a=Object.freeze({NONE:0,SMALL:1,MEDIUM:2,LARGE:3});f["default"]=a}),66);
__d("LSInternetConnectionState",[],(function(a,b,c,d,e,f){a=Object.freeze({NOT_CONNECTED:0,CONNECTED:1});f["default"]=a}),66);
__d("LSLoadThreadPkFromThreadId",["LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][loadThreadPkFromThreadId] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.filter(c.db.table(173).fetch(),function(b){return c.i64.to_string(b.jid)===a[0]}).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[13]=new c.Map(),d[13].set("error_code",c.i64.cast([0,100])),d[13].set("stored_procedure","LSEncryptedBackupsLoadThreadPkFromThreadIdStoredProcedure"),d[13].set("error_message",""),e=[void 0,d[13]],d[2]=e[0],d[3]=e[1],e):(b=a.item,e=[b.clientThreadPk,void 0],d[2]=e[0],d[3]=e[1],e)})},function(a){return c.i64.neq(d[2],void 0)?(a=[d[2],d[3]],d[5]=a[0],d[6]=a[1],a):(d[13]=new c.Map(),d[13].set("error_code",c.i64.cast([0,7])),d[13].set("stored_procedure","LSEncryptedBackupsLoadThreadPkFromThreadIdStoredProcedure"),d[13].set("error_message",""),c.i64.neq(void 0,void 0)?(a=[void 0,d[13]],d[14]=a[0],d[15]=a[1],a):(d[16]=new c.Map(),d[16].set("error_code",c.i64.cast([0,100])),d[16].set("stored_procedure","LSEncryptedBackupsLoadThreadPkFromThreadIdStoredProcedure"),d[16].set("error_message",""),a=[void 0,d[16]],d[14]=a[0],d[15]=a[1],a),a=[d[14],d[15]],d[5]=a[0],d[6]=a[1],a),d[7]=c.i64.of_float(Date.now()),d[8]=c.i64.random(),d[10]="Finishing execution. Execution time: ",d[11]=c.i64.to_string(c.i64.sub(d[7],d[0])),d[12]=" ms",d[9]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][loadThreadPkFromThreadId] ",d[9],d[10],d[9],d[11],d[9],d[12]].join("")),c.i64.eq(c.i64.mod_(d[8],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[13]=",",d[14]=c.createArray(),void 0!==void 0?d[15]=(d[14].push(void 0),d[14]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"loadThreadPkFromThreadId",[d[10],d[13],d[11],d[13],d[12]].join(""),d[14],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[5],d[6]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsLoadThreadPkFromThreadIdStoredProcedure";a.__tables__=["mi_act_mapping_table"];e.exports=a}),null);
__d("LSIssueMessageRangeQueryTaskStoredProcedure",["LSIssueMessageRangeQueryTask","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSIssueMessageRangeQueryTask"),e.threadId,e.numMessages,e.startSortKey,e.isPointQuery,e.traceId,e.newerNumMessages,e.source,e.includeOffset);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSLogWebQpl.nop",["requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("LogWebQplNOP").__setRef("LSLogWebQpl.nop");a=function(a,b,c,d,e,f,g,i){return h.load().then(function(a){return a.call(c,d,e,f,g,i)})};a.__nop_name__="LSLogWebQpl";g["default"]=a}),98);
__d("LSMessageReplySourceType",[],(function(a,b,c,d,e,f){a=Object.freeze({NONE:0,MESSAGE:1,STORY:2,FORWARD:3,FB_STORY_SHARE:4,IG_STORY_SHARE:5,LIGHTWEIGHT_STATUS:6,LIGHTWEIGHT_STATUS_REACTION:7,FB_FEED_POST:13,HIGHLIGHTS_TAB_POST_REPLY:14,HIGHLIGHTS_TAB_LOCAL_EVENT_REPLY:15,SHARED_ALBUM:16,AVATAR_DETAIL:17,NOTE_REPLY_ARMADILLO:18,HIGHLIGHTS_TAB_CARDS_FOR_MOM:19,HIGHLIGHTS_TAB_CARDS_FOR_BIRTHDAY:20,NOTE_MENTION:21,AI_PERSONA_NOTE_REPLY:26,AI_PERSONA_NOTE_REACTION:27,FB_MSGR_NOTE:28});f["default"]=a}),66);
__d("LSMessageReplySourceTypeV2",[],(function(a,b,c,d,e,f){a=Object.freeze({NONE:0,MESSAGE:1,STORY:2,FORWARD:3,FB_STORY_SHARE:4,IG_STORY_SHARE:5,STORY_BASE64_ENCODED:6,LIGHTWEIGHT_STATUS:7,CLOSE_FRIENDS:8,XMA:9,IG_NOTE:10,CLOSE_FRIENDS_NOTE_REPLY:11,LIGHTWEIGHT_STATUS_REACTION:12,FB_FEED_POST:13,HIGHLIGHTS_TAB_POST_REPLY:14,HIGHLIGHTS_TAB_LOCAL_EVENT_REPLY:15,SHARED_ALBUM:16,AVATAR_DETAIL:17,NOTE_REPLY_ARMADILLO:18,HIGHLIGHTS_TAB_CARDS_FOR_MOM:19,HIGHLIGHTS_TAB_CARDS_FOR_BIRTHDAY:20,NOTE_MENTION:21,FB_STORY_MENTION:22,EXPIRED_STORY:23,FB_PRODUCER_STORY_REPLY:24,FB_POST_MENTION:25,AI_PERSONA_NOTE_REPLY:26,AI_PERSONA_NOTE_REACTION:27,FB_MSGR_NOTE:28});f["default"]=a}),66);
__d("LSMessageSendStatus",[],(function(a,b,c,d,e,f){a=Object.freeze({NONE:0,SENDING_TO_SERVER:1,SERVER_RECEIVED:2,NON_RETRIABLE_ERROR:4,RETRIABLE_ERROR:5});f["default"]=a}),66);
__d("LSReplyMessageAttachmentType",[],(function(a,b,c,d,e,f){a=Object.freeze({OTHER:0,PHOTO:1,VIDEO:2,GIF:3,STICKER:4,LINK:5,MULTIPHOTO:6,PERMANENT_RAVEN_PHOTO:7,PERMANENT_RAVEN_VIDEO:8,AUDIO:10,ROLL_CALL_PHOTO_CONTRIBUTION:11,ROLL_CALL_VIDEO_CONTRIBUTION:12,FEED_POST:13,POWER_UP:14,XMA:15,ROLL_CALL_TEXT_CONTRIBUTION:16,BLOKS_XMA:17,EPHEMERAL_RAVEN_MESSAGE:18,THIRD_PARTY_STICKER:19,SOUND_BITE:9});f["default"]=a}),66);
__d("LSThreadMediaGalleryGroup",[],(function(a,b,c,d,e,f){a=Object.freeze({PHOTOS_AND_VIDEOS:0,FILES_ONLY:1,LINKS:2});f["default"]=a}),66);
__d("MAWAckLevel",["LSIntEnum","LSMessageSendStatus"],(function(a,b,c,d,e,f,g){"use strict";var h,i={clock:0,contentGone:-3,contentTooBig:-4,contentUnuploadable:-5,expired:-2,failed:-1,failedRetryable:-9,inactiveReceived:-6,partialOptimistic:-8,played:4,read:3,received:2,senderBackFillSent:-7,sent:1};function a(a){return a>0}function b(a){switch(a){case i.partialOptimistic:return(h||(h=d("LSIntEnum"))).ofNumber(0);case i.clock:return(h||(h=d("LSIntEnum"))).ofNumber(1);case i.sent:case i.received:case i.read:case i.played:return(h||(h=d("LSIntEnum"))).ofNumber(2);case i.failedRetryable:return(h||(h=d("LSIntEnum"))).ofNumber(5);default:return(h||(h=d("LSIntEnum"))).ofNumber(4)}}function e(a){switch(a){case i.partialOptimistic:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSMessageSendStatus").NONE);case i.clock:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSMessageSendStatus").SENDING_TO_SERVER);case i.sent:case i.received:case i.read:case i.played:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSMessageSendStatus").SERVER_RECEIVED);case i.failedRetryable:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSMessageSendStatus").RETRIABLE_ERROR);default:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSMessageSendStatus").NON_RETRIABLE_ERROR)}}g.ACK=i;g.isMsgAuthoritative=a;g.levelToMessagingSendStatusV2=b;g.levelToMessagingSendStatus=e}),98);
__d("MAWAdminMsgType",[],(function(a,b,c,d,e,f){"use strict";a="currentUserAddedDevice";b="participantAddedDevice";c="currentUserRemovedDevice";d="participantRemovedDevice";e="currentUserUpdatedDevice";var g="participantUpdatedDevice",h="participantAddedYou",i="participantAddedYouAndOneUser",j="participantAddedYouAndMoreThanOneUsers",k="unknowUserAddedYou",l="unknowUserAddedYouAndOneUser",m="unknowUserAddedYouAndMoreThanOneUser",n="unknownUserAddedOneUser",o="unknownUserAddedTwoUser",p="unknownUserAddedMoreThanTwoUser",q="participantAddedOneUser",aa="participantAddedTwoUser",ba="participantAddedMoreThanTwoUser",ca="currentUserRemovedOneParticipant",da="currentUserRemovedTwoParticipant",ea="currentUserRemovedMoreThanTwoParticipant",fa="currentUserAddedOneParticipant",ga="currentUserAddedTwoParticipant",r="currentUserAddedMoreThanTwoParticipant",ha="participantRemovedYou",ia="participantRemovedYouAndOneUser",ja="participantRemovedYouAndMoreThanOneUsers",ka="unknowUserRemovedYou",la="unknowUserRemovedYouAndOneUser",ma="unknowUserRemovedYouAndMoreThanOneUser",na="unknownUserRemovedOneUser",oa="unknownUserRemovedTwoUser",pa="unknownUserRemovedMoreThanTwoUser",qa="participantRemovedOneUser",ra="participantRemovedTwoUser",sa="participantRemovedMoreThanTwoUser",ta="participantLeftGroup",ua="currentUserLeftGroup",va="participantCustomizeParticipantNickname",wa="participantClearParticipantNickname",xa="participantCustomizeCurrentUserNickname",ya="currentUserSetOwnNickname",za="currentUserClearOwnNickname",Aa="currentUserClearParticipantNickname",Ba="participantSetOwnNickname",Ca="participantClearOwnNickname",Da="participantClearCurrentUserNickname",Ea="currentUserCustomizeNickname",Fa="currentUserNamedGroup",Ga="unkonwnUserNamedGroup",Ha="participantNamedGroup",Ia="currentUserCustomizeHotlike",Ja="participantCustomizeHotlike",Ka="currentUserCustomizeTheme",La="currentUserCustomizeAITheme",Ma="currentUserCustomizePhoto",Na="participantCustomizeTheme",Oa="participantCustomizeAITheme",Pa="participantCustomizePhoto",Qa="currentUserSetAddModeAdminOnly",Ra="currentUserSetAddModeAllMembers",Sa="participantSetAddModeAdminOnly",Ta="participantSetAddModeAllMembers",Ua="serverSetAddModeAdminOnly",Va="serverSetAddModeAllMembers",s="currentUserPinnedMessage",t="currentUserUnpinnedMessage",u="participantPinnedMessage",v="participantUnpinnedMessage",w="currentUserLimitSharingDisabled",x="currentUserLimitSharingEnabled",y="participantLimitSharingDisabled",z="participantLimitSharingEnabled",A="cutoverThreadAdminMessage",B="cutoverIGDThreadAdminMessage",C="cutoverRollbackAdminMessage",D="dualThreadCutoverAdminMessage",E="e2eeThreadDescription",F="e2eeThreadUKOSAAdminMessage",Wa="debugMsg",Xa="reachabilityError",Ya="twoUsersConnected",Za="twoUsersConnectedOneMSplit",G="CurrentUserCreatedPoll",H="ParticipantCreatedPoll",I="CurrentUserAddedPollOption",J="ParticipantAddedPollOption",K="CurrentUserAddedMultiplePollOptions",L="ParticipantAddedMultiplePollOptions",M="CurrentUserAddedPollVote",N="ParticipantAddedPollVote",O="CurrentUserAddedMultiplePollVotes",P="ParticipantAddedMultiplePollVotes",Q="CurrentUserRemovedPollVote",R="ParticipantRemovedPollVote",S="CurrentUserRemovedMultiplePollVotes",T="ParticipantRemovedMultiplePollVotes",U="CurrentUserMixedPollUpdate",V="ParticipantMixedPollUpdate",W="CurrentUserChangedPollVote",X="ParticipantChangedPollVote",Y="CurrentUserChangedMultiplePollVotes",Z="ParticipantChangedMultiplePollVotes",$="PollUnsentUpdate";r={CURRENT_USER_ADDED_DEVICE:a,CURRENT_USER_ADDED_MORE_THAN_TWO_PARTICIPANTS:r,CURRENT_USER_ADDED_MULTIPLE_POLL_OPTIONS:K,CURRENT_USER_ADDED_MULTIPLE_POLL_VOTES:O,CURRENT_USER_ADDED_ONE_PARTICIPANT:fa,CURRENT_USER_ADDED_POLL_OPTION:I,CURRENT_USER_ADDED_POLL_VOTE:M,CURRENT_USER_ADDED_TWO_PARTICIPANTS:ga,CURRENT_USER_CHANGED_MULTIPLE_POLL_VOTES:Y,CURRENT_USER_CHANGED_POLL_VOTE:W,CURRENT_USER_CLEAR_OWN_NICKNAME:za,CURRENT_USER_CLEAR_PARTICIPANT_NICKNAME:Aa,CURRENT_USER_CREATED_POLL:G,CURRENT_USER_CUSTOMIZE_AI_THEME:La,CURRENT_USER_CUSTOMIZE_HOTLIKE:Ia,CURRENT_USER_CUSTOMIZE_NICKNAME:Ea,CURRENT_USER_CUSTOMIZE_PHOTO:Ma,CURRENT_USER_CUSTOMIZE_THEME:Ka,CURRENT_USER_LEFT_GROUP:ua,CURRENT_USER_LIMIT_SHARING_DISABLED:w,CURRENT_USER_LIMIT_SHARING_ENABLED:x,CURRENT_USER_MIXED_POLL_UPDATE:U,CURRENT_USER_NAMED_GROUP:Fa,CURRENT_USER_PINNED_MESSAGE:s,CURRENT_USER_REMOVED_DEVICE:c,CURRENT_USER_REMOVED_MORE_THAN_TWO_PARTICIPANTS:ea,CURRENT_USER_REMOVED_MULTIPLE_POLL_VOTES:S,CURRENT_USER_REMOVED_ONE_PARTICIPANT:ca,CURRENT_USER_REMOVED_POLL_VOTE:Q,CURRENT_USER_REMOVED_TWO_PARTICIPANTS:da,CURRENT_USER_SET_ADD_MODE_ADMIN_ONLY:Qa,CURRENT_USER_SET_ADD_MODE_ALL_MEMBERS:Ra,CURRENT_USER_SET_OWN_NICKNAME:ya,CURRENT_USER_UNPINNED_MESSAGE:t,CURRENT_USER_UPDATED_DEVICE:e,CUTOVER_IGD_THREAD_ADMIN_MESSAGE:B,CUTOVER_ROLLBACK_ADMIN_MESSAGE:C,CUTOVER_THREAD_ADMIN_MESSAGE:A,DEBUG_MSG:Wa,DUAL_THREAD_CUTOVER_ADMIN_MESSAGE:D,E2EE_THREAD_DESCRIPTION:E,E2EE_THREAD_UK_OSA_ADMIN_MESSAGE:F,PARTICIPANT_ADDED_DEVICE:b,PARTICIPANT_ADDED_MORE_THAN_TWO_USER:ba,PARTICIPANT_ADDED_MULTIPLE_POLL_OPTIONS:L,PARTICIPANT_ADDED_MULTIPLE_POLL_VOTES:P,PARTICIPANT_ADDED_ONE_USER:q,PARTICIPANT_ADDED_POLL_OPTION:J,PARTICIPANT_ADDED_POLL_VOTE:N,PARTICIPANT_ADDED_TWO_USER:aa,PARTICIPANT_ADDED_YOU:h,PARTICIPANT_ADDED_YOU_AND_MORE_THAN_ONE_USERS:j,PARTICIPANT_ADDED_YOU_AND_ONE_USER:i,PARTICIPANT_CHANGED_MULTIPLE_POLL_VOTES:Z,PARTICIPANT_CHANGED_POLL_VOTE:X,PARTICIPANT_CLEAR_CURRENT_USER_NICKNAME:Da,PARTICIPANT_CLEAR_OWN_NICKNAME:Ca,PARTICIPANT_CLEAR_PARTICIPANT_NICKNAME:wa,PARTICIPANT_CREATED_POLL:H,PARTICIPANT_CUSTOMIZE_AI_THEME:Oa,PARTICIPANT_CUSTOMIZE_CURRENT_USER_NICKNAME:xa,PARTICIPANT_CUSTOMIZE_HOTLIKE:Ja,PARTICIPANT_CUSTOMIZE_PARTICIPANT_NICKNAME:va,PARTICIPANT_CUSTOMIZE_PHOTO:Pa,PARTICIPANT_CUSTOMIZE_THEME:Na,PARTICIPANT_LEFT_GROUP:ta,PARTICIPANT_LIMIT_SHARING_DISABLED:y,PARTICIPANT_LIMIT_SHARING_ENABLED:z,PARTICIPANT_MIXED_POLL_UPDATE:V,PARTICIPANT_NAMED_GROUP:Ha,PARTICIPANT_PINNED_MESSAGE:u,PARTICIPANT_REMOVED_DEVICE:d,PARTICIPANT_REMOVED_MORE_THAN_TWO_USER:sa,PARTICIPANT_REMOVED_MULTIPLE_POLL_VOTES:T,PARTICIPANT_REMOVED_ONE_USER:qa,PARTICIPANT_REMOVED_POLL_VOTE:R,PARTICIPANT_REMOVED_TWO_USER:ra,PARTICIPANT_REMOVED_YOU:ha,PARTICIPANT_REMOVED_YOU_AND_MORE_THAN_ONE_USERS:ja,PARTICIPANT_REMOVED_YOU_AND_ONE_USER:ia,PARTICIPANT_SET_ADD_MODE_ADMIN_ONLY:Sa,PARTICIPANT_SET_ADD_MODE_ALL_MEMBERS:Ta,PARTICIPANT_SET_OWN_NICKNAME:Ba,PARTICIPANT_UNPINNED_MESSAGE:v,PARTICIPANT_UPDATED_DEVICE:g,POLL_UNSENT_UPDATE:$,REACHABILITY_ERROR:Xa,SERVER_SET_ADD_MODE_ADMIN_ONLY:Ua,SERVER_SET_ADD_MODE_ALL_MEMBERS:Va,TWO_USERS_CONNECTED:Ya,TWO_USERS_CONNECTED_ONE_MSPLIT:Za,UNKNOWN_USER_ADDED_MORE_THAN_TWO_USER:p,UNKNOWN_USER_ADDED_ONE_USER:n,UNKNOWN_USER_ADDED_TWO_USER:o,UNKNOWN_USER_ADDED_YOU:k,UNKNOWN_USER_ADDED_YOU_AND_MORE_THAN_ONE_USER:m,UNKNOWN_USER_ADDED_YOU_AND_ONE_USER:l,UNKNOWN_USER_NAMED_GROUP:Ga,UNKNOWN_USER_REMOVED_MORE_THAN_TWO_USER:pa,UNKNOWN_USER_REMOVED_ONE_USER:na,UNKNOWN_USER_REMOVED_TWO_USER:oa,UNKNOWN_USER_REMOVED_YOU:ka,UNKNOWN_USER_REMOVED_YOU_AND_MORE_THAN_ONE_USER:ma,UNKNOWN_USER_REMOVED_YOU_AND_ONE_USER:la};f.CURRENT_USER_ADDED_DEVICE=a;f.CURRENT_USER_PINNED_MESSAGE=s;f.CURRENT_USER_UNPINNED_MESSAGE=t;f.PARTICIPANT_PINNED_MESSAGE=u;f.PARTICIPANT_UNPINNED_MESSAGE=v;f.CURRENT_USER_LIMIT_SHARING_DISABLED=w;f.CURRENT_USER_LIMIT_SHARING_ENABLED=x;f.PARTICIPANT_LIMIT_SHARING_DISABLED=y;f.PARTICIPANT_LIMIT_SHARING_ENABLED=z;f.CUTOVER_THREAD_ADMIN_MESSAGE=A;f.CUTOVER_IGD_THREAD_ADMIN_MESSAGE=B;f.CUTOVER_ROLLBACK_ADMIN_MESSAGE=C;f.DUAL_THREAD_CUTOVER_ADMIN_MESSAGE=D;f.E2EE_THREAD_DESCRIPTION=E;f.E2EE_THREAD_UK_OSA_ADMIN_MESSAGE=F;f.CURRENT_USER_CREATED_POLL=G;f.PARTICIPANT_CREATED_POLL=H;f.CURRENT_USER_ADDED_POLL_OPTION=I;f.PARTICIPANT_ADDED_POLL_OPTION=J;f.CURRENT_USER_ADDED_MULTIPLE_POLL_OPTIONS=K;f.PARTICIPANT_ADDED_MULTIPLE_POLL_OPTIONS=L;f.CURRENT_USER_ADDED_POLL_VOTE=M;f.PARTICIPANT_ADDED_POLL_VOTE=N;f.CURRENT_USER_ADDED_MULTIPLE_POLL_VOTES=O;f.PARTICIPANT_ADDED_MULTIPLE_POLL_VOTES=P;f.CURRENT_USER_REMOVED_POLL_VOTE=Q;f.PARTICIPANT_REMOVED_POLL_VOTE=R;f.CURRENT_USER_REMOVED_MULTIPLE_POLL_VOTES=S;f.PARTICIPANT_REMOVED_MULTIPLE_POLL_VOTES=T;f.CURRENT_USER_MIXED_POLL_UPDATE=U;f.PARTICIPANT_MIXED_POLL_UPDATE=V;f.CURRENT_USER_CHANGED_POLL_VOTE=W;f.PARTICIPANT_CHANGED_POLL_VOTE=X;f.CURRENT_USER_CHANGED_MULTIPLE_POLL_VOTES=Y;f.PARTICIPANT_CHANGED_MULTIPLE_POLL_VOTES=Z;f.POLL_UNSENT_UPDATE=$;f.ADMIN_MSG_TYPE=r}),66);
__d("MAWLocalizationType",["MAWAdminMsgType"],(function(a,b,c,d,e,f,g){"use strict";a="emptySnippet";b="currentUserCreatedGroup";c="participantCreatedGroup";e="unknownUserCreatedGroup";f="currentUserGotPromoted";var h="currentUserGotDemoted",i="participantGotPromoted",j="participantGotDemoted",k="participantPromotedYou",l="participantDemotedYou",m="currentUserPromotedParticipant",n="currentUserDemotedParticipant",o="participantDemotedParticipant",p="participantPromotedParticipant",q="participantSelfDemoted",r="currentUserSelfDemoted",s="currentUserSendText",t="currentUserSendImage",u="currentUserSendVideo",v="currentUserSendAudio",w="currentUserSendGif",x="currentUserSendSticker",y="participantSendText",z="participantSendTextInGroup",A="participantSendImage",B="participantSendVideo",C="participantSendAudio",D="participantSendGif",E="participantSendSticker",F="unavailableSnippet",G="unknownUserEphemeralSettingTurnedOnSeconds",H="unknownUserEphemeralSettingTurnedOnMinutes",I="unknownUserEphemeralSettingTurnedOnHours",J="unknownUserEphemeralSettingTurnedOnDays",K="youEphemeralSettingTurnedOnSeconds",L="youEphemeralSettingTurnedOnMinutes",M="youEphemeralSettingTurnedOnHours",N="youEphemeralSettingTurnedOnDays",O="participantEphemeralSettingTurnedOnSeconds",P="participantEphemeralSettingTurnedOnMinutes",Q="participantEphemeralSettingTurnedOnHours",R="participantEphemeralSettingTurnedOnDays",S="unknownUserEphemeralSettingChangeSeconds",T="unknownUserEphemeralSettingChangeMinutes",U="unknownUserEphemeralSettingChangeHours",V="unknownUserEphemeralSettingChangeDays",W="youEphemeralSettingChangeSeconds",X="youEphemeralSettingChangeMinutes",Y="youEphemeralSettingChangeHours",aa="youEphemeralSettingChangeDays",ba="participantEphemeralSettingChangeSeconds",ca="participantEphemeralSettingChangeMinutes",da="participantEphemeralSettingChangeHours",ea="participantEphemeralSettingChangeDays",fa="unknownUserEphemeralSettingTurnedOff",ga="youEphemeralSettingTurnedOff",ha="participantEphemeralSettingTurnedOff",ia="ephemeralSettingsAutoReset",ja="currentUserUnsentMessage",ka="participantUnsentMessage",la="participantReactMessage",ma="participantReactMessageInGroup",Z="unknownUserEphemeralTakeScreenshot",na="unknownUserEphemeralRecordScreen",oa="youEphemeralTakeScreenshot",pa="youEphemeralRecordScreen",qa="participantEphemeralTakeScreenshot",ra="participantEphemeralRecordScreen",sa="icdcAlertAdminMessage",ta="yourDeviceICDCAlertAdminMessage",$="currentUserSendAttachment",ua="participantSendAttachment",va="currentUserSentPost",wa="currentUserSentReel",xa="currentUserSentStory",ya="currentUserSentEvent",za="currentUserMentionedStoryIG",Aa="currentUserReceivedStoryMentionIG",Ba="participantSentPost",Ca="participantSentReel",Da="participantSentStory",Ea="participantSentEvent",Fa="currentUserSentStoryHighlight",Ga="participantSentStoryHighlight",Ha="currentUserMissedAudioCall",Ia="participantMissedAudioCall",Ja="currentUserMissedVideoCall",Ka="participantMissedVideoCall",La="currentUserAudioCalled",Ma="participantAudioCalled",Na="currentUserVideoCalled",Oa="participantVideoCalled",Pa="currentUserStartedGroupAudioCall",Qa="participantStartedGroupAudioCall",Ra="currentUserStartedGroupVideoCall",Sa="participantStartedGroupVideoCall",Ta="currentUserBumpedOwnMessage",Ua="currentUserBumpedMessage",Va="participantBumpedOwnMessage",Wa="participantBumpedParticipantMessage",Xa="participantBumpedCurrentUserMessage",Ya="userSendUnavailableMessage",Za="userSendEncryptedMessage",$a="currentUserSendUnrenderableMessage",ab="participantSendUnrenderableMessage",bb="currentUserSendLocationFallback",cb="participantSendLocation",db="currentUserSendLiveLocationFallback",eb="participantSendLiveLocation",fb="currentUserSendLocation",gb="participantSendLocation",hb="currentUserSendPollCreationFallback",ib="participantSendPollCreation",jb="currentUserSendContactShareFallback",kb="participantSendContactShareFallback",lb="currentUserSendContactShare",mb="participantSendContactShare",nb="currentUserSendAIContactShare",ob="participantSendAIContactShare",pb="currentUserSendStoryMentionFallback",qb="currentUserSendStoryMention",rb="participantSendStoryMention",sb="participantSendStoryMentionFallback",tb="currentUserSendPostMentionFallback",ub="participantSendPostMentionFallback",vb="currentUserSendMemoriesShare",wb="participantSendMemoriesShare",xb="currentUserSendPostMention",yb="participantSendPostMention",zb="currentUserSendNoteMentionFallback",Ab="participantSendNoteMentionFallback",Bb="messengerMemoryEncryptedMessageFallback",Cb="rtcXMAMessageFallback",Db="metaAISendMessageFallback",Eb="currentUserSendBumpMessageFallback",Fb="participantSendBumpMessageFallback",Gb="participantSendBumpMessageOriginalUnavailable",Hb="currentUserSendStickerReceiverFetchMessageFallback",Ib="participantSendStickerReceiverFetchMessageFallback",Jb="viewOncePhotoMessageFallback",Kb="viewOnceVideoMessageFallback",Lb="unavailableStory",Mb="currentUserLimitSharingDisabled",Nb="currentUserLimitSharingEnabled",Ob="participantLimitSharingDisabled",Pb="participantLimitSharingEnabled";d=babelHelpers["extends"]({},d("MAWAdminMsgType").ADMIN_MSG_TYPE,{CURRENT_USER_AUDIO_CALLED:La,CURRENT_USER_BUMPED_MESSAGE:Ua,CURRENT_USER_BUMPED_OWN_MESSAGE:Ta,CURRENT_USER_CREATED_GROUP:b,CURRENT_USER_DEMOTED_PARTICIPANT:n,CURRENT_USER_GOT_DEMOTED:h,CURRENT_USER_GOT_PROMOTED:f,CURRENT_USER_LIMIT_SHARING_DISABLED:Mb,CURRENT_USER_LIMIT_SHARING_ENABLED:Nb,CURRENT_USER_MENTIONED_STORY_IG:za,CURRENT_USER_MISSED_AUDIO_CALL:Ha,CURRENT_USER_MISSED_VIDEO_CALL:Ja,CURRENT_USER_PROMOTED_PARTICIPANT:m,CURRENT_USER_RECEIVED_STORY_MENTION_IG:Aa,CURRENT_USER_SELF_DEMOTED:r,CURRENT_USER_SEND_AI_CONTACT_SHARE:nb,CURRENT_USER_SEND_ATTACHMENT:$,CURRENT_USER_SEND_AUDIO:v,CURRENT_USER_SEND_BUMP_MESSAGE_FALLBACK:Eb,CURRENT_USER_SEND_CONTACT_SHARE:lb,CURRENT_USER_SEND_CONTACT_SHARE_FALLBACK:jb,CURRENT_USER_SEND_GIF:w,CURRENT_USER_SEND_IMAGE:t,CURRENT_USER_SEND_LIVE_LOCATION_FALLBACK:db,CURRENT_USER_SEND_LOCATION:fb,CURRENT_USER_SEND_LOCATION_FALLBACK:bb,CURRENT_USER_SEND_MEMORIES_SHARE:vb,CURRENT_USER_SEND_NOTE_MENTION_FALLBACK:zb,CURRENT_USER_SEND_POLL_CREATION_FALLBACK:hb,CURRENT_USER_SEND_POST_MENTION:xb,CURRENT_USER_SEND_POST_MENTION_FALLBACK:tb,CURRENT_USER_SEND_STICKER:x,CURRENT_USER_SEND_STICKER_RECEIVER_FETCH_MESSAGE_FALLBACK:Hb,CURRENT_USER_SEND_STORY_MENTION:qb,CURRENT_USER_SEND_STORY_MENTION_FALLBACK:pb,CURRENT_USER_SEND_TEXT:s,CURRENT_USER_SEND_UNRENDERABLE_MESSAGE_FALLBACK:$a,CURRENT_USER_SEND_VIDEO:u,CURRENT_USER_SENT_EVENT:ya,CURRENT_USER_SENT_POST:va,CURRENT_USER_SENT_REEL:wa,CURRENT_USER_SENT_STORY:xa,CURRENT_USER_SENT_STORY_HIGHLIGHT:Fa,CURRENT_USER_STARTED_GROUP_AUDIO_CALL:Pa,CURRENT_USER_STARTED_GROUP_VIDEO_CALL:Ra,CURRENT_USER_UNSENT_MESSAGE:ja,CURRENT_USER_VIDEO_CALLED:Na,EMPTY_SNIPPET:a,EPHEMERAL_SETTINGS_AUTO_RESET:ia,ICDC_ALERT_ADMIN_MESSAGE:sa,MESSENGER_MEMORY_ENCRYPTED_MESSAGE_FALLBACK:Bb,META_AI_SEND_MESSAGE_FALLBACK:Db,PARTICIPANT_AUDIO_CALLED:Ma,PARTICIPANT_BUMPED_CURRENT_USER_MESSAGE:Xa,PARTICIPANT_BUMPED_OWN_MESSAGE:Va,PARTICIPANT_BUMPED_PARTICIPANT_MESSAGE:Wa,PARTICIPANT_CREATED_GROUP:c,PARTICIPANT_DEMOTED_PARTICIPANT:o,PARTICIPANT_DEMOTED_YOU:l,PARTICIPANT_EPHEMERAL_RECORD_SCREEN:ra,PARTICIPANT_EPHEMERAL_SETTING_CHANGE_DAYS:ea,PARTICIPANT_EPHEMERAL_SETTING_CHANGE_HOURS:da,PARTICIPANT_EPHEMERAL_SETTING_CHANGE_MINUTES:ca,PARTICIPANT_EPHEMERAL_SETTING_CHANGE_SECONDS:ba,PARTICIPANT_EPHEMERAL_SETTING_TURNED_OFF:ha,PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_DAYS:R,PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_HOURS:Q,PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_MINUTES:P,PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_SECONDS:O,PARTICIPANT_EPHEMERAL_TAKE_SCREENSHOT:qa,PARTICIPANT_GOT_DEMOTED:j,PARTICIPANT_GOT_PROMOTED:i,PARTICIPANT_LIMIT_SHARING_DISABLED:Ob,PARTICIPANT_LIMIT_SHARING_ENABLED:Pb,PARTICIPANT_MISSED_AUDIO_CALL:Ia,PARTICIPANT_MISSED_VIDEO_CALL:Ka,PARTICIPANT_PROMOTED_PARTICIPANT:p,PARTICIPANT_PROMOTED_YOU:k,PARTICIPANT_REACT_MESSAGE:la,PARTICIPANT_REACT_MESSAGE_IN_GROUP:ma,PARTICIPANT_SELF_DEMOTED:q,PARTICIPANT_SEND_AI_CONTACT_SHARE:ob,PARTICIPANT_SEND_ATTACHMENT:ua,PARTICIPANT_SEND_AUDIO:C,PARTICIPANT_SEND_BUMP_MESSAGE:Fb,PARTICIPANT_SEND_BUMP_MESSAGE_ORIGINAL_UNAVAILABLE_FALLBACK:Gb,PARTICIPANT_SEND_CONTACT_SHARE:mb,PARTICIPANT_SEND_CONTACT_SHARE_FALLBACK:kb,PARTICIPANT_SEND_GIF:D,PARTICIPANT_SEND_IMAGE:A,PARTICIPANT_SEND_LIVE_LOCATION_FALLBACK:eb,PARTICIPANT_SEND_LOCATION:gb,PARTICIPANT_SEND_LOCATION_FALLBACK:cb,PARTICIPANT_SEND_MEMORIES_SHARE:wb,PARTICIPANT_SEND_NOTE_MENTION_FALLBACK:Ab,PARTICIPANT_SEND_POLL_CREATION_FALLBACK:ib,PARTICIPANT_SEND_POST_MENTION:yb,PARTICIPANT_SEND_POST_MENTION_FALLBACK:ub,PARTICIPANT_SEND_STICKER:E,PARTICIPANT_SEND_STICKER_RECEIVER_FETCH_MESSAGE_FALLBACK:Ib,PARTICIPANT_SEND_STORY_MENTION:rb,PARTICIPANT_SEND_STORY_MENTION_FALLBACK:sb,PARTICIPANT_SEND_TEXT:y,PARTICIPANT_SEND_TEXT_IN_GROUP:z,PARTICIPANT_SEND_UNRENDERABLE_MESSAGE_FALLBACK:ab,PARTICIPANT_SEND_VIDEO:B,PARTICIPANT_SENT_EVENT:Ea,PARTICIPANT_SENT_POST:Ba,PARTICIPANT_SENT_REEL:Ca,PARTICIPANT_SENT_STORY:Da,PARTICIPANT_SENT_STORY_HIGHLIGHT:Ga,PARTICIPANT_STARTED_GROUP_AUDIO_CALL:Qa,PARTICIPANT_STARTED_GROUP_VIDEO_CALL:Sa,PARTICIPANT_UNSENT_MESSAGE:ka,PARTICIPANT_VIDEO_CALLED:Oa,RTC_XMA_FALLBACK:Cb,UNAVAILABLE_SNIPPET:F,UNAVAILABLE_STORY:Lb,UNKNOWN_USER_CREATED_GROUP:e,UNKNOWN_USER_EPHEMERAL_RECORD_SCREEN:na,UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_DAYS:V,UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_HOURS:U,UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_MINUTES:T,UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_SECONDS:S,UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_OFF:fa,UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_DAYS:J,UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_HOURS:I,UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_MINUTES:H,UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_SECONDS:G,UNKNOWN_USER_EPHEMERAL_TAKE_SCREENSHOT:Z,USER_SEND_ENCRYPTED_MESSAGE_FALLBACK:Za,USER_SEND_UNAVAILABLE_MESSAGE_FALLBACK:Ya,VIEW_ONCE_PHOTO_MESSAGE:Jb,VIEW_ONCE_VIDEO_MESSAGE:Kb,YOU_EPHEMERAL_RECORD_SCREEN:pa,YOU_EPHEMERAL_SETTING_CHANGE_DAYS:aa,YOU_EPHEMERAL_SETTING_CHANGE_HOURS:Y,YOU_EPHEMERAL_SETTING_CHANGE_MINUTES:X,YOU_EPHEMERAL_SETTING_CHANGE_SECONDS:W,YOU_EPHEMERAL_SETTING_TURNED_OFF:ga,YOU_EPHEMERAL_SETTING_TURNED_ON_DAYS:N,YOU_EPHEMERAL_SETTING_TURNED_ON_HOURS:M,YOU_EPHEMERAL_SETTING_TURNED_ON_MINUTES:L,YOU_EPHEMERAL_SETTING_TURNED_ON_SECONDS:K,YOU_EPHEMERAL_TAKE_SCREENSHOT:oa,YOUR_DEVICE_ICDC_ALERT_ADMIN_MESSAGE:ta});g.CURRENT_USER_CREATED_GROUP=b;g.CURRENT_USER_SEND_TEXT=s;g.CURRENT_USER_SEND_IMAGE=t;g.CURRENT_USER_SEND_VIDEO=u;g.CURRENT_USER_SEND_AUDIO=v;g.CURRENT_USER_SEND_GIF=w;g.CURRENT_USER_SEND_STICKER=x;g.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_SECONDS=G;g.UNKNOWN_USER_EPHEMERAL_TAKE_SCREENSHOT=Z;g.CURRENT_USER_SEND_ATTACHMENT=$;g.LOCALIZATION_TYPE=d}),98);
__d("MAWAdminMsgNormalized",["MAWLocalizationType"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){switch(a){case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_ONE_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_ONE_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_LEFT_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_PROMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_DEMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_PHOTO:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_PINNED_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UNPINNED_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_UK_OSA_ADMIN_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_GOT_PROMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_GOT_DEMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_PROMOTED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_DEMOTED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_PROMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SELF_DEMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_DEMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UPDATED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CLEAR_PARTICIPANT_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CLEAR_OWN_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CLEAR_CURRENT_USER_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_TAKE_SCREENSHOT:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_RECORD_SCREEN:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SET_ADD_MODE_ADMIN_ONLY:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SET_ADD_MODE_ALL_MEMBERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_BUMPED_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_CURRENT_USER_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_OWN_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_PARTICIPANT_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_LIMIT_SHARING_DISABLED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_LIMIT_SHARING_ENABLED:return{contactIds:b,contents:[]};case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CREATED_POLL:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_MIXED_POLL_UPDATE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_MORE_THAN_ONE_USERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_MORE_THAN_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_MORE_THAN_ONE_USERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_NAMED_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_HOTLIKE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_CURRENT_USER_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SET_OWN_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_MINUTES:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_MINUTES:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_HOURS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_HOURS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_DAYS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_DAYS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_OFF:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_SECONDS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_SECONDS:a=b[0];var c=b[1];return{contactIds:[a],contents:[c]};case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_PARTICIPANT_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CLEAR_PARTICIPANT_NICKNAME:a=b[0];c=b[1];var e=b[2];return{contactIds:[a,c],contents:[e]};case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_AI_THEME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_THEME:a=b[0];c=b[1];e=b[2];return{contactIds:[a],contents:[c,e]};case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CHANGED_POLL_VOTE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_POLL_VOTE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_POLL_VOTE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_POLL_OPTION:a=b[0];c=b[1];b[2];return{contactIds:[a],contents:[c]};case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CHANGED_MULTIPLE_POLL_VOTES:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_MULTIPLE_POLL_VOTES:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_MULTIPLE_POLL_VOTES:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_MULTIPLE_POLL_OPTIONS:e=b[0];a=b[1];c=b[2];b[3];return{contactIds:[e],contents:[a,c]};case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CHANGED_MULTIPLE_POLL_VOTES:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_MULTIPLE_POLL_VOTES:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_POLL_VOTE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_MULTIPLE_POLL_VOTES:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_POLL_VOTE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_NAMED_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_NAMED_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU_AND_MORE_THAN_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_AI_THEME:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_THEME:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_HOTLIKE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SET_OWN_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CREATED_POLL:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_POLL_OPTION:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_MULTIPLE_POLL_OPTIONS:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_MIXED_POLL_UPDATE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CHANGED_POLL_VOTE:case d("MAWLocalizationType").LOCALIZATION_TYPE.POLL_UNSENT_UPDATE:default:return{contactIds:[],contents:b}}}g.deconstructContactIdsFromAdminContent=a}),98);
__d("MAWAnimatedImageThumbnailStore",[],(function(a,b,c,d,e,f){"use strict";var g=new Map();function a(a){return(a=g.get(a))!=null?a:null}function b(a,b){g.set(a,b)}f.getThumbnailSpec=a;f.setThumbnailSpec=b}),66);
__d("MAWAsyncEBPendingQueryPromise",["Promise"],(function(a,b,c,d,e,f){"use strict";var g,h=new Map(),i=new Map(),j=new Map(),k=new Map(),l=new Map(),m=new Map();function a(a){var c=new(g||(g=b("Promise")))(function(b,c){i.set(a,b),k.set(a,c)});h.set(a,c);return c}function c(a,b){j.set(a,b)}function d(a){return j.get(a)}function e(a){var c=new(g||(g=b("Promise")))(function(b,c){l.set(a,{data:null,resolve:b}),m.set(a,c)});return c}function n(a,b){var c=i.get(a);c!=null&&(i["delete"](a),c(b));c=l.get(a);c!=null&&l.set(a,{data:b,resolve:c.resolve})}function o(a,b){var c=k.get(a);c!=null&&(i["delete"](a),c(b));c=m.get(a);c!=null&&(m["delete"](a),c(b),l["delete"](a))}function p(a){var b=l.get(a);b!=null&&b.data!=null&&(b.resolve(b.data),l["delete"](a),m["delete"](a))}f.getPendingQueryPromiseFromTrace=a;f.setJidFromThreadId=c;f.getJidFromThreadId=d;f.getWaitForRestorePromiseFromTrace=e;f.resolvePendingQueryIfPresent=n;f.rejectPendingQueryIfPresent=o;f.resolvePendingQueryUponReStore=p}),66);
__d("MAWMediaPreProcessQpl",["MAWSendQplToServer","Random","justknobx","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h=typeof self.BigInt==="function",i=c("justknobx")._("3427")*1e3;function a(a,b){var e=Date.now()+(Math.round(d("Random").random()*1e4)+1e4);a=d("MAWSendQplToServer").startQplUserFlow(c("qpl")._(1056840460,"718"),{bool:{has_big_int_support:h},string:{preprocess_type:a}},e,i);b&&a.addAnnotations({"int":{input_file_size:b.size},string:{mimetype:b.type}});return a}g.startMediaPreProcessQpl=a}),98);
__d("WABlobToArrayBuffer",["Promise","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return"arrayBuffer"in a&&typeof a.arrayBuffer==="function"?a.arrayBuffer():new(h||(h=b("Promise")))(function(b,d){var e=new FileReader();e.onload=function(){var a=e.result;a instanceof ArrayBuffer?b(a):d(c("err")("blobToArrayBuffer got error because result is not ArrayBuffer: "+typeof a))};e.onerror=function(){var a;d((a=e.error)!=null?a:c("err")("blobToArrayBuffer got unknown error"))};e.readAsArrayBuffer(a)})}g.blobToArrayBuffer=a}),98);
__d("WABlobToImage",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;function a(a){var c;return new(g||(g=b("Promise")))(function(b,d){c=new Image();var e=URL.createObjectURL(a),f=function(){return URL.revokeObjectURL(e)};c.onload=function(){b({image:c,releaseImageMemory:f})};c.onerror=function(){f(),d("loadBlobToImage error")};c.src=e})}f.blobToImage=a}),66);
__d("WACalculateBoundOutputSize",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return b!=null?g(a.width,a.height,b.width,b.height):{outputWidth:a.width,outputHeight:a.height}}function g(a,b,c,d){var e=a,f=b;a>b?a>c&&(f*=c/e,e=c):f>d&&(e*=d/f,f=d);return{outputWidth:Math.round(Math.max(e,1)),outputHeight:Math.round(Math.max(f,1))}}f.calculateBoundOutputSize=a}),66);
__d("WADecodeImage",["WABlobToImage","WACalculateBoundOutputSize","WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["start decoding image with DOM: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["start decoding image without DOM: ",""]);i=function(){return a};return a}var j=d("WATagsLogger").TAGS(["decodeImage"]);c=typeof self.createImageBitmap==="function"&&typeof self.OffscreenCanvas==="function";e=c?a:b;async function a(a,b){j.DEV(i(),a.name);a=await self.createImageBitmap(a);var c=a.width,e=a.height;b=d("WACalculateBoundOutputSize").calculateBoundOutputSize({width:c,height:e},b);var f=b.outputWidth;b=b.outputHeight;var g=new self.OffscreenCanvas(f,b);g=k({canvas:g,inputWidth:c,inputHeight:e,outputWidth:f,outputHeight:b,image:a});return g}async function b(a,b){j.DEV(h(),a.name);a=await d("WABlobToImage").blobToImage(a);var c=a.image;a=a.releaseImageMemory;var e=c.width,f=c.height;b=d("WACalculateBoundOutputSize").calculateBoundOutputSize({width:e,height:f},b);var g=b.outputWidth;b=b.outputHeight;var i=document.createElement("canvas");i=k({canvas:i,inputWidth:e,inputHeight:f,outputWidth:g,outputHeight:b,image:c});a();return i}function k(a){var b=a.canvas,c=a.image,d=a.inputWidth,e=a.inputHeight,f=a.outputWidth;a=a.outputHeight;b.width=f;b.height=a;var g=b.getContext("2d");g.fillStyle="rgb(255,255,255)";g.fillRect(0,0,b.width,b.height);g.drawImage(c,0,0,d,e,0,0,f,a);b=g.getImageData(0,0,f,a);return b}g.canDecodeWithoutDOM=c;g.decodeImage=e;g.decodeImageWithoutDOM=a;g.decodeImageWithDOM=b}),98);
__d("WAPromiseTimeout",["Promise","WACustomError"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,c,e){var f=null,g=new(h||(h=b("Promise")))(function(a,b){f=setTimeout(function(){b(new(d("WACustomError").TimeoutError)(e)),clearTimeout(f)},c)});return h.race([a,g])["finally"](function(){clearTimeout(f)})};g.promiseTimeout=a}),98);
__d("WAMediaWasmWorkerClient",["WAByteArray","WACustomError","WAMediaWasmWorkerResource","WAPromiseTimeout","WAResultOrError","WATagsLogger","WorkerBundleResource","WorkerClient","WorkerMessagePort"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["media storage test failed for storageType: ",", error: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["received storage results from worker, requestId: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["start media storage shadow test"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["requestId: ",", error: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["received output from worker, requestId: ",", success: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["sending input to worker, requestId: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["worker-connection-runtime-error: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["requestId: ",", error: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["received output from worker, requestId: ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["sending input bytes to worker, requestId: ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["start prewarming media wasm worker, operation: ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["mp4RepairMuxInWorker processing video"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["mp4CheckAndRepairInWorker processing video"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["worker error: ",""]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["from worker: ",""]);v=function(){return a};return a}function a(){var b=babelHelpers.taggedTemplateLiteralLoose(["initiated."]);a=function(){return b};return b}var w=d("WATagsLogger").TAGS(["WAMediaWasmWorkerClient"]);c=d("WorkerBundleResource").createDedicatedWebWorker(c("WAMediaWasmWorkerResource"));var x=new(d("WorkerMessagePort").WorkerSyncedMessagePort)(c,"WAMediaWasmWorker");d("WorkerClient").init(x);w.DEV(a());x.addMessageListener("log",function(a){var b=a.logType;a=a.message;switch(b){case"dev":w.DEV(v(),a);break;case"error":w.ERROR(u(),a);break;default:b}});function b(a){var b=a.input;a=a.eventFlow;return C({operation:"webpCheck",input:d("WAByteArray").uint8ArrayToBuffer(b)},a)}function e(a){var b=a.input;a=a.eventFlow;w.LOG(t());return C({operation:"mp4CheckAndRepair",input:d("WAByteArray").uint8ArrayToBuffer(b)},a)}function f(a){var b=a.input;a=a.eventFlow;w.LOG(s());return C({operation:"mp4RepairMux",input:d("WAByteArray").uint8ArrayToBuffer(b)},a)}function y(a){var b=a.imageData,c=a.quality,e=a.useHdScanConfig;a=a.eventFlow;return C({operation:"progressiveJpegEncode",input:d("WAByteArray").uint8ArrayToBuffer(b.data),height:b.height,width:b.width,quality:c,useHdScanConfig:e},a)}async function z(a){var b=a.file,c=a.quality,d=a.useHdScanConfig,e=a.eventFlow;a=a.maxOutputResolution;var f=await b.arrayBuffer();return C({operation:"progressiveJpegEncodeWithFile",input:f,fileName:b.name,fileType:b.type,quality:c,useHdScanConfig:d,maxOutputWidth:a==null?void 0:a.width,maxOutputHeight:a==null?void 0:a.height},e)}function A(a){w.LOG(r(),a),x.postMessage({type:"prewarm",operation:a})}var B=function(){var a=0;return function(){return++a}}();async function C(a,b){var c=B();w.LOG(q(),c);var e=await D(b);if(!e.success)return e;e=e.value;var f=e.onMessageOnce("mediaOperationResponse",function(a){return a.requestId===c}),g=a.input?[a.input]:void 0;e.postMessage(babelHelpers.extends({},a,{requestId:c,type:"mediaOperationRequest"}),g);b==null?void 0:b.addPoint("sent_request_to_media_worker_start");e=await f;a=e.output;if(a.success){w.LOG(p(),c);b==null?void 0:b.addPoint("sent_request_to_media_worker_end",{bool:{isOpfsSyncSupported:a.value.isOpfsSyncSupported}});return d("WAResultOrError").makeResult(a.value.bytes)}w.ERROR(o(),c,a.error.errorMessage);b==null?void 0:b.addPoint("sent_request_to_media_worker_fail");return d("WAResultOrError").makeError(a.error.errorType)}function D(a){a==null?void 0:a.addPoint("get_connected_worker_port_start");var b=3e4;return d("WAPromiseTimeout").promiseTimeout(x.fullyConnected,b).then(function(b){a==null?void 0:a.addPoint("get_connected_worker_port_end");return d("WAResultOrError").makeResult(b)}).catch(function(b){a==null?void 0:a.addPoint("get_connected_worker_port_fail",{string:{workerPortFailure:b instanceof d("WACustomError").TimeoutError?"timeout":"runtime-error"}});if(b instanceof d("WACustomError").TimeoutError)return d("WAResultOrError").makeError("worker-connection-timeout");w.ERROR(n(),b);return d("WAResultOrError").makeError("worker-connection-runtime-error")})}async function E(a){var b=a.file,c=a.maxDimension,e=a.thumbnailBlobByteSizeLimitBytes;a=a.thumbnailQualityPercentageWhenAboveByteSizeLimit;var f=B();w.LOG(m(),f);var g=await D();if(!g.success)return g;g=g.value;var h=g.onMessageOnce("mediaGenerateImageThumbnailResponse",function(a){return a.requestId===f}),i=await b.arrayBuffer(),j=i?[i]:void 0;g.postMessage({input:i,fileName:b.name,fileType:b.type,maxDimension:c,requestId:f,thumbnailBlobByteSizeLimitBytes:e,thumbnailQualityPercentageWhenAboveByteSizeLimit:a,type:"mediaGenerateImageThumbnailRequest"},j);g=await h;w.LOG(l(),f,g.output.success);if(g.output.success)return d("WAResultOrError").makeResult(g.output.value);w.ERROR(k(),f,g.output.error.errorMessage);return Promise.reject(g.output.error.errorMessage)}async function F(a,b){w.LOG(j());var c=B(),e=await D();if(!e.success)return d("WAResultOrError").makeError({errorName:"port-init",errorMessage:e.error});e=e.value;var f=e.onMessageOnce("mediaStorageShadowTestResponse",function(a){return a.requestId===c});e.postMessage({input:a,requestId:c,storageType:b,type:"mediaStorageShadowTestRequest"});e=await f;a=e.output;if(a.success){w.LOG(i(),c);return d("WAResultOrError").makeResult(a.value)}w.ERROR(h(),b,a.error);return d("WAResultOrError").makeError({errorName:a.error.errorName,errorMessage:a.error.errorMessage})}g.webpCheckInWorker=b;g.mp4CheckAndRepairInWorker=e;g.mp4RepairMuxInWorker=f;g.progressiveJpegEncodeInWorker=y;g.progressiveJpegEncodeInWorkerWithFile=z;g.prewarmMediaWasmWorker=A;g.generateImageThumbnailInWorker=E;g.runMediaStorageShadowTestWasmWorker=F}),98);
__d("MAWImagePreProcess",["MAWGetImageSpec","MAWImageUtils","MAWMediaPreProcessQpl","MWFBLogger","WABlobToArrayBuffer","WACustomError","WADecodeImage","WAMediaWasmWorkerClient","WAPromiseTimeout","WAResultOrError","cometIsMimeTypeForMedia","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error while processing url to thumbnail in worker"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["finished jpeg transcoding through mozjpeg: "," bytes"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["start process image through wasm, file name: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["finished image transcoding through browser api: "," bytes"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["start image transcoding through browser api"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error while transcoding image through browser api: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["start image transcode ",""]);n=function(){return a};return a}var o=12e4,p=d("MWFBLogger").MWMediaLogger.tags(["ImagePreProcess"]),q=85,r=["image/heic"];function b(a,b,e,f){f===!0?f={height:c("justknobx")._("187"),width:c("justknobx")._("187")}:f={height:c("justknobx")._("2144"),width:c("justknobx")._("2144")};var g;b?g=a.type==="image/webp"?Promise.resolve(a):t(a,"image/webp",b,e,f):g=a.type==="image/gif"?Promise.resolve(a):t(a,"image/jpeg",!1,e,f);e=a.type==="image/gif";return e?g.then(function(a){return Promise.all([d("MAWGetImageSpec").getImageSpec(a),a])}).then(async function(c){var e=c[0];c=c[1];return{file:c,imageSpec:e,plaintext:await d("WABlobToArrayBuffer").blobToArrayBuffer(c),thumbnailUrlAndSpec:null,type:s(a,b)}}):g.then(function(b){return Promise.all([w(a,c("justknobx")._("2033")),d("MAWGetImageSpec").getImageSpec(b),b])}).then(async function(c){var e=c[0],f=c[1];c=c[2];return Promise.resolve({file:c,imageSpec:f,plaintext:await d("WABlobToArrayBuffer").blobToArrayBuffer(c),thumbnailUrlAndSpec:e,type:s(a,b)})})}async function e(b,e){var f=a.URL.createObjectURL(b),g=e===!0?c("justknobx")._("2545"):c("justknobx")._("2033");g=await d("MAWImageUtils").urlToThumbnailSpec(f,g);var h={height:g.height,width:g.width};return{file:b,imageSpec:h,thumbnailSpec:g,type:s(b,e),url:f}}function s(a,b){return b===!0?"sticker":a.type==="image/gif"?"animated_image":"image"}async function t(a,b,c,e,f){p.DEBUG(n(),a.name);var g=d("MAWMediaPreProcessQpl").startMediaPreProcessQpl("image",a);g.addAnnotations({int:{total_number_of_files:e!=null?e:1},string:{targetMimetype:b}});var h=function(){return u(a,b,q,c,f).then(function(a){return a.success?a.value:Promise.reject("runtime-error")}).catch(function(a){p.MUSTFIX(m(),String(a));g.addPoint("native_encode_failure",{string:{native_encode_error:a.toString()}});return null})};e=b==="image/jpeg"?await d("WAPromiseTimeout").promiseTimeout(v(a,q,g,f).then(function(a){return a.success?a.value:Promise.reject(a.error)}),o).catch(function(a){a instanceof d("WACustomError").TimeoutError?g.addPoint("mozjpeg_encode_timeout"):g.addPoint("mozjpeg_encode_failure",{string:{mozjpeg_encode_error:a.toString()}});return h()}):await h();if(e==null){g.endFail("unable_to_transcode_image");throw p.mustfixThrow("unable to transcode image")}g.endSuccess({int:{compressed_file_size:e.size}});return e}function f(b,c){b=a.URL.createObjectURL(b);return d("MAWImageUtils").urlToThumbnail(b,c)}function u(b,c,e,f,g){p.DEBUG(l());var h=a.URL.createObjectURL(b),i=b.name;return d("MAWImageUtils").urlToFile(h,c,e,f,g).then(function(a){a=a.blob;p.DEBUG(k(),a.size);return d("WAResultOrError").makeResult(new File([a],i,{type:c}))})}async function v(a,b,c,e){p.DEBUG(j(),a.name);d("WAMediaWasmWorkerClient").prewarmMediaWasmWorker("progressiveJpegEncode");c.addPoint("prewarm_worker_started");var f;d("WADecodeImage").canDecodeWithoutDOM&&(f=await d("WAMediaWasmWorkerClient").progressiveJpegEncodeInWorkerWithFile({eventFlow:c,file:a,maxOutputResolution:e,quality:b,useHdScanConfig:!0}));if(f==null||!f.success&&f.error==="decode-image-error"){e=await d("WADecodeImage").decodeImageWithDOM(a,e).catch(function(a){c.addPoint("image_decode_failure");throw a});c.addPoint("image_decode_success");f=await d("WAMediaWasmWorkerClient").progressiveJpegEncodeInWorker({eventFlow:c,imageData:e,quality:b,useHdScanConfig:!0})}if(!f.success)return f;c.addPoint("pjpeg_encode_success");p.DEBUG(i(),f.value.byteLength);return d("WAResultOrError").makeResult(new File([f.value],a.name,{type:"image/jpeg"}))}function w(b,e){var f=async function(){var c=a.URL.createObjectURL(b),f=await d("MAWImageUtils").urlToThumbnail(c,e);a.URL.revokeObjectURL(c);return f};if(!d("WADecodeImage").canDecodeWithoutDOM)return f();var g=c("justknobx")._("2338")*1024,i=c("justknobx")._("2340");return d("WAPromiseTimeout").promiseTimeout(d("WAMediaWasmWorkerClient").generateImageThumbnailInWorker({file:b,maxDimension:e,thumbnailBlobByteSizeLimitBytes:g,thumbnailQualityPercentageWhenAboveByteSizeLimit:i}).then(function(a){if(!a.success)throw p.mustfixThrow("urlToFileInWorker error: "+a.error);return{height:a.value.height,jpegThumbnail:a.value.blob,width:a.value.width}}).catch(function(a){p.catching(a).MUSTFIX(h());throw a}),o).catch(function(a){return f()})}function x(a){if(a==="image/gif"||a==="image/webp")return!0;return!d("cometIsMimeTypeForMedia").isMimeTypeForPhoto(a)?!1:!r.includes(a)}g.imagePreprocess=b;g.optimisticImagePreprocess=e;g.getJpegThumbnailInfo=f;g.generateImageThumbnailInWorkerWithFallback=w;g.isSupportedImageFileType=x}),98);
__d("MAWImageUtils",["FBLogger","MAWAnimatedImageThumbnailStore","MAWDbMedia","MAWFrontendMediaUtils","MAWImagePreProcess","MWPBumpEntityKey","Promise","WABlobToArrayBuffer","WACalculateBoundOutputSize","cr:8676","err","gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h,i="image/jpeg",j=100,k=c("justknobx")._("2338")*1024,l=c("justknobx")._("2340"),m=c("justknobx")._("2545");function n(a,d){d===void 0&&(d=!0);var e;return new(h||(h=b("Promise")))(function(b,f){e=new Image();var g=/^(?:data|blob):/.test(a);d&&!g&&e.setAttribute("crossOrigin","anonymous");e.onload=b;e.onabort=function(){f(function(){throw c("FBLogger")("messenger_web").mustfixThrow("Error loading image from provided URL")})};e.onerror=function(){f(function(){throw c("FBLogger")("messenger_web").mustfixThrow("Wrong blob type")})};e.src=a}).then(function(){return e})}function o(a,c,e,f){e===void 0&&(e=!1);if(a.toBlob)return new(h||(h=b("Promise")))(function(b){var d=f==null?void 0:f/100;a.toBlob(b,c,d)}).then(function(d){var f=k,g=l/100;return e&&d.size>=f?new(h||(h=b("Promise")))(function(b){a.toBlob(b,c,g)}):d});else{var g;d("MWPBumpEntityKey").bumpEntityKey("maw","data_url_to_blob");var i=(g=b("cr:8676")==null?void 0:b("cr:8676").dataURLtoBlob)!=null?g:window.dataURLtoBlob;return(h||(h=b("Promise"))).resolve(i(a.toDataURL(c))).then(function(d){var f=k,g=l/100;return e&&d.size>=f?(h||(h=b("Promise"))).resolve(i(a.toDataURL(c,g))):d})}}function p(a,e,f,g,i){return n(a).then(function(a){var b=a.naturalWidth,c=a.naturalHeight,h=d("WACalculateBoundOutputSize").calculateBoundOutputSize({height:c,width:b},i),j=h.outputHeight,k=h.outputWidth;h=document.createElement("canvas");h.width=k;h.height=j;var l=h.getContext("2d");g!==!0&&r(h);l.drawImage(a,0,0,b,c,0,0,k,j);return o(h,e,!1,f).then(function(a){return{blob:a,height:j,width:k}})})["catch"](function(a){return(h||(h=b("Promise"))).reject(a!=null?a:c("err")("Error loading image from URL"))})}function a(a,b){return n(a).then(function(a){var c=document.createElement("canvas"),e=a.naturalWidth,f=a.naturalHeight,g=c.getContext("2d");f=s(f,e,b);c.width=f.width;c.height=f.height;var h=c.width,j=c.height;q(c);g.drawImage(a,0,0,h,j);return o(c,i,!0).then(function(a){return d("WABlobToArrayBuffer").blobToArrayBuffer(a).then(function(a){return{height:j,jpegThumbnail:a,width:h}})})})}function e(a,b){return n(a).then(function(a){a=s(a.naturalHeight,a.naturalWidth,b);return{height:a.height,width:a.width}})}function q(a){var b=a.getContext("2d");b.fillStyle="rgb(247,247,247)";b.fillRect(0,0,a.width,a.height)}function r(a){var b=a.getContext("2d");b.fillStyle="rgb(255,255,255)";b.fillRect(0,0,a.width,a.height)}function s(a,b,c){b=b!=null?b:c;a=a!=null?a:c;b>a?b>c&&(a*=c/b,b=c):a>c&&(b*=c/a,a=c);return{height:Math.round(Math.max(a,1)),width:Math.round(Math.max(b,1))}}function f(a){return n(a).then(function(a){return{height:a.naturalHeight,width:a.naturalWidth}})}function t(a,e,f){var g=d("MAWAnimatedImageThumbnailStore").getThumbnailSpec(a);if(g)return(h||(h=b("Promise"))).resolve(g);g=p(a,"image/gif");return g==null||e==null||f==null?null:g.then(function(b){b=new File([b.blob],"gif",{type:"image/gif"});return d("MAWImagePreProcess").generateImageThumbnailInWorkerWithFallback(b,Math.max(f,e)).then(function(b){d("MAWAnimatedImageThumbnailStore").setThumbnailSpec(a,b);return b})})["catch"](function(a){throw c("FBLogger")("messenger_web_media").mustfixThrow("Failed while generating thumbnail for GIF",a)})}function u(a){var e=a==null?void 0:a.file,f=a==null?void 0:a.width,g=a==null?void 0:a.height;if(e==null||f==null||g==null)return(h||(h=b("Promise"))).resolve(a);var i=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(e.type,!0);i=i.mediaType;return i!==d("MAWDbMedia").MEDIA_TYPE.GIF?(h||(h=b("Promise"))).resolve(a):c("gkx")("12431")?d("MAWImagePreProcess").generateImageThumbnailInWorkerWithFallback(e,Math.max(f,g)).then(function(a){var b=new File([a.jpegThumbnail],"secure_threads_xma_preview_thumbnail",{type:"image/jpeg"});return{file:b,height:a.height,width:a.width}}):(h||(h=b("Promise"))).resolve(a)}g.TYPE_JPEG=i;g.IMG_THUMB_MAX_EDGE=j;g.STICKER_THUMBNAIL_MAX_SIZE=m;g.canvasToBlob=o;g.urlToFile=p;g.urlToThumbnail=a;g.urlToThumbnailSpec=e;g.boundHeightWidth=s;g.urlToImageSpec=f;g.generateGIFThumbnail=t;g.generatePreviewBlobForShare=u}),98);
__d("MAWGetImageSpec",["MAWImageUtils"],(function(a,b,c,d,e,f,g){"use strict";function b(b,c){var e=a.URL.createObjectURL(b);return d("MAWImageUtils").urlToFile(e,c!=null?c:b.type).then(function(a){var b=a.height;a=a.width;return{height:b,width:a}})}async function c(b){b=a.URL.createObjectURL(b);var c=await d("MAWImageUtils").urlToImageSpec(b);a.URL.revokeObjectURL(b);return c}g.getImageSpec_DEPRECATED=b;g.getImageSpec=c}),98);
__d("MAWMediaGalleryEBTaggingUtils",["LSThreadMediaGalleryGroup","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("gkx")("13725")}function b(a){return a===c("LSThreadMediaGalleryGroup").PHOTOS_AND_VIDEOS}g.isMediaGalleryEBTaggingRestoreEnabled=a;g.isMediaGalleryGroupSupportedForTaggedRestore=b}),98);
__d("MAWMediaGalleryM2Utils",["MAWMediaGalleryEBTaggingUtils","gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function h(){return c("gkx")("4219")}function a(){return c("justknobx")._("3060")&&(h()||d("MAWMediaGalleryEBTaggingUtils").isMediaGalleryEBTaggingRestoreEnabled())}function b(){return c("gkx")("4219")}g.isMediaGalleryM2Enabled=h;g.shouldSkipSyncToLSDB=a;g.isFilesEBRestoreEnabled=b}),98);
__d("WAHashUtils",["WABase64"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("WABase64").encodeB64UrlSafe(a,b)}function b(a,b){return d("WABase64").encodeB64UrlSafe(a,b)}function c(a){return a}function e(a){return a}function f(a){return""+a.slice(0,3)}g.toPlaintextHash=a;g.toCiphertextHash=b;g.stringToPlaintextHash=c;g.toHashedPlaintextHash=e;g.sanitisePlaintextHash=f}),98);
__d("getReplyContentForNoteReply",["WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c=a.author,e=a.msgId;c=d("WAJids").authorToUserId(c,b);b=(b=a.quote)==null?void 0:(b=b.content.msgContent)==null?void 0:b.content;a=(a=a.quote)==null?void 0:a.content.expirationTs;return{isNoteReply:!0,replyMediaExpirationTimestampMs:a!=null?a*1e3:void 0,replyMessageText:b,replySourceId:e,replyToUserId:c}}g["default"]=a}),98);
__d("MAWBridgeMsg",["FBLogger","LSHotEmojiSize","LSIntEnum","MAWDbMsg","MAWImageUtils","MAWMediaGalleryM2Utils","MAWMsgType","MAWUserJidWrapper","MAWVault","MAWXMAUtils","MWPBumpEntityKey","WAAssertUnreachable","WAHashUtils","WAJids","WALogger","WAMsgType","WATimeUtils","getReplyContentForNoteReply","gkx","justknobx","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MAWBridgeMsg] Missing content for external link share XMA message"]);i=function(){return a};return a}function j(a,b){if(!c("gkx")("15418"))return;if(a.isForwarded===!0&&a.type!==d("MAWMsgType").MSG_TYPE.STICKER)return{replyType:"FORWARD"};if(d("MAWXMAUtils").isXMAStoryShare(a.xmaMessageType)||d("MAWXMAUtils").isXMAStoryReaction(a.xmaMessageType)||d("MAWXMAUtils").isXMAStoryMention(a.xmaMessageType)||d("MAWXMAUtils").isXMAStoryHighlightShare(a.xmaMessageType)||d("MAWXMAUtils").isXMAMsgHighlightsTabFriendUpdatesReply(a.xmaMessageType)||d("MAWXMAUtils").isFBXMAPostMention(a.xmaMessageType))return;a=(a=a.quote)==null?void 0:a.content;if(a==null||(a==null?void 0:a.msgId)==null&&(a==null?void 0:a.sourceId)==null)return;var e=a.author,f=a.msgId,g=a.plaintextHash,h=a.sourceId,i=a.ts,j=a.type;a=a.xmaMessageType;if(j===d("WAMsgType").NOTE_REPLY)return;e=d("WAJids").authorToUserId(e,b);if(j===d("MAWMsgType").MSG_TYPE.XMA&&d("MAWXMAUtils").isXMAStoryReply(a))return{replyType:"STORY",storyMediaPlaintextHash:g,storyOwnerId:e,storyUrl:c("nullthrows")(h),timestampMs:i!=null?d("WATimeUtils").castUnixTimeToMillisTime(i):null};if(f!=null)return{replyToMsgId:f,replyType:"MESSAGE"}}function k(a,b,e){var f,g;f=((f=a.quote)==null?void 0:f.content.type)===d("WAMsgType").NOTE_REPLY;if(f)return c("getReplyContentForNoteReply")(a,e);f=(f=a.quote)==null?void 0:f.content;if(d("MAWXMAUtils").isXMAStoryShare(a.xmaMessageType)||d("MAWXMAUtils").isXMAStoryReaction(a.xmaMessageType)||d("MAWXMAUtils").isXMAStoryMention(a.xmaMessageType)||d("MAWXMAUtils").isXMAStoryHighlightShare(a.xmaMessageType)||d("MAWXMAUtils").isXMAMsgHighlightsTabFriendUpdatesReply(a.xmaMessageType)||d("MAWXMAUtils").isFBXMAPostMention(a.xmaMessageType)){var h=a.author,i=a.mediaId,j=a.msgId,k=d("WAJids").authorToUserId(h,e);if(d("MAWXMAUtils").isXMAStoryMention(a.xmaMessageType)||d("MAWXMAUtils").isFBXMAPostMention(a.xmaMessageType)){var l=a.threadJid,m;l!=null&&(m=d("WAJids").interpretAsUserJid(l));m!=null&&(k=d("WAJids").userIdFromJid(m))}i!=null&&a.plaintextHash==null&&d("MWPBumpEntityKey").bumpEntityKeyWithAppId("maw.reply_attachment_media_missing_plaintext_hash","bridge_msg_get_reply_content");return{isFBPostMention:d("MAWXMAUtils").isFBXMAPostMention(a.xmaMessageType),isFBStoryMention:d("MAWXMAUtils").isFBXMAStoryMention(a.xmaMessageType),isIGStoryMention:d("MAWXMAUtils").isIGXMAStoryMention(a.xmaMessageType),isIGXMAStoryShare:d("MAWXMAUtils").isIGXMAStoryShare(a.xmaMessageType),isMsgHighlightsTabFriendUpdatesReply:d("MAWXMAUtils").isXMAMsgHighlightsTabFriendUpdatesReply(a.xmaMessageType),isStoryHighlightShare:d("MAWXMAUtils").isXMAStoryHighlightShare(a.xmaMessageType),isStoryReaction:d("MAWXMAUtils").isXMAStoryReaction(a.xmaMessageType),isStoryReply:d("MAWXMAUtils").isXMAStoryReply(a.xmaMessageType),replyMediaExpirationTimestampMs:f==null?void 0:f.expirationTs,replyMediaId:i,replyPlaintextHash:(l=a.plaintextHash)!=null?l:void 0,replySenderIsMe:h===d("WAJids").AUTHOR_ME||k===e,replySourceId:j,replySourceTimestampMs:a.sortOrderMs,replyStatusType:i!=null?d("MAWMsgType").MSG_TYPE.IMAGE:void 0,replyToUserId:k,storyShareAuthor:b==null?void 0:b.storyShareAuthor}}if(f==null||(f==null?void 0:f.msgId)==null&&(f==null?void 0:f.sourceId)==null)return;l=f||{};h=l.author;j=l.mediaId;a=l.msgId;i=l.plaintextHash;k=l.sourceId;var n=l.specialTextSize,o=l.ts,p=l.type;l=l.xmaMessageType;o=o!=null?o*1e3:void 0;g=f.type===d("MAWMsgType").MSG_TYPE.TEXT||d("MAWXMAUtils").isXMAExternalLinkShare(l)?(g=f.msgContent)==null?void 0:g.content:void 0;var q=d("WAJids").authorToUserId(h,e),r=f.type===d("MAWMsgType").MSG_TYPE.TEXT?f.msgContent.mentionedJids:void 0;h=h===d("WAJids").AUTHOR_ME||q===e;e=b||{};b=e.replyMediaId;var s=e.replyMediaPreviewHeight,t=e.replyMediaPreviewWidth,u=e.replyMediaUrlFallback,v=e.replyPlaintextHash;e=e.replyXMAId;if(d("MAWXMAUtils").isXMAStoryReply(l)){return{isStoryProducerReply:d("MAWXMAUtils").isXMAStoryProducerReply(l),isStoryReaction:d("MAWXMAUtils").isXMAStoryReaction(l),isStoryReply:!0,replyMediaExpirationTimestampMs:f==null?void 0:f.expirationTs,replyMediaId:j,replyPlaintextHash:(f=v!=null?d("WAHashUtils").stringToPlaintextHash(v):i)!=null?f:void 0,replySenderIsMe:h,replySourceId:k,replySourceTimestampMs:o,replyStatusType:j!=null?d("MAWMsgType").MSG_TYPE.IMAGE:void 0,replyToUserId:q}}i=d("MAWImageUtils").boundHeightWidth(s,t,96*.8);f=i.height;k=i.width;return{isIGXMAPostShare:d("MAWXMAUtils").isIGXMAPostShare(l),isIGXMAStoryShare:d("MAWXMAUtils").isIGXMAStoryShare(l),isStoryReply:!1,replyMediaId:b,replyMediaPreviewHeight:p===d("MAWMsgType").MSG_TYPE.STICKER?f:s,replyMediaPreviewWidth:p===d("MAWMsgType").MSG_TYPE.STICKER?k:t,replyMediaUrlFallback:u,replyMentionedJids:r,replyMessageText:g,replyPlaintextHash:v!=null?d("WAHashUtils").stringToPlaintextHash(v):void 0,replySenderIsMe:h,replySourceId:a,replySourceTimestampMs:o,replyStatusType:n===1||n===2||n===3?d("MAWMsgType").MSG_TYPE.STICKER:p,replyToUserId:q,replyXMAId:e}}function a(a){a=a.specialTextSize;switch(a){case 1:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSHotEmojiSize").SMALL);case 2:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSHotEmojiSize").MEDIUM);case 3:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSHotEmojiSize").LARGE);default:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSHotEmojiSize").NONE)}}function l(a){if(c("justknobx")._("3424")&&d("MAWMediaGalleryM2Utils").isMediaGalleryM2Enabled()&&a==="media_restore")return"EncryptedBackupsMedia";switch(a){case"eb_restore":return"EncryptedBackups";case"media_restore":return"EncryptedBackupsMedia";case"whatsapp":return"WhatsApp";default:return void 0}}function b(a,b){var e,f,g=d("WAJids").extractUserId(d("MAWUserJidWrapper").getMyUserJid());e=((e=a.isForwarded)!=null?e:!1)&&a.type!==d("MAWMsgType").MSG_TYPE.STICKER;f=(f=a.forwardingScore)!=null?f:0;var h=d("MAWDbMsg").getCanonicalTsFromMsg(a),m=k(a,b,g),n=j(a,g),o=d("MAWXMAUtils").isXMAStoryShare(a.xmaMessageType),p=d("MAWXMAUtils").isXMAStoryReaction(a.xmaMessageType),q=d("MAWXMAUtils").isXMAExternalLinkShare(a.xmaMessageType),r=d("MAWXMAUtils").isIGXMAStoryMention(a.xmaMessageType),s=d("MAWXMAUtils").isFBXMAStoryMention(a.xmaMessageType),t=d("MAWXMAUtils").isXMAStoryHighlightShare(a.xmaMessageType),u=d("MAWXMAUtils").isXMAPostPrivateReply(a.xmaMessageType),v=d("MAWXMAUtils").isXMAMsgHighlightsTabFriendUpdatesReply(a.xmaMessageType),w=a.messageExpirationTs!=null&&a.messageExpirationTs<=d("WATimeUtils").unixTime(),x=d("MAWDbMsg").getSortOrderWithFallback(a),y=a.externalId,z=l(a.source);(b==null?void 0:b.replyPlaintextHash)!==(m==null?void 0:m.replyPlaintextHash)&&c("FBLogger")("messenger_web").warn("replayPlaintextHash mismatch. From replyMeta is null: %s, from replyContent is null: %s. Message type: %s",(b==null?void 0:b.replyPlaintextHash)==null,(m==null?void 0:m.replyPlaintextHash)==null,a.type);b=(b==null?void 0:b.replyPlaintextHash)!=null?d("WAHashUtils").stringToPlaintextHash(b==null?void 0:b.replyPlaintextHash):(b=m==null?void 0:m.replyPlaintextHash)!=null?b:void 0;switch(a.type){case d("MAWMsgType").MSG_TYPE.TEXT:var A=d("MAWVault").isVaulted(a.msgContent.content)?a.msgContent.content:d("MAWVault").vault(a.msgContent.content);return babelHelpers["extends"]({},m,{ack:a.ack,applicationErrorCode:a.applicationErrorCode,chatJid:a.threadJid,commands:a.msgContent.commands,content:A,editCount:a.editCount,ephemeralDurationInSec:(A=a.ephemeralSetting)==null?void 0:A.ephemeralExpirationInSec,externalId:y,forwardingScore:f,isAdminMessage:!1,isAuthorMe:a.author===d("WAJids").AUTHOR_ME,isExpiredMsg:w,isForwarded:e,mentionedJids:a.msgContent.mentionedJids,msgId:a.msgId,replyContent:n,replyPlaintextHash:b,sender:d("WAJids").authorToUserId(a.author,g),sortOrderMs:x,specialTextSize:a.specialTextSize,transportKey:z,ts:h,type_:a.type});case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:case d("MAWMsgType").MSG_TYPE.RAVEN:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:return babelHelpers["extends"]({},m,{ack:a.ack,applicationErrorCode:a.applicationErrorCode,chatJid:a.threadJid,ephemeralDurationInSec:(A=a.ephemeralSetting)==null?void 0:A.ephemeralExpirationInSec,externalId:y,forwardingScore:f,groupId:a.groupId,groupIndex:a.groupIndex,groupSize:a.groupSize,isAdminMessage:!1,isAuthorMe:a.author===d("WAJids").AUTHOR_ME,isExpiredMsg:w,isForwarded:e,msgId:a.msgId,replyContent:n,replyPlaintextHash:b,sender:d("WAJids").authorToUserId(a.author,g),sortOrderMs:x,transportKey:z,ts:h,type_:a.type});case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:return babelHelpers["extends"]({},m,{ack:a.ack,chatJid:a.threadJid,externalId:y,forwardingScore:f,isAdminMessage:!1,isAuthorMe:a.author===d("WAJids").AUTHOR_ME,isExpiredMsg:w,isForwarded:e,msgId:a.msgId,replyContent:n,replyPlaintextHash:b,sender:d("WAJids").authorToUserId(a.author,g),sortOrderMs:x,transportKey:z,ts:h,type_:a.type,unsupportedType:a.msgContent.subtype});case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:return{ack:a.ack,chatJid:a.threadJid,externalId:y,forwardingScore:f,isAdminMessage:!1,isAuthorMe:a.author===d("WAJids").AUTHOR_ME,isExpiredMsg:w,isForwarded:e,msgId:a.msgId,sender:d("WAJids").authorToUserId(a.author,g),sortOrderMs:x,transportKey:z,ts:h,type_:a.type};case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:return babelHelpers["extends"]({},m,{ack:a.ack,chatJid:a.threadJid,externalId:y,forwardingScore:f,isAdminMessage:!1,isAuthorMe:a.author===d("WAJids").AUTHOR_ME,isExpiredMsg:w,isForwarded:e,msgId:a.msgId,replyContent:n,replyPlaintextHash:b,sender:d("WAJids").authorToUserId(a.author,g),sortOrderMs:x,transportKey:z,ts:h,type_:a.type});case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:return{ack:a.ack,adminContent:[a.msgContent.authorName],adminType:a.msgContent.adminType,chatJid:a.threadJid,externalId:y,forwardingScore:f,isAdminMessage:!0,isAuthorMe:a.author===d("WAJids").AUTHOR_ME,isExpiredMsg:w,isForwarded:e,msgId:a.msgId,sender:d("WAJids").authorToUserId(a.author,g),sortOrderMs:x,transportKey:z,ts:h,type_:a.type};case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_UPDATE:return{ack:a.ack,adminContent:(A=a.msgContent)==null?void 0:(A=A.adminMsgContent)==null?void 0:A.map(function(a){return a==="Facebook User"?"0":a}),adminType:(A=a.msgContent)==null?void 0:A.adminType,adminVersion:(A=a.msgContent)==null?void 0:A.version,chatJid:a.threadJid,externalId:y,forwardingScore:f,isAdminMessage:!0,isAuthorMe:a.author===d("WAJids").AUTHOR_ME,isExpiredMsg:w,isForwarded:e,msgId:a.msgId,sender:d("WAJids").authorToUserId(a.author,g),sortOrderMs:x,transportKey:z,ts:h,type_:a.type};case d("MAWMsgType").MSG_TYPE.REVOKED:return{ack:a.ack,chatJid:a.threadJid,externalId:y,forwardingScore:f,isAdminMessage:!1,isAuthorMe:a.author===d("WAJids").AUTHOR_ME,isExpiredMsg:w,isForwarded:e,msgId:a.msgId,originalTs:a.originalTs,sender:d("WAJids").authorToUserId(a.author,g),sortOrderMs:x,transportKey:z,ts:h,type_:a.type};case d("MAWMsgType").MSG_TYPE.XMA:var B;A=(A=a.msgContent)==null?void 0:A.content;B=A!=null?d("MAWVault").isVaulted(A)?(B=a.msgContent)==null?void 0:B.content:d("MAWVault").vault(A):void 0;q&&B==null&&d("WALogger").WARN(i());A=c("justknobx")._("1191")||p||q?B:void 0;return babelHelpers["extends"]({},m,{ack:a.ack,applicationErrorCode:a.applicationErrorCode,chatJid:a.threadJid,commands:(q=a.msgContent)==null?void 0:q.commands,content:A,ephemeralDurationInSec:(B=a.ephemeralSetting)==null?void 0:B.ephemeralExpirationInSec,externalId:y,forwardingScore:f,isAdminMessage:!1,isAuthorMe:a.author===d("WAJids").AUTHOR_ME,isCollapsed:a.isCollapsed,isExpiredMsg:w,isExpiredXmaMsg:a.isExpiredXmaMsg,isFBPostMention:d("MAWXMAUtils").isFBXMAPostMention(a.xmaMessageType),isFBStoryMention:s,isForwarded:e,isIGStoryMention:r,isMsgHighlightsTabFriendUpdatesReply:v,isPostPrivateReply:u,isStoryHighlightShare:t,isStoryReaction:p,isStoryShare:o,mentionedJids:(m=a.msgContent)==null?void 0:m.mentionedJids,msgId:a.msgId,replyContent:n,replyPlaintextHash:b,sender:d("WAJids").authorToUserId(a.author,g),sortOrderMs:x,transportKey:z,ts:h,type_:a.type,xmaMessageType:a.xmaMessageType});default:return c("WAAssertUnreachable")(a.type)}}g.getSpecialTextSize=a;g.convertDbMsgSourceToLSTransportKey=l;g.createBridgeMsg=b}),98);
__d("MAWBridgeSearchMsg",["MAWCurrentUser","MAWVault","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){b===void 0&&(b=!0);var c=a,e=d("MAWCurrentUser").getID(),f=a.author,g=a.externalId,h=a.msgId,i=a.threadJid;if(i==null)return null;var j=c.content;c=c.sortOrderMs;i={chatJid:i,externalId:g,msg:{msgId:h,sender:d("WAJids").authorToUserId(f,e),ts:a.canonicalTs},sortOrderMs:c};g=j;return babelHelpers["extends"]({},i,{msg:babelHelpers["extends"]({},i.msg,{content:g!=null?d("MAWVault").isVaulted(g)?b?g:d("MAWVault").unvault(g):b?d("MAWVault").vault(g):g:void 0})})}b="message_content_search";c="non_message_content_search";g.createBridgeSearchMsg=a;g.MESSAGE_CONTENT_SEARCH=b;g.NON_MESSAGE_CONTENT_SEARCH=c}),98);
__d("MAWConvertExtendedContentTypeToLSXmaContentType",["LSXmaContentType","WAArmadilloXMA.pb"],(function(a,b,c,d,e,f,g){"use strict";function a(a){if(a==null)return null;switch(a){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE:return c("LSXmaContentType").FB_FEED_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY:return c("LSXmaContentType").FB_STORY_REPLY;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_SHARE:return c("LSXmaContentType").FB_STORY_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_MENTION:return c("LSXmaContentType").FB_STORY_MENTION;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_VIDEO_SHARE:return c("LSXmaContentType").FB_FEED_VIDEO_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_GAMING_CUSTOM_UPDATE:return c("LSXmaContentType").FB_GAMING_CUSTOM_UPDATE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_PRODUCER_STORY_REPLY:return c("LSXmaContentType").FB_PRODUCER_STORY_REPLY;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_EVENT:return c("LSXmaContentType").FB_EVENT;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_POST_PRIVATE_REPLY:return c("LSXmaContentType").FB_FEED_POST_PRIVATE_REPLY;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_HIGHLIGHTS_TAB_FRIEND_UPDATES_REPLY:return c("LSXmaContentType").MSG_HIGHLIGHTS_TAB_FRIEND_UPDATES_REPLY;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_SHORT:return c("LSXmaContentType").FB_SHORT;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_LOCATION_SHARING:return c("LSXmaContentType").MSG_LOCATION_SHARING;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_LOCATION_SHARING_V2:return c("LSXmaContentType").MSG_LOCATION_SHARING_V2;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_POST_MENTION:return c("LSXmaContentType").FB_POST_MENTION;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_CONTACT:return c("LSXmaContentType").MSG_CONTACT;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_AI_CONTACT:return c("LSXmaContentType").MSG_AI_CONTACT;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_MEMORIES_SHARE:return c("LSXmaContentType").MSG_MEMORIES_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE:return c("LSXmaContentType").MSG_EXTERNAL_LINK_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_AUDIO_CALL:return c("LSXmaContentType").RTC_AUDIO_CALL;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_VIDEO_CALL:return c("LSXmaContentType").RTC_VIDEO_CALL;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_AUDIO_CALL:return c("LSXmaContentType").RTC_MISSED_AUDIO_CALL;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_VIDEO_CALL:return c("LSXmaContentType").RTC_MISSED_VIDEO_CALL;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_PROFILE_DIRECTORY_ITEM:return c("LSXmaContentType").FB_PROFILE_DIRECTORY_ITEM;default:return null}}g.convertExtendedContentTypeToLSXmaContentType=a}),98);
__d("MAWDbXMA",["I64"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return a}function b(a){return a}function c(a){return(h||(h=d("I64"))).to_float(a)}g.convertNumbersToXMAIds=a;g.convertNumberToXMAId=b;g.convertXMAId64ToXMAId=c}),98);
__d("MAWEBLSInWorkerSwitch",["MAWEBEnabledStateManager"],(function(a,b,c,d,e,f,g){"use strict";a=new(d("MAWEBEnabledStateManager").MAWEBEnabledStateManager)();b=a;g["default"]=b}),98);
__d("MAWIsFbProfileDirectoryItemXmaEnabled",["gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("gkx")("15740")}g.isFbProfileDirectoryItemXmaEnabled=a}),98);
__d("MAWIsLiveLocationXmaEnabled",["gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("gkx")("3758")===!0}g.isLiveLocationXmaEnabled=a}),98);
__d("MAWIsMemoriesXmaEnabled",["gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("gkx")("1063")}g.isMemoriesXmaEnabled=a}),98);
__d("MAWJidUtils",["FBLogger","I64","LSIntEnum","MAWDbMsg","MAWJids","WAGlobals","WAJids"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,b,e){if(d("WAJids").isAuthorSystem(a)||b==null||e==null){c("FBLogger")("messenger_web").warn("Failed to create protocolMsgId with externalId %s for a msg to edit",e);return}return{author:a,chat:b,externalId:e}}function a(a){var b;return j(a.author,a.threadJid,(b=a.externalId)!=null?b:a.editExternalId)}function b(a){return d("WAJids").isAuthorMe(a)?d("WAGlobals").getMyUserJid():a}function e(a,b){a=(h||(h=d("I64"))).to_string(a);b=(i||(i=d("LSIntEnum"))).unwrapIntEnum(b);switch(b){case 15:return d("MAWJids").jidUtils.toUserJid(a);case 16:return d("WAJids").toGroupJid(a);default:return null}}function f(a){return m(a.threadJid,a.externalId)}function k(a){return l(a.threadJid,a.externalId)}function l(a,b){a=d("MAWDbMsg").toMsgId(m(a,b));if(a==null)throw c("FBLogger")("messenger_e2ee_web").mustfixThrow("formatProtocolMsgIdFromExternalId: Failed to create protocolMsgId with externalId %s for a msg",b);return a}function m(a,b){return a+"."+b}g.maybeToProtocolMsgId=j;g.toProtocolMsgId=a;g.getAuthorJid=b;g.LSJidtoChatJid=e;g.toProtocolMsgIdStringForMAWStorage=f;g.formatProtocolMsgIdFromMsg=k;g.formatProtocolMsgIdFromExternalId=l}),98);
__d("MAWMainTraceUtils",["I64","LSRequestId"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){return c("LSRequestId").generate()}async function b(a,b,c,e,f,g,i){await a.data_trace_meta.add({contextOne:f,contextThree:i,contextTwo:g,foregroundTimestampMs:(h||(h=d("I64"))).zero,initTimestampMs:b,predefinedId:void 0,shouldFlush:!1,traceId:c,traceType:e})}g.createTraceId=a;g.startTraceWithTxn=b}),98);
__d("MAWMediaManagerUiIntegrationCheck",["qex"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a;return(a=c("qex")._("4221"))!=null?a:!1}g.getIsMediaManagerUiIntegrationEnabled=a}),98);
__d("MAWMsg",["$InternalEnum","I64","LSBitFlag","LSIntEnum","LSMessagingThreadTypeUtil","LSReplyMessageAttachmentType","MAWMsgType","WAArmadilloXMA.pb"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a,b,c,e,f,g){if(a===d("MAWMsgType").MSG_TYPE.TEXT)if(b)return(i||(i=d("LSIntEnum"))).ofNumber(8192);else return(i||(i=d("LSIntEnum"))).ofNumber(1);else if(a===d("MAWMsgType").MSG_TYPE.IMAGE||a===d("MAWMsgType").MSG_TYPE.VIDEO||a===d("MAWMsgType").MSG_TYPE.RAVEN)return(i||(i=d("LSIntEnum"))).ofNumber(2);else if(a===d("MAWMsgType").MSG_TYPE.PTT)return(i||(i=d("LSIntEnum"))).ofNumber(4);else if(a===d("MAWMsgType").MSG_TYPE.FUTUREPROOF)return k(f);else if(a===d("MAWMsgType").MSG_TYPE.CIPHERTEXT)return(i||(i=d("LSIntEnum"))).ofNumber(65536);else if(a===d("MAWMsgType").MSG_TYPE.UNAVAILABLE)return(i||(i=d("LSIntEnum"))).ofNumber(262144);else if(a===d("MAWMsgType").MSG_TYPE.GIF)return(i||(i=d("LSIntEnum"))).ofNumber(16384);else if(a===d("MAWMsgType").MSG_TYPE.STICKER)return(i||(i=d("LSIntEnum"))).ofNumber(4096);else if(a===d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE)return(i||(i=d("LSIntEnum"))).ofNumber(64);else if(a===d("MAWMsgType").MSG_TYPE.XMA)if(c!=null&&c)return(i||(i=d("LSIntEnum"))).ofNumber(256);else return g===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_RECEIVER_FETCH?(i||(i=d("LSIntEnum"))).ofNumber(536870912):(i||(i=d("LSIntEnum"))).ofNumber(1024);else if(a===d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE)if(!e)return(i||(i=d("LSIntEnum"))).ofNumber(33554432);else return(i||(i=d("LSIntEnum"))).ofNumber(1);else if(a===d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH)return(i||(i=d("LSIntEnum"))).ofNumber(134217728);else return(i||(i=d("LSIntEnum"))).ofNumber(1)}function k(a){switch(a){case"liveLocationMessage":return(i||(i=d("LSIntEnum"))).ofNumber(4294967296);case"locationMessage":return(i||(i=d("LSIntEnum"))).ofNumber(524288);case"pollCreationMessage":return(i||(i=d("LSIntEnum"))).ofNumber(1048576);case"contactShareMessage":return(i||(i=d("LSIntEnum"))).ofNumber(2097152);case"storyMentionMessage":return(i||(i=d("LSIntEnum"))).ofNumber(4194304);case"postMentionMessage":return(i||(i=d("LSIntEnum"))).ofNumber(2147483648);case"metaAiMessage":return(i||(i=d("LSIntEnum"))).ofNumber(8388608);case"bumpMessage":return(i||(i=d("LSIntEnum"))).ofNumber(16777216);case"stickerReceiverFetchMessage":return(i||(i=d("LSIntEnum"))).ofNumber(67108864);case"noteMention":return(i||(i=d("LSIntEnum"))).ofNumber(1073741824);case"messengerMemory":return(i||(i=d("LSIntEnum"))).ofNumber(8589934592);case"rtcMessage":return(i||(i=d("LSIntEnum"))).ofNumber(17179869184);default:return(i||(i=d("LSIntEnum"))).ofNumber(131072)}}function e(a){a=a.displayedContentTypes;return(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(2))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(4))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(16384))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(16))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(64))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(4096))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(134217728))}function f(a,b){var e=a.replyAttachmentType;if(e==null)return!1;b=d("LSMessagingThreadTypeUtil").isArmadilloSecure(b);return b&&a.replyAttachmentId==null?!1:(j||(j=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(c("LSReplyMessageAttachmentType").PHOTO))||(j||(j=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(c("LSReplyMessageAttachmentType").GIF))||(j||(j=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(c("LSReplyMessageAttachmentType").AUDIO))||(j||(j=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(c("LSReplyMessageAttachmentType").STICKER))||(j||(j=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(c("LSReplyMessageAttachmentType").VIDEO))}function l(a){return(j||(j=d("I64"))).equal(a.displayedContentTypes,(i||(i=d("LSIntEnum"))).ofNumber(134217728))}function m(a){return d("LSBitFlag").has((i||(i=d("LSIntEnum"))).ofNumber(536870912),a.displayedContentTypes)}function n(a){a=a.displayedContentTypes;if((j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(32)))return!0;else return!1}function o(a){return(j||(j=d("I64"))).lt(a.sendStatusV2,(i||(i=d("LSIntEnum"))).ofNumber(2))}function p(a){a=a.displayedContentTypes;return d("LSBitFlag").has((i||(i=d("LSIntEnum"))).ofNumber(1024),a)||d("LSBitFlag").has((i||(i=d("LSIntEnum"))).ofNumber(536870912),a)}function q(a){a=a.displayedContentTypes;return(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(65536))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(131072))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(524288))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(4294967296))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(1048576))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(2097152))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(4194304))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(2147483648))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(8388608))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(16777216))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(1073741824))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(8589934592))?!0:(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(262144))}var r=(b=b("$InternalEnum"))({PLAYED:0,SCREENSHOTTED:1,FORCE_DISABLED:2}),s=b({PERMANENT:0,UNSEEN:1,SEEN:2,REPLAYED:3,EXPIRED:4}),t=b({VIEW_ONCE:0,ALLOW_REPLAY:1,KEEP_IN_CHAT:2});b=b({IMAGE:0,VIDEO:1});g.text=(h=d("MAWMsgType")).MSG_TYPE.TEXT;g.image=h.MSG_TYPE.IMAGE;g.video=h.MSG_TYPE.VIDEO;g.ptt=h.MSG_TYPE.PTT;g.unsent=h.MSG_TYPE.REVOKED;g.gif=h.MSG_TYPE.GIF;g.bumpExistingMessage=h.MSG_TYPE.BUMP_EXISTING_MESSAGE;g.getDisplayedContentTypes=a;g.isMediaMsg=e;g.isMediaReplyAttachmentType=f;g.isReceiverFetchMsg=l;g.isReceiverFetchXMAMsg=m;g.isAdminMsg=n;g.isOptimistic=o;g.isXMAMsg=p;g.isPlaceholder=q;g.MAWRavenActionNotifType=r;g.MAWRavenMsgEphemeralMediaState=s;g.MAWRavenMsgEphemeralType=t;g.MAWRavenMsgMediaType=b}),98);
__d("MWXMAV2IsDataclassLiveLocationXMA",[],(function(a,b,c,d,e,f){"use strict";function a(a){if(a==null)return!1;a=JSON.parse(a);if(a==null)return!1;a=a.content;if(a==null||(a==null?void 0:a.__typename)!=="XMSGXmaSingleContent")return!1;a=a.custom_template_data;if(a==null||(a==null?void 0:a.__typename)!=="XMSGXmaLocationTemplateData")return!1;a=a.location_metadata;return a==null||(a==null?void 0:a.__typename)!=="XMSGXmaLiveLocationMetadata"?!1:!0}f.isDataclassLiveLocationXMA=a}),66);
__d("MAWParseXMAFBConfig",["FBLogger","MAWIsFbProfileDirectoryItemXmaEnabled","MAWIsLiveLocationXmaEnabled","MAWIsMemoriesXmaEnabled","MWXMAV2IsDataclassLiveLocationXMA","WAArmadilloXMA.pb","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h=new Set([(b=d("WAArmadilloXMA.pb")).EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE,b.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_SHORT,b.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_SHARE,b.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY,b.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_GAMING_CUSTOM_UPDATE,b.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE,b.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_AUDIO_CALL,b.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_VIDEO_CALL,b.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_AUDIO_CALL,b.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_VIDEO_CALL,b.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_AUDIO_CALL,b.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_VIDEO_CALL,b.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_POST_PRIVATE_REPLY,b.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_HIGHLIGHTS_TAB_FRIEND_UPDATES_REPLY,b.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_HIGHLIGHTS_TAB_LOCAL_EVENT_REPLY,b.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_EVENT,b.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_PRODUCER_STORY_REPLY,b.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_MENTION,b.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_PRODUCER_STORY_REPLY,b.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_RECEIVER_FETCH]);function a(a){var b=a.fbTargetType,e=a.silentExposure;a=a.xmaDataclass;if(b!=null&&h.has(b))return!0;e=e!=null?e:!1;switch(b){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_CONTACT:return e?c("gkx")("5304"):c("gkx")("4902");case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_AI_CONTACT:return e?c("gkx")("9338"):c("gkx")("9339");case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_LOCATION_SHARING_V2:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_LOCATION_SHARING:return a!=null&&d("MWXMAV2IsDataclassLiveLocationXMA").isDataclassLiveLocationXMA(a)?d("MAWIsLiveLocationXmaEnabled").isLiveLocationXmaEnabled():e?c("gkx")("5320"):c("gkx")("6952");case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_POST_MENTION:return e?c("gkx")("2605"):c("gkx")("2722");case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_MEMORIES_SHARE:return d("MAWIsMemoriesXmaEnabled").isMemoriesXmaEnabled();case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_PROFILE_DIRECTORY_ITEM:return d("MAWIsFbProfileDirectoryItemXmaEnabled").isFbProfileDirectoryItemXmaEnabled();default:c("FBLogger")("maw_db").mustfix("MAWParseXMAFBConfig encountered an unknown unsupported XMA type: %s",String(b));return!1}}g.FB_FULLY_SUPPORTED_TARGET_TYPES=h;g.isFBSupportedTargetType=a}),98);
__d("MAWUpdateClientRestoreStatusOperationType",[],(function(a,b,c,d,e,f){"use strict";a=0;b=1;f.upsertClientRestoreStatus=a;f.markCompleteClientRestoreStatus=b}),66);
__d("MAWXMALoggingUtils",["WAArmadilloXMA.pb","objectEntries"],(function(a,b,c,d,e,f,g){"use strict";var h=c("objectEntries")(d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE).reduce(function(a,b){var c=b[0];b=b[1];a.set(b,c);return a},new Map());function a(a){return a!=null?h.get(a):void 0}g.getXmaTargetTypeStringFromEnum=a}),98);
__d("MWChatEncryptedBackupsQPLEvents",["qpl"],(function(a,b,c,d,e,f,g){"use strict";b=(a=c("qpl"))._(521476140,"378");d=a._(521472542,"295");e=a._(521482085,"409");f=a._(521485406,"272");c=a._(521482763,"296");var h=a._(521484295,"1460"),i=a._(521482969,"1519"),j=a._(521479124,"1939"),k=a._(521474385,"263"),l=a._(521476098,"504"),m=a._(521482858,"1290"),n=a._(521473194,"1331");a=a._(521471024,"2275");g.pinCodeChangeQplEvent=b;g.optOutQplEvent=d;g.backupSetupQplEvent=e;g.mobileOnboardingQplEvent=f;g.restoreQplEvent=c;g.restoreDeviceAuthQplEvent=h;g.messageRestoreQplEvent=i;g.restoreWithAutoRestoreConsentQplEvent=j;g.hsmFleetMigrationQplEvent=k;g.virtualDeviceRevocationQplEvent=l;g.onboardingAuthQplEvent=m;g.processBackupIdsQPLEvent=n;g.fetchBackupIdsQPLEvent=a}),98);
__d("MessagingAttachmentType",[],(function(a,b,c,d,e,f){a=Object.freeze({NONE:0,STICKER:1,IMAGE:2,ANIMATED_IMAGE:3,VIDEO:4,AUDIO:5,FILE:6,XMA:7,EPHEMERAL_IMAGE:8,EPHEMERAL_VIDEO:9,SELFIE_STICKER:10,SOUND_BITE:12,CATALOG_ITEM:13,POWER_UP:14,THIRD_PARTY_STICKER:15});f["default"]=a}),66);
__d("OfflineThreadingId",["I64","XPlatReactCrypto"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(h||(h=d("I64"))).of_string("4194303");function a(){return(h||(h=d("I64"))).to_string(j())}function j(){var a=d("XPlatReactCrypto").getRandomValues(new Uint8Array(8));a=new DataView(a.buffer);a=(h||(h=d("I64"))).add(h.lsl_(h.of_int32(a.getUint32(0)),32),h.of_int32(a.getUint32(4)));return k(Date.now(),a)}function k(a,b){return(h||(h=d("I64"))).and_(h.or_(h.lsl_(h.of_float(a),22),h.and_(b,i)),h.max_int)}function b(a){var b=j(),c=[];for(var e=0;e<a.length;e++)c.push([a[e],(h||(h=d("I64"))).to_string(b)]),b=l(b);return c}function l(a,b){b===void 0&&(b=(h||(h=d("I64"))).one);var c=m(a);a=n(a);return k(c,(h||(h=d("I64"))).add(a,b))}function m(a){return(h||(h=d("I64"))).to_float(h.lsr_(a,22))}function n(a){return(h||(h=d("I64"))).and_(a,i)}g.createOfflineThreadingID=a;g.createForItemsInOrder=b;g.extractTimestamp=m}),98);
__d("RavenMessagingState",[],(function(a,b,c,d,e,f){a=Object.freeze({PERMANENT:0,UNSEEN:1,SEEN:2,REPLAYED:3,EXPIRED:4});f["default"]=a}),66);
__d("WACommsConnectionState",["WAGenericStateManager"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.call(this,!1)||this}var c=b.prototype;c.isConnected=function(){return this.get()};c.waitForConnection=function(){return this.waitForValue(!0)};return b}(d("WAGenericStateManager").WAGenericStateManager);b=new a();g.WACommsConnectionState=b}),98);
__d("WAJobOrchestratorTypes",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({SKIP:"SKIP_PRIORITIZATION",UI_ACTION:"UI_ACTION",LOW:"LOW",HIGH:"HIGH",OFFLINE:"OFFLINE",HISTORY_SYNC:"HISTORY_SYNC",BEST_EFFORT:"BEST_EFFORT"});c=1;d=a.LOW;e=10*1e3;f.JOB_PRIORITY=a;f.DEFAULT_CONCURRENCY=c;f.DEFAULT_JOB_PRIORITY=d;f.DEFAULT_JOB_TIMEOUT_MS=e}),66);
__d("WAMediaQplHelper",[],(function(a,b,c,d,e,f){"use strict";function a(a){if(a==null||a<0||a>1e3*1024*1024)return"invalid_size";else if(a===0)return"size equal to 0KB";else if(a<=1*1024)return"size lower than 1 KB";else if(a<=50*1024)return"size between 1 KB and 50 KB";else if(a<=100*1024)return"size between 50 KB and 100 KB";else if(a<=500*1024)return"size between 100 KB and 500 KB";else if(a<=1*1024*1024)return"size between 500 KB and 1 MB";else if(a<=2*1024*1024)return"size between 1 MB and 2 MB";else if(a<=5*1024*1024)return"size between 2 MB and 5 MB";else if(a<=10*1024*1024)return"size between 5 MB and 10 MB";else if(a<=20*1024*1024)return"size between 10 MB and 20 MB";else if(a<=25*1024*1024)return"size between 20 MB and 25 MB";else if(a<=30*1024*1024)return"size between 25 MB and 30 MB";else if(a<=50*1024*1024)return"size between 30 MB and 50 MB";else if(a<=75*1024*1024)return"size between 50 MB and 75 MB";else if(a<=100*1024*1024)return"size between 75 MB and 100 MB";else return"size above 100 MB"}f.convertIntegerSizeToStringBucket=a}),66);
__d("isMWBumpMessage",["EntMessageReplyType","I64","LSIntEnum"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a){return a!=null&&(h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(c("EntMessageReplyType").BUMP))}g["default"]=a}),98);/*FB_PKG_DELIM*/
__d("BroadcastChannelFallback",["FBLogger","WAMapWithDefault"],(function(a,b,c,d,e,f,g){"use strict";var h=new(d("WAMapWithDefault").MapWithDefault)(function(){return new Set()});function a(a,b){h.get(a).add(b)}function b(a,b){h.get(a)["delete"](b)}function e(a,b){var d=h.get(a);d.forEach(function(a){return a(b)});d.size===0&&c("FBLogger")("BroadcastChannelFallback").warn("No listener for namespace",a)}g.registerBroadcastChannelFallbackListener=a;g.unregisterBroadcastChannelFallbackListener=b;g.handleBroadcastChannelFallbackMessage=e}),98);
__d("LSAddParticipantIdToGroupThread",["LSComputeParticipantCapabilities"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return c.storedProcedure(b("LSComputeParticipantCapabilities"),a[1],a[0]).then(function(a){return a=a,d[0]=a[0],a})},function(b){return c.filter(c.db.table(14).fetch([[[a[0],a[1]]]]),function(b){return c.i64.eq(b.threadKey,a[0])&&c.i64.eq(c.i64.cast([0,0]),c.i64.cast([0,0]))&&c.i64.eq(b.contactId,a[1])&&c.i64.gt(b.authorityLevel,a[9])}).next().then(function(b){var e=b.done;b.value;return e?c.db.table(14).put({threadKey:a[0],contactId:a[1],readWatermarkTimestampMs:a[2],readActionTimestampMs:a[3],deliveredWatermarkTimestampMs:a[4],nickname:a[5],normalizedSearchTerms:a[10],isAdmin:a[6],isSuperAdmin:a[13],subscribeSource:a[7],authorityLevel:a[9],participantCapabilities:d[0],groupParticipantJoinState:a[11],isModerator:a[12],threadRoles:a[14]}):0})}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxAddParticipantIdToGroupThreadStoredProcedure";a.__tables__=["participants"];e.exports=a}),null);
__d("LSCheckAuthoritativeMessageExists",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(e){return b.sequence([function(d){return b.filter(b.db.table(12).fetch([[[a[1]]],"optimistic"]),function(c){return b.i64.eq(c.threadKey,a[0])&&c.offlineThreadingId===a[1]&&b.i64.eq(c.authorityLevel,b.i64.cast([0,80]))}).next().then(function(a,b){b=a.done;a=a.value;return b?c[0]=!1:(a.item,c[0]=!0)})},function(a){return d[0]=c[0]}])},function(a){return b.resolve(d)}])}a.__sproc_name__="LSMailboxCheckAuthoritativeMessageExistsStoredProcedure";a.__tables__=["messages"];e.exports=a}),null);
__d("LSClearPinnedMessages",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.db.table(205).fetch([[[a[0]]]]),function(a){return a["delete"]()})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxClearPinnedMessagesStoredProcedure";a.__tables__=["msg_pinned_messages_v2"];e.exports=a}),null);
__d("getChatJidForLSDBJid",["I64","LSMessagingThreadTypeUtil","ReQL","WAJids"],(function(a,b,c,d,e,f,g){"use strict";var h;async function a(a,b,c){a=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(b));if(a!=null){b=(h||(h=d("I64"))).to_string(c);return d("LSMessagingThreadTypeUtil").isGroup(a.threadType)?d("WAJids").toGroupJid(b):d("WAJids").toMsgrUserJid(b)}}g.getMaybeChatJidForLSDBJid=a}),98);
__d("LSShimCompleteThreadCutover.nop",["I64","MAWBridgeFireAndForget","ReQL","getChatJidForLSDBJid"],(function(a,b,c,d,e,f,g){"use strict";var h;a=async function(a,b,c,e,f){b=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.cutover_threads).getKeyRange(e));if(b!=null){c=b.showOpenMessageHistory===!1;if(c)return[(h||(h=d("I64"))).one];c=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.mi_act_mapping_table.index("jid")).getKeyRange(b.armadilloThreadId));if(c!=null){b=await d("getChatJidForLSDBJid").getMaybeChatJidForLSDBJid(a,c.serverThreadKey,c.jid);if(b==null)return[(h||(h=d("I64"))).one];d("MAWBridgeFireAndForget").fireAndForget("backend","insertAdminMessageInCutoverThreads",{openThreadId:(h||(h=d("I64"))).to_string(e),threadJid:b,traceId:f});return[h.zero]}return[(h||(h=d("I64"))).one]}return[(h||(h=d("I64"))).one]};a.__nop_name__="LSShimCompleteThreadCutover";g.default=a}),98);
__d("LSCompleteThreadCutover",["LSShimCompleteThreadCutover.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.nativeOperation(b("LSShimCompleteThreadCutover.nop"),a[0],a[1],a[2]).then(function(a){return a=a,d[0]=a[0],a})},function(a){return c.resolve(e)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxCompleteThreadCutoverStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSDeleteAllCommunityChannelCategories",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(a){return b.sequence([function(a){return b.forEach(b.db.table(182).fetch(),function(a){return a["delete"]()})},function(a){return b.forEach(b.db.table(9).fetch([[[b.i64.cast([0,20])]],"threadTypeLastActivityTimestampMs"]),function(a){return a["delete"]()})}])},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxDeleteAllCommunityChannelCategoriesStoredProcedure";a.__tables__=["cm_category_list","threads"];e.exports=a}),null);
__d("LSDeleteAllCommunityFolders",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(a){return b.sequence([function(a){return b.forEach(b.db.table(162).fetch(),function(a){return a["delete"]()})},function(a){return b.forEach(b.db.table(9).fetch([[[b.i64.cast([0,17])]],"threadTypeLastActivityTimestampMs"]),function(a){return a["delete"]()})}])},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxDeleteAllCommunityFoldersStoredProcedure";a.__tables__=["community_folders","threads"];e.exports=a}),null);
__d("LSDeleteAndReenrollDeviceState",["LSArrayGetObjectAt","LSDeleteBackupOnClient","LSIsEncryptionVersionSecure","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsDeleteAndReenrollDeviceStateStoredProcedure] Beginning execution."),c.i64.neq(a[0],void 0)?c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[13]=new c.Map(),d[13].set("error_msg","Expected a nonempty query result"),d[13].set("code",c.i64.cast([0,3])),d[13].set("src_line","MEBClientStateUtils.php:247 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[14]=c.createArray(),d[15]=(d[14].push(d[13]),d[14]),e=[void 0,d[14]],d[7]=e[0],d[8]=e[1],e):(b=a.item,d[13]=new c.Map(),d[13].set("backup_id",b.backupId),d[13].set("device_public_key_blob",b.devicePublicKeyBlob),d[13].set("device_private_key_blob",b.devicePrivateKeyBlob),d[13].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[13].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[13].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[13].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[13].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[13].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[13].set("orf_client_state_v2_blob",void 0),d[13].set("orf_v2_authority_level",void 0),d[13].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[13].set("device_id",b.deviceId),d[13].set("backup_tenancy",b.backupTenancy),d[13].set("encryption_version",b.encryptionVersion),d[13].set("revision_version",b.revisionVersion),d[13].set("initialize_restore_result",void 0),d[13].set("device_creation_timestamp_sec",void 0),d[13].set("authority_level",b.authorityLevel),e=[d[13],void 0],d[7]=e[0],d[8]=e[1],e)})},function(e){return d[10]=new c.Map(),d[10].set("value",d[7]),d[10].set("errors",d[8]),d[11]=d[10].get("value"),d[11]!==void 0?c.sequence([function(e){return d[13]=d[11].get("backup_id"),d[14]=d[11].get("device_public_key_blob"),d[15]=d[11].get("device_private_key_blob"),d[16]=d[11].get("epoch_storage_public_key_blob"),d[17]=d[11].get("epoch_storage_private_key_blob"),d[18]=d[11].get("epoch_auth_public_key_blob"),d[19]=d[11].get("epoch_auth_private_key_blob"),d[20]=d[11].get("mailbox_root_key_blob"),d[21]=d[11].get("ocmf_client_state_blob"),d[22]=d[11].get("orf_client_state_v2_blob"),d[23]=d[11].get("orf_v2_authority_level"),d[24]=d[11].get("oblivious_validation_token_blob"),d[25]=d[11].get("device_id"),d[26]=d[11].get("backup_tenancy"),d[27]=d[11].get("encryption_version"),d[28]=d[11].get("revision_version"),d[29]=d[11].get("initialize_restore_result"),d[30]=d[11].get("device_creation_timestamp_sec"),d[31]=d[11].get("authority_level"),c.i64.neq(d[25],void 0)?c.sequence([function(a){return d[33]=void 0,c.i64.neq(d[33],void 0)?c.resolve(d[34]=d[33]):c.sequence([function(a){return d[37]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[38]=a[0],a})},function(a){return d[38]?d[47]=(d[37].push(c.i64.cast([0,0])),d[37]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[39]=a[0],a})},function(a){return d[39]?d[47]=(d[37].push(c.i64.cast([0,2])),d[37]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[40]=a[0],a})},function(a){return d[40]?d[47]=(d[37].push(c.i64.cast([0,3])),d[37]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[41]=a[0],a})},function(a){return d[41]?d[47]=(d[37].push(c.i64.cast([0,4])),d[37]):0,d[42]=c.createArray(),d[43]=c.i64.of_int32(d[37].length),c.i64.gt(d[43],c.i64.cast([0,0]))?c.loopAsync(d[43],function(a){return d[47]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[37],d[47]).then(function(a){return a=a,d[48]=a[0],d[49]=a[1],a})},function(a){return d[50]=(d[42].push(d[48]),d[42])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[47]=c.createArray(),d[48]=c.i64.of_int32(d[42].length),c.i64.gt(d[48],c.i64.cast([0,0]))?c.loopAsync(d[48],function(a){return d[50]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[42],d[50]).then(function(a){return a=a,d[51]=a[0],d[52]=a[1],a})},function(a){return d[53]=(d[47].push(c.i64.to_string(d[51])),d[47])}])}):c.resolve()},function(a){return d[49]=d[47].join(","),d[44]=d[49]}])},function(a){return d[42].some(function(a){return c.i64.eq(d[27],a)})?d[45]=d[27]:d[45]=void 0,c.i64.neq(d[45],void 0)?d[46]=d[45]:d[46]=void 0,d[34]=d[46]}])},function(e){return c.i64.neq(d[34],void 0)?d[35]=d[34]:d[35]=c.i64.cast([0,0]),c.i64.neq(d[26],void 0)?d[36]=d[26]:d[36]=c.i64.cast([0,1]),c.i64.eq(d[25],a[0])?c.sequence([function(a){return c.storedProcedure(b("LSDeleteBackupOnClient"),d[13],void 0,!1,void 0,void 0,!0)},function(b){return d[37]=c.i64.of_float(Date.now()),c.db.table(343).add({pk:void 0,deviceReenrollmentReason:a[1],reenrollmentTimestamp:d[37]})}]):c.resolve(0)},function(a){return d[32]=!0}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsDeleteAndReenrollDeviceStateStoredProcedure] Failed to load client state: 24"),d[34]="Failed to load client state: 24",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsDeleteAndReenrollDeviceStateStoredProcedure] ","",d[34]].join("")),d[33]=c.createArray(),void 0!==void 0?d[35]=(d[33].push(void 0),d[33]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDeleteAndReenrollDeviceStateStoredProcedure",d[34],d[33],c.i64.cast([0,3]))},function(a){return d[32]=!1}])},function(a){return d[12]=d[32]}]):c.sequence([function(a){return d[13]=d[10].get("errors"),d[14]=d[10].get("errors"),function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsDeleteAndReenrollDeviceStateStoredProcedure] Failed to load client state: 1"),d[16]="Failed to load client state: 1",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsDeleteAndReenrollDeviceStateStoredProcedure] ","",d[16]].join("")),d[15]=c.createArray(),void 0!==void 0?d[17]=(d[15].push(void 0),d[15]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDeleteAndReenrollDeviceStateStoredProcedure",d[16],d[15],c.i64.cast([0,3]))},function(a){return d[12]=!1}])}]):c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!0}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[13]=new c.Map(),d[13].set("error_msg","Expected a nonempty query result"),d[13].set("code",c.i64.cast([0,3])),d[13].set("src_line","MEBClientStateUtils.php:247 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[14]=c.createArray(),d[15]=(d[14].push(d[13]),d[14]),e=[void 0,d[14]],d[7]=e[0],d[8]=e[1],e):(b=a.item,d[13]=new c.Map(),d[13].set("backup_id",b.backupId),d[13].set("device_public_key_blob",b.devicePublicKeyBlob),d[13].set("device_private_key_blob",b.devicePrivateKeyBlob),d[13].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[13].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[13].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[13].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[13].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[13].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[13].set("orf_client_state_v2_blob",void 0),d[13].set("orf_v2_authority_level",void 0),d[13].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[13].set("device_id",b.deviceId),d[13].set("backup_tenancy",b.backupTenancy),d[13].set("encryption_version",b.encryptionVersion),d[13].set("revision_version",b.revisionVersion),d[13].set("initialize_restore_result",void 0),d[13].set("device_creation_timestamp_sec",void 0),d[13].set("authority_level",b.authorityLevel),e=[d[13],void 0],d[7]=e[0],d[8]=e[1],e)})},function(a){return d[10]=new c.Map(),d[10].set("value",d[7]),d[10].set("errors",d[8]),d[11]=d[10].get("value"),d[11]!==void 0?c.sequence([function(a){return d[13]=d[11].get("backup_id"),d[14]=d[11].get("device_public_key_blob"),d[15]=d[11].get("device_private_key_blob"),d[16]=d[11].get("epoch_storage_public_key_blob"),d[17]=d[11].get("epoch_storage_private_key_blob"),d[18]=d[11].get("epoch_auth_public_key_blob"),d[19]=d[11].get("epoch_auth_private_key_blob"),d[20]=d[11].get("mailbox_root_key_blob"),d[21]=d[11].get("ocmf_client_state_blob"),d[22]=d[11].get("orf_client_state_v2_blob"),d[23]=d[11].get("orf_v2_authority_level"),d[24]=d[11].get("oblivious_validation_token_blob"),d[25]=d[11].get("device_id"),d[26]=d[11].get("backup_tenancy"),d[27]=d[11].get("encryption_version"),d[28]=d[11].get("revision_version"),d[29]=d[11].get("initialize_restore_result"),d[30]=d[11].get("device_creation_timestamp_sec"),d[31]=d[11].get("authority_level"),c.i64.neq(d[25],void 0)?c.sequence([function(a){return d[33]=void 0,c.i64.neq(d[33],void 0)?c.resolve(d[34]=d[33]):c.sequence([function(a){return d[37]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[38]=a[0],a})},function(a){return d[38]?d[47]=(d[37].push(c.i64.cast([0,0])),d[37]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[39]=a[0],a})},function(a){return d[39]?d[47]=(d[37].push(c.i64.cast([0,2])),d[37]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[40]=a[0],a})},function(a){return d[40]?d[47]=(d[37].push(c.i64.cast([0,3])),d[37]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[41]=a[0],a})},function(a){return d[41]?d[47]=(d[37].push(c.i64.cast([0,4])),d[37]):0,d[42]=c.createArray(),d[43]=c.i64.of_int32(d[37].length),c.i64.gt(d[43],c.i64.cast([0,0]))?c.loopAsync(d[43],function(a){return d[47]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[37],d[47]).then(function(a){return a=a,d[48]=a[0],d[49]=a[1],a})},function(a){return d[50]=(d[42].push(d[48]),d[42])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[47]=c.createArray(),d[48]=c.i64.of_int32(d[42].length),c.i64.gt(d[48],c.i64.cast([0,0]))?c.loopAsync(d[48],function(a){return d[50]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[42],d[50]).then(function(a){return a=a,d[51]=a[0],d[52]=a[1],a})},function(a){return d[53]=(d[47].push(c.i64.to_string(d[51])),d[47])}])}):c.resolve()},function(a){return d[49]=d[47].join(","),d[44]=d[49]}])},function(a){return d[42].some(function(a){return c.i64.eq(d[27],a)})?d[45]=d[27]:d[45]=void 0,c.i64.neq(d[45],void 0)?d[46]=d[45]:d[46]=void 0,d[34]=d[46]}])},function(a){return c.i64.neq(d[34],void 0)?d[35]=d[34]:d[35]=c.i64.cast([0,0]),c.i64.neq(d[26],void 0)?d[36]=d[26]:d[36]=c.i64.cast([0,1]),d[32]=!0}]):c.resolve(d[32]=!1)},function(a){return d[12]=d[32]}]):c.resolve((d[13]=d[10].get("errors"),d[14]=d[10].get("errors"),d[12]=!1))},function(e){return d[12]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsDeleteAndReenrollDeviceStateStoredProcedure] Failure. Attempted to reset nux flags on an onboarded device"),d[14]="Failure. Attempted to reset nux flags on an onboarded device",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsDeleteAndReenrollDeviceStateStoredProcedure] ","",d[14]].join("")),d[13]=c.createArray(),void 0!==void 0?d[15]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDeleteAndReenrollDeviceStateStoredProcedure",d[14],d[13],c.i64.cast([0,3]))):(d[13]=c.i64.of_float(Date.now()),c.db.table(343).add({pk:void 0,deviceReenrollmentReason:a[1],reenrollmentTimestamp:d[13]}))}])},function(a){return d[1]=c.i64.of_float(Date.now()),d[2]=c.i64.random(),d[4]="Finishing execution. Execution time: ",d[5]=c.i64.to_string(c.i64.sub(d[1],d[0])),d[6]=" ms",d[3]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsDeleteAndReenrollDeviceStateStoredProcedure] ",d[3],d[4],d[3],d[5],d[3],d[6]].join("")),c.i64.eq(c.i64.mod_(d[2],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[7]=",",d[8]=c.createArray(),void 0!==void 0?d[9]=(d[8].push(void 0),d[8]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDeleteAndReenrollDeviceStateStoredProcedure",[d[4],d[7],d[5],d[7],d[6]].join(""),d[8],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsDeleteAndReenrollDeviceStateStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state","encrypted_backups_reenrollment_trigger"];e.exports=a}),null);
__d("LSDeleteBanner",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.filter(b.db.table(118).fetch([[[a[1],a[0]]]]),function(c){return b.i64.eq(c.threadKey,a[1])&&b.i64.eq(b.i64.cast([0,0]),b.i64.cast([0,0]))&&b.i64.eq(c.bannerId,a[0])}),function(a){return a["delete"]()})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSInThreadBannerDeleteBannerStoredProcedure";a.__tables__=["in_thread_banner"];e.exports=a}),null);
__d("LSDeleteBannersByIds",["LSArrayGetObjectAt"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return c.sequence([function(e){return d[1]=c.createArray(),d[2]=c.i64.of_int32(a[1].length),c.i64.gt(d[2],c.i64.cast([0,0]))?c.loopAsync(d[2],function(e){return d[4]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[1],d[4]).then(function(a){return a=a,d[5]=a[0],d[6]=a[1],a})},function(a){return d[7]=(d[1].push(c.i64.to_string(d[5])),d[1])}])}):c.resolve()},function(a){return d[3]=d[1].join(","),d[0]=d[3]}])},function(b){return c.forEach(c.filter(c.db.table(118).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.threadKey,a[0])&&a[1].some(function(a){return c.i64.eq(b.bannerId,a)})}),function(a){return a["delete"]()})}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSInThreadBannerDeleteBannersByIdsStoredProcedure";a.__tables__=["in_thread_banner"];e.exports=a}),null);
__d("LSDeleteExistingMessageRanges",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.db.table(13).fetch([[[a[0]]]]),function(a){return a["delete"]()})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxDeleteExistingMessageRangesStoredProcedure";a.__tables__=["messages_ranges_v2__generated"];e.exports=a}),null);
__d("LSDeleteRowRichStatusCustomAudience",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.resolve(c)}a.__sproc_name__="LSOmnistoreSettingsDeleteRowRichStatusCustomAudienceStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSDeleteThenInsertAvatarFeatureConfig",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.resolve(c)}a.__sproc_name__="LSContactDeleteThenInsertAvatarFeatureConfigStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSDeleteThenInsertBotProfileInfoV2",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.db.table(299).put({botId:a[0],isCreatedByViewer:a[1],description:a[4],tintColor:a[2],shortDescription:a[3]})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSContactDeleteThenInsertBotProfileInfoV2StoredProcedure";a.__tables__=["bot_profile_info_v2"];e.exports=a}),null);
__d("LSDeleteThenInsertCmChannelList",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.db.table(167).put({communityId:a[0],threadId:a[1],categoryId:a[2],channelPrivacy:a[3]})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSOmnistoreSettingsDeleteThenInsertCmChannelListStoredProcedure";a.__tables__=["cm_channel_list"];e.exports=a}),null);
__d("LSDeleteThenInsertCmCommunityList",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.db.table(166).put({communityId:a[0]})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSOmnistoreSettingsDeleteThenInsertCmCommunityListStoredProcedure";a.__tables__=["cm_community_list"];e.exports=a}),null);
__d("LSDeleteThenInsertCommunityFolder",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.filter(b.db.table(162).fetch([[[a[0]]]]),function(c){return b.i64.eq(c.folderId,a[0])&&b.i64.gt(b.i64.cast([0,80]),a[54])}).next().then(function(c){var d=c.done;c.value;return d?b.db.table(162).put({folderId:a[0],fbGroupId:a[1],name:a[2],memberCount:a[4],description:a[3],pictureUrl:a[5],pictureUrlFallback:a[6],pictureUrlExpirationTimestampMs:a[7],joiningChannelTaskId:a[8],afterJoiningOpenChannelId:a[10],capabilities:a[11],capabilities2:a[12],capabilities3:a[13],notificationSetting:a[14],notificationMutedUntil:a[15],sendsBlockedUntil:a[17],isHidden:a[18],hasSeenDisablingAlert:a[19],inviteLink:a[21],communityType:a[22],directInviteLink:a[23],enableState:a[24],takedownState:a[25],fbGroupType:a[28],threadCount:a[29],disableTimestamp:a[32],readTimestampMs:a[33],inviteStatus:a[37],blockedFromCommunityMemberCount:a[40],categoryCount:a[41],snippetText:a[42],coverPicUrl:a[43],coverPicUrlFallback:a[44],coverPicUrlExpirationTimestampMs:a[45],invitedThreadId:a[47],fbGroupUserParticipationApprovalStatus:a[48],ccAdminAssistRegistrationStatus:a[49],pauseStatus:a[50],isMember:a[51],latestThreadId:a[52],latestThreadActivityTimestampMs:a[53]}):0})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxDeleteThenInsertCommunityFolderStoredProcedure";a.__tables__=["community_folders"];e.exports=a}),null);
__d("LSDeleteThenInsertCommunityUnjoinedThread",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(d){return c[1]=a[12]==null?b.i64.cast([0,19]):a[12],c[2]="community",c[3]=b.i64.cast([0,0])==null?b.i64.cast([0,0]):b.i64.cast([0,0]),b.db.table(9).fetch([[[a[0]]]]).next().then(function(d,e){var f=d.done;d=d.value;return f?b.db.table(9).put({threadKey:a[0],parentThreadKey:a[1],mailboxType:b.i64.cast([0,0]),threadType:c[1],threadName:a[2],folderName:c[2],threadPictureUrl:a[3],threadPictureUrlFallback:a[4],threadPictureUrlExpirationTimestampMs:a[5],authorityLevel:a[6],lastActivityTimestampMs:a[7],lastReadWatermarkTimestampMs:a[8],muteExpireTimeMs:c[3],removeWatermarkTimestampMs:b.i64.cast([-1,4294967295]),ongoingCallState:b.i64.cast([0,0]),threadDescription:a[9],snippet:a[10],hasPendingInvitation:a[13],eventStartTimestampMs:a[14],eventEndTimestampMs:a[15],takedownState:a[16],cannotReplyReason:a[17],themeFbid:a[18],threadStatus:a[19],needsAdminApprovalForNewParticipant:a[20],joinRequestApprovalSetting:a[21],snippetText:a[24],hasPendingJoinRequest:a[25],capabilities:b.i64.cast([0,0]),capabilities2:b.i64.cast([0,0]),capabilities3:b.i64.cast([0,0]),capabilities4:b.i64.cast([0,0]),syncSource:a[26]}):(e=d.item,c[4]=e.lastActivityTimestampMs,c[6]=e.parentThreadKey,c[5]=e.disappearingThreadKey,c[7]=e.isDisappearingMode,b.i64.le(e.authorityLevel,a[6])?b.i64.gt(c[4],a[7])&&b.i64.neq(c[5],void 0)?(b.i64.eq(a[1],b.i64.cast([-1,4294967286]))&&b.i64.eq(c[6],b.i64.cast([0,0]))?(f=[c[6],e.folderName],c[8]=f[0],c[9]=f[1],f):(d=[a[1],c[2]],c[8]=d[0],c[9]=d[1],d),b.db.table(9).put({threadKey:a[0],parentThreadKey:c[8],mailboxType:b.i64.cast([0,0]),threadType:c[1],threadName:a[2],folderName:c[9],threadPictureUrl:a[3],threadPictureUrlFallback:a[4],threadPictureUrlExpirationTimestampMs:a[5],authorityLevel:a[6],lastActivityTimestampMs:c[4],lastReadWatermarkTimestampMs:e.lastReadWatermarkTimestampMs,muteExpireTimeMs:c[3],removeWatermarkTimestampMs:b.i64.cast([-1,4294967295]),ongoingCallState:b.i64.cast([0,0]),threadDescription:a[9],snippet:a[10],hasPendingInvitation:a[13],eventStartTimestampMs:a[14],eventEndTimestampMs:a[15],takedownState:a[16],cannotReplyReason:a[17],themeFbid:a[18],threadStatus:a[19],needsAdminApprovalForNewParticipant:a[20],joinRequestApprovalSetting:a[21],snippetText:a[24],hasPendingJoinRequest:a[25],capabilities:b.i64.cast([0,0]),capabilities2:b.i64.cast([0,0]),capabilities3:b.i64.cast([0,0]),capabilities4:b.i64.cast([0,0]),syncSource:a[26],disappearingThreadKey:c[5],isDisappearingMode:c[7]})):b.db.table(9).put({threadKey:a[0],parentThreadKey:a[1],mailboxType:b.i64.cast([0,0]),threadType:c[1],threadName:a[2],folderName:c[2],threadPictureUrl:a[3],threadPictureUrlFallback:a[4],threadPictureUrlExpirationTimestampMs:a[5],authorityLevel:a[6],lastActivityTimestampMs:a[7],lastReadWatermarkTimestampMs:a[8],muteExpireTimeMs:c[3],removeWatermarkTimestampMs:b.i64.cast([-1,4294967295]),ongoingCallState:b.i64.cast([0,0]),threadDescription:a[9],snippet:a[10],hasPendingInvitation:a[13],eventStartTimestampMs:a[14],eventEndTimestampMs:a[15],takedownState:a[16],cannotReplyReason:a[17],themeFbid:a[18],threadStatus:a[19],needsAdminApprovalForNewParticipant:a[20],joinRequestApprovalSetting:a[21],snippetText:a[24],hasPendingJoinRequest:a[25],capabilities:b.i64.cast([0,0]),capabilities2:b.i64.cast([0,0]),capabilities3:b.i64.cast([0,0]),capabilities4:b.i64.cast([0,0]),syncSource:a[26],disappearingThreadKey:c[5],isDisappearingMode:c[7]}):b.resolve())})},function(a){return b.resolve(d)}])}a.__sproc_name__="LSMailboxDeleteThenInsertCommunityUnjoinedThreadStoredProcedure";a.__tables__=["threads"];e.exports=a}),null);
__d("LSMinosVerifySingleEpoch.nop",["EBMinosQplFlow","Promise","gkx","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("EBMinosVerifySingleEpoch").__setRef("LSMinosVerifySingleEpoch.nop");a=function(a,e,f,g,j,k,l,m,n){if(!c("gkx")("14827"))return(h||(h=b("Promise"))).resolve([!1]);var o=d("EBMinosQplFlow").startMinosVerifySingleEpochQpl();return i.load().then(function(a){return a.minosVerifySingleEpoch(f,g,j,k,l,m,n,o)})};a.__nop_name__="LSMinosVerifySingleEpoch";g["default"]=a}),98);
__d("LSSetThreadImageURL",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.db.table(9).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({threadPictureUrl:a[1]===""?void 0:a[1],threadPictureUrlFallback:a[2],threadPictureUrlExpirationTimestampMs:a[3],isCustomThreadPicture:a[4],shouldRoundThreadPicture:a[5]})})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxSetThreadImageURLStoredProcedure";a.__tables__=["threads"];e.exports=a}),null);
__d("LSWriteMinosPublicKey.nop",["Promise","gkx","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("EBWriteMinosMailboxKeysToCache").__setRef("LSWriteMinosPublicKey.nop");a=function(a,d,e,f,g,j,k,l,m,n,o,p){return!c("gkx")("14827")?(h||(h=b("Promise"))).resolve():i.load().then(function(a){return a.writeMinosMailboxKeysToCache(e,f,g,j,k,l,m,n,o,p)})};a.__nop_name__="LSWriteMinosPublicKey";g["default"]=a}),98);
__d("LSDeleteThenInsertContact",["LSBase64Decode.nop","LSMinosVerifySingleEpoch.nop","LSQplAnnotateString.nop","LSQplMarkEnd.nop","LSQplMarkPoint.nop","LSQplStartTrace.nop","LSSetThreadImageURL","LSWriteMinosPublicKey.nop","gkx"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,d=a[a.length-1],e=[],f=[];return d.sequence([function(f){return d.sequence([function(c){return a[50]!==void 0?d.sequence([function(c){return d.nativeOperation(b("LSBase64Decode.nop"),a[50]).then(function(a){return a=a,e[16]=a[0],a})},function(a){return e[0]=e[16]}]):d.resolve(e[0]=void 0)},function(c){return a[52]!==void 0?d.sequence([function(c){return d.nativeOperation(b("LSBase64Decode.nop"),a[52]).then(function(a){return a=a,e[16]=a[0],a})},function(a){return e[1]=e[16]}]):d.resolve(e[1]=void 0)},function(c){return a[53]!==void 0?d.sequence([function(c){return d.nativeOperation(b("LSBase64Decode.nop"),a[53]).then(function(a){return a=a,e[16]=a[0],a})},function(a){return e[2]=e[16]}]):d.resolve(e[2]=void 0)},function(c){return a[55]!==void 0?d.sequence([function(c){return d.nativeOperation(b("LSBase64Decode.nop"),a[55]).then(function(a){return a=a,e[16]=a[0],a})},function(a){return e[3]=e[16]}]):d.resolve(e[3]=void 0)},function(c){return a[56]!==void 0?d.sequence([function(c){return d.nativeOperation(b("LSBase64Decode.nop"),a[56]).then(function(a){return a=a,e[16]=a[0],a})},function(a){return e[4]=e[16]}]):d.resolve(e[4]=void 0)},function(c){return a[57]!==void 0?d.sequence([function(c){return d.nativeOperation(b("LSBase64Decode.nop"),a[57]).then(function(a){return a=a,e[16]=a[0],a})},function(a){return e[5]=e[16]}]):d.resolve(e[5]=void 0)},function(c){return a[58]!==void 0?d.sequence([function(c){return d.nativeOperation(b("LSBase64Decode.nop"),a[58]).then(function(a){return a=a,e[16]=a[0],a})},function(a){return e[6]=e[16]}]):d.resolve(e[6]=void 0)},function(f){return c("gkx")("14857")&&c("gkx")("16269")||!1?d.sequence([function(a){return e[16]=d.i64.random(),e[26]=d.i64.to_string(e[16]),e[26]!==void 0?d.nativeOperation(b("LSQplStartTrace.nop"),d.i64.cast([0,1021648240]),e[26],!0,void 0):d.resolve()},function(c){return d.blobs.eq(e[2],void 0)&&d.blobs.eq(e[1],void 0)&&d.i64.eq(a[51],void 0)&&d.i64.eq(a[54],void 0)&&d.blobs.eq(e[3],void 0)&&d.blobs.eq(e[4],void 0)&&d.blobs.eq(e[5],void 0)&&d.blobs.eq(e[0],void 0)?d.sequence([function(a){return e[26]!==void 0?d.nativeOperation(b("LSQplMarkPoint.nop"),d.i64.cast([0,1021648240]),e[26],"dasm_minos_epoch_verify_minos_keys_null"):d.resolve()},function(a){return e[26]!==void 0?d.nativeOperation(b("LSQplMarkEnd.nop"),d.i64.cast([0,1021648240]),e[26],!0):d.resolve()},function(b){return b=[e[0],e[2],e[1],a[51],a[54],e[3],e[4],e[5],e[6]],e[17]=b[0],e[18]=b[1],e[19]=b[2],e[20]=b[3],e[21]=b[4],e[22]=b[5],e[23]=b[6],e[24]=b[7],e[25]=b[8],b}]):d.sequence([function(c){return d.blobs.neq(e[2],void 0)?d.sequence([function(c){return d.blobs.neq(e[4],void 0)?d.sequence([function(c){return d.blobs.neq(e[3],void 0)?d.sequence([function(c){return d.blobs.neq(e[0],void 0)?d.sequence([function(c){return d.blobs.neq(e[5],void 0)?d.sequence([function(c){return d.nativeOperation(b("LSMinosVerifySingleEpoch.nop"),e[2],a[0],e[3],e[0],e[4],e[6],e[5]).then(function(a){return a=a,e[41]=a[0],a})},function(c){return e[41]?d.sequence([function(a){return e[26]!==void 0?d.nativeOperation(b("LSQplMarkPoint.nop"),d.i64.cast([0,1021648240]),e[26],"dasm_minos_epoch_verify_native_op_success"):d.resolve()},function(a){return e[26]!==void 0?d.nativeOperation(b("LSQplMarkEnd.nop"),d.i64.cast([0,1021648240]),e[26],!0):d.resolve()}]):d.sequence([function(a){return e[26]!==void 0?d.nativeOperation(b("LSQplMarkPoint.nop"),d.i64.cast([0,1021648240]),e[26],"dasm_minos_epoch_verify_native_op_failure"):d.resolve()},function(c){return e[42]=["dasm_minos_epoch_verify_",".",["Key verification failed for contact id: ","",d.i64.to_string(a[0])].join("")].join(""),e[26]!==void 0?e[42]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,1021648240]),e[26],"error",e[42]):d.resolve():d.resolve()},function(a){return e[26]!==void 0?d.nativeOperation(b("LSQplMarkEnd.nop"),d.i64.cast([0,1021648240]),e[26],!1):d.resolve()}])},function(a){return e[40]=e[41]}]):d.sequence([function(a){return e[26]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,1021651939]),e[26],"dasm_error","MinosPublicKeyClientUtils: Missing or Null Epoch Signature Self"):d.resolve()},function(a){return e[26]!==void 0?d.nativeOperation(b("LSQplMarkEnd.nop"),d.i64.cast([0,1021648240]),e[26],!1):d.resolve()},function(a){return e[40]=!0}])},function(a){return e[39]=e[40]}]):d.sequence([function(a){return e[26]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,1021651939]),e[26],"dasm_error","MinosPublicKeyClientUtils: Missing or Null Minos Encryption Public Key"):d.resolve()},function(a){return e[26]!==void 0?d.nativeOperation(b("LSQplMarkEnd.nop"),d.i64.cast([0,1021648240]),e[26],!1):d.resolve()},function(a){return e[39]=!0}])},function(a){return e[38]=e[39]}]):d.sequence([function(a){return e[26]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,1021651939]),e[26],"dasm_error","MinosPublicKeyClientUtils: Missing or Null Minos Signing Public Key"):d.resolve()},function(a){return e[26]!==void 0?d.nativeOperation(b("LSQplMarkEnd.nop"),d.i64.cast([0,1021648240]),e[26],!1):d.resolve()},function(a){return e[38]=!0}])},function(a){return e[37]=e[38]}]):d.sequence([function(a){return e[26]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,1021651939]),e[26],"dasm_error","MinosPublicKeyClientUtils: Missing or Null Minos Auth Public Key"):d.resolve()},function(a){return e[26]!==void 0?d.nativeOperation(b("LSQplMarkEnd.nop"),d.i64.cast([0,1021648240]),e[26],!1):d.resolve()},function(a){return e[37]=!0}])},function(a){return e[27]=e[37]}]):d.sequence([function(a){return e[26]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,1021651939]),e[26],"dasm_error","MinosPublicKeyClientUtils: Missing or Null Minos Epoch Anon ID"):d.resolve()},function(a){return e[26]!==void 0?d.nativeOperation(b("LSQplMarkEnd.nop"),d.i64.cast([0,1021648240]),e[26],!1):d.resolve()},function(a){return e[27]=!0}])},function(b){return e[27]?(b=[e[0],e[2],e[1],a[51],a[54],e[3],e[4],e[5],e[6]],e[28]=b[0],e[29]=b[1],e[30]=b[2],e[31]=b[3],e[32]=b[4],e[33]=b[5],e[34]=b[6],e[35]=b[7],e[36]=b[8],b):(b=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0],e[28]=b[0],e[29]=b[1],e[30]=b[2],e[31]=b[3],e[32]=b[4],e[33]=b[5],e[34]=b[6],e[35]=b[7],e[36]=b[8],b),b=[e[28],e[29],e[30],e[31],e[32],e[33],e[34],e[35],e[36]],e[17]=b[0],e[18]=b[1],e[19]=b[2],e[20]=b[3],e[21]=b[4],e[22]=b[5],e[23]=b[6],e[24]=b[7],e[25]=b[8],b}])},function(a){return a=[e[17],e[18],e[19],e[20],e[21],e[22],e[23],e[24],e[25]],e[7]=a[0],e[8]=a[1],e[9]=a[2],e[10]=a[3],e[11]=a[4],e[12]=a[5],e[13]=a[6],e[14]=a[7],e[15]=a[8],a}]):d.resolve((f=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0],e[7]=f[0],e[8]=f[1],e[9]=f[2],e[10]=f[3],e[11]=f[4],e[12]=f[5],e[13]=f[6],e[14]=f[7],e[15]=f[8],f))},function(f){return c("gkx")("14857")&&c("gkx")("16269")||!1?0:0,c("gkx")("14857")&&c("gkx")("16269")||!1?d.nativeOperation(b("LSWriteMinosPublicKey.nop"),a[0],e[2],a[51],e[0],e[1],a[54],e[5],e[4],e[3],e[6]):d.resolve()},function(b){return d.i64.eq(a[23],d.i64.cast([0,39423]))?e[16]=d.i64.cast([0,1]):(d.i64.eq(a[23],d.i64.cast([0,14342874]))?e[17]=d.i64.cast([0,2]):e[17]=void 0,e[16]=e[17]),d.filter(d.db.table(7).fetch([[[a[0]]]]),function(b){return d.i64.eq(b.id,a[0])&&d.i64.eq(d.i64.cast([0,1]),d.i64.cast([0,1]))&&d.i64.gt(b.authorityLevel,a[21])}).next().then(function(b){var c=b.done;b.value;return c?d.db.table(7).put({id:a[0],profilePictureUrl:a[2],profilePictureFallbackUrl:a[3],profilePictureUrlExpirationTimestampMs:a[4],profilePictureLargeUrl:a[5],profilePictureLargeFallbackUrl:a[6],profilePictureLargeUrlExpirationTimestampMs:a[7],name:a[9],secondaryName:a[41],normalizedNameForSearch:a[10],normalizedSearchTerms:a[33],isMessengerUser:a[11],isMemorialized:a[12],isManagedByViewer:a[35],blockedByViewerStatus:a[14],rank:a[17],firstName:a[18],contactType:a[19],contactTypeExact:a[20],authorityLevel:a[21],messengerCallLogThirdPartyId:a[22],profileRingColor:a[23],requiresMultiway:a[24],blockedSinceTimestampMs:a[25],fbUnblockedSinceTimestampMs:a[48],canViewerMessage:a[26],profileRingColorExpirationTimestampMs:a[27],phoneNumber:a[28],emailAddress:a[29],workCompanyId:a[30],workCompanyName:a[31],workJobTitle:a[32],deviceContactId:a[34],workForeignEntityType:a[36],capabilities:a[37],capabilities2:a[38],profileRingState:e[16],contactViewerRelationship:a[39],gender:a[40],username:a[43],contactReachabilityStatusType:a[44],friendshipStatus:a[45],restrictionType:a[46],waConnectStatus:a[47],isEmployee:!1,pageType:a[49]}):0})},function(c){return d.storedProcedure(b("LSSetThreadImageURL"),a[0],a[2],a[3],a[4],!1,!0)}])},function(a){return d.resolve(f)}])}a.__sproc_name__="LSContactDeleteThenInsertContactStoredProcedure";a.__tables__=["contacts"];d=a;g["default"]=d}),98);
__d("LSDeleteThenInsertMessageRequest",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.db.table(34).put({threadKey:a[0],messageRequestStatus:a[2]})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxDeleteThenInsertMessageRequestStoredProcedure";a.__tables__=["message_requests"];e.exports=a}),null);
__d("LSDeleteThenInsertNotificationsSettingsGraphQLSnapshot",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.db.table(175).put({id:a[0],globalMuteUntil:a[1],showMessagePreview:a[4],isSoundOn:a[7],groupNotificationSetting:a[8],oneToOneNotificationSetting:a[9],replyReminderSetting:a[10],messageReminderDisabled:a[12],messageSound:a[13],ringtoneSound:a[14],newFriendBumpDisabledSetting:a[15],globalMuteMessageUntil:a[2],globalMuteCallUntil:a[3],includeInSwitchAccountBadges:a[11],dismissNfbThreadsCount:a[16],mutePageAccountMessageReminder:a[17]})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSOmnistoreSettingsDeleteThenInsertNotificationsSettingsGraphQLSnapshotStoredProcedure";a.__tables__=["notification_settings"];e.exports=a}),null);
__d("LSDeleteThenInsertRankingRequest",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.db.table(135).put({scoreType:a[0],requestId:a[1]})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSRankingDeleteThenInsertRankingRequestStoredProcedure";a.__tables__=["ranking_requests"];e.exports=a}),null);
__d("LSDeleteThenInsertRankingScore",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.db.table(134).put({contactId:a[0],scoreType:a[1],contactType:a[2],score:a[3],scoreIndex:a[4]})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSRankingDeleteThenInsertRankingScoreStoredProcedure";a.__tables__=["ranking_scores"];e.exports=a}),null);
__d("LSDeleteThenInsertThread",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(d){return b.db.table(9).fetch([[[a[7]]]]).next().then(function(d,e){var f=d.done;d=d.value;return f?b.db.table(9).put({threadKey:a[7],lastReadWatermarkTimestampMs:a[1],authorityLevel:a[6],mailboxType:a[8],threadType:a[9],folderName:a[10],ongoingCallState:a[29],parentThreadKey:a[35],lastActivityTimestampMs:a[0],snippet:a[2],threadName:a[3],threadPictureUrl:a[4],needsAdminApprovalForNewParticipant:a[5],threadPictureUrlFallback:a[11],threadPictureUrlExpirationTimestampMs:a[12],removeWatermarkTimestampMs:a[13],muteExpireTimeMs:a[14],muteCallsExpireTimeMs:a[15],groupNotificationSettings:a[16],isAdminSnippet:a[17],snippetSenderContactId:a[18],snippetText:a[20],snippetStringHash:a[21],snippetStringArgument1:a[22],snippetAttribution:a[23],snippetAttributionStringHash:a[24],disappearingSettingTtl:a[25],disappearingSettingUpdatedTs:a[26],disappearingSettingUpdatedBy:a[27],cannotReplyReason:a[30],customEmoji:a[31],customEmojiImageUrl:a[32],outgoingBubbleColor:a[33],themeFbid:a[34],nullstateDescriptionText1:a[36],nullstateDescriptionType1:a[37],nullstateDescriptionText2:a[38],nullstateDescriptionType2:a[39],nullstateDescriptionText3:a[40],nullstateDescriptionType3:a[41],snippetHasEmoji:a[42],hasPersistentMenu:a[43],disableComposerInput:a[44],cannotUnsendReason:a[45],viewedPluginKey:a[46],viewedPluginContext:a[47],clientThreadKey:a[48],capabilities:a[49],shouldRoundThreadPicture:a[50],proactiveWarningDismissTime:a[51],isCustomThreadPicture:a[52],otidOfFirstMessage:a[53],normalizedSearchTerms:a[54],additionalThreadContext:a[55],disappearingThreadKey:a[56],isDisappearingMode:a[57],disappearingModeInitiator:a[58],unreadDisappearingMessageCount:a[59],lastMessageCtaId:a[61],lastMessageCtaType:a[62],consistentThreadFbid:a[63],threadDescription:a[64],unsendLimitMs:a[65],syncGroup:a[66],threadInvitesEnabled:a[67],threadInviteLink:a[68],numUnreadSubthreads:a[69],subthreadCount:a[70],threadInvitesEnabledV2:a[71],joinRequestApprovalSetting:a[72],pendingJoinRequestsCount:a[73],eventStartTimestampMs:a[74],eventEndTimestampMs:a[75],takedownState:a[76],memberCount:a[77],admodCount:a[78],secondaryParentThreadKey:a[79],igFolder:a[80],inviterId:a[81],threadTags:a[82],readReceiptsDisabledV2:a[83],threadStatus:a[84],threadSubtype:a[85],pauseThreadTimestamp:a[86],metadata:a[87],syncSource:a[88]}):(e=d.item,c[1]=e.lastActivityTimestampMs,c[3]=e.parentThreadKey,c[2]=e.disappearingThreadKey,c[4]=e.isDisappearingMode,b.i64.le(e.authorityLevel,a[6])?b.i64.gt(c[1],a[0])&&b.i64.neq(c[2],void 0)?(b.i64.eq(a[35],b.i64.cast([-1,4294967286]))&&b.i64.eq(c[3],b.i64.cast([0,0]))?(f=[c[3],e.folderName],c[5]=f[0],c[6]=f[1],f):(d=[a[35],a[10]],c[5]=d[0],c[6]=d[1],d),b.db.table(9).put({threadKey:a[7],lastReadWatermarkTimestampMs:e.lastReadWatermarkTimestampMs,authorityLevel:a[6],mailboxType:a[8],threadType:a[9],folderName:c[6],ongoingCallState:a[29],parentThreadKey:c[5],lastActivityTimestampMs:c[1],snippet:a[2],threadName:a[3],threadPictureUrl:a[4],needsAdminApprovalForNewParticipant:a[5],threadPictureUrlFallback:a[11],threadPictureUrlExpirationTimestampMs:a[12],removeWatermarkTimestampMs:a[13],muteExpireTimeMs:a[14],muteCallsExpireTimeMs:a[15],groupNotificationSettings:a[16],isAdminSnippet:a[17],snippetSenderContactId:a[18],snippetText:a[20],snippetStringHash:a[21],snippetStringArgument1:a[22],snippetAttribution:a[23],snippetAttributionStringHash:a[24],disappearingSettingTtl:a[25],disappearingSettingUpdatedTs:a[26],disappearingSettingUpdatedBy:a[27],cannotReplyReason:a[30],customEmoji:a[31],customEmojiImageUrl:a[32],outgoingBubbleColor:a[33],themeFbid:a[34],nullstateDescriptionText1:a[36],nullstateDescriptionType1:a[37],nullstateDescriptionText2:a[38],nullstateDescriptionType2:a[39],nullstateDescriptionText3:a[40],nullstateDescriptionType3:a[41],snippetHasEmoji:a[42],hasPersistentMenu:a[43],disableComposerInput:a[44],cannotUnsendReason:a[45],viewedPluginKey:a[46],viewedPluginContext:a[47],clientThreadKey:a[48],capabilities:a[49],shouldRoundThreadPicture:a[50],proactiveWarningDismissTime:a[51],isCustomThreadPicture:a[52],otidOfFirstMessage:a[53],normalizedSearchTerms:a[54],additionalThreadContext:a[55],disappearingThreadKey:c[2],isDisappearingMode:c[4],disappearingModeInitiator:a[58],unreadDisappearingMessageCount:a[59],lastMessageCtaId:a[61],lastMessageCtaType:a[62],consistentThreadFbid:a[63],threadDescription:a[64],unsendLimitMs:a[65],syncGroup:a[66],threadInvitesEnabled:a[67],threadInviteLink:a[68],numUnreadSubthreads:a[69],subthreadCount:a[70],threadInvitesEnabledV2:a[71],joinRequestApprovalSetting:a[72],pendingJoinRequestsCount:a[73],eventStartTimestampMs:a[74],eventEndTimestampMs:a[75],takedownState:a[76],memberCount:a[77],admodCount:a[78],secondaryParentThreadKey:a[79],igFolder:a[80],inviterId:a[81],threadTags:a[82],readReceiptsDisabledV2:a[83],threadStatus:a[84],threadSubtype:a[85],pauseThreadTimestamp:a[86],metadata:a[87],syncSource:a[88]})):b.db.table(9).put({threadKey:a[7],lastReadWatermarkTimestampMs:a[1],authorityLevel:a[6],mailboxType:a[8],threadType:a[9],folderName:a[10],ongoingCallState:a[29],parentThreadKey:a[35],lastActivityTimestampMs:a[0],snippet:a[2],threadName:a[3],threadPictureUrl:a[4],needsAdminApprovalForNewParticipant:a[5],threadPictureUrlFallback:a[11],threadPictureUrlExpirationTimestampMs:a[12],removeWatermarkTimestampMs:a[13],muteExpireTimeMs:a[14],muteCallsExpireTimeMs:a[15],groupNotificationSettings:a[16],isAdminSnippet:a[17],snippetSenderContactId:a[18],snippetText:a[20],snippetStringHash:a[21],snippetStringArgument1:a[22],snippetAttribution:a[23],snippetAttributionStringHash:a[24],disappearingSettingTtl:a[25],disappearingSettingUpdatedTs:a[26],disappearingSettingUpdatedBy:a[27],cannotReplyReason:a[30],customEmoji:a[31],customEmojiImageUrl:a[32],outgoingBubbleColor:a[33],themeFbid:a[34],nullstateDescriptionText1:a[36],nullstateDescriptionType1:a[37],nullstateDescriptionText2:a[38],nullstateDescriptionType2:a[39],nullstateDescriptionText3:a[40],nullstateDescriptionType3:a[41],snippetHasEmoji:a[42],hasPersistentMenu:a[43],disableComposerInput:a[44],cannotUnsendReason:a[45],viewedPluginKey:a[46],viewedPluginContext:a[47],clientThreadKey:a[48],capabilities:a[49],shouldRoundThreadPicture:a[50],proactiveWarningDismissTime:a[51],isCustomThreadPicture:a[52],otidOfFirstMessage:a[53],normalizedSearchTerms:a[54],additionalThreadContext:a[55],disappearingThreadKey:c[2],isDisappearingMode:c[4],disappearingModeInitiator:a[58],unreadDisappearingMessageCount:a[59],lastMessageCtaId:a[61],lastMessageCtaType:a[62],consistentThreadFbid:a[63],threadDescription:a[64],unsendLimitMs:a[65],syncGroup:a[66],threadInvitesEnabled:a[67],threadInviteLink:a[68],numUnreadSubthreads:a[69],subthreadCount:a[70],threadInvitesEnabledV2:a[71],joinRequestApprovalSetting:a[72],pendingJoinRequestsCount:a[73],eventStartTimestampMs:a[74],eventEndTimestampMs:a[75],takedownState:a[76],memberCount:a[77],admodCount:a[78],secondaryParentThreadKey:a[79],igFolder:a[80],inviterId:a[81],threadTags:a[82],readReceiptsDisabledV2:a[83],threadStatus:a[84],threadSubtype:a[85],pauseThreadTimestamp:a[86],metadata:a[87],syncSource:a[88]}):b.resolve())})},function(a){return b.resolve(d)}])}a.__sproc_name__="LSMailboxDeleteThenInsertThreadStoredProcedure";a.__tables__=["threads"];e.exports=a}),null);
__d("LSShimHybridThreadDeleteByThreadKey.nop",[],(function(a,b,c,d,e,f){"use strict";a=async function(a,b,c){};a.__nop_name__="LSShimHybridThreadDeleteByThreadKey";f.default=a}),66);
__d("LSHybridThreadDelete",["LSShimHybridThreadDeleteByThreadKey.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[];return c.sequence([function(d){return c.nativeOperation(b("LSShimHybridThreadDeleteByThreadKey.nop"),a[0])},function(a){return c.resolve(d)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxHybridThreadDeleteStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSInsertAttachmentCta",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.db.table(19).add({ctaId:a[0],attachmentFbid:a[1],attachmentIndex:a[2],threadKey:a[3],messageId:a[5],title:a[6],type_:a[7],platformToken:a[8],actionUrl:a[9],nativeUrl:a[10],urlWebviewType:a[11],actionContentBlob:a[12],enableExtensions:a[13],extensionHeightType:a[14],targetId:a[15]})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxInsertAttachmentCtaStoredProcedure";a.__tables__=["attachment_ctas"];e.exports=a}),null);
__d("LSInsertBlobAttachment",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.sequence([function(c){return b.forEach(b.filter(b.db.table(16).fetch([[[a[27],a[32],a[34]]]]),function(c){return b.i64.eq(c.threadKey,a[27])&&b.i64.eq(b.i64.cast([0,0]),a[28])&&c.messageId===a[32]&&c.attachmentFbid===a[34]&&b.i64.lt(c.authorityLevel,a[48])&&(b.i64.eq(c.attachmentType,b.i64.cast([0,2]))||b.i64.eq(c.attachmentType,b.i64.cast([0,3]))||b.i64.eq(c.attachmentType,b.i64.cast([0,4]))||b.i64.eq(c.attachmentType,b.i64.cast([0,5]))||b.i64.eq(c.attachmentType,b.i64.cast([0,6]))||b.i64.eq(c.attachmentType,b.i64.cast([0,10]))||b.i64.eq(c.attachmentType,b.i64.cast([0,14]))||b.i64.eq(c.attachmentType,b.i64.cast([0,15])))&&b.i64.eq(c.ephemeralMediaState,void 0)&&c.isSharable===!1}),function(a){return a["delete"]()})},function(c){return b.db.table(16).add({threadKey:a[27],messageId:a[32],attachmentFbid:a[34],filename:a[0],filesize:a[1],hasMedia:a[2],isSharable:!1,playableUrl:a[3],playableUrlFallback:a[4],playableUrlExpirationTimestampMs:a[5],playableUrlMimeType:a[6],dashManifest:a[7],previewUrl:a[8],previewUrlFallback:a[9],previewUrlExpirationTimestampMs:a[10],previewUrlMimeType:a[11],miniPreview:a[13],previewWidth:a[14],previewHeight:a[15],attributionAppId:a[16],attributionAppName:a[17],attributionAppIcon:a[18],attributionAppIconFallback:a[19],attributionAppIconUrlExpirationTimestampMs:a[20],localPlayableUrl:a[21],playableDurationMs:a[22],attachmentIndex:a[23],accessibilitySummaryText:a[24],isPreviewImage:a[25],originalFileHash:a[26],attachmentType:a[29],timestampMs:a[31],offlineAttachmentId:a[33],hasXma:a[35],xmaLayoutType:a[36],xmasTemplateType:a[37],titleText:a[38],subtitleText:a[39],descriptionText:a[40],sourceText:a[41],faviconUrlExpirationTimestampMs:a[42],isBorderless:a[44],previewUrlLarge:a[45],samplingFrequencyHz:a[46],waveformData:a[47],authorityLevel:a[48]})}])},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxInsertBlobAttachmentStoredProcedure";a.__tables__=["attachments"];e.exports=a}),null);
__d("LSIssueInsertPersistentMenuItemsForThreadTask",["LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return d[0]=new c.Map(),d[0].set("thread_key",a[0]),d[1]=c.toJSON(d[0]),c.storedProcedure(b("LSIssueNewTask"),"insert_persistent_menu_items",c.i64.cast([0,117]),d[1],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))},function(a){return c.resolve(e)}])}a.__sproc_name__="LSOmnistoreSettingsIssueInsertPersistentMenuItemsForThreadTaskStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSSetForwardScore",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.filter(b.db.table(12).fetch([[[a[0],a[2],a[1]]]]),function(c){return b.i64.eq(c.threadKey,a[0])&&b.i64.eq(b.i64.cast([0,0]),b.i64.cast([0,0]))&&b.i64.eq(c.timestampMs,a[2])&&c.messageId===a[1]}),function(b){var c=b.update;b.item;return c({forwardScore:a[3]})})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxSetForwardScoreStoredProcedure";a.__tables__=["messages"];e.exports=a}),null);
__d("LSGroupRoomTruncate",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(a){return b.forEach(b.filter(b.db.table(63).fetch(),function(a){return b.i64.neq(a.groupRoomType,void 0)&&b.i64.neq(a.groupRoomType,b.i64.cast([0,5]))}),function(a){return a["delete"]()})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSStoriesGroupRoomTruncateStoredProcedure";a.__tables__=["rooms"];e.exports=a}),null);
__d("LSUpdateOrInsertThread",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(d){return b.db.table(9).fetch([[[a[7]]]]).next().then(function(d,e){var f=d.done;d=d.value;return f?b.db.table(9).add({threadKey:a[7],lastReadWatermarkTimestampMs:a[1],authorityLevel:a[6],mailboxType:a[8],threadType:a[9],folderName:a[10],ongoingCallState:a[32],parentThreadKey:a[38],lastActivityTimestampMs:a[0],snippet:a[2],threadName:a[3],threadPictureUrl:a[4],needsAdminApprovalForNewParticipant:a[5],threadPictureUrlFallback:a[11],threadPictureUrlExpirationTimestampMs:a[12],removeWatermarkTimestampMs:a[13],muteExpireTimeMs:a[14],muteMentionExpireTimeMs:a[15],muteCallsExpireTimeMs:a[16],groupNotificationSettings:a[19],isAdminSnippet:a[20],snippetSenderContactId:a[21],snippetText:a[23],snippetStringHash:a[24],snippetStringArgument1:a[25],snippetAttribution:a[26],snippetAttributionStringHash:a[27],disappearingSettingTtl:a[28],disappearingSettingUpdatedTs:a[29],disappearingSettingUpdatedBy:a[30],cannotReplyReason:a[33],customEmoji:a[34],customEmojiImageUrl:a[35],outgoingBubbleColor:a[36],themeFbid:a[37],nullstateDescriptionText1:a[39],nullstateDescriptionType1:a[40],nullstateDescriptionText2:a[41],nullstateDescriptionType2:a[42],nullstateDescriptionText3:a[43],nullstateDescriptionType3:a[44],snippetHasEmoji:a[45],hasPersistentMenu:a[46],disableComposerInput:a[47],cannotUnsendReason:a[48],viewedPluginKey:a[49],viewedPluginContext:a[50],clientThreadKey:a[51],capabilities:a[52],shouldRoundThreadPicture:a[53],proactiveWarningDismissTime:a[54],isCustomThreadPicture:a[55],otidOfFirstMessage:a[56],normalizedSearchTerms:a[57],additionalThreadContext:a[58],disappearingThreadKey:a[59],isDisappearingMode:a[60],disappearingModeInitiator:a[61],unreadDisappearingMessageCount:a[62],lastMessageCtaId:a[64],lastMessageCtaType:a[65],lastMessageCtaTimestampMs:a[66],consistentThreadFbid:a[67],threadDescription:a[69],unsendLimitMs:a[70],capabilities2:a[78],capabilities3:a[79],syncGroup:a[82],threadInvitesEnabled:a[83],threadInviteLink:a[84],isAllUnreadMessageMissedCallXma:a[85],numUnreadSubthreads:a[86],subthreadCount:a[87],lastNonMissedCallXmaMessageTimestampMs:a[88],isHidden:a[89],threadInvitesEnabledV2:a[90],joinRequestApprovalSetting:a[93],hasPendingInvitation:a[94],eventStartTimestampMs:a[95],eventEndTimestampMs:a[96],takedownState:a[97],secondaryParentThreadKey:a[98],igFolder:a[99],inviterId:a[100],threadTags:a[101],isReadReceiptsDisabled:a[102],readReceiptsDisabledV2:a[103],threadStatus:a[104],threadSubtype:a[105],pauseThreadTimestamp:a[106],metadata:a[107],capabilities4:a[108],syncSource:a[109],capabilities5:a[110],ongoingCallTimestampMs:a[111]}):(e=d.item,c[1]=e.lastActivityTimestampMs,c[3]=e.parentThreadKey,c[2]=e.disappearingThreadKey,c[4]=e.isDisappearingMode,b.i64.le(e.authorityLevel,a[6])?b.i64.gt(c[1],a[0])&&b.i64.neq(c[2],void 0)?(b.i64.eq(a[38],b.i64.cast([-1,4294967286]))&&b.i64.eq(c[3],b.i64.cast([0,0]))?(f=[c[3],e.folderName],c[5]=f[0],c[6]=f[1],f):(d=[a[38],a[10]],c[5]=d[0],c[6]=d[1],d),b.forEach(b.db.table(9).fetch([[[a[7]]]]),function(b){var d=b.update;b.item;return d({lastReadWatermarkTimestampMs:e.lastReadWatermarkTimestampMs,authorityLevel:a[6],mailboxType:a[8],threadType:a[9],folderName:c[6],ongoingCallState:a[32],parentThreadKey:c[5],lastActivityTimestampMs:c[1],snippet:a[2],threadName:a[3],threadPictureUrl:a[4],needsAdminApprovalForNewParticipant:a[5],threadPictureUrlFallback:a[11],threadPictureUrlExpirationTimestampMs:a[12],removeWatermarkTimestampMs:a[13],muteExpireTimeMs:a[14],muteMentionExpireTimeMs:a[15],muteCallsExpireTimeMs:a[16],groupNotificationSettings:a[19],isAdminSnippet:a[20],snippetSenderContactId:a[21],snippetText:a[23],snippetStringHash:a[24],snippetStringArgument1:a[25],snippetAttribution:a[26],snippetAttributionStringHash:a[27],disappearingSettingTtl:a[28],disappearingSettingUpdatedTs:a[29],disappearingSettingUpdatedBy:a[30],cannotReplyReason:a[33],customEmoji:a[34],customEmojiImageUrl:a[35],outgoingBubbleColor:a[36],themeFbid:a[37],nullstateDescriptionText1:a[39],nullstateDescriptionType1:a[40],nullstateDescriptionText2:a[41],nullstateDescriptionType2:a[42],nullstateDescriptionText3:a[43],nullstateDescriptionType3:a[44],snippetHasEmoji:a[45],hasPersistentMenu:a[46],disableComposerInput:a[47],cannotUnsendReason:a[48],viewedPluginKey:a[49],viewedPluginContext:a[50],clientThreadKey:a[51],capabilities:a[52],shouldRoundThreadPicture:a[53],proactiveWarningDismissTime:a[54],isCustomThreadPicture:a[55],otidOfFirstMessage:a[56],normalizedSearchTerms:a[57],additionalThreadContext:a[58],disappearingThreadKey:c[2],isDisappearingMode:c[4],disappearingModeInitiator:a[61],unreadDisappearingMessageCount:a[62],lastMessageCtaId:a[64],lastMessageCtaType:a[65],lastMessageCtaTimestampMs:a[66],consistentThreadFbid:a[67],threadDescription:a[69],unsendLimitMs:a[70],capabilities2:a[78],capabilities3:a[79],syncGroup:a[82],threadInvitesEnabled:a[83],threadInviteLink:a[84],isAllUnreadMessageMissedCallXma:a[85],numUnreadSubthreads:a[86],subthreadCount:a[87],lastNonMissedCallXmaMessageTimestampMs:a[88],isHidden:a[89],threadInvitesEnabledV2:a[90],joinRequestApprovalSetting:a[93],hasPendingInvitation:a[94],eventStartTimestampMs:a[95],eventEndTimestampMs:a[96],takedownState:a[97],secondaryParentThreadKey:a[98],igFolder:a[99],inviterId:a[100],threadTags:a[101],isReadReceiptsDisabled:a[102],readReceiptsDisabledV2:a[103],threadStatus:a[104],threadSubtype:a[105],pauseThreadTimestamp:a[106],metadata:a[107],capabilities4:a[108],syncSource:a[109],capabilities5:a[110],ongoingCallTimestampMs:a[111],avatarStickerInstructionKeyId:void 0,avatarStickerId:void 0,avatarStickerThumbnailImageUrl:void 0,avatarStickerThumbnailImageMimeType:void 0,avatarStickerOriginalImageUrl:void 0,avatarStickerOriginalImageMimeType:void 0,hasPendingJoinRequest:void 0,pendingJoinRequestsCount:void 0,memberCount:void 0,admodCount:void 0,ctmAdId:void 0,ctmAdgroupId:void 0,ctmAdCampaignId:void 0,ctmAdCampaignGroupId:void 0,ctmAdAccountId:void 0,typingIndicatorDisabled:void 0})})):b.forEach(b.db.table(9).fetch([[[a[7]]]]),function(b){var d=b.update;b.item;return d({lastReadWatermarkTimestampMs:a[1],authorityLevel:a[6],mailboxType:a[8],threadType:a[9],folderName:a[10],ongoingCallState:a[32],parentThreadKey:a[38],lastActivityTimestampMs:a[0],snippet:a[2],threadName:a[3],threadPictureUrl:a[4],needsAdminApprovalForNewParticipant:a[5],threadPictureUrlFallback:a[11],threadPictureUrlExpirationTimestampMs:a[12],removeWatermarkTimestampMs:a[13],muteExpireTimeMs:a[14],muteMentionExpireTimeMs:a[15],muteCallsExpireTimeMs:a[16],groupNotificationSettings:a[19],isAdminSnippet:a[20],snippetSenderContactId:a[21],snippetText:a[23],snippetStringHash:a[24],snippetStringArgument1:a[25],snippetAttribution:a[26],snippetAttributionStringHash:a[27],disappearingSettingTtl:a[28],disappearingSettingUpdatedTs:a[29],disappearingSettingUpdatedBy:a[30],cannotReplyReason:a[33],customEmoji:a[34],customEmojiImageUrl:a[35],outgoingBubbleColor:a[36],themeFbid:a[37],nullstateDescriptionText1:a[39],nullstateDescriptionType1:a[40],nullstateDescriptionText2:a[41],nullstateDescriptionType2:a[42],nullstateDescriptionText3:a[43],nullstateDescriptionType3:a[44],snippetHasEmoji:a[45],hasPersistentMenu:a[46],disableComposerInput:a[47],cannotUnsendReason:a[48],viewedPluginKey:a[49],viewedPluginContext:a[50],clientThreadKey:a[51],capabilities:a[52],shouldRoundThreadPicture:a[53],proactiveWarningDismissTime:a[54],isCustomThreadPicture:a[55],otidOfFirstMessage:a[56],normalizedSearchTerms:a[57],additionalThreadContext:a[58],disappearingThreadKey:c[2],isDisappearingMode:c[4],disappearingModeInitiator:a[61],unreadDisappearingMessageCount:a[62],lastMessageCtaId:a[64],lastMessageCtaType:a[65],lastMessageCtaTimestampMs:a[66],consistentThreadFbid:a[67],threadDescription:a[69],unsendLimitMs:a[70],capabilities2:a[78],capabilities3:a[79],syncGroup:a[82],threadInvitesEnabled:a[83],threadInviteLink:a[84],isAllUnreadMessageMissedCallXma:a[85],numUnreadSubthreads:a[86],subthreadCount:a[87],lastNonMissedCallXmaMessageTimestampMs:a[88],isHidden:a[89],threadInvitesEnabledV2:a[90],joinRequestApprovalSetting:a[93],hasPendingInvitation:a[94],eventStartTimestampMs:a[95],eventEndTimestampMs:a[96],takedownState:a[97],secondaryParentThreadKey:a[98],igFolder:a[99],inviterId:a[100],threadTags:a[101],isReadReceiptsDisabled:a[102],readReceiptsDisabledV2:a[103],threadStatus:a[104],threadSubtype:a[105],pauseThreadTimestamp:a[106],metadata:a[107],capabilities4:a[108],syncSource:a[109],capabilities5:a[110],ongoingCallTimestampMs:a[111],avatarStickerInstructionKeyId:void 0,avatarStickerId:void 0,avatarStickerThumbnailImageUrl:void 0,avatarStickerThumbnailImageMimeType:void 0,avatarStickerOriginalImageUrl:void 0,avatarStickerOriginalImageMimeType:void 0,hasPendingJoinRequest:void 0,pendingJoinRequestsCount:void 0,memberCount:void 0,admodCount:void 0,ctmAdId:void 0,ctmAdgroupId:void 0,ctmAdCampaignId:void 0,ctmAdCampaignGroupId:void 0,ctmAdAccountId:void 0,typingIndicatorDisabled:void 0})}):b.resolve())})},function(a){return b.resolve(d)}])}a.__sproc_name__="LSMailboxUpdateOrInsertThreadStoredProcedure";a.__tables__=["threads"];e.exports=a}),null);
__d("LSPopulateCommunityFolderData",["LSDeleteThenInsertCommunityFolder","LSUpdateOrInsertThread"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[];return c.sequence([function(d){return c.sequence([function(d){return c.storedProcedure(b("LSDeleteThenInsertCommunityFolder"),a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],void 0,void 0,void 0,a[11],a[12],a[13],a[14],a[15],void 0,a[16],a[17],a[18],void 0,a[19],a[20],a[21],a[22],a[23],void 0,void 0,a[24],a[26],void 0,void 0,a[25],a[37],void 0,void 0,c.i64.cast([0,0]),a[29],void 0,c.i64.cast([0,1]),a[28],a[27],a[30],a[31],a[32],a[33],void 0,a[34],a[35],a[36],a[38],a[39],void 0,void 0,c.i64.cast([0,80]))},function(d){return c.storedProcedure(b("LSUpdateOrInsertThread"),a[8],a[9],a[10],a[2],a[5],void 0,c.i64.cast([0,80]),a[0],c.i64.cast([0,0]),c.i64.cast([0,17]),"community",a[6],a[7],c.i64.cast([0,0]),c.i64.cast([0,0]),c.i64.cast([0,0]),c.i64.cast([0,0]),c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,!1,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,void 0,void 0,void 0,c.i64.cast([-1,4294967282]),void 0,void 0,void 0,void 0,void 0,void 0,!1,!1,!1,void 0,void 0,void 0,void 0,c.i64.cast([0,0]),void 0,void 0,!1,void 0,void 0,void 0,void 0,!1,void 0,c.i64.cast([0,0]),void 0,c.i64.cast([0,0]),void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,0]),void 0,void 0,void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,void 0,c.i64.cast([0,0]),void 0,!1,void 0,void 0,void 0,!1,c.i64.cast([0,0]),void 0,void 0,void 0,void 0,void 0,void 0,void 0,a[40],void 0,void 0,void 0,!1,c.i64.cast([0,0]),void 0,void 0,void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),c.i64.cast([0,0]),void 0)}])},function(a){return c.resolve(d)}])}a.__sproc_name__="LSMailboxPopulateCommunityFolderDataStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSRemoveTask",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(d){return b.db.table(2).fetch([[[a[0]]]]).next().then(function(d,e){var f=d.done;d=d.value;return f?0:(e=d.item,b.forEach(b.db.table(2).fetch([[[e.queueName,{lte:a[0]}]],"queueNameTaskId"]),function(a){var d=a.item;return b.sequence([function(a){return c[0]=d.taskDispatchPriority,b.forEach(b.filter(b.db.table(2).fetch([[[d.taskId]]]),function(a){return b.i64.eq(a.taskId,d.taskId)&&a.queueName===d.queueName}),function(a){return a["delete"]()})},function(a){return b.i64.eq(c[0],b.i64.cast([0,1e3]))||b.i64.eq(c[0],b.i64.cast([0,2e3]))?c[1]=b.i64.cast([0,734739218]):c[1]=b.i64.cast([0,734737036])}])}))})},function(a){return b.resolve(d)}])}a.__sproc_name__="LSCoreRemoveTaskStoredProcedure";a.__tables__=["pending_tasks"];e.exports=a}),null);
__d("LSRoomTruncate",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(a){return b.forEach(b.filter(b.db.table(63).fetch(),function(a){return b.i64.eq(a.groupRoomType,void 0)||b.i64.eq(a.groupRoomType,b.i64.cast([0,5]))}),function(a){return a["delete"]()})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSStoriesRoomTruncateStoredProcedure";a.__tables__=["rooms"];e.exports=a}),null);
__d("LSSetRegionHint",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.db.table(1).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({regionHint:a[1]})})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSCoreSetRegionHintStoredProcedure";a.__tables__=["sync_groups"];e.exports=a}),null);
__d("LSTaskExists",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(e){return b.sequence([function(d){return b.db.table(2).fetch([[[a[0]]]]).next().then(function(a,b){b=a.done;a=a.value;return b?c[0]=!1:(a.item,c[0]=!0)})},function(a){return d[0]=c[0]}])},function(a){return b.resolve(d)}])}a.__sproc_name__="LSCoreTaskExistsStoredProcedure";a.__tables__=["pending_tasks"];e.exports=a}),null);
__d("LSTruncateCommunityListTable",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(a){return b.forEach(b.db.table(166).fetch(),function(a){return a["delete"]()})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSOmnistoreSettingsTruncateCommunityListTableStoredProcedure";a.__tables__=["cm_community_list"];e.exports=a}),null);
__d("LSTruncateNotificationSettings",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(a){return b.forEach(b.db.table(175).fetch(),function(a){return a["delete"]()})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSOmnistoreSettingsTruncateNotificationSettingsStoredProcedure";a.__tables__=["notification_settings"];e.exports=a}),null);
__d("LSUpdateLastSyncCompletedTimestampMsToNow",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(d){return c[0]=b.i64.of_float(Date.now()),b.forEach(b.db.table(1).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({lastSyncCompletedTimestampMs:c[0]})})},function(a){return b.resolve(d)}])}a.__sproc_name__="LSCoreUpdateLastSyncCompletedTimestampMsToNowStoredProcedure";a.__tables__=["sync_groups"];e.exports=a}),null);
__d("LSUpsertGradientColor",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.db.table(117).put({themeFbid:a[0],gradientIndex:a[1],color:a[2],type_:a[3]})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSThreadThemeUpsertGradientColorStoredProcedure";a.__tables__=["gradient_colors"];e.exports=a}),null);
__d("LSUpsertSequenceId",["LSGetViewerFBID"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(a){return c.storedProcedure(b("LSGetViewerFBID")).then(function(a){return a=a,d[0]=a[0],a})},function(b){return c.i64.neq(a[1],void 0)?d[1]=a[1]:d[1]=d[0],c.db.table(25).put({id:d[1],lastAppliedMailboxSequenceId:a[0]})}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxUpsertSequenceIdStoredProcedure";a.__tables__=["mailbox_metadata"];e.exports=a}),null);
__d("LSUpsertTheme",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(d){return b.i64.neq(a[12],void 0)?c[0]=a[12]:c[0]=a[0],b.db.table(116).put({fbid:a[0],themeIdx:a[1],fallbackColor:a[2],reverseGradiantsForRadial:a[3],accessibilityLabel:a[4],iconUrl:a[5],iconUrlFallback:a[6],backgroundUrl:a[8],description:a[9],isDeprecated:a[11],normalThemeId:c[0],appColorMode:a[13],titlebarBackgroundColor:a[14],titlebarButtonTintColor:a[15],titlebarTextColor:a[16],titlebarAttributionTextColor:a[17],composerTintColor:a[18],composerUnselectedTintColor:a[19],composerInputTextPlaceholderColor:a[20],composerInputBackgroundColor:a[21],composerInputBorderColor:a[22],composerInputBorderWidth:a[23],composerBackgroundColor:a[24],messageTextColor:a[25],messageBorderColor:a[26],messageBorderWidth:a[27],incomingMessageTextColor:a[28],incomingMessageBorderColor:a[29],incomingMessageBorderWidth:a[30],deliveryReceiptColor:a[31],tertiaryTextColor:a[32],primaryButtonBackgroundColor:a[33],hotLikeColor:a[34],reactionPillBackgroundColor:a[35],secondaryTextColor:a[36],quotedIncomingMessageBubbleColor:a[37],cornerRadius:a[38],blurredComposerBackgroundColor:a[39],composerSecondaryButtonColor:a[40],composerPlaceholderTextColor:a[41]})},function(a){return b.resolve(d)}])}a.__sproc_name__="LSThreadThemeUpsertThemeStoredProcedure";a.__tables__=["thread_themes"];e.exports=a}),null);
__d("LSStaticDependencies",["LSDeleteAllCommunityChannelCategories","LSDeleteAllCommunityFolders","LSDeleteThenInsertCmCommunityList","LSDeleteThenInsertContact","LSDeleteThenInsertMessageRequest","LSDeleteThenInsertNotificationsSettingsGraphQLSnapshot","LSDeleteThenInsertThread","LSExecuteFinallyBlockForSyncTransaction","LSExecuteFirstBlockForSyncTransaction","LSGroupRoomTruncate","LSPopulateCommunityFolderData","LSRemoveTask","LSRoomTruncate","LSSetRegionHint","LSTaskExists","LSTruncateCommunityListTable","LSTruncateNotificationSettings","LSUpdateLastSyncCompletedTimestampMsToNow","LSUpsertGradientColor","LSUpsertSequenceId","LSUpsertTheme","LSVerifyContactRowExists"],(function(a,b,c,d,e,f,g){"use strict";a={deleteAllCommunityChannelCategories:c("LSDeleteAllCommunityChannelCategories"),deleteAllCommunityFolders:c("LSDeleteAllCommunityFolders"),deleteThenInsertCmCommunityList:c("LSDeleteThenInsertCmCommunityList"),deleteThenInsertContact:c("LSDeleteThenInsertContact"),deleteThenInsertMessageRequest:c("LSDeleteThenInsertMessageRequest"),deleteThenInsertNotificationsSettingsGraphQLSnapshot:c("LSDeleteThenInsertNotificationsSettingsGraphQLSnapshot"),deleteThenInsertThread:c("LSDeleteThenInsertThread"),executeFinallyBlockForSyncTransaction:c("LSExecuteFinallyBlockForSyncTransaction"),executeFirstBlockForSyncTransaction:c("LSExecuteFirstBlockForSyncTransaction"),groupRoomTruncate:c("LSGroupRoomTruncate"),populateCommunityFolderData:c("LSPopulateCommunityFolderData"),removeTask:c("LSRemoveTask"),roomTruncate:c("LSRoomTruncate"),setRegionHint:c("LSSetRegionHint"),taskExists:c("LSTaskExists"),truncateCommunityListTable:c("LSTruncateCommunityListTable"),truncateNotificationSettings:c("LSTruncateNotificationSettings"),updateLastSyncCompletedTimestampMsToNow:c("LSUpdateLastSyncCompletedTimestampMsToNow"),upsertGradientColor:c("LSUpsertGradientColor"),upsertSequenceId:c("LSUpsertSequenceId"),upsertTheme:c("LSUpsertTheme"),verifyContactRowExists:c("LSVerifyContactRowExists")};b=a;g["default"]=b}),98);
__d("LSTransportHybridParticipantUpdateReceipts",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.resolve(c)}a.__sproc_name__="LSE2EEMessagingMetadataMailboxTransportHybridParticipantUpdateReceiptsStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSTruncateMetadataThreads.nop",["I64","LSIntEnum","ReQL","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=async function(a,b){if(c("gkx")("9855")){b=a.mi_act_mapping_table.keys(new WeakMap());while(!0){var e,f=await b.next();if(f.done)break;await (e=a.mi_act_mapping_table).delete.apply(e,f.value)}e=d("ReQL").fromTableAscending(a.threads).filter(function(a){return a.syncGroup!=null&&(h||(h=d("I64"))).equal(a.syncGroup,(i||(i=d("LSIntEnum"))).ofNumber(95))}).iterator(new WeakMap());while(!0){f=await e.next();if(f.done)break;await (b=a.threads).delete.apply(b,f.value[0])}}return Promise.resolve()};a.__nop_name__="LSTruncateMetadataThreads";g.default=a}),98);
__d("LSTruncateMetadataThreads",["LSTruncateMetadataThreads.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[];return c.sequence([function(a){return c.nativeOperation(b("LSTruncateMetadataThreads.nop"))},function(a){return c.resolve(d)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxTruncateMetadataThreadsStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSTruncateThreadRangeTablesForSyncGroup",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.sequence([function(c){return b.i64.eq(a[0],b.i64.cast([0,1]))?b.forEach(b.filter(b.db.table(10).fetch(),function(a){return b.i64.eq(b.i64.cast([0,1])==null?b.i64.cast([0,1]):b.i64.cast([0,1]),b.i64.cast([0,1]))}),function(a){return a["delete"]()}):b.i64.eq(a[0],b.i64.cast([0,95]))?b.forEach(b.filter(b.db.table(10).fetch([[[b.i64.cast([0,0])],[b.i64.cast([-1,4294967295])]]]),function(a){return b.i64.eq(b.i64.cast([0,1])==null?b.i64.cast([0,1]):b.i64.cast([0,1]),b.i64.cast([0,1]))&&(b.i64.eq(a.parentThreadKey,b.i64.cast([0,0]))||b.i64.eq(a.parentThreadKey,b.i64.cast([-1,4294967295])))}),function(a){return a["delete"]()}):b.resolve(0)},function(c){return b.i64.eq(a[0],b.i64.cast([0,1]))?b.forEach(b.filter(b.db.table(247).fetch(),function(a){return b.i64.eq(a.syncGroup==null?b.i64.cast([0,1]):a.syncGroup,b.i64.cast([0,1]))}),function(a){return a["delete"]()}):b.resolve()},function(c){return b.forEach(b.db.table(198).fetch([[[a[0]]]]),function(a){return a["delete"]()})},function(c){return b.forEach(b.db.table(220).fetch([[[a[0]]]]),function(a){return a["delete"]()})}])},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxTruncateThreadRangeTablesForSyncGroupStoredProcedure";a.__tables__=["threads_ranges_v2__generated","filtered_threads_ranges_v3__generated","inbox_threads_ranges","sync_group_threads_ranges"];e.exports=a}),null);
__d("LSTruncateTablesForSyncGroup",["LSTruncateThreadRangeTablesForSyncGroup"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[];return c.sequence([function(d){return c.sequence([function(b){return c.forEach(c.filter(c.db.table(9).fetch(),function(b){return(c.i64.eq(b.syncGroup,a[0])||c.i64.eq(b.syncGroup,void 0)&&c.i64.eq(c.i64.cast([0,1]),a[0]))&&![c.i64.cast([0,17]),c.i64.cast([0,18]),c.i64.cast([0,19]),c.i64.cast([0,20]),c.i64.cast([0,21]),c.i64.cast([0,22]),c.i64.cast([0,23]),c.i64.cast([0,24]),c.i64.cast([0,25]),c.i64.cast([0,26]),c.i64.cast([0,27]),c.i64.cast([0,28])].some(function(a){return c.i64.eq(b.threadType,a)})}),function(a){return a["delete"]()})},function(d){return c.storedProcedure(b("LSTruncateThreadRangeTablesForSyncGroup"),a[0])}])},function(a){return c.resolve(d)}])}a.__sproc_name__="LSMailboxTruncateTablesForSyncGroupStoredProcedure";a.__tables__=["threads"];e.exports=a}),null);
__d("LSUpdateAttachmentItemCtaAtIndex",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.i64.eq(a[5],b.i64.cast([0,0]))?b.forEach(b.db.table(18).fetch([[[a[0],a[1]]]]),function(b){var c=b.update;b.item;return c({defaultCtaId:a[2],defaultCtaTitle:a[3],defaultCtaType:a[4]})}):b.i64.eq(a[5],b.i64.cast([0,1]))?b.forEach(b.db.table(18).fetch([[[a[0],a[1]]]]),function(b){var c=b.update;b.item;return c({attachmentCta1Id:a[2],cta1Title:a[3],cta1Type:a[4],cta1IconType:void 0})}):b.i64.eq(a[5],b.i64.cast([0,2]))?b.forEach(b.db.table(18).fetch([[[a[0],a[1]]]]),function(b){var c=b.update;b.item;return c({attachmentCta2Id:a[2],cta2Title:a[3],cta2Type:a[4],cta2IconType:void 0})}):b.i64.eq(a[5],b.i64.cast([0,3]))?b.forEach(b.db.table(18).fetch([[[a[0],a[1]]]]),function(b){var c=b.update;b.item;return c({attachmentCta3Id:a[2],cta3Title:a[3],cta3Type:a[4],cta3IconType:void 0})}):b.resolve(function(a){b.logger(a).warn(a)}("Unexpected CTA index"))},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxUpdateAttachmentItemCtaAtIndexStoredProcedure";a.__tables__=["attachment_items"];e.exports=a}),null);
__d("LSUpdateOrInsertCommunitySurfaceRange",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.db.table(253).put({surfaceType:a[0],communityKey:a[1],isLoadingAfter:!1,hasMoreAfter:a[2],nextPageCursor:a[4]})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxUpdateOrInsertCommunitySurfaceRangeStoredProcedure";a.__tables__=["community_surface_ranges"];e.exports=a}),null);
__d("LSUpdateReadReceipt",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.filter(b.db.table(14).fetch([[[a[1],a[2]]]]),function(c){return b.i64.eq(c.threadKey,a[1])&&b.i64.eq(b.i64.cast([0,0]),b.i64.cast([0,0]))&&b.i64.eq(c.contactId,a[2])&&b.i64.lt(c.readWatermarkTimestampMs,a[0])}),function(c){var d=c.update;c=c.item;return d({readWatermarkTimestampMs:a[0],readActionTimestampMs:b.i64.gt(a[3],b.i64.cast([0,0]))?a[3]:c.readActionTimestampMs})})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxUpdateReadReceiptStoredProcedure";a.__tables__=["participants"];e.exports=a}),null);
__d("LSShimGetServerThreadKeyFromJIDV2.nop",["ReQL","RetUtil"],(function(a,b,c,d,e,f,g){"use strict";a=async function(a,b,c){b=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.mi_act_mapping_table.index("jid")).getKeyRange(c));return d("RetUtil").getNullableRetResult(b==null?void 0:b.serverThreadKey)};a.__nop_name__="LSShimGetServerThreadKeyFromJIDV2";g.default=a}),98);
__d("LSReplaceOptimisticThread",["gkx"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,b=a[a.length-1],d=[],e=[];return b.sequence([function(e){return b.db.table(9).fetch([[[a[1]]]]).next().then(function(e,f){var g=e.done;e=e.value;return g?b.forEach(b.filter(b.db.table(9).fetch([[[a[0]]]]),function(c){return b.i64.eq(c.threadKey,a[0])&&b.i64.le(c.authorityLevel,b.i64.cast([0,20]))}),function(c){var d=c.update;c.item;return d({threadKey:a[1],authorityLevel:b.i64.cast([0,40])})}):(f=e.item,b.i64.le(f.authorityLevel,b.i64.cast([0,40]))?(c("gkx")("14697")?d[2]=!1:d[2]=!0,d[1]=d[2]):d[1]=!0,d[1]?b.forEach(b.db.table(9).fetch([[[a[0]]]]),function(a){return a["delete"]()}):b.resolve())})},function(a){return b.resolve(e)}])}a.__sproc_name__="LSMailboxReplaceOptimisticThreadStoredProcedure";a.__tables__=["threads"];b=a;g["default"]=b}),98);
__d("LSUpdateOptimisticContextThreadKeys",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.sequence([function(c){return b.forEach(b.filter(b.db.table(32).fetch(),function(c){return b.i64.eq(c.threadKey,a[0])}),function(b){var c=b.update;b.item;return c({threadKey:a[1]})})},function(c){return b.forEach(b.filter(b.db.table(31).fetch(),function(c){return b.i64.eq(c.threadKey,a[0])}),function(b){var c=b.update;b.item;return c({threadKey:a[1]})})}])},function(a){return b.resolve(c)}])}a.__sproc_name__="LSCoreUpdateOptimisticContextThreadKeysStoredProcedure";a.__tables__=["threads_optimistic_context","messages_optimistic_context"];e.exports=a}),null);
__d("LSUpdateTaskQueueName",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.db.table(2).fetch([[[a[0]]],"queueNameTaskId"]),function(b){var c=b.update;b.item;return c({queueName:a[1]})})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSCoreUpdateTaskQueueNameStoredProcedure";a.__tables__=["pending_tasks"];e.exports=a}),null);
__d("LSUpdateTaskValue",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.db.table(2).fetch([[[a[0]]],"queueNameTaskId"]),function(b){var c=b.update;b=b.item;return c({taskValue:b.taskValue.split(a[1]).join(a[2])})})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSCoreUpdateTaskValueStoredProcedure";a.__tables__=["pending_tasks"];e.exports=a}),null);
__d("LSUpdateThreadAuthorityAndMapping",["LSHybridThreadDelete","LSIssueNewTask","LSReplaceOptimisticThread","LSShimGetServerThreadKeyFromJIDV2.nop","LSUpdateOptimisticContextThreadKeys","LSUpdateTaskQueueName","LSUpdateTaskValue"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return c.nativeOperation(b("LSShimGetServerThreadKeyFromJIDV2.nop"),a[0]).then(function(a){return a=a,d[0]=a[0],a})},function(b){return c.db.table(9).fetch([[[a[1]]]]).next().then(function(a,b){b=a.done;a=a.value;return b?d[1]=!1:(a.item,d[1]=!0)})},function(b){return c.filter(c.db.table(9).fetch(),function(b){return c.i64.eq(b.threadKey,a[2])}).next().then(function(a,b){b=a.done;a=a.value;return b?d[3]=!1:(a.item,d[3]=!0)})},function(e){return d[5]=c.i64.neq(d[0],void 0),d[7]=c.i64.eq(d[0],a[2])&&d[5],!d[7]&&!(c.i64.eq(d[0],a[1])&&d[5])&&d[5]?function(a){c.logger(a).mustfix(a)}("The mi_act_mapping row did not correspond to either the authoritative or optimistic thread key."):0,c.i64.neq(a[2],void 0)?d[6]=a[2]:d[6]=c.i64.cast([0,0]),d[5]?d[7]?c.sequence([function(e){return d[1]?c.sequence([function(b){return c.db.table(173).fetch([[[a[1]]]]).next().then(function(a,b){var c=a.done;a=a.value;return c?d[8]=void 0:(b=a.item,d[8]=b.jid)})},function(e){return d[10]=new c.Map(),d[10].set("authoritative_thread_key",a[1]),d[10].set("jid_authoritative_mapped",d[8]),d[10].set("jid_optimistic_mapped",a[0]),d[10].set("optimistic_thread_key",a[2]),d[11]=c.toJSON(d[10]),c.storedProcedure(b("LSIssueNewTask"),"e2ee_log_incorrect_occam_mapping",c.i64.cast([0,160033]),d[11],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))},function(d){return c.storedProcedure(b("LSHybridThreadDelete"),a[1])}]):c.resolve()},function(a){return c.i64.neq(d[6],void 0)?c.forEach(c.db.table(9).fetch([[[d[6]]]]),function(a){var b=a.update;a.item;return b({clientThreadKey:d[6]})}):c.resolve()},function(e){return c.storedProcedure(b("LSReplaceOptimisticThread"),d[6],a[1])},function(e){return c.storedProcedure(b("LSUpdateOptimisticContextThreadKeys"),d[6],a[1])}]):d[3]?c.storedProcedure(b("LSHybridThreadDelete"),d[6]):c.resolve():d[3]?d[1]?c.storedProcedure(b("LSHybridThreadDelete"),d[6]):c.sequence([function(a){return c.i64.neq(d[6],void 0)?c.forEach(c.db.table(9).fetch([[[d[6]]]]),function(a){var b=a.update;a.item;return b({clientThreadKey:d[6]})}):c.resolve()},function(e){return c.storedProcedure(b("LSReplaceOptimisticThread"),d[6],a[1])},function(e){return c.storedProcedure(b("LSUpdateOptimisticContextThreadKeys"),d[6],a[1])}]):c.resolve()},function(e){return d[3]?c.sequence([function(e){return d[9]=c.i64.to_string(d[6]),d[8]=c.i64.to_string(a[1]),c.storedProcedure(b("LSUpdateTaskQueueName"),d[9],d[8])},function(a){return c.storedProcedure(b("LSUpdateTaskValue"),d[8],d[9],d[8])}]):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxUpdateThreadAuthorityAndMappingStoredProcedure";a.__tables__=["threads","mi_act_mapping_table"];e.exports=a}),null);
__d("LSUpdateThreadAuthorityAndMappingWithOTIDFromJID",["LSShimGetServerThreadKeyFromJIDV2.nop","LSUpdateThreadAuthorityAndMapping"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return c.nativeOperation(b("LSShimGetServerThreadKeyFromJIDV2.nop"),a[0]).then(function(a){return a=a,d[0]=a[0],a})},function(e){return c.i64.neq(d[0],a[1])?d[1]=d[0]:d[1]=void 0,c.storedProcedure(b("LSUpdateThreadAuthorityAndMapping"),a[0],a[1],d[1])}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxUpdateThreadAuthorityAndMappingWithOTIDFromJIDStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSUpdateThreadsRangesV2",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(d){return b.sequence([function(c){return b.forEach(b.db.table(10).fetch([[[a[1]]]]),function(a){return a["delete"]()})},function(d){return c[8]=b.i64.gt(a[2],b.i64.cast([0,1]))&&b.i64.gt(a[3],b.i64.cast([-2147483648,0])),a[0]==="inbox"&&b.i64.eq(a[1],b.i64.cast([0,0]))&&b.i64.eq(a[4],b.i64.cast([0,1]))?b.sequence([function(d){return c[9]=a[2],c[10]=a[3],c[11]=!1,c[12]=c[8],b.forEach(b.db.table(198).fetch(),function(a){a=a.item;return c[13]=a.minLastActivityTimestampMs,c[15]=a.minThreadKey,c[14]=b.i64.lt(c[9]==null?c[13]:c[9],c[13]),c[9]=c[14]?c[13]:c[9],c[10]=c[14]?c[15]:c[10],c[11]=c[11]||a.isLoadingBefore,c[12]=c[12]||b.i64.gt(c[13],b.i64.cast([0,1]))&&b.i64.gt(c[15],b.i64.cast([-2147483648,0]))})},function(a){return a=[c[9],c[10],c[11],c[12]],c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],a}]):b.resolve((d=[a[2],a[3],!1,c[8]],c[0]=d[0],c[1]=d[1],c[2]=d[2],c[3]=d[3],d))},function(d){return b.i64.eq(a[4],b.i64.cast([0,1]))?b.sequence([function(d){return c[9]=c[0],c[10]=c[1],c[11]=c[2],c[12]=c[3],b.forEach(b.filter(b.db.table(220).fetch(),function(c){return b.i64.eq(c.parentThreadKey,a[1])}),function(a){a=a.item;return c[13]=a.minLastActivityTimestampMs,c[15]=a.minThreadKey,c[14]=b.i64.lt(c[9]==null?c[13]:c[9],c[13]),c[9]=c[14]?c[13]:c[9],c[10]=c[14]?c[15]:c[10],c[11]=c[11]||a.isLoadingBefore,c[12]=c[12]||b.i64.gt(c[13],b.i64.cast([0,1]))&&b.i64.gt(c[15],b.i64.cast([-2147483648,0]))})},function(a){return a=[c[9],c[10],c[11],c[12]],c[4]=a[0],c[5]=a[1],c[6]=a[2],c[7]=a[3],a}]):b.resolve((d=[c[0],c[1],c[2],c[3]],c[4]=d[0],c[5]=d[1],c[6]=d[2],c[7]=d[3],d))},function(d){return b.db.table(10).add({parentThreadKey:a[1],minThreadKey:c[5]==null?b.i64.cast([-2147483648,0]):c[5],minLastActivityTimestampMs:c[4]==null?b.i64.cast([0,1]):c[4],maxLastActivityTimestampMs:b.i64.cast([0,1]),maxThreadKey:b.i64.cast([-2147483648,0]),isLoadingBefore:c[6],isLoadingAfter:!1,hasMoreBefore:c[7],hasMoreAfter:!1})}])},function(a){return b.resolve(d)}])}a.__sproc_name__="LSMailboxUpdateThreadsRangesV2StoredProcedure";a.__tables__=["threads_ranges_v2__generated","inbox_threads_ranges","sync_group_threads_ranges"];e.exports=a}),null);
__d("LSUpsertFolderSeenTimestamp",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.i64.gt(a[1],b.i64.cast([0,0]))?b.db.table(35).fetch([[[a[0]]]]).next().then(function(c,d){var e=c.done;c=c.value;return e?b.db.table(35).add({parentThreadKey:a[0],lastSeenRequestTimestampMs:a[1]}):(d=c.item,b.i64.lt(d.lastSeenRequestTimestampMs,a[1])?b.forEach(b.db.table(35).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({lastSeenRequestTimestampMs:a[1]})}):b.resolve())}):b.resolve()},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxUpsertFolderSeenTimestampStoredProcedure";a.__tables__=["folder_metadata"];e.exports=a}),null);
__d("LSUpsertMessage",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.db.table(12).fetch([[[a[9]]],"optimistic"]).next().then(function(c,d){var e=c.done;c=c.value;return e?b.db.table(12).add({threadKey:a[3],timestampMs:a[5],messageId:a[8],offlineThreadingId:a[9],authorityLevel:a[2],primarySortKey:a[6],senderId:a[10],isAdminMessage:a[12],sendStatus:a[15],sendStatusV2:a[16],text:a[0],subscriptErrorMessage:a[1],secondarySortKey:a[7],stickerId:a[11],messageRenderingType:a[13],isUnsent:a[17],unsentTimestampMs:a[18],mentionOffsets:a[19],mentionLengths:a[20],mentionIds:a[21],mentionTypes:a[22],replySourceId:a[23],replySourceType:a[24],replySourceTypeV2:a[25],replyStatus:a[26],replySnippet:a[27],replyMessageText:a[28],replyToUserId:a[29],replyMediaExpirationTimestampMs:a[30],replyMediaUrl:a[31],replyMediaPreviewWidth:a[33],replyMediaPreviewHeight:a[34],replyMediaUrlMimeType:a[35],replyMediaUrlFallback:a[36],replyCtaId:a[37],replyCtaTitle:a[38],replyAttachmentType:a[39],replyAttachmentId:a[40],replyAttachmentExtra:a[41],replyType:a[42],isForwarded:a[43],forwardScore:a[44],hasQuickReplies:a[45],adminMsgCtaId:a[46],adminMsgCtaTitle:a[47],adminMsgCtaType:a[48],cannotUnsendReason:a[49],textHasLinks:a[50],viewFlags:a[51],displayedContentTypes:a[52],viewedPluginKey:a[53],viewedPluginContext:a[54],quickReplyType:a[55],hotEmojiSize:a[56],platformXmdEncoded:a[57],replySourceTimestampMs:a[58],ephemeralDurationInSec:a[59],msUntilExpirationTs:a[60],ephemeralExpirationTs:a[61],takedownState:a[62],isCollapsed:a[63],subthreadKey:a[64],botResponseId:a[65],metadataDataclass:a[66],editCount:a[67],isPaidPartnership:a[68],adminSignatureName:a[69],adminSignatureProfileUrl:a[70],adminSignatureCreatorType:a[71],translatedText:a[72],textDialect:a[73],translatedTextDialect:a[74],scheduledTimestamp:a[75],isVideoQuickSend:a[76]}):(d=c.item,b.i64.le(d.authorityLevel,a[2])?b.db.table(12).put({threadKey:a[3],timestampMs:a[5],messageId:a[8],offlineThreadingId:a[9],authorityLevel:a[2],primarySortKey:d.primarySortKey,senderId:a[10],isAdminMessage:a[12],sendStatus:a[15],sendStatusV2:a[16],text:a[0],subscriptErrorMessage:a[1],secondarySortKey:d.secondarySortKey,stickerId:a[11],messageRenderingType:a[13],isUnsent:a[17],unsentTimestampMs:a[18],mentionOffsets:a[19],mentionLengths:a[20],mentionIds:a[21],mentionTypes:a[22],replySourceId:a[23],replySourceType:a[24],replySourceTypeV2:a[25],replyStatus:a[26],replySnippet:a[27],replyMessageText:a[28],replyToUserId:a[29],replyMediaExpirationTimestampMs:a[30],replyMediaUrl:a[31],replyMediaPreviewWidth:a[33],replyMediaPreviewHeight:a[34],replyMediaUrlMimeType:a[35],replyMediaUrlFallback:a[36],replyCtaId:a[37],replyCtaTitle:a[38],replyAttachmentType:a[39],replyAttachmentId:a[40],replyAttachmentExtra:a[41],replyType:a[42],isForwarded:a[43],forwardScore:a[44],hasQuickReplies:a[45],adminMsgCtaId:a[46],adminMsgCtaTitle:a[47],adminMsgCtaType:a[48],cannotUnsendReason:a[49],textHasLinks:a[50],viewFlags:a[51],displayedContentTypes:a[52],viewedPluginKey:a[53],viewedPluginContext:a[54],quickReplyType:a[55],hotEmojiSize:a[56],platformXmdEncoded:a[57],replySourceTimestampMs:a[58],ephemeralDurationInSec:a[59],msUntilExpirationTs:a[60],ephemeralExpirationTs:a[61],takedownState:a[62],isCollapsed:a[63],subthreadKey:a[64],botResponseId:a[65],metadataDataclass:a[66],editCount:a[67],isPaidPartnership:a[68],adminSignatureName:a[69],adminSignatureProfileUrl:a[70],adminSignatureCreatorType:a[71],translatedText:a[72],textDialect:a[73],translatedTextDialect:a[74],scheduledTimestamp:a[75],isVideoQuickSend:a[76]}):b.resolve())})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxUpsertMessageStoredProcedure";a.__tables__=["messages"];e.exports=a}),null);
__d("LSWriteThreadCapabilities",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(d){return b.db.table(9).fetch([[[a[0]]]]).next().then(function(d,e){e=d.done;d=d.value;return e?0:(d.item,c[0]=b.i64.of_float(Date.now()),b.forEach(b.db.table(9).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({capabilities:a[1],capabilities2:a[2],capabilities3:a[3],capabilities4:a[4],capabilities5:a[5]})}))})},function(a){return b.resolve(d)}])}a.__sproc_name__="LSMailboxWriteThreadCapabilitiesStoredProcedure";a.__tables__=["threads"];e.exports=a}),null);
__d("LSExpandedStaticDependencies",["LSAddParticipantIdToGroupThread","LSClearPinnedMessages","LSDeleteBanner","LSDeleteExistingMessageRanges","LSGetFirstAvailableAttachmentCTAID","LSHybridThreadDelete","LSInsertAttachmentCta","LSInsertAttachmentItem","LSInsertBlobAttachment","LSInsertNewMessageRange","LSIssueInsertPersistentMenuItemsForThreadTask","LSSetForwardScore","LSSetMessageDisplayedContentTypes","LSStaticDependencies","LSTransportHybridParticipantUpdateReceipts","LSTruncateMetadataThreads","LSTruncateTablesForSyncGroup","LSUpdateAttachmentItemCtaAtIndex","LSUpdateOrInsertCommunitySurfaceRange","LSUpdateOrInsertThread","LSUpdateReadReceipt","LSUpdateThreadAuthorityAndMappingWithOTIDFromJID","LSUpdateThreadsRangesV2","LSUpsertFolderSeenTimestamp","LSUpsertInboxThreadsRange","LSUpsertMessage","LSUpsertReaction","LSUpsertSyncGroupThreadsRange","LSWriteThreadCapabilities"],(function(a,b,c,d,e,f,g){"use strict";a=babelHelpers["extends"]({},c("LSStaticDependencies"),{addParticipantIdToGroupThread:c("LSAddParticipantIdToGroupThread"),clearPinnedMessages:c("LSClearPinnedMessages"),deleteBanner:c("LSDeleteBanner"),deleteExistingMessageRanges:c("LSDeleteExistingMessageRanges"),getFirstAvailableAttachmentCTAID:c("LSGetFirstAvailableAttachmentCTAID"),hybridThreadDelete:c("LSHybridThreadDelete"),insertAttachmentCta:c("LSInsertAttachmentCta"),insertAttachmentItem:c("LSInsertAttachmentItem"),insertBlobAttachment:c("LSInsertBlobAttachment"),insertNewMessageRange:c("LSInsertNewMessageRange"),issueInsertPersistentMenuItemsForThreadTask:c("LSIssueInsertPersistentMenuItemsForThreadTask"),setForwardScore:c("LSSetForwardScore"),setMessageDisplayedContentTypes:c("LSSetMessageDisplayedContentTypes"),transportHybridParticipantUpdateReceipts:c("LSTransportHybridParticipantUpdateReceipts"),truncateMetadataThreads:c("LSTruncateMetadataThreads"),truncateTablesForSyncGroup:c("LSTruncateTablesForSyncGroup"),updateAttachmentItemCtaAtIndex:c("LSUpdateAttachmentItemCtaAtIndex"),updateOrInsertCommunitySurfaceRange:c("LSUpdateOrInsertCommunitySurfaceRange"),updateOrInsertThread:c("LSUpdateOrInsertThread"),updateReadReceipt:c("LSUpdateReadReceipt"),updateThreadAuthorityAndMappingWithOTIDFromJID:c("LSUpdateThreadAuthorityAndMappingWithOTIDFromJID"),updateThreadsRangesV2:c("LSUpdateThreadsRangesV2"),upsertFolderSeenTimestamp:c("LSUpsertFolderSeenTimestamp"),upsertInboxThreadsRange:c("LSUpsertInboxThreadsRange"),upsertMessage:c("LSUpsertMessage"),upsertReaction:c("LSUpsertReaction"),upsertSyncGroupThreadsRange:c("LSUpsertSyncGroupThreadsRange"),writeThreadCapabilities:c("LSWriteThreadCapabilities")});b=a;g["default"]=b}),98);
__d("MAWDeanonDataCheck",["gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,d){if(!c("gkx")("8338")){var e=b;d||(e=b+1);return a.length>=e}if(a.length===0)return!1;var f=a[a.length-1].sortOrderMs;e=a.filter(function(a){return a.sortOrderMs===f});e=a.length-e.length;if(!d){var g=a[0].sortOrderMs;d=a.filter(function(a){return a.sortOrderMs===g});e-=d.length}return e>=b}g.hasEnoughDeanonData=a}),98);
__d("MAWFetchEBDeanonMessagesMetadata",["DateConsts","EBFormatUtils","FBLogger","I64","MAWEBDeanonFetch","MAWMessagesDirection","MAWMessagesPaginationUtils","WAResultOrError","qex"],(function(a,b,c,d,e,f,g){"use strict";var h,i=100,j="timeout",k=10*d("DateConsts").MS_PER_SEC;async function a(a){var b=a.chatJid,e=a.direction,f=a.includeReferenceTimestamp,g=a.logger,l=a.range;a=a.sortFn;c("FBLogger")("messenger_web").info("EBMessageRangeDataSource: Issuing fetch request to EB Deanon API");g==null?void 0:g.markQPLPoint("eb_fetch_deanon_start");var m=d("MAWMessagesDirection").translateMwpDirectionToMawDirection(e),n=(h||(h=d("I64"))).to_float(d("EBFormatUtils").adjustTs(d("MAWMessagesDirection").getI64RangeTimestampForDirection(e,l),m));e=await d("MAWMessagesPaginationUtils").getRangeExternalIdForDirection(e,l);l=(l=c("qex")._("3653"))!=null?l:i;return Promise.race([d("MAWEBDeanonFetch").fetchMessagesMetadataFromEBDeanon({chatJid:b,count:l,direction:m,includeReferenceTimestamp:f,referenceExternalId:e,referenceTimestampMs:n,sortFn:a}),new Promise(function(a){return window.setTimeout(function(){return a(d("WAResultOrError").makeError(j))},k)})]).then(function(a){g==null?void 0:g.markQPLPoint("eb_fetch_deanon_end");return a})}g.fetchEBDeanonMessagesMetadata=a}),98);
__d("MAWSubscribeToLSTruncateMetadataThreads",["I64","Int64Hooks","MAWMiActMappingTableAPI","gkx","promiseDone","react-compiler-runtime","useAsyncReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(a,b){return!c("gkx")("9855")?function(){}:d("MAWMiActMappingTableAPI").subscribeToMappingDeletion(a,b)};function a(a,b){var e=d("react-compiler-runtime").c(5),f=c("useAsyncReStore")(),g,k;e[0]!==f||e[1]!==b||e[2]!==a?(g=function(){if(!c("gkx")("9855"))return;var e=f.then(function(c){return i(c,function(c,e){(h||(h=d("I64"))).equal(e,a)&&b()})});return function(){c("promiseDone")(e,j)}},k=[a,f,b],e[0]=f,e[1]=b,e[2]=a,e[3]=g,e[4]=k):(g=e[3],k=e[4]);d("Int64Hooks").useEffectInt64(g,k)}function j(a){return a()}g.subscribeToLSTruncateMetadataThreads=i;g.useLSTruncateMetadataThread=a}),98);
__d("MAWFetchDeanonMetadataUsingCache",["I64","MAWDeanonDataCheck","MAWFetchEBDeanonMessagesMetadata","MAWMessagesCompare","MAWMessagesDirection","MAWSubscribeToLSTruncateMetadataThreads","WAJids","WAResultOrError","WATagsLogger","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Using init-sync deanon data for ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Using cached Deanon messages metadata for comparison to local data"]);j=function(){return a};return a}var k=d("WATagsLogger").TAGS(["MAWFetchDeanonMetadataUsingCache"]),l=new Map(),m=c("justknobx")._("3763"),n=new Map(),o=null;async function a(a){var b=a.chatJid,c=a.db,e=a.direction,f=a.isFirstPage,g=a.logger,h=a.pageSize,i=a.range;a=a.sortFn;q(c);c=p(b,e,g,i);if(c!=null){g==null?void 0:g.addQPLAnnotations({bool:{is_first_page:f},int:{deanon_cached_data_size:c==null?void 0:c.length}});if(d("MAWDeanonDataCheck").hasEnoughDeanonData(c,h,f)){k.LOG(j());g==null?void 0:g.addQPLAnnotations({bool:{is_deanon_cached_data_used:!0}});return d("WAResultOrError").makeResult(c)}}h=await d("MAWFetchEBDeanonMessagesMetadata").fetchEBDeanonMessagesMetadata({chatJid:b,direction:e,includeReferenceTimestamp:!f,logger:g,range:i,sortFn:a});h.success===!0&&(g==null?void 0:g.addQPLAnnotations({bool:{is_deanon_data_fetched:!0}}),s(b,e,g,h.value,i));return h}function p(a,b,c,e){c==null?void 0:c.markQPLPoint("deanon_cache_fetch_start");t(a,b);a=(a=l.get(d("WAJids").threadIdForChatJid(a)))==null?void 0:a.get(b);if(a==null)return null;var f=d("MAWMessagesDirection").getI64RangeTimestampForDirection(b,e);e=(h||(h=d("I64"))).ge(f,a.minTimestampMs)&&(h||(h=d("I64"))).le(f,a.maxTimestampMs);if(!e)return null;e=d("MAWMessagesDirection").switchOnMWPMessagesDirection(b,{asc:a.msgsMetadata.findIndex(function(a){return(h||(h=d("I64"))).ge(h.of_float(a.sortOrderMs),f)}),desc:a.msgsMetadata.findIndex(function(a){return(h||(h=d("I64"))).le(h.of_float(a.sortOrderMs),f)})});b=a.msgsMetadata.slice(e);c==null?void 0:c.markQPLPoint("deanon_cache_fetch_end");return b}function q(a){if(o!=null)return;o=d("MAWSubscribeToLSTruncateMetadataThreads").subscribeToLSTruncateMetadataThreads(a,function(a,b){b=(h||(h=d("I64"))).to_string(a);l.delete(b);n.delete(b)})}function r(a,b,c,e){var f;a=d("WAJids").threadIdForChatJid(a);f=(f=l.get(a))!=null?f:new Map();f.set(b,{maxTimestampMs:e.max,minTimestampMs:e.min,msgsMetadata:c});l.set(a,f)}function s(a,b,c,e,f){if(e.length===0)return;c==null?void 0:c.markQPLPoint("deanon_cache_replace_start");var g=(h||(h=d("I64"))).of_float(e[e.length-1].sortOrderMs);f=d("MAWMessagesDirection").switchOnMWPMessagesDirection(b,{asc:{max:g,min:f.maxTimestampMs},desc:{max:f.minTimestampMs,min:g}});r(a,b,e,f);c==null?void 0:c.markQPLPoint("deanon_cache_replace_end")}function b(a,b){if(b.length===0)return;b=[].concat(b).sort(d("MAWMessagesCompare").getSortComparisonFunctionForDirection("desc"));var c=0,e=b.length-1;while(c<e&&b[c].sortOrderMs===b[c+1].sortOrderMs)c++;if(c===e)return;e=(h||(h=d("I64"))).of_float(b[e].sortOrderMs);n.set(h.to_string(a),{insertTime:Date.now(),minTimestampMs:e,msgsMetadata:b.slice(c)})}function t(a,b){var c=u(a,b);if(c==null)return;k.LOG(i(),a);r(a,b,c.msgsMetadata,{max:(h||(h=d("I64"))).max_int,min:c.minTimestampMs});n.delete(d("WAJids").threadIdForChatJid(a))}function u(a,b){if(b!=="desc")return;b=Date.now();a=n.get(d("WAJids").threadIdForChatJid(a));if(a!=null&&b-a.insertTime>m)return;return a}g.MAWFetchDeanonMetadataUsingCache=a;g.fetchDeanonDataFromCache=p;g.initDeanonCacheDescForThread=b}),98);
__d("LSFillDeanonCacheForE2EEThread.nop",["I64","LSShape","LSSynchronousPromise","LSVec","MAWFetchDeanonMetadataUsingCache","PromiseOrValue","ReQL","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=function(a,b,e,f){if(!c("gkx")("15959"))return d("LSSynchronousPromise").makeSynchronousPromise();var g=c("LSVec").toArray(f).map(function(a){a=d("LSShape").toRecord(a);var b=a.offline_threading_id;a=a.sort_order_ms;return{externalId:b,msgType:"unknown-deanon",sortOrderMs:(h||(h=d("I64"))).to_float(a)}});b=d("ReQL").fromTableAscending(a.mi_act_mapping_table).getKeyRange(e).iterator(new WeakMap());return d("LSSynchronousPromise").wrapInSyncPromiseIfNotPromise((i||(i=d("PromiseOrValue"))).map(b.next(),function(a){var b;((b=a.value)==null?void 0:b[1].jid)!=null&&d("MAWFetchDeanonMetadataUsingCache").initDeanonCacheDescForThread(a.value[1].jid,g)}))};a.__nop_name__="LSFillDeanonCacheForE2EEThread";g["default"]=a}),98);
__d("LSFillDeanonCacheForE2EEThread",["LSFillDeanonCacheForE2EEThread.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[];return c.sequence([function(d){return c.nativeOperation(b("LSFillDeanonCacheForE2EEThread.nop"),a[0],a[1])},function(a){return c.resolve(d)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxFillDeanonCacheForE2EEThreadStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSIssueFetchThreadCapabilitiesTask",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.resolve(c)}a.__sproc_name__="LSMailboxIssueFetchThreadCapabilitiesTaskStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSMarkThreadReadV2",["LSGetViewerFBID"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(b){return c.db.table(9).fetch([[[a[0]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?d[0]=c.i64.cast([0,0]):(b=a.item,d[0]=b.lastActivityTimestampMs)})},function(e){return c.i64.gt(d[0],a[1])?c.sequence([function(a){return c.storedProcedure(b("LSGetViewerFBID")).then(function(a){return a=a,d[2]=a[0],a})},function(b){return c.count(c.filter(c.db.table(12).fetch([[[a[0],{gt:a[1]}]]]),function(b){return c.i64.eq(b.threadKey,a[0])&&c.i64.eq(b.senderId,d[2])&&c.i64.gt(b.timestampMs,a[1])})).then(function(a){return d[3]=a})},function(b){return c.count(c.db.table(12).fetch([[[a[0],{gt:a[1]}]]])).then(function(a){return d[4]=a})},function(b){return c.i64.eq(d[3],d[4])&&c.i64.gt(d[4],c.i64.cast([0,0]))?c.forEach(c.db.table(9).fetch([[[a[0]]]]),function(a){var b=a.update;a=a.item;return b({lastReadWatermarkTimestampMs:a.lastActivityTimestampMs})}):c.forEach(c.filter(c.db.table(9).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.threadKey,a[0])&&c.i64.gt(a[1],b.lastReadWatermarkTimestampMs)}),function(b){var c=b.update;b.item;return c({lastReadWatermarkTimestampMs:a[1]})})}]):c.forEach(c.filter(c.db.table(9).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.threadKey,a[0])&&c.i64.gt(a[1],b.lastReadWatermarkTimestampMs)}),function(b){var c=b.update;b.item;return c({lastReadWatermarkTimestampMs:a[1]})})}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxMarkThreadReadV2StoredProcedure";a.__tables__=["threads","messages"];e.exports=a}),null);
__d("LSStoreProjectConfiguration",["LSBase64Decode.nop","LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return c.nativeOperation(b("LSBase64Decode.nop"),a[4]).then(function(a){return a=a,d[0]=a[0],a})},function(e){return c.blobs.neq(d[0],void 0)?c.db.table(307).put({configId:a[1],projectName:a[0],cipherSuite:a[5],publicKey:d[0],maxEvals:a[2],redemptionLimit:a[3],expirationTimestampMs:a[6],tokenPollFrequencyMs:a[7],maxClientTokenPoolSize:a[8]}):(function(a){c.logger(a).info(a)}("issuing retry for project configurations task since public key was null"),d[1]=new c.Map(),d[1].set("project_name",a[0]),d[2]=d[1].get("project_name"),d[3]=c.toJSON(d[1]),c.storedProcedure(b("LSIssueNewTask"),["acs_credentials","_",d[2]].join(""),c.i64.cast([0,351]),d[3],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0])))}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSAnonymousCredentialsStoreProjectConfigurationStoredProcedure";a.__tables__=["secure_acs_configurations"];e.exports=a}),null);
__d("LSSyncBumpThreadDataToClient",["LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.filter(c.db.table(9).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.threadKey,a[0])&&c.i64.ge(a[1],b.lastActivityTimestampMs)}).next().then(function(e,f){var g=e.done;e=e.value;return g?0:(f=e.item,c.sequence([function(e){return c.i64.eq(f.parentThreadKey,c.i64.cast([-1,4294967286]))&&c.i64.eq(a[2],c.i64.cast([0,2]))?(d[0]=new c.Map(),d[0].set("thread_fbid",a[0]),d[0].set("force_upsert",!1),d[0].set("use_open_messenger_transport",!1),d[0].set("sync_group",c.i64.cast([0,95])),d[0].set("metadata_only",!1),d[0].set("preview_only",!1),d[1]=d[0].get("thread_fbid"),d[2]=c.toJSON(d[0]),c.storedProcedure(b("LSIssueNewTask"),c.i64.to_string(d[1]),c.i64.cast([0,209]),d[2],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))):c.resolve()},function(b){return c.forEach(c.db.table(9).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({lastActivityTimestampMs:a[1]})})},function(b){return c.i64.eq(a[2],c.i64.cast([0,1]))?c.forEach(c.db.table(9).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({lastReadWatermarkTimestampMs:a[1]})}):c.i64.eq(a[2],c.i64.cast([0,2]))?c.resolve(0):c.i64.eq(a[2],c.i64.cast([0,3]))?c.i64.ge(f.lastReadWatermarkTimestampMs,f.lastActivityTimestampMs)?c.forEach(c.db.table(9).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({lastReadWatermarkTimestampMs:a[1]})}):c.resolve():c.resolve(0)}]))})},function(a){return c.resolve(e)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxSyncBumpThreadDataToClientStoredProcedure";a.__tables__=["threads"];e.exports=a}),null);
__d("LSTriggerReenrollementFromOptOutDelta",["LSArrayGetObjectAt","LSDeleteAndReenrollDeviceState","LSIsEncryptionVersionSecure"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,e){var f=a.done;a=a.value;return f?(f=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,1]),void 0,void 0,void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,20]),void 0,void 0],d[0]=f[0],d[1]=f[1],d[2]=f[2],d[3]=f[3],d[4]=f[4],d[5]=f[5],d[6]=f[6],d[7]=f[7],d[8]=f[8],d[9]=f[9],d[10]=f[10],d[11]=f[11],d[12]=f[12],d[13]=f[13],d[14]=f[14],d[15]=f[15],d[16]=f[16],d[17]=f[17],f):(e=a.item,c.sequence([function(a){return d[26]=e.backupTenancy,d[25]=e.encryptionVersion,d[21]=void 0,c.i64.neq(d[21],void 0)?c.resolve(d[22]=d[21]):c.sequence([function(a){return d[27]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[28]=a[0],a})},function(a){return d[28]?d[37]=(d[27].push(c.i64.cast([0,0])),d[27]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[29]=a[0],a})},function(a){return d[29]?d[37]=(d[27].push(c.i64.cast([0,2])),d[27]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[30]=a[0],a})},function(a){return d[30]?d[37]=(d[27].push(c.i64.cast([0,3])),d[27]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[31]=a[0],a})},function(a){return d[31]?d[37]=(d[27].push(c.i64.cast([0,4])),d[27]):0,d[32]=c.createArray(),d[33]=c.i64.of_int32(d[27].length),c.i64.gt(d[33],c.i64.cast([0,0]))?c.loopAsync(d[33],function(a){return d[37]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[27],d[37]).then(function(a){return a=a,d[38]=a[0],d[39]=a[1],a})},function(a){return d[40]=(d[32].push(d[38]),d[32])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[37]=c.createArray(),d[38]=c.i64.of_int32(d[32].length),c.i64.gt(d[38],c.i64.cast([0,0]))?c.loopAsync(d[38],function(a){return d[40]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[32],d[40]).then(function(a){return a=a,d[41]=a[0],d[42]=a[1],a})},function(a){return d[43]=(d[37].push(c.i64.to_string(d[41])),d[37])}])}):c.resolve()},function(a){return d[39]=d[37].join(","),d[34]=d[39]}])},function(a){return d[32].some(function(a){return c.i64.eq(d[25],a)})?d[35]=d[25]:d[35]=void 0,c.i64.neq(d[35],void 0)?d[36]=d[35]:d[36]=void 0,d[22]=d[36]}])},function(a){return c.i64.neq(d[22],void 0)?d[23]=d[22]:d[23]=c.i64.cast([0,0]),c.i64.neq(d[26],void 0)?d[24]=d[26]:d[24]=c.i64.cast([0,1]),a=[e.backupId,e.deviceId,e.mailboxRootKeyBlob,e.ocmfClientStateBlob,void 0,void 0,d[23],d[24],e.epochAuthPublicKeyBlob,e.epochAuthPrivateKeyBlob,e.devicePublicKeyBlob,e.devicePrivateKeyBlob,e.epochStoragePublicKeyBlob,e.epochStoragePrivateKeyBlob,e.obliviousValidationTokenBlob,e.authorityLevel,void 0,void 0],d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[3],d[4]=a[4],d[5]=a[5],d[6]=a[6],d[7]=a[7],d[8]=a[8],d[9]=a[9],d[10]=a[10],d[11]=a[11],d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15],d[16]=a[16],d[17]=a[17],a}]))})},function(e){return d[19]=!1,d[20]=c.i64.of_int32(a[1].length),c.i64.gt(d[20],c.i64.cast([0,0]))?c.loopAsync(d[20],function(e){return d[21]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[1],d[21]).then(function(a){return a=a,d[22]=a[0],d[23]=a[1],a})},function(a){return d[19]=d[19]||c.i64.eq(d[22],d[1])}])}):c.resolve()},function(e){return d[19]&&c.i64.eq(a[0],d[0])?c.i64.neq(d[1],void 0)?c.storedProcedure(b("LSDeleteAndReenrollDeviceState"),d[1],c.i64.cast([0,6])):c.resolve():c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsTriggerReenrollementFromOptOutDeltaStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state"];e.exports=a}),null);
__d("LSUpdateCommunityThreadStaleState",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.filter(b.db.table(9).fetch([[[a[0]]]]),function(c){return b.i64.eq(c.threadKey,a[0])&&([b.i64.cast([0,23]),b.i64.cast([0,21]),b.i64.cast([0,18]),b.i64.cast([0,26]),b.i64.cast([0,27])].some(function(a){return b.i64.eq(c.threadType,a)})||b.i64.eq(c.threadType,b.i64.cast([0,152])))}).next().then(function(c,d){d=c.done;c=c.value;return d?0:(c.item,b.db.table(294).fetch([[[a[0]]]]).next().then(function(c,d){d=c.done;c=c.value;return d?b.db.table(294).add({threadKey:a[0],threadQueueSequenceId:b.i64.cast([0,0]),isStale:a[1]}):(c.item,b.forEach(b.db.table(294).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({isStale:a[1]})}))}))})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxUpdateCommunityThreadStaleStateStoredProcedure";a.__tables__=["threads","community_thread_sync_info"];e.exports=a}),null);
__d("LSUpdateThreadActivityStatus",["LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return c.db.table(9).fetch([[[a[0]]]]).next().then(function(e,f){var g=e.done;e=e.value;return g?c.sequence([function(e){return d[2]=new c.Map(),d[2].set("thread_fbid",a[0]),d[2].set("force_upsert",!1),d[2].set("use_open_messenger_transport",!1),d[2].set("sync_group",c.i64.cast([0,104])),d[2].set("metadata_only",!1),d[2].set("preview_only",!1),d[3]=d[2].get("thread_fbid"),d[4]=c.toJSON(d[2]),c.storedProcedure(b("LSIssueNewTask"),c.i64.to_string(d[3]),c.i64.cast([0,209]),d[4],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))},function(e){return d[5]=c.createArray(),d[8]=(d[5].push(a[0]),d[5]),d[6]=new c.Map(),d[6].set("number_of_threads",c.i64.cast([0,1])),d[6].set("event_type","issue_tpq_for_verify_threads_activity_status"),d[6].set("thread_ids",d[5]),d[7]=c.toJSON(d[6]),c.storedProcedure(b("LSIssueNewTask"),"log_community_resnapshot_event",c.i64.cast([0,576]),d[7],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))},function(a){return d[0]=c.i64.cast([0,2])}]):(f=e.item,c.sequence([function(b){return c.i64.lt(f.lastActivityTimestampMs,a[1])?c.sequence([function(b){return c.forEach(c.db.table(9).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({lastActivityTimestampMs:a[1],snippet:a[2]})})},function(a){return d[2]=c.i64.cast([0,1])}]):c.resolve(d[2]=c.i64.cast([0,0]))},function(a){return d[0]=d[2]}]))})},function(a){return e[0]=d[0]}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxUpdateThreadActivityStatusStoredProcedure";a.__tables__=["threads"];e.exports=a}),null);
__d("LSOnSendMessageFailure.nop",["MWChatInteraction","Promise","err","justknobx","promiseDone","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("sendToSentQPLLogger").__setRef("LSOnSendMessageFailure.nop");function a(a,d,e,f){if(!c("justknobx")._("1414"))return(h||(h=b("Promise"))).resolve();if(e==null)return(h||(h=b("Promise"))).resolve();var g=j(e);if(g==null)return(h||(h=b("Promise"))).resolve();c("promiseDone")(i.load().then(function(a){return a.markSendToSentFail(g,"send_message_server_error",c("err")("send_message_server_error: %s",f))}));return(h||(h=b("Promise"))).resolve()}function j(a){a=d("MWChatInteraction").get(d("MWChatInteraction").s2sKey(a));return a==null?null:Number(a)}a.__nop_name__="LSOnSendMessageFailure";g["default"]=a}),98);
__d("LSMarkOptimisticMessageFailed",["LSOnSendMessageFailure.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return a[2]===!0?d[0]=c.i64.cast([0,5]):d[0]=c.i64.cast([0,4]),a[2]===!0?d[1]=c.i64.cast([0,5]):d[1]=c.i64.cast([0,4]),a[2]===!0?d[2]=c.i64.cast([0,5]):d[2]=c.i64.cast([0,4]),c.nativeOperation(b("LSOnSendMessageFailure.nop"),a[0],a[1])},function(b){return c.forEach(c.filter(c.db.table(12).fetch([[[a[0]]],"optimistic"]),function(b){return b.offlineThreadingId===a[0]&&c.i64.eq(b.authorityLevel,c.i64.cast([0,20]))}),function(a){var b=a.update;a.item;return b({sendStatus:d[0],sendStatusV2:d[1]})})}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxMarkOptimisticMessageFailedStoredProcedure";a.__tables__=["messages"];e.exports=a}),null);
__d("LSMarkOptimisticMessageFailedStoredProcedure",["LSMarkOptimisticMessageFailed","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSMarkOptimisticMessageFailed"),e.optimisticMid,e.errorMessage,e.isRetryable);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("MAWMarkMessageSendAsFailedLSDB",["LSFactory","LSMarkOptimisticMessageFailedStoredProcedure"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,d,e,g){return(b=e==null?void 0:e.runInTransaction(async function(b){await c("LSMarkOptimisticMessageFailedStoredProcedure")(c("LSFactory")(b),{errorMessage:d,isRetryable:g,optimisticMid:a})},"readwrite",void 0,void 0,f.id+":29"))!=null?b:Promise.resolve()}g.markMessageSendAsFailed=a}),98);
__d("MAWCommonSetupBridge",["BroadcastChannelFallback","BrowserLockManager","CurrentAppID","CurrentUser","FBLogger","I64","LSDatabaseSingleton","LSIntEnum","LSMessagingThreadAttributionType","MAWBridge","MAWChatJid","MAWCrossWorkerPortal","MAWCurrentUser","MAWDbMedia","MAWInit","MAWJobActionsV2","MAWMIC","MAWReportSendMessageSuccessResult","MAWThreadCutover","MAWThreadUtils","MWLogSend","ODS","Promise","QPLEvent","QPLUserFlow","WACrossWorkerPortal","WADevToolMessageChannel","WADevToolsBridge","WAExceededStorageQuota","WAJids","cr:2691","gkx","justknobx","pageID","performanceAbsoluteNow","promiseDone","requireDeferred","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o=c("requireDeferred")("MAWMainThreadLogger").__setRef("MAWCommonSetupBridge"),p=new Set([25312111,25311870]),q=new Map();e=new Map([[(a=d("MAWDbMedia")).MEDIA_TYPE.IMAGE,8],[a.MEDIA_TYPE.VIDEO,10],[a.MEDIA_TYPE.GIF,6],[a.MEDIA_TYPE.STICKER,4],[a.MEDIA_TYPE.PTT,11],[a.MEDIA_TYPE.DOCUMENT_FILE,9]]);var r=new Set([25312150,25313100,1056840931,25299294]),s=function(){return(n||(n=c("performanceAbsoluteNow")))()-Date.now()},t=s();function u(a,b,e){return(i||(i=d("LSDatabaseSingleton"))).LSDatabaseSingleton.then(function(f){return d("MAWThreadCutover").isCutoverSecureThreadFromChatJid(f,a).then(function(a){c("QPLUserFlow").addAnnotations(b,{bool:{is_cutover:a}},{instanceKey:e})})})}var v=/[^a-zA-Z0-9._-]/g,w=/[.]+/g,x=/[\s_.-]+/g;function y(a){return a.replace(x,".").replace(v,"").replace(w,".")}var z={broadcastChannelFallback:function(a){var b=a.event;a=a.namespace;d("BroadcastChannelFallback").handleBroadcastChannelFallbackMessage(a,b)},handleMessageSendResult:function(a){a.success&&d("MAWReportSendMessageSuccessResult").reportSendMessageSuccessResult(a.report)},log:function(a){var b=a.logLevel,c=a.logString,e=a.tags;a=e.length>0;var f=""+(d("CurrentAppID").getAppID()||"unknown");switch(b){case"count":(j||(j=d("ODS"))).bumpEntityKey(3185,y("e2ee."+(a?e.join("."):c)),y("count."+(a?c+"."+f:f)),1);o.onReadyImmediately(function(a){a=a.count;return a(c,e)});return;case"log":o.onReadyImmediately(function(a){a=a.info;return a(c,e)});return;case"warn":o.onReadyImmediately(function(a){a=a.warn;return a(c,e)});return;case"logRestricted":o.onReadyImmediately(function(a){a=a.logRestricted;return a(c,e)});return;case"debug":break;case"error":break;default:break}},logError:function(a){var b=a.entriesToReport,c=a.framesToPop,d=a.logString,e=a.message,f=a.stack,g=a.tags;o.onReadyImmediately(function(a){a=a.logError;return a(d,g,e,f,c,b)})},odsBumpEntityKey:function(a){var b=a.amount,c=a.entity;a=a.key;(j||(j=d("ODS"))).bumpEntityKey(3185,c,a+"."+(d("CurrentAppID").getAppID()||"unknown"),b)},onJobFinished:function(a){a.type==="createGroup"&&a.originalArgs.key!=null&&d("MAWJobActionsV2").recentFinishedJobsCache.set(a.originalArgs.key,a.result);switch(a.type){case"sendAppData":var b=a.originalArgs,e=a.result;(b=b.args.contents.actions)==null?void 0:b.forEach(function(a){a=a.messageAction;if(a==null||a.type!=="delete_for_me"||e.type!=="not_sent")return;q.set(e.appDataExternalId,{chatJid:a.protocolMsgId.chat,externalId:a.protocolMsgId.externalId,type:"deleteMsgForMe"})});break}if(a.type==="sendWrittenAppData"){b=a.originalArgs.appDataExternalId;var f=q.get(b);q["delete"](b);if(f!=null&&f.type==="deleteMsgForMe"&&a.result.type==="success"){var g=f.chatJid,h=f.externalId,j=d("MAWThreadUtils").getLSThreadTypeFromJid(g);c("promiseDone")((i||(i=d("LSDatabaseSingleton"))).LSDatabaseSingleton.then(function(a){c("promiseDone")(d("MAWChatJid").toThreadKey(a.tables,g,"MAWCommonSetupBridge::sendWrittenAppData").then(function(b){d("MWLogSend").log(a,{actor:(k||(k=d("I64"))).of_string(d("MAWCurrentUser").getID()),attachmentFbids:[],attachmentType:25,backend:1,hasReply:!1,messagingThreadId:k.to_string(b),offlineThreadingId:h,sendType:3,source:(l||(l=d("LSIntEnum"))).ofNumber(c("LSMessagingThreadAttributionType").UNKNOWN),threadKey:b,threadType:j})}))}))}}},qplEvent:function(a){var e=a.action,f=a.annotations,g=a.debugInfo,i=a.error,j=a.event,k=a.instanceKey,l=a.performanceAndDateSkew,n=a.timeoutInMs;a=a.timestamp;if(!c("CurrentUser").isEmployee()&&p.has((m||(m=d("QPLEvent"))).getMarkerId(j)))return;var o=k||0;k=f==null?void 0:(k=f.string)==null?void 0:k.jid;k=k!=null?d("WAJids").validateChatJid(k):void 0;k=r.has((m||(m=d("QPLEvent"))).getMarkerId(j))&&k!=null?u(k,j,o):(h||(h=b("Promise"))).resolve();var q=a!=null&&l!=null&&c("gkx")("8334")?a+l-t+s():a;switch(e.type){case"start":c("QPLUserFlow").start(j,{annotations:babelHelpers["extends"]({},f||{},{bool:babelHelpers["extends"]({},(f==null?void 0:f.bool)||{},{isArmadilloPublicLaunchUser:c("gkx")("23405"),isDev:0,isGifSearchEnbled:!0,isLockApiSupported:c("BrowserLockManager")!=null,isRestoreDBEnabled:c("gkx")("23906"),isTlcPublicUser:d("MAWCurrentUser").isTlcPublicUser(),s_pdb:c("gkx")("8483"),useSharedWorker:d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()})}),instanceKey:o,timeoutInMs:n,timestamp:q});break;case"success":c("QPLUserFlow").addAnnotations(j,{bool:{exceededStorageQuota:d("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0}},{instanceKey:o});k["finally"](function(){c("QPLUserFlow").endSuccess(j,{annotations:f,instanceKey:o,timestamp:q})});break;case"cancel":c("QPLUserFlow").addAnnotations(j,{bool:{exceededStorageQuota:d("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0}},{instanceKey:o});k["finally"](function(){c("QPLUserFlow").endCancel(j,{annotations:f,instanceKey:o,timestamp:q})});break;case"point":f&&c("QPLUserFlow").addAnnotations(j,f,{instanceKey:o});(m||(m=d("QPLEvent"))).getMarkerId(j)===1056839232?d("MAWMIC").addPoint(e.name,q):c("QPLUserFlow").addPoint(j,e.name,{instanceKey:o,timestamp:q});break;case"annotations":c("QPLUserFlow").addAnnotations(j,f!=null?f:{},{instanceKey:o});break;case"failure":c("QPLUserFlow").addAnnotations(j,{bool:{exceededStorageQuota:d("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0},string:{failureReason:e.name}},{instanceKey:o});k["finally"](function(){c("QPLUserFlow").endFailure(j,e.name,{annotations:f,instanceKey:o,timestamp:q})});break;case"error":c("QPLUserFlow").markError(j,e.name,{debugInfo:g,error:i,instanceKey:o});break;default:throw c("FBLogger")("messenger_web").mustfixThrow("Bridge sends unreachable qplEvent action type")}}},A=function(a,b){a.push(b);return a};f=function(a){var e=a.customizeEventHandlers;a=a.worker;d("MAWInit").MAWInit.logPoint("bridge_setup_start");var f=d("MAWBridge").getBridge();f.setHandlers("event",babelHelpers["extends"]({},z,{},e));e=d("MAWCrossWorkerPortal").getOrCreateCrossWorkerPortal(f,["backend","mps"],A,{bridgeBatcherMaxTokens:Number.MAX_SAFE_INTEGER,portalCacheSize:c("justknobx")._("3092"),useLRUCache:c("gkx")("6949")});e.setPort(a);if(c("gkx")("3282")){var g=d("WADevToolsBridge").getDevToolBridge();a=new MessageChannel();var h=d("WACrossWorkerPortal").attachPortal(g,["backend"],A,c("pageID")),i=d("WACrossWorkerPortal").attachPortal(g,["devtool","mawDbDevTool"],A,c("pageID"));d("WADevToolMessageChannel").onCreateNewChannel(function(a){h.setPort(a.port1)});i.setPort(a.port1);b("cr:2691")==null?void 0:b("cr:2691").connectAddonPort(a.port2);e.addListener(function(a,b){return g.fireAndForget("devtool","bridgeMessage",{direction:b==="outgoing"?"toWorker":"toMain",msg:a,ts:Date.now()},!0)})}d("MAWMIC").addPoint("bridge_setup_done");d("MAWInit").MAWInit.logPoint("bridge_setup_end");return f};g.MEDIA_TYPE_TO_ATTACHMENT_TYPE=e;g.initBridge=f}),98);
__d("MAWGetAttachmentTypeForSendWrittenMsg",["MAWCommonSetupBridge"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e,f,g,h,i){if(f)return 43;if(a==="revokeMsg")return 26;if(g!=null)return g;if(c)return 3;if(e&&h===!1)return 13;if(i===!0)return 13;f=b!=null?d("MAWCommonSetupBridge").MEDIA_TYPE_TO_ATTACHMENT_TYPE.get(b):null;return f!=null?f:0}g.getAttachmentTypeForSendWrittenMsg=a}),98);
__d("MAWReportSendMessageSuccessResult",["BrowserLockManager","FBLogger","I64","LSDatabaseSingleton","LSIntEnum","LSMessagingThreadAttributionType","MAWChatJid","MAWCurrentUser","MAWFrontendMediaUtils","MAWGetAttachmentTypeForSendWrittenMsg","MAWThreadUtils","MAWVault","MAWXMAUtils","MWLogSend","MultipleTabsLogger","URLMatcher","WAJids","gkx","justknobx","promiseDone","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;async function k(a,b){try{a=await d("MAWChatJid").toThreadKey(a.tables,b,"MAWCommonSetupBridge::sendWrittenMsg");return a}catch(a){if(c("gkx")("10750")){c("FBLogger")("messenger_e2ee_web_send").warn("MAWCommonSetupBridge::sendWrittenMsg failed to get threadKey. With error: %s",a);return(h||(h=d("I64"))).zero}throw a}}function l(a){var b,e=a.externalId,f=null,g=!1,l=!1;switch(a.messageType){case"editMsg":g=!0;break;case"revokeMsg":e=a.referencedExternalId;break;case"sendMsg":l=a.specialTextSize!=null;break;case"reactionMsg":f=a.reaction!=null?20:27;break;case"bumpMsg":break;case"noteReplyMsg":break;case"sendPoll":break;case"fixMe":return;default:a.messageType}var m=null;a.fileType!=null&&(m=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(a.fileType).mediaType);var n=a.xmaMessageType!=null,o=a.quote!=null||d("MAWXMAUtils").isXMAStoryReply(a.xmaMessageType);b=c("URLMatcher").match(d("MAWVault").unvault((b=a.content)!=null?b:""));b=b!=null&&b.length>0;var p=d("MAWGetAttachmentTypeForSendWrittenMsg").getAttachmentTypeForSendWrittenMsg(a.messageType,m,l,n,g,f,o,b),q=d("MAWThreadUtils").getLSThreadTypeFromJid(a.chatJid);c("promiseDone")((i||(i=d("LSDatabaseSingleton"))).LSDatabaseSingleton.then(async function(b){var f=(a==null?void 0:a.source)!=null?a.source:(j||(j=d("LSIntEnum"))).ofNumber(c("LSMessagingThreadAttributionType").UNKNOWN),g=await k(b,a.chatJid),i=d("WAJids").validateGroupJid(a.chatJid);d("MWLogSend").log(b,{actor:(h||(h=d("I64"))).of_string(d("MAWCurrentUser").getID()),attachmentFbids:[],attachmentType:p,backend:1,hasReply:o,initatingSource:a==null?void 0:a.initiatingSource,messagingThreadId:h.to_string(g),msgTtl:(b=a.ephemeralSetting)==null?void 0:b.ephemeralExpirationInSec,offlineThreadingId:e,sendType:1,source:f,threadKey:g,threadType:q,waGroupJid:c("gkx")("10750")&&i!=null?d("WAJids").threadIdForChatJid(i):void 0})}))}function a(a){if(c("justknobx")._("154")&&d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()&&(c("BrowserLockManager")!=null&&!d("MultipleTabsLogger").hasUniqueLock()))return;l(a)}g.reportSendMessageSuccessResultFn=l;g.reportSendMessageSuccessResult=a}),98);
__d("MAWMessageSendReporter",["FBLogger","MAWMarkMessageSendAsFailedLSDB","MAWReportSendMessageSuccessResult","MAWSetupWorkerAuxStateForLogging","MWLogSendToSentFailedError","QPLUserFlow","WAGetSafeQPLError","justknobx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";async function a(a,b,e,f){var g=e.qplEventType;e=e.qplInstanceKey;try{b=await b;if(b==null)return;if(b.success)b.value!=null?d("MAWReportSendMessageSuccessResult").reportSendMessageSuccessResultFn(b.value):c("QPLUserFlow").addPoint(g,"no-op",{instanceKey:e}),c("QPLUserFlow").endSuccess(g,{instanceKey:e});else{var i,j=b.error.isRetriable===!0;c("MWLogSendToSentFailedError")({qplEventType:g,qplInstanceKey:e},b.error.type,void 0,b.error.errorCode,b.error.applicationErrorCode);c("QPLUserFlow").endFailure(g,b.error.type,{annotations:{bool:{isRetriable:(i=b.error.isRetriable)!=null?i:!1,workerTerminatedPermanently:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.workerTerminatedPermanently},int:{errorCode:(i=b.error.errorCode)!=null?i:0},string:{details:(i=b.error.details)!=null?i:""},string_array:{worker_restart_msgs:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartMessageTypes,worker_restart_reasons:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartReasons}},instanceKey:e});h(a,j,f)}}catch(k){c("MWLogSendToSentFailedError")({qplEventType:g,qplInstanceKey:e},"runtime-failure",k);c("QPLUserFlow").endFailure(g,"runtime-failure",{annotations:{bool:{workerTerminatedPermanently:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.workerTerminatedPermanently},string:{errorDescription:d("WAGetSafeQPLError").getSafeQPLErrorMessage(k)},string_array:{worker_restart_msgs:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartMessageTypes,worker_restart_reasons:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartReasons}},instanceKey:e});h(a,!1,f,k);c("FBLogger")("messenger_web").catching(k).mustfix("MAWMessageSendReporter");if(c("justknobx")._("4010")&&typeof k==="object"){b=String(k==null?void 0:k.message);i=String(k==null?void 0:k.messageParams);j=String(k==null?void 0:k.stack);c("FBLogger")("messenger_web").mustfix("Failed to send, e: %s. error params: %s. call stack: %s",b,i,j)}}}function h(a,b,e,f){if(a==null)return;var g=a.chatJid;a=a.externalId;c("promiseDone")(d("MAWMarkMessageSendAsFailedLSDB").markMessageSendAsFailed(a,g,d("WAGetSafeQPLError").getSafeQPLErrorMessage(f),e,b))}g.MAWMessageSendReporter=a}),98);
__d("LSUpdateDisappearingSettingInClientThreadsTable.nop",["I64","LSMessagingThreadAttributionType","MAWBridgeFireAndForget","MAWBridgeSendAndReceive","MAWCurrentUser","MAWEphemeralMsgAutoResetSystemId","MAWJids","MAWMessageSendReporter","MAWMiActOnActThreadReady","ReQL","WATimeUtils","promiseDone","qpl","sendToSentQPLLogger"],(function(a,b,c,d,e,f,g){"use strict";var h;a=async function(a,b,e){var f=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(e));if(f!=null)return d("MAWMiActOnActThreadReady").onActThreadReady(a,e,"LSUpdateDisappearingSettingInClientThreadsTable.nop",function(a,b){var e={ephemeralExpirationInSec:(h||(h=d("I64"))).to_int32((a=f.disappearingSettingTtl)!=null?a:(h||(h=d("I64"))).zero),ephemeralLastUpdatedOrSetTimestamp:d("WATimeUtils").castMilliSecondsToUnixTime(h.to_float((a=f.disappearingSettingUpdatedTs)!=null?a:(h||(h=d("I64"))).zero))};d("MAWBridgeFireAndForget").fireAndForget("backend","setEphemeralSettingCache",{jid:b,settings:e});if(f.disappearingSettingUpdatedBy!=null){a=(h||(h=d("I64"))).to_string(f.disappearingSettingUpdatedBy);var g=a===c("MAWEphemeralMsgAutoResetSystemId");if(a===d("MAWCurrentUser").getID()||g){var i=function(a){return d("MAWBridgeSendAndReceive").sendAndReceive("backend","setEphemeralSettingsFromFrontend",{chatJid:b,ephemeralExpirationInSec:e.ephemeralExpirationInSec,ephemeralLastUpdatedOrSetTimestamp:e.ephemeralLastUpdatedOrSetTimestamp,isEphemeralSettingReset:g,s2sInstanceKey:a})},j=d("sendToSentQPLLogger").markSendToSentStartWithAnnotation(f,{isEphemeralSetting:!0},c("LSMessagingThreadAttributionType").UNKNOWN);c("promiseDone")(d("MAWMessageSendReporter").MAWMessageSendReporter(null,i(j),{qplEventType:c("qpl")._(25313175,"1551"),qplInstanceKey:j}))}else d("MAWBridgeFireAndForget").fireAndForget("backend","setEphemeralSettingsFromMI",{author:d("MAWJids").toUserJid(a),chatJid:b,ephemeralExpirationInSec:e.ephemeralExpirationInSec,ephemeralLastUpdatedOrSetTimestamp:e.ephemeralLastUpdatedOrSetTimestamp,fromWAI:!1,isEphemeralSettingReset:!1,serverTs:e.ephemeralLastUpdatedOrSetTimestamp})}return Promise.resolve()})};a.__nop_name__="LSInsertAdminMessageInClientMessages";g.default=a}),98);
__d("LSUpdateThreadDisappearingSetting",["LSArrayGetObjectAt","LSDeserializeFromJsonIntoDictionaryV2.nop","LSUpdateDisappearingSettingInClientThreadsTable.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=new c.Map(),d[0].set("ephemerality_type",void 0),d[0].set("ephemeral_options_duration_in_sec",a[1]),c.db.table(9).fetch([[[a[0]]]]).next().then(function(a,e){var f=a.done;a=a.value;return f?d[1]=void 0:(e=a.item,c.sequence([function(a){return d[7]=e.metadata,d[7]!==void 0?c.sequence([function(a){return c.nativeOperation(b("LSDeserializeFromJsonIntoDictionaryV2.nop"),d[7]).then(function(a){return a=a,d[8]=a[0],a})},function(a){return d[9]=new c.Map(),d[36]="theme_fbid",d[10]=d[8].get(d[36]),d[10]!==void 0?(d[10]!==void 0?d[55]=c.i64.from_string(d[10]):d[55]=void 0,d[9].set(d[36],d[55])):0,d[37]="cannot_reply_reason",d[11]=d[8].get(d[37]),d[11]!==void 0?d[9].set(d[37],d[11]):0,d[38]="message_sound",d[12]=d[8].get(d[38]),c.i64.neq(d[12],void 0)?d[9].set(d[38],d[12]):0,d[39]="magic_words",d[13]=d[8].get(d[39]),d[13]?d[14]=!1:d[14]=!0,d[14]?c.resolve():c.sequence([function(a){return d[13]?d[55]=!1:d[55]=!0,d[55]?c.resolve(d[56]=void 0):c.sequence([function(a){return d[57]=c.createArray(),d[58]=c.i64.of_int32(d[13].length),c.i64.gt(d[58],c.i64.cast([0,0]))?c.loopAsync(d[58],function(a){return d[59]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[13],d[59]).then(function(a){return a=a,d[60]=a[0],d[61]=a[1],a})},function(a){return d[62]=new c.Map(),d[67]="magic_word",d[63]=d[60].get(d[67]),d[63]!==void 0?d[62].set(d[67],d[63]):0,d[68]="creation_timestamp_ms",d[64]=d[60].get(d[68]),c.i64.neq(d[64],void 0)?d[62].set(d[68],d[64]):0,d[69]="emoji_string",d[65]=d[60].get(d[69]),d[65]!==void 0?d[62].set(d[69],d[65]):0,d[70]="selection_type",d[66]=d[60].get(d[70]),c.i64.neq(d[66],void 0)?d[62].set(d[70],d[66]):0,d[71]=(d[57].push(d[62]),d[57])}])}):c.resolve()},function(a){return d[56]=d[57]}])},function(a){return d[9].set(d[39],d[56])}])},function(a){return d[40]="is_typing_indicator_disabled",d[15]=d[8].get(d[40]),c.i64.neq(d[15],void 0)?d[9].set(d[40],d[15]):0,d[41]="pinned_messages",d[16]=d[8].get(d[41]),d[16]?d[17]=!1:d[17]=!0,d[17]?c.resolve():c.sequence([function(a){return d[16]?d[55]=!1:d[55]=!0,d[55]?c.resolve(d[56]=void 0):c.sequence([function(a){return d[57]=c.createArray(),d[58]=c.i64.of_int32(d[16].length),c.i64.gt(d[58],c.i64.cast([0,0]))?c.loopAsync(d[58],function(a){return d[59]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[16],d[59]).then(function(a){return a=a,d[60]=a[0],d[61]=a[1],a})},function(a){return d[62]=new c.Map(),d[66]="message_otid",d[63]=d[60].get(d[66]),d[63]!==void 0?d[62].set(d[66],d[63]):0,d[67]="actor_user_fbid",d[64]=d[60].get(d[67]),d[64]!==void 0?d[62].set(d[67],c.i64.from_string(d[64])):0,d[68]="creation_timestamp_ms",d[65]=d[60].get(d[68]),d[65]!==void 0?d[62].set(d[68],c.i64.from_string(d[65])):0,d[69]=(d[57].push(d[62]),d[57])}])}):c.resolve()},function(a){return d[56]=d[57]}])},function(a){return d[9].set(d[41],d[56])}])},function(a){return d[42]="ttlc_message_type",d[18]=d[8].get(d[42]),d[18]?d[19]=!1:d[19]=!0,d[19]?0:(d[18]?d[55]=!1:d[55]=!0,d[55]?d[56]=void 0:(d[57]=new c.Map(),d[61]="enabled_ttlc_message_type",d[58]=d[18].get(d[61]),d[58]?d[59]=!1:d[59]=!0,d[59]?0:(d[58]?d[63]=!1:d[63]=!0,d[63]?d[64]=void 0:(d[65]=new c.Map(),d[81]="text",d[66]=d[58].get(d[81]),d[66]!==void 0?d[65].set(d[81],d[66]):0,d[82]="clip",d[67]=d[58].get(d[82]),d[67]!==void 0?d[65].set(d[82],d[67]):0,d[83]="reel_share",d[68]=d[58].get(d[83]),d[68]!==void 0?d[65].set(d[83],d[68]):0,d[84]="media_share",d[69]=d[58].get(d[84]),d[69]!==void 0?d[65].set(d[84],d[69]):0,d[85]="story_share",d[70]=d[58].get(d[85]),d[70]!==void 0?d[65].set(d[85],d[70]):0,d[86]="link",d[71]=d[58].get(d[86]),d[71]!==void 0?d[65].set(d[86],d[71]):0,d[87]="generic_xma",d[72]=d[58].get(d[87]),d[72]!==void 0?d[65].set(d[87],d[72]):0,d[88]="profile",d[73]=d[58].get(d[88]),d[73]!==void 0?d[65].set(d[88],d[73]):0,d[89]="image",d[74]=d[58].get(d[89]),d[74]!==void 0?d[65].set(d[89],d[74]):0,d[90]="video",d[75]=d[58].get(d[90]),d[75]!==void 0?d[65].set(d[90],d[75]):0,d[91]="gif",d[76]=d[58].get(d[91]),d[76]!==void 0?d[65].set(d[91],d[76]):0,d[92]="raven",d[77]=d[58].get(d[92]),d[77]!==void 0?d[65].set(d[92],d[77]):0,d[93]="collection",d[78]=d[58].get(d[93]),d[78]!==void 0?d[65].set(d[93],d[78]):0,d[94]="calling",d[79]=d[58].get(d[94]),d[79]!==void 0?d[65].set(d[94],d[79]):0,d[95]="rest_of_msg_type",d[80]=d[58].get(d[95]),d[80]!==void 0?d[65].set(d[95],d[80]):0,d[64]=d[65]),d[57].set(d[61],d[64])),d[62]="is_ttlc_enabled",d[60]=d[18].get(d[62]),d[60]!==void 0?d[57].set(d[62],d[60]):0,d[56]=d[57]),d[9].set(d[42],d[56])),d[43]="call_link_id",d[20]=d[8].get(d[43]),d[20]!==void 0?(d[20]!==void 0?d[55]=c.i64.from_string(d[20]):d[55]=void 0,d[9].set(d[43],d[55])):0,d[44]="marketplace_trust_signal_data",d[21]=d[8].get(d[44]),d[21]?d[22]=!1:d[22]=!0,d[22]?0:(d[21]?d[55]=!1:d[55]=!0,d[55]?d[56]=void 0:(d[57]=new c.Map(),d[62]="ratings",d[58]=d[21].get(d[62]),d[58]?d[59]=!1:d[59]=!0,d[59]?0:(d[58]?d[64]=!1:d[64]=!0,d[64]?d[65]=void 0:(d[66]=new c.Map(),d[69]="rating_average",d[67]=d[58].get(d[69]),d[67]!==void 0?d[66].set(d[69],d[67]):0,d[70]="rating_count",d[68]=d[58].get(d[70]),c.i64.neq(d[68],void 0)?d[66].set(d[70],d[68]):0,d[65]=d[66]),d[57].set(d[62],d[65])),d[63]="responsiveness",d[60]=d[21].get(d[63]),d[60]?d[61]=!1:d[61]=!0,d[61]?0:(d[60]?d[64]=!1:d[64]=!0,d[64]?d[65]=void 0:(d[66]=new c.Map(),d[70]="buyer_avg_response_time",d[67]=d[60].get(d[70]),d[67]!==void 0?d[66].set(d[70],d[67]):0,d[71]="buyer_response_rate",d[68]=d[60].get(d[71]),d[68]!==void 0?d[66].set(d[71],d[68]):0,d[72]="buyer_responsiveness_level",d[69]=d[60].get(d[72]),c.i64.neq(d[69],void 0)?d[66].set(d[72],d[69]):0,d[65]=d[66]),d[57].set(d[63],d[65])),d[56]=d[57]),d[9].set(d[44],d[56])),d[45]="message_ephemerality_setting",d[23]=d[8].get(d[45]),d[23]?d[24]=!1:d[24]=!0,d[24]?0:(d[23]?d[55]=!1:d[55]=!0,d[55]?d[56]=void 0:(d[57]=new c.Map(),d[60]="ephemerality_type",d[58]=d[23].get(d[60]),c.i64.neq(d[58],void 0)?d[57].set(d[60],d[58]):0,d[61]="ephemeral_options_duration_in_sec",d[59]=d[23].get(d[61]),d[59]!==void 0?(d[59]!==void 0?d[62]=c.i64.from_string(d[59]):d[62]=void 0,d[57].set(d[61],d[62])):0,d[56]=d[57]),d[9].set(d[45],d[56])),d[46]="is_ai_initiated_messaging_enabled",d[25]=d[8].get(d[46]),d[25]!==void 0?d[9].set(d[46],d[25]):0,d[47]="is_secret_conversation_for_deprecation",d[26]=d[8].get(d[47]),d[26]!==void 0?d[9].set(d[47],d[26]):0,d[48]="is_limit_sharing_enabled",d[27]=d[8].get(d[48]),d[27]!==void 0?d[9].set(d[48],d[27]):0,d[49]="first_eb_message_timestamp_ms",d[28]=d[8].get(d[49]),c.i64.neq(d[28],void 0)?d[9].set(d[49],d[28]):0,d[50]="eb_message_timestamp_type",d[29]=d[8].get(d[50]),d[29]?d[30]=!1:d[30]=!0,d[30]?c.resolve():c.sequence([function(a){return d[29]?d[55]=!1:d[55]=!0,d[55]?c.resolve(d[56]=void 0):c.sequence([function(a){return d[57]=c.createArray(),d[58]=c.i64.of_int32(d[29].length),c.i64.gt(d[58],c.i64.cast([0,0]))?c.loopAsync(d[58],function(a){return d[59]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[29],d[59]).then(function(a){return a=a,d[60]=a[0],d[61]=a[1],a})},function(a){return d[62]=new c.Map(),d[65]="first_eb_message_timestamp_ms_long",d[63]=d[60].get(d[65]),d[63]!==void 0?(d[63]!==void 0?d[67]=c.i64.from_string(d[63]):d[67]=void 0,d[62].set(d[65],d[67])):0,d[66]="timestamp_status",d[64]=d[60].get(d[66]),c.i64.neq(d[64],void 0)?d[62].set(d[66],d[64]):0,d[67]=(d[57].push(d[62]),d[57])}])}):c.resolve()},function(a){return d[56]=d[57]}])},function(a){return d[9].set(d[50],d[56])}])},function(a){return d[51]="thread_initiator_id",d[31]=d[8].get(d[51]),d[31]!==void 0?d[9].set(d[51],d[31]):0,d[52]="is_phone_connection",d[32]=d[8].get(d[52]),d[32]!==void 0?d[9].set(d[52],d[32]):0,d[53]="is_hidden_in_spam_folder",d[33]=d[8].get(d[53]),d[33]!==void 0?d[9].set(d[53],d[33]):0,d[54]="cc_deprecation_composer_block",d[34]=d[8].get(d[54]),d[34]?d[35]=!1:d[35]=!0,d[35]?0:(d[34]?d[55]=!1:d[55]=!0,d[55]?d[56]=void 0:(d[57]=new c.Map(),d[64]="title",d[58]=d[34].get(d[64]),d[58]!==void 0?d[57].set(d[64],d[58]):0,d[65]="pause_text",d[59]=d[34].get(d[65]),d[59]!==void 0?d[57].set(d[65],d[59]):0,d[66]="learn_more_text",d[60]=d[34].get(d[66]),d[60]!==void 0?d[57].set(d[66],d[60]):0,d[67]="learn_more_url",d[61]=d[34].get(d[67]),d[61]!==void 0?d[57].set(d[67],d[61]):0,d[68]="cta_url",d[62]=d[34].get(d[68]),d[62]!==void 0?d[57].set(d[68],d[62]):0,d[69]="cta_text",d[63]=d[34].get(d[69]),d[63]!==void 0?d[57].set(d[69],d[63]):0,d[56]=d[57]),d[9].set(d[54],d[56])),d[6]=d[9]}]):c.resolve((d[8]=new c.Map(),d[6]=d[8]))},function(a){return d[1]=d[6]}]))})},function(a){return d[1]?d[3]=!1:d[3]=!0,d[3]?0:d[1].set("message_ephemerality_setting",d[0]),d[1]?d[4]=!1:d[4]=!0,d[4]?c.resolve(d[5]=void 0):c.sequence([function(a){return d[6]=new c.Map(),d[34]="theme_fbid",d[7]=d[1].get(d[34]),c.i64.neq(d[7],void 0)?(c.i64.neq(d[7],void 0)?d[53]=c.i64.to_string(d[7]):d[53]=void 0,d[6].set(d[34],d[53])):0,d[35]="cannot_reply_reason",d[8]=d[1].get(d[35]),d[8]!==void 0?d[6].set(d[35],d[8]):0,d[36]="message_sound",d[9]=d[1].get(d[36]),c.i64.neq(d[9],void 0)?d[6].set(d[36],d[9]):0,d[37]="magic_words",d[10]=d[1].get(d[37]),d[10]?d[11]=!1:d[11]=!0,d[11]?c.resolve():c.sequence([function(a){return d[10]?d[53]=!1:d[53]=!0,d[53]?c.resolve(d[54]=void 0):c.sequence([function(a){return d[56]=c.createArray(),d[57]=c.i64.of_int32(d[10].length),c.i64.gt(d[57],c.i64.cast([0,0]))?c.loopAsync(d[57],function(a){return d[58]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[10],d[58]).then(function(a){return a=a,d[59]=a[0],d[60]=a[1],a})},function(a){return d[61]=new c.Map(),d[66]="magic_word",d[62]=d[59].get(d[66]),d[62]!==void 0?d[61].set(d[66],d[62]):0,d[67]="creation_timestamp_ms",d[63]=d[59].get(d[67]),c.i64.neq(d[63],void 0)?d[61].set(d[67],d[63]):0,d[68]="emoji_string",d[64]=d[59].get(d[68]),d[64]!==void 0?d[61].set(d[68],d[64]):0,d[69]="selection_type",d[65]=d[59].get(d[69]),c.i64.neq(d[65],void 0)?d[61].set(d[69],d[65]):0,d[70]=(d[56].push(d[61]),d[56])}])}):c.resolve()},function(a){return d[54]=d[56]}])},function(a){return d[55]=c.i64.of_int32(d[54].length),c.i64.neq(d[55],c.i64.cast([0,0]))?d[6].set(d[37],d[54]):0}])},function(a){return d[38]="is_typing_indicator_disabled",d[12]=d[1].get(d[38]),c.i64.neq(d[12],void 0)?d[6].set(d[38],d[12]):0,d[39]="pinned_messages",d[13]=d[1].get(d[39]),d[13]?d[14]=!1:d[14]=!0,d[14]?c.resolve():c.sequence([function(a){return d[13]?d[53]=!1:d[53]=!0,d[53]?c.resolve(d[54]=void 0):c.sequence([function(a){return d[56]=c.createArray(),d[57]=c.i64.of_int32(d[13].length),c.i64.gt(d[57],c.i64.cast([0,0]))?c.loopAsync(d[57],function(a){return d[58]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[13],d[58]).then(function(a){return a=a,d[59]=a[0],d[60]=a[1],a})},function(a){return d[61]=new c.Map(),d[65]="message_otid",d[62]=d[59].get(d[65]),d[62]!==void 0?d[61].set(d[65],d[62]):0,d[66]="actor_user_fbid",d[63]=d[59].get(d[66]),c.i64.neq(d[63],void 0)?d[61].set(d[66],c.i64.to_string(d[63])):0,d[67]="creation_timestamp_ms",d[64]=d[59].get(d[67]),c.i64.neq(d[64],void 0)?d[61].set(d[67],c.i64.to_string(d[64])):0,d[68]=(d[56].push(d[61]),d[56])}])}):c.resolve()},function(a){return d[54]=d[56]}])},function(a){return d[55]=c.i64.of_int32(d[54].length),c.i64.neq(d[55],c.i64.cast([0,0]))?d[6].set(d[39],d[54]):0}])},function(a){return d[40]="ttlc_message_type",d[15]=d[1].get(d[40]),d[15]?d[16]=!1:d[16]=!0,d[16]?0:(d[15]?d[53]=!1:d[53]=!0,d[53]?d[54]=void 0:(d[57]=new c.Map(),d[61]="enabled_ttlc_message_type",d[58]=d[15].get(d[61]),d[58]?d[59]=!1:d[59]=!0,d[59]?0:(d[58]?d[63]=!1:d[63]=!0,d[63]?d[64]=void 0:(d[67]=new c.Map(),d[83]="text",d[68]=d[58].get(d[83]),d[68]!==void 0?d[67].set(d[83],d[68]):0,d[84]="clip",d[69]=d[58].get(d[84]),d[69]!==void 0?d[67].set(d[84],d[69]):0,d[85]="reel_share",d[70]=d[58].get(d[85]),d[70]!==void 0?d[67].set(d[85],d[70]):0,d[86]="media_share",d[71]=d[58].get(d[86]),d[71]!==void 0?d[67].set(d[86],d[71]):0,d[87]="story_share",d[72]=d[58].get(d[87]),d[72]!==void 0?d[67].set(d[87],d[72]):0,d[88]="link",d[73]=d[58].get(d[88]),d[73]!==void 0?d[67].set(d[88],d[73]):0,d[89]="generic_xma",d[74]=d[58].get(d[89]),d[74]!==void 0?d[67].set(d[89],d[74]):0,d[90]="profile",d[75]=d[58].get(d[90]),d[75]!==void 0?d[67].set(d[90],d[75]):0,d[91]="image",d[76]=d[58].get(d[91]),d[76]!==void 0?d[67].set(d[91],d[76]):0,d[92]="video",d[77]=d[58].get(d[92]),d[77]!==void 0?d[67].set(d[92],d[77]):0,d[93]="gif",d[78]=d[58].get(d[93]),d[78]!==void 0?d[67].set(d[93],d[78]):0,d[94]="raven",d[79]=d[58].get(d[94]),d[79]!==void 0?d[67].set(d[94],d[79]):0,d[95]="collection",d[80]=d[58].get(d[95]),d[80]!==void 0?d[67].set(d[95],d[80]):0,d[96]="calling",d[81]=d[58].get(d[96]),d[81]!==void 0?d[67].set(d[96],d[81]):0,d[97]="rest_of_msg_type",d[82]=d[58].get(d[97]),d[82]!==void 0?d[67].set(d[97],d[82]):0,d[64]=d[67]),d[65]=d[64].keys(),d[66]=c.i64.of_int32(d[65].length),c.i64.neq(d[66],c.i64.cast([0,0]))?d[57].set(d[61],d[64]):0),d[62]="is_ttlc_enabled",d[60]=d[15].get(d[62]),d[60]!==void 0?d[57].set(d[62],d[60]):0,d[54]=d[57]),d[55]=d[54].keys(),d[56]=c.i64.of_int32(d[55].length),c.i64.neq(d[56],c.i64.cast([0,0]))?d[6].set(d[40],d[54]):0),d[41]="call_link_id",d[17]=d[1].get(d[41]),c.i64.neq(d[17],void 0)?(c.i64.neq(d[17],void 0)?d[53]=c.i64.to_string(d[17]):d[53]=void 0,d[6].set(d[41],d[53])):0,d[42]="marketplace_trust_signal_data",d[18]=d[1].get(d[42]),d[18]?d[19]=!1:d[19]=!0,d[19]?0:(d[18]?d[53]=!1:d[53]=!0,d[53]?d[54]=void 0:(d[57]=new c.Map(),d[62]="ratings",d[58]=d[18].get(d[62]),d[58]?d[59]=!1:d[59]=!0,d[59]?0:(d[58]?d[64]=!1:d[64]=!0,d[64]?d[65]=void 0:(d[68]=new c.Map(),d[71]="rating_average",d[69]=d[58].get(d[71]),d[69]!==void 0?d[68].set(d[71],d[69]):0,d[72]="rating_count",d[70]=d[58].get(d[72]),c.i64.neq(d[70],void 0)?d[68].set(d[72],d[70]):0,d[65]=d[68]),d[66]=d[65].keys(),d[67]=c.i64.of_int32(d[66].length),c.i64.neq(d[67],c.i64.cast([0,0]))?d[57].set(d[62],d[65]):0),d[63]="responsiveness",d[60]=d[18].get(d[63]),d[60]?d[61]=!1:d[61]=!0,d[61]?0:(d[60]?d[64]=!1:d[64]=!0,d[64]?d[65]=void 0:(d[68]=new c.Map(),d[72]="buyer_avg_response_time",d[69]=d[60].get(d[72]),d[69]!==void 0?d[68].set(d[72],d[69]):0,d[73]="buyer_response_rate",d[70]=d[60].get(d[73]),d[70]!==void 0?d[68].set(d[73],d[70]):0,d[74]="buyer_responsiveness_level",d[71]=d[60].get(d[74]),c.i64.neq(d[71],void 0)?d[68].set(d[74],d[71]):0,d[65]=d[68]),d[66]=d[65].keys(),d[67]=c.i64.of_int32(d[66].length),c.i64.neq(d[67],c.i64.cast([0,0]))?d[57].set(d[63],d[65]):0),d[54]=d[57]),d[55]=d[54].keys(),d[56]=c.i64.of_int32(d[55].length),c.i64.neq(d[56],c.i64.cast([0,0]))?d[6].set(d[42],d[54]):0),d[43]="message_ephemerality_setting",d[20]=d[1].get(d[43]),d[20]?d[21]=!1:d[21]=!0,d[21]?0:(d[20]?d[53]=!1:d[53]=!0,d[53]?d[54]=void 0:(d[57]=new c.Map(),d[60]="ephemerality_type",d[58]=d[20].get(d[60]),c.i64.neq(d[58],void 0)?d[57].set(d[60],d[58]):0,d[61]="ephemeral_options_duration_in_sec",d[59]=d[20].get(d[61]),c.i64.neq(d[59],void 0)?(c.i64.neq(d[59],void 0)?d[62]=c.i64.to_string(d[59]):d[62]=void 0,d[57].set(d[61],d[62])):0,d[54]=d[57]),d[55]=d[54].keys(),d[56]=c.i64.of_int32(d[55].length),c.i64.neq(d[56],c.i64.cast([0,0]))?d[6].set(d[43],d[54]):0),d[44]="is_ai_initiated_messaging_enabled",d[22]=d[1].get(d[44]),d[22]!==void 0?d[6].set(d[44],d[22]):0,d[45]="is_secret_conversation_for_deprecation",d[23]=d[1].get(d[45]),d[23]!==void 0?d[6].set(d[45],d[23]):0,d[46]="is_limit_sharing_enabled",d[24]=d[1].get(d[46]),d[24]!==void 0?d[6].set(d[46],d[24]):0,d[47]="first_eb_message_timestamp_ms",d[25]=d[1].get(d[47]),c.i64.neq(d[25],void 0)?d[6].set(d[47],d[25]):0,d[48]="eb_message_timestamp_type",d[26]=d[1].get(d[48]),d[26]?d[27]=!1:d[27]=!0,d[27]?c.resolve():c.sequence([function(a){return d[26]?d[53]=!1:d[53]=!0,d[53]?c.resolve(d[54]=void 0):c.sequence([function(a){return d[56]=c.createArray(),d[57]=c.i64.of_int32(d[26].length),c.i64.gt(d[57],c.i64.cast([0,0]))?c.loopAsync(d[57],function(a){return d[58]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[26],d[58]).then(function(a){return a=a,d[59]=a[0],d[60]=a[1],a})},function(a){return d[61]=new c.Map(),d[64]="first_eb_message_timestamp_ms_long",d[62]=d[59].get(d[64]),c.i64.neq(d[62],void 0)?(c.i64.neq(d[62],void 0)?d[66]=c.i64.to_string(d[62]):d[66]=void 0,d[61].set(d[64],d[66])):0,d[65]="timestamp_status",d[63]=d[59].get(d[65]),c.i64.neq(d[63],void 0)?d[61].set(d[65],d[63]):0,d[66]=(d[56].push(d[61]),d[56])}])}):c.resolve()},function(a){return d[54]=d[56]}])},function(a){return d[55]=c.i64.of_int32(d[54].length),c.i64.neq(d[55],c.i64.cast([0,0]))?d[6].set(d[48],d[54]):0}])},function(a){return d[49]="thread_initiator_id",d[28]=d[1].get(d[49]),d[28]!==void 0?d[6].set(d[49],d[28]):0,d[50]="is_phone_connection",d[29]=d[1].get(d[50]),d[29]!==void 0?d[6].set(d[50],d[29]):0,d[51]="is_hidden_in_spam_folder",d[30]=d[1].get(d[51]),d[30]!==void 0?d[6].set(d[51],d[30]):0,d[52]="cc_deprecation_composer_block",d[31]=d[1].get(d[52]),d[31]?d[32]=!1:d[32]=!0,d[32]?0:(d[31]?d[53]=!1:d[53]=!0,d[53]?d[54]=void 0:(d[57]=new c.Map(),d[64]="title",d[58]=d[31].get(d[64]),d[58]!==void 0?d[57].set(d[64],d[58]):0,d[65]="pause_text",d[59]=d[31].get(d[65]),d[59]!==void 0?d[57].set(d[65],d[59]):0,d[66]="learn_more_text",d[60]=d[31].get(d[66]),d[60]!==void 0?d[57].set(d[66],d[60]):0,d[67]="learn_more_url",d[61]=d[31].get(d[67]),d[61]!==void 0?d[57].set(d[67],d[61]):0,d[68]="cta_url",d[62]=d[31].get(d[68]),d[62]!==void 0?d[57].set(d[68],d[62]):0,d[69]="cta_text",d[63]=d[31].get(d[69]),d[63]!==void 0?d[57].set(d[69],d[63]):0,d[54]=d[57]),d[55]=d[54].keys(),d[56]=c.i64.of_int32(d[55].length),c.i64.neq(d[56],c.i64.cast([0,0]))?d[6].set(d[52],d[54]):0),d[33]=c.toJSON(d[6]),d[5]=d[33]}])},function(b){return c.forEach(c.filter(c.db.table(9).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.threadKey,a[0])&&c.i64.eq(b.syncGroup,c.i64.cast([0,95]))}),function(b){var c=b.update;b.item;return c({disappearingSettingTtl:a[1],disappearingSettingUpdatedTs:a[2],disappearingSettingUpdatedBy:a[3],metadata:d[5]})})},function(d){return c.nativeOperation(b("LSUpdateDisappearingSettingInClientThreadsTable.nop"),a[0])}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxUpdateThreadDisappearingSettingStoredProcedure";a.__tables__=["threads"];e.exports=a}),null);
__d("LSUpdateThreadNullState",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.db.table(9).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({threadPictureUrl:a[1],threadPictureUrlFallback:a[2],threadPictureUrlExpirationTimestampMs:a[3],nullstateDescriptionText1:a[5],nullstateDescriptionType1:a[10],nullstateDescriptionText2:a[6],nullstateDescriptionType2:a[11],nullstateDescriptionText3:a[7],nullstateDescriptionType3:a[12],capabilities:a[15],threadName:a[16],threadSubtype:a[4]})})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxUpdateThreadNullStateStoredProcedure";a.__tables__=["threads"];e.exports=a}),null);
__d("LSUpsertContextualProfileV1",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(d){return b.i64.eq(a[5],b.i64.cast([0,0]))?c[0]=void 0:c[0]=a[5],b.db.table(216).put({ownerId:a[0],associatedEntityId:a[1],profilePictureUrl:a[2],profilePictureFallbackUrl:a[4],profilePictureUrlExpirationTimestampMs:c[0],profileName:a[3]})},function(a){return b.resolve(d)}])}a.__sproc_name__="LSContactUpsertContextualProfileV1StoredProcedure";a.__tables__=["contextual_profile_v1"];e.exports=a}),null);
__d("LSVoprfComputeSharedSecret.nop",["XPlatReactVoprf"],(function(a,b,c,d,e,f,g){"use strict";a=async function(a,b,c,e){a=await d("XPlatReactVoprf").loadXPlatReactVoprf();b=a.voprfInstance;a=b.voprfInfo;var f=b.voprfWasm;try{f=f.clientFinalize(a,new Uint8Array(c),new Uint8Array(e));return Promise.resolve([f.finalEvaluation.buffer])}catch(a){throw a}finally{d("XPlatReactVoprf").freeVoprfInstance(b)}};a.__nop_name__="LSVoprfComputeSharedSecret";g.default=a}),98);
__d("LSVoprfUnblind.nop",["XPlatReactVoprf"],(function(a,b,c,d,e,f,g){"use strict";a=async function(a,b,c,e,f,g,h,i){a=await d("XPlatReactVoprf").loadXPlatReactVoprf();b=a.voprfInstance;a=b.voprfInfo;var j=b.voprfWasm;try{j=j.verifiableUnblind(a,new Uint8Array(h),new Uint8Array(i),new Uint8Array(e),new Uint8Array(g),new Uint8Array(f),new Uint8Array(c),!0);return Promise.resolve([j.unblindedElement.buffer])}catch(a){throw a}finally{d("XPlatReactVoprf").freeVoprfInstance(b)}};a.__nop_name__="LSVoprfUnblind";g.default=a}),98);
__d("LSVerifyAndSaveNewCredentials",["LSArrayGetObjectAt","LSBase64Decode.nop","LSRemoveBlindedTokens","LSVoprfComputeSharedSecret.nop","LSVoprfUnblind.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.db.table(307).fetch([[[a[0]]]]).next().then(function(e,f){var g=e.done;e=e.value;return g?(d[1]=c.createArray(),d[2]=(d[1].push("No valid config found when saving signed credentials for project: "),d[1]),d[3]=(d[1].push("unknown"),d[1]),d[4]=c.toJSON(d[1]),function(a){c.logger(a).mustfix(a)}(d[4])):(f=e.item,c.sequence([function(e){return d[1]=c.i64.of_int32(a[1].length),c.i64.gt(d[1],c.i64.cast([0,0]))?c.loopAsync(d[1],function(e){return d[2]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[1],d[2]).then(function(a){return a=a,d[3]=a[0],d[4]=a[1],a})},function(a){return d[5]=d[3].get("token_id"),c.db.table(308).fetch([[[d[5]]]]).next().then(function(b,e){var a=b.done;b=b.value;return a?(a=[c.blob(""),c.blob(""),c.blob("")],d[6]=a[0],d[7]=a[1],d[8]=a[2],a):(e=b.item,a=[e.nonce,e.blindedNonce,e.blindingFactor],d[6]=a[0],d[7]=a[1],d[8]=a[2],a)})},function(a){return c.forEach(c.db.table(308).fetch([[[d[5]]]]),function(a){return a["delete"]()})},function(a){return d[10]=d[3].get("signed_nonce"),c.nativeOperation(b("LSBase64Decode.nop"),d[10]).then(function(a){return a=a,d[11]=a[0],a})},function(a){return d[12]=d[3].get("proof_c"),c.nativeOperation(b("LSBase64Decode.nop"),d[12]).then(function(a){return a=a,d[13]=a[0],a})},function(a){return d[14]=d[3].get("proof_s"),c.nativeOperation(b("LSBase64Decode.nop"),d[14]).then(function(a){return a=a,d[15]=a[0],a})},function(a){return c.nativeOperation(b("LSVoprfUnblind.nop"),f.publicKey,d[8],d[7],d[11]==null?c.blob(""):d[11],d[13]==null?c.blob(""):d[13],d[15]==null?c.blob(""):d[15]).then(function(a){return a=a,d[16]=a[0],a})},function(e){return c.blobs.neq(d[16],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSVoprfComputeSharedSecret.nop"),d[6],d[16]).then(function(a){return a=a,d[17]=a[0],a})},function(b){return c.blobs.neq(d[17],void 0)?c.db.table(309).add({tokenId:d[5],configId:a[0],nonce:d[6],redeemLimit:f.redemptionLimit,sharedSecret:d[17]}):c.resolve()}]):c.resolve()}])}):c.resolve()},function(d){return c.storedProcedure(b("LSRemoveBlindedTokens"),a[0])}]))})},function(a){return c.resolve(e)}])}a.__sproc_name__="LSAnonymousCredentialsVerifyAndSaveNewCredentialsStoredProcedure";a.__tables__=["secure_acs_configurations","secure_acs_blinded_tokens","secure_acs_tokens"];e.exports=a}),null);
__d("LSVerifyCommunityFolderExistsV2",["LSIssueNewTaskWithExtraOperations"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(b){return a[1]?c.resolve(d[0]=a[1]):c.sequence([function(b){return c.db.table(162).fetch([[[a[0]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?d[1]=!0:(b=a.item,c.sequence([function(a){return c.db.table(9).fetch([[[b.folderId]]]).next().then(function(a,b){b=a.done;a=a.value;return b?d[3]=!0:(a.item,d[3]=!1)})},function(a){return d[1]=d[3]}]))})},function(a){return d[0]=d[1]}])},function(e){return d[0]?(d[1]=new c.Map(),d[1].set("folder_id",a[0]),d[2]=d[1].get("folder_id"),d[3]=c.toJSON(d[1]),c.storedProcedure(b("LSIssueNewTaskWithExtraOperations"),c.i64.to_string(d[2]),c.i64.cast([0,813]),d[3],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),void 0,c.i64.cast([0,0]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxVerifyCommunityFolderExistsV2StoredProcedure";a.__tables__=["community_folders","threads"];e.exports=a}),null);
__d("LSExpandedStaticDependenciesWithPopover",["LSCheckAuthoritativeMessageExists","LSCompleteThreadCutover","LSDeleteBannersByIds","LSDeleteRowRichStatusCustomAudience","LSDeleteThenInsertAvatarFeatureConfig","LSDeleteThenInsertBotProfileInfoV2","LSDeleteThenInsertCmChannelList","LSDeleteThenInsertCommunityUnjoinedThread","LSDeleteThenInsertRankingRequest","LSDeleteThenInsertRankingScore","LSExpandedStaticDependencies","LSFillDeanonCacheForE2EEThread","LSIssueFetchThreadCapabilitiesTask","LSIssueNextSync","LSMailboxTaskCompletionApiOnTaskCompletion","LSMarkThreadReadV2","LSStoreProjectConfiguration","LSSyncBumpThreadDataToClient","LSTriggerReenrollementFromOptOutDelta","LSUpdateCommunityThreadStaleState","LSUpdateOrInsertOhaiGatewayKeyConfigs","LSUpdateThreadActivityStatus","LSUpdateThreadDisappearingSetting","LSUpdateThreadNullState","LSUpsertContextualProfileV1","LSVerifyAndSaveNewCredentials","LSVerifyCommunityFolderExistsV2","LSVerifyE2EEMetadataThreadExistsV2"],(function(a,b,c,d,e,f,g){"use strict";a=babelHelpers["extends"]({},c("LSExpandedStaticDependencies"),{LSVerifyCommunityFolderExistsV2:c("LSVerifyCommunityFolderExistsV2"),checkAuthoritativeMessageExists:c("LSCheckAuthoritativeMessageExists"),completeThreadCutover:c("LSCompleteThreadCutover"),deleteBannersByIds:c("LSDeleteBannersByIds"),deleteRowRichStatusCustomAudience:c("LSDeleteRowRichStatusCustomAudience"),deleteThenInsertAvatarFeatureConfig:c("LSDeleteThenInsertAvatarFeatureConfig"),deleteThenInsertBotProfileInfoV2:c("LSDeleteThenInsertBotProfileInfoV2"),deleteThenInsertCmChannelList:c("LSDeleteThenInsertCmChannelList"),deleteThenInsertCommunityUnjoinedThread:c("LSDeleteThenInsertCommunityUnjoinedThread"),deleteThenInsertRankingRequest:c("LSDeleteThenInsertRankingRequest"),deleteThenInsertRankingScore:c("LSDeleteThenInsertRankingScore"),fillDeanonCacheForE2EEThread:c("LSFillDeanonCacheForE2EEThread"),issueFetchThreadCapabilitiesTask:c("LSIssueFetchThreadCapabilitiesTask"),issueNextSync:c("LSIssueNextSync"),mailboxTaskCompletionApiOnTaskCompletion:c("LSMailboxTaskCompletionApiOnTaskCompletion"),markThreadReadV2:c("LSMarkThreadReadV2"),storeProjectConfiguration:c("LSStoreProjectConfiguration"),syncBumpThreadDataToClient:c("LSSyncBumpThreadDataToClient"),triggerReenrollementFromOptOutDelta:c("LSTriggerReenrollementFromOptOutDelta"),updateCommunityThreadStaleState:c("LSUpdateCommunityThreadStaleState"),updateOrInsertOhaiGatewayKeyConfigs:c("LSUpdateOrInsertOhaiGatewayKeyConfigs"),updateThreadActivityStatus:c("LSUpdateThreadActivityStatus"),updateThreadDisappearingSetting:c("LSUpdateThreadDisappearingSetting"),updateThreadNullState:c("LSUpdateThreadNullState"),upsertContextualProfileV1:c("LSUpsertContextualProfileV1"),verifyAndSaveNewCredentials:c("LSVerifyAndSaveNewCredentials"),verifyE2EEMetadataThreadExistsV2:c("LSVerifyE2EEMetadataThreadExistsV2")});b=a;g["default"]=b}),98);/*FB_PKG_DELIM*/
__d("ReStorePersistence",["FBLogger","JSONStringifyBigIntSafe","ReStoreCommonUtils","ReStoreKeyComparer","ReStorePersistenceIds","ReStoreUtils","gkx","isPromise","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j={},k={gt:[!1,0],gte:[!0,0],lt:[!0,1],lte:[!1,1]},l=new Set(["encrypted_backups_virtual_devices","secure_encrypted_backups_recovery_code_status","device_metadata","secure_encrypted_backups_epochs","secure_encrypted_backups_client_state","encrypted_backups","experiences_shared_state"]),m=16,n=64,o=64,p=Math.floor(m/2),q=Math.floor(n/2),r=Math.floor(o/2);function s(b){if(b==null)return b;var c=Object.getOwnPropertyNames(b),a={},d,e;for(d=0;d<c.length;d++)e=b[c[d]],a[c[d]]=e;return a}function t(a,b){b===void 0&&(b=j);return a===b}function u(a,b,c){var e=0,f=a.length-1;while(e<=f){var g=e+f>>1;(c[0]?(i||(i=d("ReStoreKeyComparer"))).compareKey(a[g],b)<0:(i||(i=d("ReStoreKeyComparer"))).compareKey(a[g],b)<=0)?e=g+1:f=g-1}g=[e,f][c[1]];return g===a.length?-1:g}var v=function(){function a(a,b,c,d,e,f){this.$2=b,this.$3=c,this.$1=a,this.$4=d,this.$5=e,this.$6=f}var b=a.prototype;b.$7=function(a){return a==null?"root":"index("+a+")"};b.$8=function(a,b){return d("ReStoreUtils").getOrCreate(this.$1,b,function(){return{children:[].concat(a.children),isLeaf:!0,keys:[].concat(a.keys),nextId:a.nextId,prevId:a.prevId}})};b.$9=function(a,b){return d("ReStoreUtils").getOrCreate(this.$1,b,function(){return{children:[].concat(a.children),isLeaf:!1,keys:[].concat(a.keys)}})};b.$10=function(a,b){return d("ReStoreUtils").getOrCreate(this.$1,b,function(){return{headId:a.headId,rootId:a.rootId,tailId:a.tailId}})};b.$11=function(a,b){if(!a.length)return[0,0];var c=u(a,b,k.gte);if(c===-1)return[a.length,0];else if((i||(i=d("ReStoreKeyComparer"))).compareKey(a[c],b)===0)return[c,1];return[c,0]};b.$12=function*(a,b,d,e){var f=(yield* this.$13(a,b));f=f;b=b;var g=-1;while(!f.isLeaf){e==null?void 0:e.push([f,b,g]);if(f.keys==null){l.has(this.$2)&&(this.$4.logError==null?void 0:this.$4.logError(this.$2,this.$5,"dbCorruption",{}));throw c("FBLogger")("messenger_web").mustfixThrow("Encountered not leaf node without keys")}g=u(f.keys,d,k.gt);g===-1&&(g=f.keys.length);b=f.children[g];f=(yield* this.$13(a,b))}return[f,b,g]};b.$14=function*(a,b){this.$3();var d=this.$1.get(b);if(t(d))return void 0;if(d!==void 0)return d;d=this.$4.get(a,this.$2,b,this.$5);return(h||(h=c("isPromise")))(d)?yield d:d};b.$13=function*(a,b){a=(yield* this.$14(a,b));if(a===void 0){var d=this.$1.get(b);this.$4.logError==null?void 0:this.$4.logError(this.$2,this.$5,"dbCorruption",{deletedInThisTxn:t(d)?"true":"false",id:c("JSONStringifyBigIntSafe")(b)||""});throw c("FBLogger")("messenger_web").mustfixThrow("value not found")}return a};b.$15=function*(a,b){a=(a=(yield* this.$14(a,d("ReStorePersistenceIds").idForNextId)))!=null?a:0;this.$1.set("nextId",a+1);this.$1.set(a,b);return a};b.$16=function(a,b){this.$3(),this.$1.set(a,b)};b.incrementSeed=function*(a,b){a=(a=(yield* this.$14(a,"seed")))!=null?a:0;if(b===void 0){this.$1.set("seed",a+1);return a}b>=a&&this.$1.set("seed",b+1);return b};b.readData=function*(a,b){return yield* this.$14(a,b)};b.$17=function*(a,b,c){b=(yield* this.$14(a,this.$7(b)));if(b==null)return;a=(yield* this.$12(a,b.rootId,c));b=a[0];a=u(b.keys,c,k.gte);if(a===-1||(i||(i=d("ReStoreKeyComparer"))).compareKey(b.keys[a],c)!==0)return;return b.children[a]};b.tableGet=function*(a,b){b=(yield* this.$17(a,void 0,b));if(b===void 0)return;return yield* this.$18(a,b)};b.$18=function*(a,b){return Array.isArray(b)?b[0]:yield* this.$13(a,b)};b.$19=function*(a,b,d,e){if(Array.isArray(b)){var f=(yield* this.$17(a,void 0,b));if(f==null){c("gkx")("3570")&&this.$6(d,e,this.$2);throw c("FBLogger")("messenger_web").mustfixThrow("Encountered value in index %s but not found in table %s",d,this.$2)}return yield* this.$18(a,f)}return yield* this.$13(a,b)};b.indexGet=function*(a,b,c){var d=(yield* this.$17(a,b,c));if(d==null)return;return yield* this.$19(a,d,b,c)};b.getId=function*(a,b){a=(yield* this.$17(a,void 0,b));return Array.isArray(a)?b:a};b.tableSet=function*(a,b,c){var d,e=this.$4.shouldInline(this.$2,c),f=this.$7(),g=(yield* this.$14(a,f));if(g==null){var h;e||(d=(yield* this.$15(a,c)));h={children:[(h=d)!=null?h:[c]],isLeaf:!0,keys:[b]};h=(yield* this.$15(a,h));this.$16(f,{headId:h,rootId:h,tailId:h});return[(h=d)!=null?h:b,!1]}h=[];var i=(yield* this.$12(a,g.rootId,b,h)),k=i[0];i=i[1];var l=this.$11(k.keys,b),m=l[0];l=l[1];var n=!1;if(l===1){var o=k.children[m];if(!Array.isArray(o)){n=!0;if(!e){this.$16(o,c);return[o,!1]}else this.$1.set(o,j)}}o=this.$8(k,i);e||(d=(yield* this.$15(a,c)));l===0&&o.keys.splice(m,0,b);o.children.splice(m,l,(k=d)!=null?k:[c]);yield* this.$20(a,o,i,h,g,f,!0);return[(m=d)!=null?m:b,l===1&&!(e&&!n)]};b.indexSet=function*(a,b,c,d){b=this.$7(b);var e=(yield* this.$14(a,b));if(e==null){var f={children:[d],isLeaf:!0,keys:[c]};f=(yield* this.$15(a,f));this.$16(b,{headId:f,rootId:f,tailId:f});return}f=[];var g=(yield* this.$12(a,e.rootId,c,f)),h=g[0];g=g[1];var i=this.$11(h.keys,c),j=i[0];i=i[1];if(i===1&&h.children[j]===d)return;h=this.$8(h,g);h.keys.splice(j,i,c);h.children.splice(j,i,d);yield* this.$20(a,h,g,f,e,b,!1)};b.$20=function*(a,b,c,d,e,f,g){b=b;var h;c=c;for(;b.keys.length>=(b.isLeaf?g?m:n:o);b=h,c=i){var i;i=(i=d.pop())!=null?i:[];h=i[0];i=i[1];i!=null?h=this.$9(h,i):(h={children:[c],isLeaf:!1,keys:[]},this.$10(e,f).rootId=(yield* this.$15(a,h)));var j=Math.floor(b.keys.length/2),k=void 0;if(b.isLeaf){var l={children:b.children.slice(j),isLeaf:!0,keys:b.keys.slice(j),nextId:b.nextId,prevId:c},p=k=b.nextId=(yield* this.$15(a,l));l=l.nextId;l?this.$8(yield* this.$13(a,l),l).prevId=p:this.$10(e,f).tailId=k}else k=(yield* this.$15(a,{children:b.children.slice(j+1),isLeaf:!1,keys:b.keys.slice(j+1)}));l=this.$11(h.keys,b.keys[j]);p=l[0];l=l[1];h.keys.splice(p,l,b.keys[j]);h.children.splice(p+1,0,k);b.keys.length=j;b.children.length=j+(b.isLeaf?0:1)}};b.tableDelete=function*(a,b){a=(yield* this.$21(a,void 0,b));if(a==null)return!1;Array.isArray(a)||(this.$3(),this.$1.set(a,j));return!0};b.indexDelete=function*(a,b,c){return(yield* this.$21(a,b,c))!=null};b.$21=function*(a,b,e){var f=this.$7(b),g=(yield* this.$14(a,f));if(g==null)return;var h=[],m=(yield* this.$12(a,g.rootId,e,h)),n=m[0],o=m[1];m=m[2];var s=this.$8(n,o),t=u(n.keys,e,k.gte);if(t===-1||(i||(i=d("ReStoreKeyComparer"))).compareKey(n.keys[t],e)!==0)return;n=s.children[t];s.keys.splice(t,1);s.children.splice(t,1);e=s;t=o;s=m;var v;for(;e.keys.length<(e.isLeaf?b==null?p:q:r)&&h.length;x=[m,v,o],e=x[0],t=x[1],s=x[2],x){o=h.pop();m=o[0];v=o[1];o=o[2];m=this.$9(m,v);var w=[[{nodeId:m.children[s-1]},{node:e,nodeId:t},s-1],[{node:e,nodeId:t},{nodeId:m.children[s+1]},s]].filter(function(b){var a=b[0];b=b[1];return a.nodeId!==void 0&&b.nodeId!==void 0});for(var x of w){var y=x[0],z=x[1],A=x[2],B=y.node=y.node||(yield* this.$13(a,y.nodeId)),C=z.node=z.node||(yield* this.$13(a,z.nodeId)),D=e.isLeaf?b==null?p:q:r;if(B.keys.length+z.node.keys.length>=D*2){if(e.isLeaf){var E=this.$8(B,y.nodeId),F=this.$8(C,z.nodeId),G=[].concat(E.children,F.children),H=[].concat(B.keys,C.keys);E.children=(F.children=G).splice(0,D);E.keys=(F.keys=H).splice(0,D);m.keys[A]=H[0]}else{G=this.$9(B,y.nodeId);E=this.$9(C,z.nodeId);F=[].concat(G.children,E.children);H=[].concat(G.keys,[m.keys[A]],E.keys);G.children=(E.children=F).splice(0,D+1);m.keys[A]=H.splice(D,1)[0];G.keys=(E.keys=H).splice(0,D)}return n}}for(B of w){y=B[0];C=B[1];z=B[2];if(e.isLeaf){F=this.$8(y.node,y.nodeId);A=this.$8(C.node,C.nodeId);F.children=[].concat(F.children,A.children);F.keys=[].concat(F.keys,A.keys);A.keys.length=0;G=A.nextId;if(G){E=this.$8(yield* this.$13(a,G),G);E.prevId=y.nodeId}else this.$10(g,f).tailId=y.nodeId;F.nextId=A.nextId}else{H=this.$9(y.node,y.nodeId);D=this.$9(C.node,C.nodeId);H.children=[].concat(H.children,D.children);H.keys=[].concat(H.keys,[m.keys[z]],D.keys)}m.keys.splice(z,1);m.children.splice(z+1,1);this.$1.set(C.nodeId,j);break}}w=(yield* this.$13(a,g.rootId));if(!w.keys.length&&w.children.length){if(w.isLeaf){l.has(this.$2)&&(this.$4.logError==null?void 0:this.$4.logError(this.$2,this.$5,"dbCorruption",{}));throw c("FBLogger")("messenger_web").mustfixThrow("cannot be leaf")}this.$1.set(g.rootId,j);this.$10(g,f).rootId=w.children[0]}return n};b.btreeIterator=function(a,b,e){e=e===void 0?{}:e;var f=e.dir,g=f===void 0?"asc":f,h=babelHelpers.objectWithoutPropertiesLoose(e,["dir"]);function j(){if(g==="asc"){if(Object.prototype.hasOwnProperty.call(h,"gt"))return h.gt;else if(Object.prototype.hasOwnProperty.call(h,"gte"))return h.gte}else if(Object.prototype.hasOwnProperty.call(h,"lt"))return h.lt;else if(Object.prototype.hasOwnProperty.call(h,"lte"))return h.lte}function l(a){if(g==="asc")return Object.prototype.hasOwnProperty.call(h,"gt")?u(a.keys,h.gt,k.gt):Object.prototype.hasOwnProperty.call(h,"gte")?u(a.keys,h.gte,k.gte):0;else return Object.prototype.hasOwnProperty.call(h,"lt")?u(a.keys,h.lt,k.lt):Object.prototype.hasOwnProperty.call(h,"lte")?u(a.keys,h.lte,k.lte):a.keys.length-1}if(Object.prototype.hasOwnProperty.call(h,"gt")&&Object.prototype.hasOwnProperty.call(h,"gte"))throw c("FBLogger")("messenger_web").mustfixThrow("cannot specify both greater than and greater than or equal");if(Object.prototype.hasOwnProperty.call(h,"lt")&&Object.prototype.hasOwnProperty.call(h,"lte"))throw c("FBLogger")("messenger_web").mustfixThrow("cannot specify both less than and less than or equal");var m,n=this;return{next:function*(e){var f,o;if(m==null){var p=(yield* n.$14(a,n.$7(b)));if(p==null)return{done:!0};var q=j();if(q!==void 0){q=(yield* n.$12(a,p.rootId,q));f=q[0];q=q[1]}else if(g==="asc"){var r=[yield* n.$13(a,p.headId),p.headId];f=r[0];q=r[1]}else{r=[yield* n.$13(a,p.tailId),p.tailId];f=r[0];q=r[1]}p=l(f)}else{r=m;p=r.i;o=r.key;q=r.nodeId;f=(yield* n.$14(a,q));if(e!=null){if((i||(i=d("ReStoreKeyComparer"))).compareKey(e,o)===(g==="asc"?-1:1))throw c("FBLogger")("messenger_web").mustfixThrow("key must be ahead of current key");if(f==null||(i||(i=d("ReStoreKeyComparer"))).compareKey(e,f.keys[0])<0||(i||(i=d("ReStoreKeyComparer"))).compareKey(e,f.keys[f.keys.length-1])>0){r=(yield* n.$14(a,n.$7(b)));if(r==null)return{done:!0};r=(yield* n.$12(a,r.rootId,e));f=r[0];q=r[1]}p=u(f.keys,e,k[g==="asc"?"gte":"lte"])}else{if(f==null||p<0||p>=f.keys.length||(i||(i=d("ReStoreKeyComparer"))).compareKey(f.keys[p],o)!==0){if(f==null||!f.keys.length||(i||(i=d("ReStoreKeyComparer"))).compareKey(o,f.keys[0])<0||(i||(i=d("ReStoreKeyComparer"))).compareKey(o,f.keys[f.keys.length-1])>0){r=(yield* n.$14(a,n.$7(b)));if(r==null)return{done:!0};e=(yield* n.$12(a,r.rootId,o));f=e[0];q=e[1]}p=u(f.keys,o,k[g==="asc"?"lte":"gte"])}p+=g==="asc"?1:-1}}if(p<0||p>=f.keys.length)if(g==="asc"){if(f.nextId===void 0)return{done:!0};q=f.nextId;f=(yield* n.$13(a,q));p=0}else{if(f.prevId===void 0)return{done:!0};q=f.prevId;f=(yield* n.$13(a,q));p=f.keys.length-1}o=f.keys[p];m={i:p,key:o,node:f,nodeId:q};if(p<0||p>=f.keys.length)return{done:!0};r=g==="asc"?Object.prototype.hasOwnProperty.call(h,"lt")&&(i||(i=d("ReStoreKeyComparer"))).compareKey(o,h.lt)>=0||Object.prototype.hasOwnProperty.call(h,"lte")&&(i||(i=d("ReStoreKeyComparer"))).compareKey(o,h.lte)>0:Object.prototype.hasOwnProperty.call(h,"gt")&&(i||(i=d("ReStoreKeyComparer"))).compareKey(o,h.gt)<=0||Object.prototype.hasOwnProperty.call(h,"gte")&&(i||(i=d("ReStoreKeyComparer"))).compareKey(o,h.gte)<0;return r?{done:!0}:{done:!1,value:[f.keys[p],f.children[p]]}}}};b.tableEntries=function(a,b){b===void 0&&(b={});var c=this.btreeIterator(a,void 0,b),d=this;return{next:function*(b){b=(yield* c.next(b));if(b.done)return b;b=b.value;var e=b[0];b=b[1];b=(yield* d.$18(a,b));return{done:!1,value:[e,b]}}}};b.indexEntries=function(a,b,c){c===void 0&&(c={});var d=this.btreeIterator(a,b,c),e=this;return{next:function*(c){c=(yield* d.next(c));if(c.done)return c;c=c.value;var f=c[0];c=c[1];c=(yield* e.$19(a,c,b,f));return{done:!1,value:[f,c]}}}};b.keys=function(a,b,c){c===void 0&&(c={});var d=this.btreeIterator(a,b,c);return{next:function*(a){a=(yield* d.next(a));if(a.done)return a;a=a.value;a=a[0];return{done:!1,value:a}}}};b.clearIds=function*(a,b){this.$3();b=this.$7(b);var c=(yield* this.$14(a,b));this.$3();if(c==null)return;var d=(yield* this.$13(a,c.rootId));c=[{id:c.rootId,node:d}];while(c.length>0){d=c.shift();var e=d.id;d=d.node;if(!d.isLeaf)for(d of d.children){var f=(yield* this.$14(a,d));f!=null&&c.push({id:d,node:f})}this.$1.set(e,j)}this.$1.set(b,j)};b.readSeed=function*(a){return(a=(yield* this.$14(a,d("ReStorePersistenceIds").idForSeed)))!=null?a:0};b.remove=function(a,b){this.$3(),this.$1.set(b,j)};b.writeData=function(a,b,c){this.$16(b,s(c))};b.writeNewData=function*(a,b){return yield* this.$15(a,s(b))};return a}(),w=function(){function a(a,b,e,f,g){var h=this;this.$2=new Map();this.$6=!1;this.$3=function(){if(h.$6){f==null?void 0:f.mark("transaction_closed");throw c("FBLogger")("messenger_web").mustfixThrow("Transaction has closed")}e()};this.$4=b;this.$1=a;this.$5={get:function(a,c,e){var f=d("ReStoreUtils").getOrCreate(h.$1,c,function(){return new Map()});f=f.get(e);if(t(f))return void 0;return f!==void 0?f:b.get(a,c,e,"readwrite")},logError:b.logError,shouldInline:b.shouldInline};this.$7=g}var b=a.prototype;b.flush=function(){for(var a of this.$2){var b=a[0],c=a[1];b=d("ReStoreUtils").getOrCreate(this.$1,b,function(){return new Map()});for(c of c){var e=c[0],f=c[1];b.set(e,f)}}this.$6=!0};b.table=function(a){return new v(d("ReStoreUtils").getOrCreate(this.$2,a,function(){return new Map()}),a,this.$3,this.$5,"readwrite",this.$7)};return a}(),x=function(){function a(a,b,d,e){var f=this;this.$1=new Map();this.$2=!1;this.$7=function(){if(f.$2)throw c("FBLogger")("messenger_web").mustfixThrow("Transaction has closed: %s",f.$5)};this.$3=a;this.$4=b;this.types=a.types;this.$5=d;this.$6=e}var b=a.prototype;b.close=function(){this.$2=!0};b.flush=async function(a){a===void 0&&(a={upgrade:!1}),await this.$3.flush(this.$1,a),this.$2=!0};b.tablePermitsSynchronousIO=function(a){return(a=this.$3.permitsSynchronousIO==null?void 0:this.$3.permitsSynchronousIO(a))!=null?a:!1};b.table=function(a){return new v(d("ReStoreUtils").getOrCreate(this.$1,a,function(){return new Map()}),a,this.$7,this.$3,this.$4,this.$6)};b.createNested=function(a){return new w(this.$1,this.$3,this.$7,a,this.$6)};return a}();function a(a){function b(b,e,f){c("promiseDone")(async function(){await a.runExclusively(function(){return Promise.resolve([async function(){var c=new x(a,"readwrite",void 0,function(){});await d("ReStoreCommonUtils").gen(c.table(f).indexDelete(new WeakMap(),b,e));await c.flush()},"readwrite"])},"fixBrokenIndex")}())}return{clearCache:a.clearCache,close:a.close,createTransaction:function(c,d){return new x(a,c,d,b)},isClosed:a.isClosed||function(){return!1},isPersistenceSupported:a.isPersistenceSupported,logError:a.logError,runExclusively:a.runExclusively}}g.sentinelDeleted=j;g.isDeletedValue=t;g.ReStoreDbStoreTable=v;g.ReStoreDbStoreTransaction=x;g.createDbStore=a}),98);
__d("EBDBEbsmApi",["$InternalEnum","EBDB","FBLogger","I64","QPLUserFlow","ReStorePersistence","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i=["encrypted_backups_virtual_devices","secure_encrypted_backups_recovery_code_status","device_metadata","secure_encrypted_backups_epochs","secure_encrypted_backups_client_state","encrypted_backups","experiences_shared_state","auto_restore_opt_out"],j=b("$InternalEnum").Mirrored(["Success","EmptyDb"]);function k(a){var b={};for(var c of Object.keys(a)){var e=a[c];typeof e==="bigint"?b[c]=(h||(h=d("I64"))).of_string(String(e)):b[c]=e}return b}async function a(a){var b=await d("EBDB").getEBDB(),c=Array.from(a.keys());await b.runInTransaction(c,"readwrite",async function(b){var c=[],e=function(a){var e=a[0];g=a[1];a=g.toAdd;var f=g.toDelete,i=d("EBDB").ebdbDescriptor==null?void 0:d("EBDB").ebdbDescriptor[e];c.push(b.stores[e].bulkDelete(f.map(function(a){a=typeof a==="object"?a==null?void 0:a[i.primaryKey]:null;if(a==null)return;return!(h||(h=d("I64"))).isI64(a)?a:BigInt((h||(h=d("I64"))).to_string(a))}).filter(function(a){return!!a})),b.stores[e].bulkPut(a.filter(function(a){return typeof a==="object"&&(a==null?void 0:a[i.primaryKey])!=null}).map(function(a){var b={};for(var c of Object.keys(a)){var e=a[c];(h||(h=d("I64"))).isI64(e)?b[c]=BigInt((h||(h=d("I64"))).to_string(e)):b[c]=e}return b})))};for(var f of a){var g;e(f)}await Promise.all(c)},"EBDB - flush EBSM state",f.id+":79")}async function l(a){var b=await a.next();while(b.done===!1)b=await a.next();return b.value}async function m(a,b,c){a=a(b);a=new(d("ReStorePersistence").ReStoreDbStoreTable)(a,b,function(){},{get:function(){},logError:function(){},shouldInline:function(){return!1}},"readwrite",function(){});for(c of c){var e=k(c),f=e[d("EBDB").ebdbDescriptor[b].primaryKey];await l(a.tableSet(new WeakMap(),[f],e))}}async function e(a){c("QPLUserFlow").addPoint(c("qpl")._(521481876,"1407"),"EBSM_HYDRATION_LOAD_DATA_FROM_EBDB");var b=await d("EBDB").getEBDB(),e=!0,g=new Map();await b.runInTransaction(i,"readonly",function(a){return Promise.all(i.map(async function(b){var c=await a.stores[b].readAll();e=e&&c.length===0;g.set(b,c)}))},"EBDB - fetch for rehydration EBSM",f.id+":186");c("QPLUserFlow").addPoint(c("qpl")._(521481876,"1407"),"EBSM_HYDRATION_LOAD_DATA_FROM_EBDB_DONE");if(e)return j.EmptyDb;var h;try{await Promise.all(Array.from(g).map(async function(b){var d=b[0];b=b[1];try{await m(a,d,b),c("QPLUserFlow").addPoint(c("qpl")._(521481876,"1407"),"EBSM_HYDRATION_DONE_ON_"+d.toUpperCase())}catch(a){h=d;c("QPLUserFlow").addPoint(c("qpl")._(521481876,"1407"),"EBSM_HYDRATION_FAILED_ON_"+d.toUpperCase());throw a}}))}catch(e){c("FBLogger")("labyrinth_web").catching(e).mustfix("rehydrateEBSMFromEBDB: Invalid data to build BTree: %s",h);void d("EBDB").clearEbStores();for(b of i){var k=a(b);k.clear()}return j.EmptyDb}return j.Success}function n(a){return function(b,c){return a.runInTransaction(async function(a){var c=[];for(var e of b){var f=e[0],g=e[1],h=g.toAdd;g=g.toDelete;var i=d("EBDB").ebdbDescriptor==null?void 0:d("EBDB").ebdbDescriptor[f];for(g of g){var j=typeof g==="object"?g==null?void 0:g[i.primaryKey]:null;j!=null&&c.push(a[f].delete(j))}for(j of h)typeof j==="object"&&(j==null?void 0:j[i.primaryKey])!=null&&c.push(a[f].put(j))}await Promise.all(c)},"readwrite",void 0,{source:c,type:"user_initiated"},f.id+":254")}}g.EB_STORES=i;g.RehydrationResult=j;g.flushEBSMtoEBDB=a;g.rehydrateEBSMFromEBDB=e;g.updateEBSM=n}),98);
__d("EBSMDBAPIDeferred",["requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("EBSMDBAPI").__setRef("EBSMDBAPIDeferred"),i=c("requireDeferred")("EBSMDBCleanupAPI").__setRef("EBSMDBAPIDeferred");function a(a){var b=a.force,c=a.getCache;return h.load().then(function(a){return a.makeEBIDBWorker({force:b,getCache:c})})}function b(a){var b=a.closeDb,c=b===void 0?!0:b,d=a.hasUserGivenAutoRestoreConsent;return h.load().then(function(a){return a.clearEBIDBNonPersistedRows({closeDb:c,hasUserGivenAutoRestoreConsent:d})})}function d(a){return i.load().then(function(b){return b.cleanupStateTables(a)})}g.makeEBIDBWorker=a;g.clearEBIDBNonPersistedRows=b;g.cleanupStateTables=d}),98);
__d("LSPlatformErrorChannel",["FBLogger","ODS","XPlatReactEventEmitter"],(function(a,b,c,d,e,f,g){"use strict";var h,i="onLSError",j=new(c("XPlatReactEventEmitter"))(),k=0,l=null;function a(a){l===null&&((h||(h=d("ODS"))).bumpEntityKey(3185,"lsplatform_error","first_error_emitted_to_"+k+"listeners"),k===0&&c("FBLogger")("messenger_web").mustfix("No listeners when emitting LS error %s",a.name)),l=a,j.emit(i,a)}function b(a){var b=j.addListener(i,a);k++;return function(){return b.remove()}}function e(){return l}function f(){j.removeAllListeners(i),l=null}f={TEST_ONLY_clear:f,emit:a,lastError:e,subscribe:b};g["default"]=f}),98);
__d("MAWEARGenNewKeychainCryptoKey",["FBLogger","MAWCryptoConsts","MAWKeychainCrypto","MAWWebInitDataHelpers","MessengerWebInitData","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";async function a(){try{var a,b=d("MAWWebInitDataHelpers").getLastAccountKeyFormatVersion(),e=(await (a=d("MAWKeychainCrypto")).getAccountKeys(b))[0],f=a.genBrowserEncryptionKeyString(),g=a.genDatabaseEncryptionSeed();e=await a.encryptDataToStringBuffer(e,g);g=d("WATimeUtils").castToUnixTime(d("WATimeUtils").unixTime()+d("MAWCryptoConsts").ENC_KEY_TTL);return{accountKeyString:await a.generateHashString(d("MAWWebInitDataHelpers").getAccountKeysString(b)[0]),appIdOrigin:c("MessengerWebInitData").appId,expiration:g,formatVersion:b,key:f,seed:e,userKeyBaseString:await a.generateHashString(c("MessengerWebInitData").userKeyBase)}}catch(a){throw c("FBLogger")("messenger_web").catching(a).mustfixThrow("Failed to generateNewKey")}}g.default=a}),98);
__d("MAWEARKeychainDecryptionError",[],(function(a,b,c,d,e,f){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(b){var c;c=a.call(this,b)||this;c.name="MAWEARKeychainDecryptionError";c.message=b;return c}return b}(babelHelpers.wrapNativeSuper(Error));f["default"]=a}),66);
__d("MAWWorkerSetupArgs",[],(function(a,b,c,d,e,f){"use strict";var g=null;function a(a){g=a}function b(){return g}function c(){g=null}f.setWorkerSetupArgs=a;f.getWorkerSetupArgs=b;f.resetWorkerSetupArgs=c}),66);
__d("MAWGenKeychainCryptoKeyWithVersion",["ExecutionEnvironment","FBLogger","MAWCurrentUser","MAWEARKeychainDecryptionError","MAWKeychainCrypto","MAWWebInitDataHelpers","MAWWorkerSetupArgs","MessengerWebInitData"],(function(a,b,c,d,e,f,g){"use strict";var h;async function a(a,b,e,f,g,i,j){f===void 0&&(f=1);try{var k=await d("MAWKeychainCrypto").getAccountKeys(f);a=await Promise.all([d("MAWKeychainCrypto").importBrowserEncryptionKey(a),Promise.all(k.map(function(a){return d("MAWKeychainCrypto").decryptDataToArrayBuffer(a,b).catch(function(){return null})}))]);var l=a[0];k=a[1];a=await Promise.all(k.filter(Boolean).map(function(a){return d("MAWKeychainCrypto").genDatabaseEncryptionKey(l,a).catch(function(){return null})}));k=a.filter(Boolean);if(k.length===0)throw new(c("MAWEARKeychainDecryptionError"))("Failed to generate keys from seed");return{keys:k,version:e}}catch(b){a=null;k=null;e=d("MAWWorkerSetupArgs").getWorkerSetupArgs();(h||(h=c("ExecutionEnvironment"))).isInWorker&&e!=null&&(a=e.userKeyBase===c("MessengerWebInitData").userKeyBase,k=e.fbId===d("MAWCurrentUser").getID());e=d("MAWWebInitDataHelpers").getAccountKeysString(f);var m=e&&e[0]!=null?await d("MAWKeychainCrypto").generateHashString(e[0]):null;c("FBLogger")("messenger_web").catching(b).mustfix("Failed to genKeyWithVersion: accountKeyBackfilled = %s; accountKeyExists = %s; acccountKeyMatches = %s; userKeyBaseBackilled = %s; userKeyBaseExists = %s; userKeyBaseMatches = %s; appIdOrigin = %s; appIdInitData = %s; userIdMatches = %s; isInWorker = %s; userKeyBase_match_between_threads = %s; userId_match_between_threads = %s; formatVersion = %s;",g!=null,e!=null,g===m,i!=null,c("MessengerWebInitData").userKeyBase!=null,i===await d("MAWKeychainCrypto").generateHashString(c("MessengerWebInitData").userKeyBase),j,c("MessengerWebInitData").appId,d("MAWCurrentUser").getID()===String(c("MessengerWebInitData").userId),(h||(h=c("ExecutionEnvironment"))).isInWorker,a,k,f);throw b}}g.default=a}),98);
__d("MWEARKeychainV3Errors",[],(function(a,b,c,d,e,f){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(b){var c;c=a.call(this,b)||this;c.name="EARKeychainNotFoundError";c.message=b;return c}return b}(babelHelpers.wrapNativeSuper(Error));f.EARKeychainNotFoundError=a}),66);
__d("MWLocalStorageErrorHandler",["cr:3449"],(function(a,b,c,d,e,f,g){"use strict";function a(){b("cr:3449")&&b("cr:3449").clearLocalStorageBigValues()}g.onQuotaExceeded=a}),98);
__d("MAWLocalStorage",["LocalStorageWrapper","MWLocalStorageErrorHandler","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["not storage found"]);h=function(){return a};return a}function i(a){d("WALogger").LOG([a])}function j(a){d("WALogger").ERROR([a])}function a(){return d("LocalStorageWrapper").getStorage(i)}function b(){return d("LocalStorageWrapper").isLocalStorageAvailable(i)}function c(a,b,c){return d("LocalStorageWrapper").setItemGuarded(a,b,c,j,d("MWLocalStorageErrorHandler").onQuotaExceeded)}function e(a,b){a==null?d("WALogger").ERROR(h()):a.removeItem(b)}g.getStorage=a;g.isLocalStorageAvailable=b;g.setItemGuarded=c;g.removeItemGuarded=e}),98);
__d("MWTabCommunicationChannel",["MAWLocalStorage"],(function(a,b,c,d,e,f,g){"use strict";var h=typeof window!=="undefined"?window:self;function i(a){var b=d("MAWLocalStorage").getStorage(),c=function(c){d("MAWLocalStorage").setItemGuarded(b,a,JSON.stringify(c))},e=function(c){window.removeEventListener("storage",c),d("MAWLocalStorage").removeItemGuarded(b,a)},f=function(a){window.addEventListener("storage",a)},g=function(b){return b!=null&&b.key===a&&typeof b.newValue==="string"?JSON.parse(b.newValue):null};return{getMessage:g,onRequestReceived:function(a){var b=function(b){b=g(b);b!=null&&a(b)};f(b);return{release:function(){e(b)}}},sendMessage:c,stopWaitingForReply:e,waitForReply:f}}function j(a){var b=new h.BroadcastChannel(a),c=new Set();b.addEventListener("message",function(a){c.forEach(function(b){b(a)})});var d=function(a){c.add(a)},e=function(a){c["delete"](a)};a=function(a){b.postMessage(JSON.stringify(a))};var f=function(a){return a!=null&&typeof a.data==="string"?JSON.parse(a.data):null};return{getMessage:f,onRequestReceived:function(a){var b=function(b){b=f(b);b!=null&&a(b)};d(b);return{release:function(){e(b)}}},sendMessage:a,stopWaitingForReply:e,waitForReply:d}}function a(a){return h.BroadcastChannel!=null?j(a):i(a)}g.getChannel=a}),98);
__d("MWTabCommunication",["MWTabCommunicationChannel","Promise","clearTimeout","pageID","promiseDone","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){function a(a,b){var c=this;this.$2=null;this.$5=function(a){a=c.$4.getMessage(a);a!=null&&a.a==="sb"&&a.t!==c.tabID()&&a.r===c.tabID()&&a.k!=null&&(c.$2&&c.$2(a.k),c.$4.stopWaitingForReply(c.$5),c.$2=null)};this.$1=a;this.$3=b!=null?b:500;this.$4=d("MWTabCommunicationChannel").getChannel(a)}var e=a.prototype;e.tabID=function(){return c("pageID")};e.$6=function(){var a={a:"r",t:this.tabID()};this.$4.sendMessage(a)};e.listenToRequest=function(a){return this.listenToRequestAsync(function(){return(h||(h=b("Promise"))).resolve(a())})};e.listenToRequestAsync=function(a){var b=this,d=function(d){d.a==="r"&&d.t!==b.tabID()&&c("promiseDone")(a().then(function(a){a={a:"sb",k:a,r:d.t,t:b.tabID()};b.$4.sendMessage(a)}))};return this.$4.onRequestReceived(d)};e.$7=function(){var a=this;return new(h||(h=b("Promise")))(function(b){a.$2=b,a.$4.waitForReply(a.$5),a.$6()})};e.request=function(a,d){var e=this,f,g=function(){f!=null&&c("clearTimeout")(f)};return(h||(h=b("Promise"))).race([this.$7().then(function(b){e.$4.stopWaitingForReply(e.$5);return a(b)}),new h(function(a){f=c("setTimeout")(function(){a(d()),e.$4.stopWaitingForReply(e.$5)},e.$3)})]).then(function(a){g();return a})};return a}();g.MWTabCommunication=a}),98);
__d("MWLSDatabaseNames",[],(function(a,b,c,d,e,f){"use strict";a="LightSpeed";b=a+"V3";f.name=a;f.lightspeedPrefix=b}),66);
__d("MWLSIndexedDBName",["MAWCurrentUser","MWLSDatabaseNames"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a=d("MAWCurrentUser").getID();return d("MWLSDatabaseNames").lightspeedPrefix+a}g.dbName=a}),98);
__d("ReStoreTabNotifier",["CurrentMessengerUser","FBLogger","MWBroadcastChannel","MWLSIndexedDBName"],(function(a,b,c,d,e,f,g){"use strict";var h=d("CurrentMessengerUser").getIDorEIMU();function a(a){var b=d("MWBroadcastChannel").MWBroadcastChannel(a==="restore-table-"+h+"-"+d("MWLSIndexedDBName").dbName()?"mwChat-"+h:a);function e(a,d){try{b.postMessage([a,d])}catch(a){c("FBLogger")("messenger_web").catching(a).warn("Failed to broadcast changes")}}function f(a,c){b.addEventListener("message",function(b){b=b.data;var d=b[0];d===a&&c(b[1])})}return{onEventReceive:f,postMessage:e}}g["default"]=a}),98);
__d("MWEARKeychainV3",["$InternalEnum","Deferred","ExecutionEnvironment","FBLogger","LSPlatformLsInitLog","MAWCryptoConsts","MAWCurrentUser","MAWEARGenNewKeychainCryptoKey","MAWGenKeychainCryptoKeyWithVersion","MAWQplProxy","MAWReliabilityMonitor","MWEARKeychainV3Errors","MWTabCommunication","QPLUserFlow","Random","ReStoreTabNotifier","WAArrayBufferUtils","WAResultOrError","WATimeUtils","getErrorSafe","gkx","memoizeOneWithArgs","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(){return{accountKey:null,databaseEncryptionKeys:new Map(),dbReady:new(c("Deferred"))(),latestVersion:d("MAWCryptoConsts").VERSION}},j={global_ear:i(),maw_ear:i()},k=null,l=function(){var a=Object.keys(j).reduce(function(a,b){a[b]="none";return a},{});return{get:function(b){return a[b]},is:function(b,c){return a[b]===c},set:function(b,c){a[b]=c;(b=k)==null?void 0:b.updateState()}}}();function a(a){j[a]=i(),l.set(a,"none")}function e(a,b){l.set(a,b)}function m(a){var b=d("Random").uint32();while(a.some(function(a){return a.randomisedVersion===b}))b=d("Random").uint32();return b}var n={global_ear:function(){return null},maw_ear:function(){return null}},o=function(a){return n[a]()},p=function(a,b){n[a]=function(){return b}},q=function(a,b){p(a,b),v(a).dbReady.resolve()},r={global_ear:"browserEncryptionMetaV2",maw_ear:"encryptionMetaV3"},s=c("memoizeOneWithArgs")(function(a,b){return new(d("MWTabCommunication").MWTabCommunication)("ear_keys_"+b+"_"+a)});async function f(a,b,e){var f;e===void 0&&(e=K);c("gkx")("9396")&&c("FBLogger")("messenger_web").info("Initialise EAR keychain: %s",a);k=I(a);if(l.is(a,"success")&&v(a).databaseEncryptionKeys.size!==0)return d("WAResultOrError").makeResult(u(a));var g=d("MAWCurrentUser").getID(),i=c("ReStoreTabNotifier")("channel-ear-keychain-v3-"+g);i.onEventReceive("notifyEarKeychainV2",E);var j=(h||(h=c("ExecutionEnvironment"))).isInWorker?"Worker":"UI";e(a+"_ear_init_start",{string:(f={},f["initFlow_"+a+"_"+j]=b,f)});try{b=await J(i,a,void 0,e);e(a+"_ear_import_end");for(f of b)v(a).databaseEncryptionKeys.set(f.result.version,{dbEntry:f.entry,keys:f.result.keys});D(a);s(a,g).listenToRequest(function(){return JSON.stringify(Array.from(v(a).databaseEncryptionKeys.entries()).map(function(a){var b=a[0];a=a[1];var c=a.dbEntry;a=a.keys;return[b,{dbEntry:c,keys:a.map(function(a){return d("WAArrayBufferUtils").arrayBufferToString(a)})}]}))});e(a+"_ear_init_end",{string_array:(i={},i[a+"_randomisedVersionKeys"+j]=t(a).map(function(a){a[0];a=a[1].dbEntry;return String(a.randomisedVersion)}),i)});l.set(a,"success");return d("WAResultOrError").makeResult(u(a))}catch(b){l.set(a,"failure");e(a+"_ear_init_error");c("gkx")("9396")&&c("FBLogger")("messenger_web").catching(c("getErrorSafe")(b)).mustfix("Failed to setup EAR Keychain V3. Namespace: %s",a);return d("WAResultOrError").DEPRECATED_makeError("keychain-setup-failure",b)}}function t(a){return Array.from(v(a).databaseEncryptionKeys.entries())}function u(a){return v(a).latestVersion}function v(a){return j[a]}function w(a,b){var e=b!=null?b:u(a);b=v(a).databaseEncryptionKeys.get(e);if(b==null){c("promiseDone")(A(a).then(function(a){var b=a.map(function(a){return a.version}).includes(e);c("FBLogger")("messenger_web").info("EAR Keychain DB match found: %s. Version = %s. NumberVersions = %s",b,e,a.length)}));var f=u(a),g=Array.from(v(a).databaseEncryptionKeys.keys());c("FBLogger")("messenger_web").mustfix("EAR Key v%s was null. Latest version: %s has key: %s, keychain length: %s, currentLatestVersion: %s, init status %s, in worker %s",e,f,v(a).databaseEncryptionKeys.get(f)==null,v(a).databaseEncryptionKeys.size,Math.max.apply(Math,g),l.get(a),(h||(h=c("ExecutionEnvironment"))).isInWorker);throw new(d("MWEARKeychainV3Errors").EARKeychainNotFoundError)("EAR Key "+e+" was null.")}return{dbEntry:b.dbEntry,keys:b.keys,randomisedVersion:b.dbEntry.randomisedVersion,version:e}}function x(a){return c("MAWGenKeychainCryptoKeyWithVersion")(a.key,a.seed,a.version,a.formatVersion,a.accountKeyString,a.userKeyBaseString,a.appIdOrigin)}var y=b("$InternalEnum")({UNKNOWN:-1,NO_KEY:0,EBSM_EARV2_UPGRADE:1,RANDOMISED_VERSION_UPGRADE:2,EXPIRED_KEY:3,FORCE_KEY_ROTATION:4});function z(a){if(a.length===0)return{reason:y.NO_KEY,result:!0};a=a[a.length-1];return!d("WATimeUtils").isInFuture(a.expiration)?{reason:y.EXPIRED_KEY,result:!0}:{result:!1}}function A(a){var b=C(a,"readonly");return new Promise(function(c,d){b.onabort=function(){return d(b.error)};b.onerror=function(){return d(b.error)};var e=b.objectStore(r[a]).getAll();e.onsuccess=function(){return c(e.result)};e.onerror=function(){return d(e.error)}}).then(B)}function B(a){var b=a.find(function(a){return a.version==null});b!=null&&c("FBLogger")("messenger_web").mustfix("EAR Keychain Rotation null version: fields nonnull: %s %s %s %s %s %s",b.id==null,b.key==null,b.seed==null,b.formatVersion==null,b.accountKeyString==null,b.userKeyBaseString==null);b=a.filter(function(a){return a.version!=null});return b.sort(function(a,b){return a.version-b.version})}function C(a,b){var d=o(a);if(d==null)throw c("FBLogger")("messenger_web").mustfixThrow("Encryption IndexDB should've been initialized. Namespace: %s",a);return d.transaction(r[a],b,{durability:"strict"})}var D=function(a){var b=Array.from(v(a).databaseEncryptionKeys.keys());b.length>0?v(a).latestVersion=Math.max.apply(Math,b):c("FBLogger")("messenger_web").mustfix("EAR latest version does not exist")},E=function(a){var b=a.namespace,d=a.version;c("promiseDone")(async function(){try{c("FBLogger")("messenger_web").info("Received key rotation notification. Namespace: %s",b);await v(b).dbReady.getPromise();var a=(await A(b)).find(function(a){return a.version===d});if(a==null)throw c("FBLogger")("messenger_web").mustfixThrow("Notified new Ear Key but missing in DB");var e=await x(a);v(b).databaseEncryptionKeys.set(e.version,{dbEntry:a,keys:e.keys});D(b);c("FBLogger")("messenger_web").info("Rotated key successfully. Namespace: %s",b)}catch(a){return c("FBLogger")("messenger_web").catching(a).mustfix("Failed to handleNewVersion. In worker %s. Namespace: %s.",(h||(h=c("ExecutionEnvironment"))).isInWorker,b)}}())};function F(a){return l.get(a)!=="none"}function G(a){return l.get(a)}function H(a){if(l.is(a,"success")){v(a).databaseEncryptionKeys.size===0&&c("FBLogger")("messenger_web").mustfix("Keychain initialised but no keys present");return!0}return!1}function I(a){return d("MAWReliabilityMonitor").MAWReliabilityMonitorSingleton.startMonitoring("EARv3",function(){return{extra:{isKeychainInitialised:H(a).toString(),latestVersion:u(a).toString()},reason:l.get(a),state:function(){switch(l.get(a)){case"none":return d("MAWReliabilityMonitor").HealthReportState.PENDING;case"success":return d("MAWReliabilityMonitor").HealthReportState.OK;case"failure":return d("MAWReliabilityMonitor").HealthReportState.ERROR;default:return d("MAWReliabilityMonitor").HealthReportState.UNKNOWN}}()}})}async function J(a,b,d,e){var f=await c("MAWEARGenNewKeychainCryptoKey")();e(b+"_ear_raw_key_generated");var g=await new Promise(function(g,i){var j=C(b,"readwrite");j.onerror=function(){return i(j.error)};j.onabort=function(){return i(j.error)};var k=j.objectStore(r[b]).getAll();k.onerror=function(){return i(k.error)};k.onsuccess=function(){var l;e(b+"_ear_keys_fetched");var n=B(k.result),o=z(n),p=o.reason;o=o.result;if((d==null?void 0:d.forceKeyRotation)!==!0&&!o)return g(n);o=(d==null?void 0:d.forceKeyRotation)===!0?y.FORCE_KEY_ROTATION:p!=null?p:y.UNKNOWN;p=n.map(function(a){return a.version});l=(l=p[p.length-1])!=null?l:0;c("FBLogger")("messenger_web").info("Key rotation. EAR versions: %s. Latest version: %s. Namespace: %s, Worker: %s",p.toString(),l,b,(h||(h=c("ExecutionEnvironment"))).isInWorker);var q=babelHelpers.extends({},f,{randomisedVersion:m(n),source:o,version:l+1});e(b+"_ear_adding_new_key");j.oncomplete=function(){n.push(babelHelpers.extends({},q,{id:q.version})),a.postMessage("notifyEarKeychainV2",{namespace:b,version:q.version}),e(b+"_ear_gen_key_end"),g(n)};var s=j.objectStore(r[b]).add(q);s.onerror=function(){return i(c("FBLogger")("messenger_web").catching(s.error).mustfixThrow("Failed to rotate EAR key"))}}});e(b+"_ear_import_start");g=await Promise.allSettled(g.map(function(a){return x(a).then(function(b){return{entry:a,result:b}})}));var i=g[g.length-1];if(i.status==="rejected"){var j;j=(j=d==null?void 0:d.corruptedEARRetryCount)!=null?j:0;if(j>=1)throw i.reason;return J(a,b,{corruptedEARRetryCount:j+1,forceKeyRotation:!0},e)}return g.map(function(a){if(a.status==="fulfilled")return a.value}).filter(Boolean)}var K=function(a,b){d("LSPlatformLsInitLog").addPoint(a,b),L(a,b)},L=function(a,b){var e=c("qpl")._(25310776,"6155");(h||(h=c("ExecutionEnvironment"))).isInWorker?d("MAWQplProxy").sendQplPointThroughBridge(e,"backend_"+a,{annotations:b}):(c("QPLUserFlow").addPoint(e,"ui_"+a),b!=null&&c("QPLUserFlow").addAnnotations(e,b))};b=function(a,b){return s(a,b).request(function(b){b=JSON.parse(b);b.forEach(function(b){var c=b[0];b=b[1];var e=b.keys.map(d("WAArrayBufferUtils").stringToArrayBuffer);v(a).databaseEncryptionKeys.set(c,{dbEntry:b.dbEntry,keys:e})});D(a);l.set(a,"success");return!0},function(){return!1})};g.InitStatus=l;g.resetKeychain__TEST_ONLY_DO_NOT_USE=a;g.setInitStatus__TEST_ONLY_DO_NOT_USE=e;g.generateNewRandomisedVersionNumber=m;g.setNamespaceSourceDbWithoutMarkingDbReady=p;g.setNamespaceSourceDbAndMarkAsReady=q;g.getEncryptionKeysTabCommunication=s;g.init=f;g.getLatestVersion=u;g.getKeychain=v;g.getDbEncryptionKey=w;g.isKeychainSettled=F;g.getKeychainInitStatus=G;g.isKeychainInitialised=H;g.logMawInitPoint=L;g.importKeysFromOtherTab=b}),98);
__d("MAWLSDBEncryption",["FBLogger","I64","LSPlatformErrorChannel","MAWCryptoConsts","MAWKeychainCrypto","MAWKeychainNaClCrypto","MAWKeychainUtil","MWEARKeychainV3","QPLUserFlow","nullthrows","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i=typeof window!=="undefined"?window:self,j="EBSMDecryptionFailure",k=function(b){babelHelpers.inheritsLoose(a,b);function a(a,c){var d;a=a+" - Encrypted Restore was unable to decrypt an entity for table "+c;d=b.call(this,a)||this;d.message=a;d.name=j;d.tableName=c;return d}var c=a.prototype;c.getTableName=function(){return this.tableName};return a}(babelHelpers.wrapNativeSuper(Error));function l(a){a=atob(a);var b=a.length,c=new Uint8Array(b);for(var d=0;d<b;d++)c[d]=a.charCodeAt(d);return c.buffer}function m(a){var b="";a=new Uint8Array(a);var c=a.byteLength;for(var d=0;d<c;d++)b+=String.fromCharCode(a[d]);return i.btoa(b)}function n(a){return c("nullthrows")(JSON.stringify(a,function(a,b){if((h||(h=d("I64"))).isI64(b))return{type:"64",value:[b[0],b[1]]};else if(a===""||b===null||typeof b==="string"||typeof b==="number"||typeof b==="boolean"||Array.isArray(b))return b;else if(b===void 0)return{type:"u"};else if(b instanceof ArrayBuffer)return{type:"ab",value:m(b)};else if(b instanceof Uint8Array)return{l:b.byteLength,o:b.byteOffset,type:"ui8",value:m(b.buffer)};else if(b instanceof Map)return{e:n(Array.from(b.entries())),type:"m"};else if(b instanceof Set)return{type:"s",v:n(Array.from(b.values()))};else if(typeof b==="object")return{type:"o",value:n(b)};throw c("FBLogger")("maw_ear").mustfixThrow('Value not supported when stringifying "%s"',b.toString())}))}function o(a){return JSON.parse(a,function(a,b){if(a===""||b===null||typeof b==="string"||typeof b==="number"||typeof b==="boolean"||Array.isArray(b))return b;else if(typeof b==="object")if(b.type==="64")return(h||(h=d("I64"))).mk(b.value[1],b.value[0]);else if(b.type==="u")return void 0;else if(b.type==="ab")return l(b.value);else if(b.type==="ui8")return new Uint8Array(l(b.value),b.o,b.l);else if(b.type==="o")return o(b.value);else if(b.type==="m")return new Map(o(b.e));else if(b.type==="s")return new Set(o(b.v));throw c("FBLogger")("maw_ear").mustfixThrow('Value not supported when parsing "%s"',b.toString())})}function a(a,b){try{var e=d("MWEARKeychainV3").getDbEncryptionKey("global_ear"),f=e.keys;f=f[0];e=e.version;e=d("MAWKeychainUtil").makeAAD(e,d("MAWCryptoConsts").CIPHER_ID);return p(f,c("nullthrows")(n(a)),e)}catch(a){throw c("FBLogger")("messenger_web").mustfixThrow(a.message+" - Encrypted LSDB was unable to encrypt an entity for table "+b)}}function b(a,b){try{var e=d("MAWKeychainCrypto").getKeyVersionFromCipherData(a),f=e.aadLengthInBytes;e=e.keyVersion;var g=d("MWEARKeychainV3").getDbEncryptionKey("global_ear",e),h=g.dbEntry;g=g.keys;g=g[0];g=q(g,a,e,h.formatVersion,f);return c("nullthrows")(o(g))}catch(a){c("QPLUserFlow").addPoint(c("qpl")._(521481876,"1407"),"EBSM_HYDRATION_DECRYPTION_FAILURE_ON_"+b.toUpperCase());c("LSPlatformErrorChannel").emit(new k(a.message,b));throw new k(a.message,b)}}function p(a,b,c){b=new TextEncoder().encode(b).buffer;return d("MAWKeychainNaClCrypto").encryptTweetNaClArrayBuffer(a,new Uint8Array(b),c)}function q(a,b,c,e,f){a=d("MAWKeychainNaClCrypto").decryptTweetNaClArrayBuffer(a,b,c,e,f);return new TextDecoder().decode(a)}g.ERROR_NAME=j;g.EBSMDecryptionFailure=k;g.stringify=n;g.parse=o;g.encryptLSDBObj=a;g.decryptLSDBObj=b}),98);
__d("EBSMHydrationUtils",["EBAPIWorkerCheck","EBLogger","EBSMDBAPI","EBSMProperties","MAWLSDBEncryption","MWEBUseLocalStorage","MWEncryptedBackupsLocalStorageEntryEnum","QPLUserFlow","qpl"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error loading data from EB State db to in memory ReStore"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Loaded data from EB State db to in memory ReStore"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error loading table "," from EB State db to in memory ReStore"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Hydrated ",": "," rows"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Hydration not performed for "," because its not present in IDB"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["EBSM hydration failed due to IDB transaction error: ",""]);m=function(){return a};return a}var n=d("EBLogger").EBLogger.tags(["EBSM"]);function o(a){var b=[];a=a;while(a!==0)b.push(a.hd),a=a.tl;return b}function p(a,b){c("QPLUserFlow").addPoint(c("qpl")._(521481876,"1407"),"EBSM_HYDRATION_GET_ROWS_OF_"+b.toUpperCase());return new Promise(function(e,f){var g=[],h,i;try{i=a.transaction(b,"readonly"),h=i.objectStore(b).openCursor()}catch(a){n.MUSTFIX(m(),String(a));return f(null)}h.onsuccess=function(a){a=a.target.result;if(a){var c=a.key,e=a.value;e=d("MAWLSDBEncryption").decryptLSDBObj(e,b);e!=null&&e.isLeaf!==void 0&&(e.keys!==void 0&&Array.isArray(e.keys)&&e.keys.length>0&&!Array.isArray(e.keys[0])&&(e.keys=e.keys.filter(function(a){return a!=null&&typeof a==="object"&&!Array.isArray(a)}).map(function(a){return o(a)})));g.push({key:c,value:e});a.continue()}};h.onerror=function(a){c("QPLUserFlow").addPoint(c("qpl")._(521481876,"1407"),"EBSM_HYDRATION_CURSOR_ERROR_ON_"+b.toUpperCase());return f(a)};i.onerror=function(a){c("QPLUserFlow").addPoint(c("qpl")._(521481876,"1407"),"EBSM_HYDRATION_TRANSACTION_ERROR_"+b.toUpperCase());return f(a)};i.onabort=function(a){c("QPLUserFlow").addPoint(c("qpl")._(521481876,"1407"),"EBSM_HYDRATION_TRANSACTION_ABORT_ERROR_"+b.toUpperCase());return f(a)};i.oncomplete=function(){c("QPLUserFlow").addPoint(c("qpl")._(521481876,"1407"),"EBSM_HYDRATION_TRANSACTION_COMPLETE_"+b.toUpperCase()),e(g)}})}async function a(a){var b=new Map();await d("EBSMDBAPI").isDBBeingUpgradedWorker();c("QPLUserFlow").addPoint(c("qpl")._(521481876,"1407"),"EBSM_HYDRATION_LOAD_DATA_FROM_IDB");return Promise.all(Array.from(c("EBSMProperties").persistedTables).map(function(e){if(!a.objectStoreNames.contains(e)){c("QPLUserFlow").addPoint(c("qpl")._(521481876,"1407"),"EBSM_HYDRATION_TABLE_"+e.toUpperCase()+"_NOT_IN_IDB");n.WARN(l(),e);return!0}var f=p(a,e),g=new Map();return f.then(function(a){a.map(function(a,b){g.set(a,b)});b.set(e,g);if(e==="secure_encrypted_backups_client_state"&&g.size===0){a=d("EBAPIWorkerCheck").runningInWorker()?!1:d("MWEBUseLocalStorage").mwEBGetIsLocalStorageEntryValuePresent(c("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_RESTORED_IN_CURRENT_SESSION);a&&c("QPLUserFlow").addAnnotations(c("qpl")._(521481876,"1407"),{string:{missing_eb_keys:"true"}})}c("QPLUserFlow").addPoint(c("qpl")._(521481876,"1407"),"EBSM_HYDRATION_DONE_ON_"+e.toUpperCase());n.DEBUG(k(),e,g.size);return!0},function(){c("QPLUserFlow").addPoint(c("qpl")._(521481876,"1407"),"EBSM_HYDRATION_FAILED_ON_"+e.toUpperCase());n.MUSTFIX(j(),e);return!1})})).then(function(a){var d=!0;a.forEach(function(a){a||(d=!1)});if(d){c("QPLUserFlow").addPoint(c("qpl")._(521481876,"1407"),"EBSM_HYDRATION_DONE_ON_ALL_TABLES_SUCCESSFULLY");n.DEBUG(i());return Promise.resolve(b)}else{c("QPLUserFlow").addPoint(c("qpl")._(521481876,"1407"),"EBSM_HYDRATION_FAILED_TO_LOAD_DATA_FROM_IDB");n.MUSTFIX(h());return Promise.reject(b)}})}g.getAllRowsByTableName=p;g.loadEBdataToEphemeralRestore=a}),98);
__d("LSE2EEMetadataSyncGroupUtils",["gkx","isArmadillo","isInstamadillo","qex"],(function(a,b,c,d,e,f,g){"use strict";var h=c("isArmadillo")()||c("gkx")("23910")===!0&&!c("isInstamadillo")(),i=c("qex")._("923")===!0&&!c("isInstamadillo")();function a(){return h}function b(){return h?{groupId:95}:null}function d(){return i?{groupId:95}:null}g.shouldAlwaysResetE2EEMetadata=a;g.getE2EEMetadataSyncGroup=b;g.getE2EEMetadataSyncGroupForIGDSyncGroup=d}),98);
__d("LSDatabase",[],(function(a,b,c,d,e,f){}),null);
__d("LSSyncGroupsUtils",["CurrentLocale","LSIntEnum","LSMailboxInitialSyncCursor"],(function(a,b,c,d,e,f,g){"use strict";var h;a={locale:c("CurrentLocale").get()};b={canIgnoreTimestamp:!1,currentCursor:void 0,dataTraceId:void 0,groupId:(h||(h=d("LSIntEnum"))).ofNumber(0),initTraceTimestampMs:void 0,lastSyncCompletedTimestampMs:void 0,lastSyncRequestTimestampMs:h.ofNumber(0),minTimeToSyncTimestampMs:h.ofNumber(-1),priority:h.ofNumber(0),regionHint:void 0,sendSyncParams:!0,syncChannel:d("LSMailboxInitialSyncCursor").syncChannel,syncParams:JSON.stringify(a),syncStatus:h.ofNumber(0)};e={epochId:void 0,failureCount:h.ofNumber(0),lastDelayedRequestTimestampMs:void 0,lastSentTimestampMs:h.ofNumber(0),lastSyncRequestTimestampMs:h.ofNumber(0),networkTaskIdentifier:void 0,syncDatabaseId:h.ofNumber(0),taskQueueName:""};f=h.ofNumber(9999999999999);g.defaultSyncParams=a;g.defaultSyncGroup=b;g.defaultNetworkRequest=e;g.neverSyncTimestamp=f}),98);
__d("MNetRankType",[],(function(a,b,c,d,e,f){a=Object.freeze({UNDEFINED_RANKING_TYPE:-1,INBOX_ACTIVE_NOW:0,MESSENGER_USER_SEARCH:1,MONTAGE_USER:2,BROADCAST_FLOW_TOP_CONTACTS:3,BROADCAST_FLOW_NEEDY_CONTACTS:4,MESSENGER_GROUP_SEARCH:5,RTC_TOP_CONTACTS:6,PSTN_TOP_CONTACTS:7,MESSENGER_NON_CONTACT_SEARCH:8,MESSENGER_SEARCH_BOOTSTRAP:9,ACTIVE_BEEPER:10,MONTAGE_AND_ACTIVE_NOW:11,MESSENGER_PAGE_SEARCH:12,MESSENGER_GAME_SEARCH:13,WWW_NULLSTATE:14,RTC_GROWTH:15,MESSENGER_OMNIPICKER_NULLSTATE:16,RTC_SEQUENTIAL_TOP_CONTACTS:17,MESSENGER_USER_SEARCH_NULLSTATE:18,MLITE_DIODE_PROMOTION:19,MESSENGER_PENDING_REQUEST:20,MESSENGER_CLOSE_CONNECTION:21,MESSENGER_MONTAGE_SEEN_SHEET:22,MESSENGER_OMNIPICKER_KEYPRESS:23,MESSENGER_NOTIF_QP_TARGETING_UPSELL_TYPE:24,CONTACT_TAB_ACTIVE_NOW:26,MESSENGER_UNIV_NULLSTATE_BLEND:27,MESSENGER_INBOX_THREADS:28,INBOX_ACTIVE_NOW_NO_BOOSTING:29,BROADCAST_FLOW_TOP_CONTACTS_FB_SHARE:30,BROADCAST_FLOW_TOP_CONTACTS_MESSENGER_SHARE:31,BROADCAST_FLOW_TOP_CONTACTS_EXTERNAL_SHARE:32,MESSENGER_TRENDING_STICKERS:33,MESSENGER_BROADCAST_FLOW_TOP_THREADS:34,MESSENGER_SENDS_28D:35,MESSENGER_ROOM_INVITE:36,MESSENGER_ROOM_INVITE_SEARCH:37,INBOX_ACTIVE_NOW_PREFETCH:38,MESSENGER_BLENDED_KEYPRESS:39,MESSENGER_BLENDED_NULLSTATE:40,MESSENGER_CARRIER_MESSAGING:41,MESSENGER_ROOM_INVITE_GROUP:42,MESSENGER_INBOX_BIRTHDAY_ITEM:43,INSTAGRAM_DIRECT_SEARCH_NULLSTATE:44,BROADCAST_FLOW_TOP_CONTACTS_AND_TOP_THREAD_FB_SHARE:45,BROADCAST_FLOW_TOP_THREADS_FB_SHARE:46,FB_H_SCROLL_RANKING:47,FB_MESSAGING_USER_SEARCH:48,FB_MESSAGING_USER_SEARCH_NULLSTATE:49,MESSENGER_ACTIVE_NOW_TRAY_ACTIVE_CC:50,MESSENGER_SHARE_SHEET:51,MESSENGER_COMMUNITY_TAB_UNJOINED_COMMUNITIES:52,MESSENGER_BCF_FREQUENTS:53,FB_ORIGINAL_PRIVATE_SHARING:54,MESSENGER_SEARCH_NULLSTATE_FOLLOWER:55});f["default"]=a}),66);
__d("isSearchQualityEnabled",["gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("gkx")("3283")}g["default"]=a}),98);
__d("seedUserInfo",["CurrentMessengerUser","I64","LSIntEnum"],(function(a,b,c,d,e,f,g){"use strict";var h,i;async function a(a){var b=d("CurrentMessengerUser").getIDorEIMU();await a._user_info.put({facebookUserId:(h||(h=d("I64"))).of_string(b),id:(i||(i=d("LSIntEnum"))).ofNumber(1)})}g.default=a}),98);
__d("LSDefaultSyncGroups",["CurrentEnvironment","I64","LSE2EEMetadataSyncGroupUtils","LSIntEnum","LSMailboxInitialSyncCursor","LSPlatformLsInitLog","LSSyncGroupsUtils","MNetRankType","ReQL","cr:17238","gkx","isInstamadillo","isSearchQualityEnabled","justknobx","promiseDone","seedUserInfo"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=new Set();d("LSE2EEMetadataSyncGroupUtils").shouldAlwaysResetE2EEMetadata()&&j.add(95);var k=c("justknobx")._("3638")||c("isInstamadillo")();e=c("justknobx")._("3637");f=d("LSE2EEMetadataSyncGroupUtils").getE2EEMetadataSyncGroup();e=[{groupId:1,lastSyncRequestTimestampMs:d("LSMailboxInitialSyncCursor").lastSyncTimestampMs,syncChannel:d("LSMailboxInitialSyncCursor").syncChannel,syncParams:d("LSMailboxInitialSyncCursor").syncParams},{groupId:2,lastSyncRequestTimestampMs:d("LSMailboxInitialSyncCursor").lastSyncTimestampMs,syncChannel:d("LSMailboxInitialSyncCursor").syncChannel},{groupId:16,syncChannel:d("LSSyncGroupsUtils").defaultSyncGroup.syncChannel},c("gkx")("4246")?null:{groupId:28,syncChannel:d("LSSyncGroupsUtils").defaultSyncGroup.syncChannel,syncParams:JSON.stringify(babelHelpers.extends({},d("LSSyncGroupsUtils").defaultSyncParams,{size_type:"wide"}))},{groupId:118,minTimeToSyncTimestampMs:d("LSSyncGroupsUtils").neverSyncTimestamp,syncChannel:d("LSSyncGroupsUtils").defaultSyncGroup.syncChannel},{groupId:198},k?{groupId:89}:null,e?{groupId:197}:null];var l=[].concat(e,[c("gkx")("10282")?null:{groupId:6},{groupId:7,syncParams:JSON.stringify({mnet_rank_types:[c("MNetRankType").INSTAGRAM_DIRECT_SEARCH_NULLSTATE]})},d("LSE2EEMetadataSyncGroupUtils").getE2EEMetadataSyncGroupForIGDSyncGroup()]),m=[].concat(e,[{groupId:7,minTimeToSyncTimestampMs:d("LSSyncGroupsUtils").neverSyncTimestamp,syncParams:JSON.stringify({mnet_rank_types:[c("MNetRankType").MESSENGER_USER_SEARCH,c("isSearchQualityEnabled")()?c("MNetRankType").MESSENGER_BLENDED_NULLSTATE:c("MNetRankType").MESSENGER_USER_SEARCH_NULLSTATE,c("MNetRankType").INBOX_ACTIVE_NOW,c("MNetRankType").MESSENGER_OMNIPICKER_NULLSTATE,c("MNetRankType").MESSENGER_BROADCAST_FLOW_TOP_THREADS,c("MNetRankType").BROADCAST_FLOW_TOP_CONTACTS]})},{groupId:15,minTimeToSyncTimestampMs:d("LSSyncGroupsUtils").neverSyncTimestamp,syncChannel:d("LSSyncGroupsUtils").defaultSyncGroup.syncChannel},{groupId:12,minTimeToSyncTimestampMs:d("LSSyncGroupsUtils").neverSyncTimestamp,syncChannel:d("LSSyncGroupsUtils").defaultSyncGroup.syncChannel},{groupId:26},{groupId:196},f,c("gkx")("24113")?{groupId:120,syncChannel:d("LSSyncGroupsUtils").defaultSyncGroup.syncChannel}:null,c("gkx")("26390")?{groupId:6,minTimeToSyncTimestampMs:d("LSSyncGroupsUtils").neverSyncTimestamp}:null,{groupId:145,syncChannel:d("LSSyncGroupsUtils").defaultSyncGroup.syncChannel},c("gkx")("5985")?{groupId:202}:null]).concat(c("gkx")("22843")?[{groupId:104,syncChannel:d("LSSyncGroupsUtils").defaultSyncGroup.syncChannel},{groupId:143},{groupId:142},{groupId:140},{groupId:141}]:[]);async function n(a,b){var c=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.network_requests).getKeyRange("")),e=c.map(function(a){a=a.syncDatabaseId;return(h||(h=d("LSIntEnum"))).toNumber(a)});return Promise.all(b.map(async function(b){b!=null&&(!e.includes(b.groupId)||j.has(b.groupId))&&await a.network_requests.put(babelHelpers.extends({},d("LSSyncGroupsUtils").defaultNetworkRequest,{syncDatabaseId:(h||(h=d("LSIntEnum"))).ofNumber(b.groupId)}))}))}async function o(a){a=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.sync_groups));return new Map(a.map(function(a){return[(h||(h=d("LSIntEnum"))).toNumber(a.groupId),a]}))}async function p(a,b){var c=await o(a);async function e(b){var e=b.groupId;b=babelHelpers.objectWithoutPropertiesLoose(b,["groupId"]);var f=c.get(e);f==null||j.has(e)?await a.sync_groups.put(babelHelpers.extends({},d("LSSyncGroupsUtils").defaultSyncGroup,{},b,{groupId:(h||(h=d("LSIntEnum"))).ofNumber(e)})):f!=null&&(f.syncParams!==b.syncParams||b.syncChannel!=null&&!(i||(i=d("I64"))).equal(f.syncChannel,b.syncChannel))&&await a.sync_groups.put(babelHelpers.extends({},f,{syncChannel:b.syncChannel!=null?b.syncChannel:f.syncChannel,syncParams:b.syncParams}))}await Promise.all(b.map(function(a){return a&&e(a)}))}function q(a){return a!=null?a:c("CurrentEnvironment").instagramdotcom?l:m}async function a(a,e){e=q(e);d("LSPlatformLsInitLog").addPoint("db_seed_start");await c("seedUserInfo")(a);await n(a,e);await p(a,e);k&&b("cr:17238")!=null&&c("promiseDone")(b("cr:17238").prewarmAcsVoprfWasmModule());d("LSPlatformLsInitLog").addPoint("db_seed_end")}g.e2eeMetadataSyncGroup=f;g.igdSyncGroups=l;g.defaultSyncGroups=m;g.seedDb=a}),98);
__d("MAWDropCutoverThreadsTable",["Promise","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){var c=d("ReQL").fromTableAscending(a.cutover_threads);return d("ReQL").toArrayAsync(c).then(function(c){return c.reduce(function(b,c){return b.then(function(){return a.cutover_threads["delete"](c.openThreadId)})},(h||(h=b("Promise"))).resolve())})}g.call=a}),98);
__d("ReStoreDecryptionFailure",[],(function(a,b,c,d,e,f){"use strict";var g="ReStoreDecryptionFailure";a=function(a){babelHelpers.inheritsLoose(b,a);function b(b,c){var d;b=b+" - Encrypted Restore was unable to decrypt an entity for table "+c;d=a.call(this,b)||this;d.message=b;d.name=g;d.tableName=c;return d}var c=b.prototype;c.getTableName=function(){return this.tableName};return b}(babelHelpers.wrapNativeSuper(Error));f.ERROR_NAME=g;f.ReStoreDecryptionFailure=a}),66);
__d("ReStoreEARSetupFailure",[],(function(a,b,c,d,e,f){"use strict";var g="Encryption keychain could not be setup",h="ReStoreEARSetupFailure";a=function(a){babelHelpers.inheritsLoose(b,a);function b(b){var c;b=g+": "+b;c=a.call(this,b)||this;c.message=b;c.name=h;return c}return b}(babelHelpers.wrapNativeSuper(Error));f.ERROR_MESSAGE=g;f.ERROR_NAME=h;f.ReStoreEARSetupFailure=a}),66);
__d("ReStoreEvent",[],(function(a,b,c,d,e,f){"use strict";a=function(){};f["default"]=a}),66);
__d("ReStoreIndexedDbClosedEvent",["ReStoreEvent"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(b,c){var d;d=a.call(this)||this;d.idb=b;d.error=c;return d}var c=b.prototype;c.getError=function(){return this.error};return b}(c("ReStoreEvent"));g["default"]=a}),98);
__d("ReStoreIndexedDbFailToOpenEvent",["ReStoreEvent"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}return b}(c("ReStoreEvent"));g["default"]=a}),98);
__d("ReStoreIndexedDbUpgradedEvent",["ReStoreEvent"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}return b}(c("ReStoreEvent"));g["default"]=a}),98);
__d("ReStoreUnexpectedlyClosed",[],(function(a,b,c,d,e,f){"use strict";a="ReStoreUnexpectedlyClosed";b=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}return b}(babelHelpers.wrapNativeSuper(Error));f.ERROR_NAME=a;f.ReStoreUnexpectedlyClosed=b}),66);
__d("GetLsDatabase",["ExecutionEnvironment","LSDefaultSyncGroups","LSPlatformErrorChannel","LSPlatformLsInitLog","MAWDropCutoverThreadsTable","MessengerLogHistory","MultipleTabsLogger","ReStoreDecryptionFailure","ReStoreEARSetupFailure","ReStoreIndexedDbClosedEvent","ReStoreIndexedDbFailToOpenEvent","ReStoreIndexedDbUpgradedEvent","ReStoreUnexpectedlyClosed","UserTimingUtils","cr:10099","cr:10200","cr:10755","cr:4489","cr:6218","cr:665","cr:7000","cr:7351","cr:8915","justknobx","promiseDone","qex","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(e=b("cr:6218"))!=null?e:b("cr:10755"),j=(e=b("cr:7000"))!=null?e:b("cr:7351");function k(a){if(a instanceof c("ReStoreIndexedDbUpgradedEvent")&&i!=null&&c("justknobx")._("1410"))c("promiseDone")(i.killSharedWorker(!0,"ls_upgrade"));else if(a instanceof c("ReStoreIndexedDbClosedEvent")){a=a.getError();b("cr:8915")!=null&&a instanceof(b("cr:8915")==null?void 0:b("cr:8915").ReStoreDbVersionChange)?c("LSPlatformErrorChannel").emit(a):a instanceof d("ReStoreDecryptionFailure").ReStoreDecryptionFailure?c("LSPlatformErrorChannel").emit(a):a instanceof d("ReStoreEARSetupFailure").ReStoreEARSetupFailure?c("LSPlatformErrorChannel").emit(a):a instanceof d("ReStoreUnexpectedlyClosed").ReStoreUnexpectedlyClosed&&b("cr:10099")!=null?(b("cr:10099")==null?void 0:b("cr:10099").releaseIfExist(),c("LSPlatformErrorChannel").emit(a)):a instanceof c("ReStoreIndexedDbFailToOpenEvent")&&b("cr:10099")!=null&&(b("cr:10099")==null?void 0:b("cr:10099").releaseIfExist())}}var l=async function(){var a=d("MessengerLogHistory").getInstance("db_init");c("promiseDone")(d("MultipleTabsLogger").getMultipleTabsAnnotation().then(function(b){a.debug("Has multiple tabs: "+b),d("MultipleTabsLogger").addAnnotationToQPLEvent(c("qpl")._(25305590,"1127"))}));a.debug("====Creating DB====");d("LSPlatformLsInitLog").addPoint("vaulting_setup_start");b("cr:4489")!=null&&b("cr:665")!=null&&(h||(h=c("ExecutionEnvironment"))).isInBrowser&&(a.debug("Vaulting setup started"),b("cr:665").setupMainWaLogger(),await d("UserTimingUtils").asyncMeasure("Setup Vaulting Materials",async function(){await b("cr:4489").setupVaultMaterials()}),a.debug("Vaulting setup finished"));d("LSPlatformLsInitLog").addPoint("vaulting_setup_end");a.debug("Connecting to DB");var e=await b("cr:10200").createDB(k);a.debug("Connection established");await e.runInTransaction(async function(b){var c=j==null?[Promise.resolve(),Promise.resolve()]:[j.call(b),d("MAWDropCutoverThreadsTable").call(b)],e=c[0];c=c[1];await Promise.all([e,c]);d("LSPlatformLsInitLog").addPoint("success_maw_data_deletion");a.debug("Seeding DB");await d("LSDefaultSyncGroups").seedDb(b,void 0);a.debug("DB seeded")},"readwrite","ui",void 0,f.id+":114");a.debug("====DB created====");return e},m;function a(){m==null&&(m=(h||(h=c("ExecutionEnvironment"))).isInBrowser||c("qex")._("3809")?l():new Promise(function(){}));return m}g.get=a}),98);
__d("IntervalList",["FBLogger","JSONStringifyBigIntSafe","ReQLBounds","ReStoreKeyComparer"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a){if(a==null)throw c("FBLogger")("messenger_web").mustfixThrow("must not be null");return a}function a(a,b){var e=new Map(),f=new Map(),g=new Map();function k(b,c){return c==null?!0:(c.gt!==void 0?a(b,c.gt)>0:c.gte!==void 0?a(b,c.gte)>=0:!0)&&(c.lt!==void 0?a(b,c.lt)<0:c.lte!==void 0?a(b,c.lte)<=0:!0)}function* l(a){var g=0;while(g<a.length&&f.size){g++;var i=a.slice(0,g);g<b&&i.push((h||(h=d("ReStoreKeyComparer"))).MAX_KEY);i=f.get(c("JSONStringifyBigIntSafe")(i));if(i!=null)for(i of i)yield i}for(i of e.entries()){g=i[0];var j=i[1];e.has(g)&&k(a,j)&&(yield g)}}function m(a){var b=g.get(a);if(b!=null){g["delete"](a);var c=j(f.get(b));c["delete"](a);c.size===0&&f["delete"](b)}else e["delete"](a)}function n(a,h){var j;if(a&&a.gte!=null&&a.lte!=null&&(j=c("JSONStringifyBigIntSafe")((i||(i=d("ReQLBounds"))).nextKey(a.gte,b)))===c("JSONStringifyBigIntSafe")(a.lte)){var k=f.get(j);k==null&&(k=new Set(),f.set(j,k));k.add(h);g.set(h,j)}else e.set(h,a)}return{"delete":m,findIntersecting:l,set:n}}g["default"]=a}),98);
__d("LSTransactionLogger",["cr:8879"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=b("cr:8879")}),98);
__d("LSReStoreQplLogger",["LSTransactionLogger"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return{startTracking:function(b,d){var e=c("LSTransactionLogger")==null?void 0:c("LSTransactionLogger").startTracking(b,a,d);return{addAnnotations:function(b){c("LSTransactionLogger")==null?void 0:c("LSTransactionLogger").addAnnotations(a,e,b)},end:function(){c("LSTransactionLogger")==null?void 0:c("LSTransactionLogger").end(a,e)},fail:function(b){c("LSTransactionLogger")==null?void 0:c("LSTransactionLogger").fail(a,e,b)},mark:function(b){c("LSTransactionLogger")==null?void 0:c("LSTransactionLogger").mark(a,e,b)},recordLogicalWrite:function(){c("LSTransactionLogger")==null?void 0:c("LSTransactionLogger").recordLogicalWrite(e)}}}}}g.createQplLogger=a}),98);
__d("createReStoreEphemeralPersistence",["FBLogger","ReStorePersistence"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,c){return(a.has(b)?a:a.set(b,c())).get(b)}function a(a,b){var e=Promise.resolve(),f=new Map();function g(a){return h(f,a,function(){return new Map()})}return{flush:function(a){a.forEach(function(a,b){var c=g(b);a.forEach(function(a,b){d("ReStorePersistence").isDeletedValue(a)?c.delete(b):c.set(b,a)})});return Promise.resolve()},get:function(a,b,c){a=g(b);return a.get(c)},logError:function(a,b,d,e){if(d==="dbCorruption"){throw c("FBLogger")("messenger_web").mustfixThrow("Got unexpected undefined in edb, mode: %s, table: %s, id: %s, deletedInThisTxn: %s",b,a,(d=e==null?void 0:e.id)!=null?d:"",(b=e==null?void 0:e.deletedInThisTxn)!=null?b:"")}},permitsSynchronousIO:function(a){return!0},queueCommitWork:void 0,runExclusively:function(a){var c=b==null?void 0:b.startTracking(!1);c==null?void 0:c.addAnnotations({string:{source:"createReStoreEphemeralPersistence",type:"runExclusivelyPromiseChain"}});return new Promise(function(b,d){e=e.then(async function(){var e=await a(),f=e[0];e[1];try{b(await f()),c==null?void 0:c.end()}catch(a){d(a),c==null?void 0:c.fail()}}).catch(function(a){d(a)})})},shouldApplySync:function(){return!1},shouldInline:function(a,b){return!0},shouldSync:function(){return!1},types:["ephemeral"],uniqueId:a}}g.default=a}),98);
__d("createLSReStoreEphemeralPersistence",["LSReStoreQplLogger","MAWCurrentUser","createReStoreEphemeralPersistence","qpl"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a=d("MAWCurrentUser").getID();return c("createReStoreEphemeralPersistence")("LSEphemeral "+a,d("LSReStoreQplLogger").createQplLogger(c("qpl")._(25303045,"817")))}g.createLSReStoreEphemeralPersistence=a}),98);
__d("MWEncryptedBackupsFirstRestoreUpsellTime",["EBAPIWorkerCheck","FBLogger","WebStorage","getMWEncryptedBackupsIsLocalStorageSupported"],(function(a,b,c,d,e,f,g){"use strict";var h,i="mw_encrypted_backups_restore_upsell_first_impression_time_key";function a(){var a=Date.now().toString();if(d("EBAPIWorkerCheck").runningInWorker())return k(a);if(!d("getMWEncryptedBackupsIsLocalStorageSupported").getMWEncryptedBackupsIsLocalStorageSupported())return a;try{var b;b=(b=(h||(h=c("WebStorage"))).getLocalStorage())==null?void 0:b.getItem(i);if(b==null){var e;(e=(h||(h=c("WebStorage"))).getLocalStorage())==null?void 0:e.setItem(i,a);return a}return b}catch(b){c("FBLogger")("labyrinth_web").warn("[labyrinth][web] Failed to set EB session identifier due to %s",b);return a}}var j=null;function k(a){j==null&&(j=a);return j}g.getFirstRestoreUpsellTime=a;g.getFirstRestoreUpsellTimeForEBLS=k}),98);
__d("QPLMemoryUtils",["MemoryUtils","QPLUserFlow"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=d("MemoryUtils").getCurrentMemory();b=b.usedJSHeapSize;c("QPLUserFlow").addAnnotations(a,{"int":{usedJSHeapSizeStart:b}})}function b(a){var b=d("MemoryUtils").getCurrentMemory();b=b.usedJSHeapSize;c("QPLUserFlow").addAnnotations(a,{"int":{usedJSHeapSizeEnd:b}})}g.logMemoryForQPLStart=a;g.logMemoryForQPLEnd=b}),98);
__d("createReStoreEBSMTablesPersistence",["CurrentMessengerUser","EBLogger","ExecutionEnvironment","MAWUnrecoverableDbErrors","MWEBODSCategory","MWEBODSEntityKey.enum","MWEBODSEntityName.enum","MWEBUseLocalStorage","MWEncryptedBackupsFirstRestoreUpsellTime","MWEncryptedBackupsLocalStorageEntryEnum","ODS","QPLMemoryUtils","QPLUserFlow","Random","ReStorePersistence","ReStoreTabNotifier","WebSession","gkx","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["ebdbEbsmApi.updateEBSM is not defined"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["An error occured in EBSM hydration when loading EB data: ",""]);k=function(){return a};return a}b=d("CurrentMessengerUser").getIDorEIMU();var l=c("ReStoreTabNotifier")==null?void 0:c("ReStoreTabNotifier")("mwChat-"+b),m=null,n=!1,o=!1,p=d("EBLogger").EBLogger.tags(["EBSM","Pesistence","MainThread"]);function q(a,b,c){return(a.has(b)?a:a.set(b,c())).get(b)}function a(a){var b=Promise.resolve(),e="flushChangesV2",f=new Map();function g(a){return q(f,a,function(){return new Map()})}var r=d("MWEncryptedBackupsFirstRestoreUpsellTime").getFirstRestoreUpsellTime();c("QPLUserFlow").start(c("qpl")._(521481876,"1407"),{annotations:{string:{ebSessionIdentifier:r,sessionTabId:d("WebSession").getId()}}});(i||(i=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_HYDRATION,c("MWEBODSEntityKey.enum").START);d("QPLMemoryUtils").logMemoryForQPLStart(c("qpl")._(521481876,"1407"));async function s(){try{await a.rehydrateEBSMFromEBDB(g),d("QPLMemoryUtils").logMemoryForQPLEnd(c("qpl")._(521481876,"1407")),c("QPLUserFlow").endSuccess(c("qpl")._(521481876,"1407")),(i||(i=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_HYDRATION,c("MWEBODSEntityKey.enum").SUCCESS)}catch(a){c("QPLUserFlow").addPoint(c("qpl")._(521481876,"1407"),"EBSM_HYDRATION_FAILED"),p.MUSTFIX(k(),a),c("QPLUserFlow").endFailure(c("qpl")._(521481876,"1407"),"Hydration failed."),(i||(i=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_HYDRATION,c("MWEBODSEntityKey.enum").FAIL)}}m=s();l==null?void 0:l.onEventReceive("flushChangesV2",function(b){b=b.changeSet;var f=new Map();b.forEach(function(a,b){f.set(b,{toAdd:[],toDelete:[]});var c=g(b);a.forEach(function(a,e){if(d("ReStorePersistence").isDeletedValue(a,d("ReStorePersistence").sentinelDeleted)){var g;(g=f.get(b))==null?void 0:g.toDelete.push(c.get(e))}else{(g=f.get(b))==null?void 0:g.toAdd.push(a)}})});if(a.updateEBSM==null){p.MUSTFIX(j());return}c("promiseDone")(a.updateEBSM(f,e))});return{flush:async function(b,f){var h;if(b.size===0)return;b.size>0&&b.forEach(function(a,c){a.size===0&&b.delete(c)});if(b.size===0)return;f=((h=f.actionSource)==null?void 0:h.type)==="user_initiated"&&((h=f.actionSource)==null?void 0:h.source)===e;if(f){c("gkx")("6240")&&b.forEach(function(a,b){var c=g(b);a.forEach(function(a,b){d("ReStorePersistence").isDeletedValue(a,d("ReStorePersistence").sentinelDeleted)?c.delete(b):c.set(b,a)})});return}var i=new Map();b.forEach(function(a,b){i.set(b,{toAdd:[],toDelete:[]});var c=g(b);a.forEach(function(a,e){if(d("ReStorePersistence").isDeletedValue(a,d("ReStorePersistence").sentinelDeleted)){var f;(f=i.get(b))==null?void 0:f.toDelete.push(c.get(e));c.delete(e)}else{(f=i.get(b))==null?void 0:f.toAdd.push(a);c.set(e,a)}})});l==null?void 0:l.postMessage("flushChangesV2",{changeSet:b,fromVersion:"",sentinelDeleted:d("ReStorePersistence").sentinelDeleted,version:""});h=d("Random").uint32();f=Array.from(b.keys());c("QPLUserFlow").start(c("qpl")._(521485383,"2200"),{annotations:{bool:{ebsmv2:!0},string_array:{tables:f}},instanceKey:h});await m;await a.flushEBSMtoEBDB(i).catch(function(){})},get:function(a,b,c){var d=g(b);if(n)return d.get(c);return m==null?Promise.reject("rehydration is not complete"):m.then(function(){n=!0;return d.get(c)})},logError:function(b,e,f,g){(i||(i=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_RESTORE_PERSISTENCE_ERROR,b);if(f==="dbCorruption"){(i||(i=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_CORRUPTION,b);f="Got unexpected undefined in ebsm, mode: "+e+", table: "+b+", id: "+((f=g==null?void 0:g.id)!=null?f:"")+", deletedInThisTxn: "+((e=g==null?void 0:g.deletedInThisTxn)!=null?e:"")+". Deleting EBSM db";p.mustfix(f);g=d("Random").uint32();d("MAWUnrecoverableDbErrors").setError(new(d("MAWUnrecoverableDbErrors").EbsmHydrationError)(f,!0,g,b),function(){c("promiseDone")(a.clearEbStores(),function(){(i||(i=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_CORRUPTION,"db_deleted.main_thread")})});o||(o=!0,d("MWEBUseLocalStorage").mwEBCreateLocalStorageEntry(c("MWEncryptedBackupsLocalStorageEntryEnum").EBSM_CORRUPTION_WIPE,"full"))}},queueCommitWork:void 0,runExclusively:function(a){return new Promise(function(c,d){b=b.then(async function(){var b=await a(),e=b[0];b[1];try{c(await e())}catch(a){d(a)}})})},shouldApplySync:function(){return!1},shouldInline:function(a,b){return!1},shouldSync:function(a,b){return a==="notifyInMemoryTable"?!1:!0},tabTablesNotifier:function(){return c("gkx")("6240")?l:(h||(h=c("ExecutionEnvironment"))).isInBrowser?l:void 0},types:["ephemeral"],uniqueId:""}}g.default=a}),98);
__d("promiseFromRequest",[],(function(a,b,c,d,e,f){"use strict";function a(a){return new self.Promise(function(b,c){a.onsuccess=function(a){b(a.target.result)},a.onerror=function(a){c(a)}})}f["default"]=a}),66);
__d("createReStoreEBSMWorkerTablesPersistance",["EBLogger","EBSMDBAPIDeferred","EBSMHydrationUtils","MAWIndexedDbMetadata","MAWLSDBEncryption","MAWUnrecoverableDbErrors","MWEBODSCategory","MWEBODSEntityKey.enum","MWEBODSEntityName.enum","MWEBUseLocalStorage","MWEncryptedBackupsFirstRestoreUpsellTime","MWEncryptedBackupsLocalStorageEntryEnum","ODS","QPLUserFlow","Random","ReStorePersistence","WAExceededStorageQuota","WebSession","promiseDone","promiseFromRequest","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["An error occured in EBSM hydration when loading EB data"]);i=function(){return a};return a}var j=null,k=!1,l=!1,m=d("EBLogger").EBLogger.tags(["EBSM","Pesistence","MainThread"]);function n(a,b,c){return(a.has(b)?a:a.set(b,c())).get(b)}function a(a,b){a===void 0&&(a=!1);var e=Promise.resolve(),f=new Map();function g(a){return n(f,a,function(){return new Map()})}var o=d("MWEncryptedBackupsFirstRestoreUpsellTime").getFirstRestoreUpsellTime();c("QPLUserFlow").start(c("qpl")._(521481876,"1407"),{annotations:{bool:{is_worker:!0},string:{ebSessionIdentifier:o,sessionTabId:d("WebSession").getId()}}});(h||(h=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_HYDRATION+c("MWEBODSEntityName.enum").MW_EBSM_WORKER_SUFFIX,c("MWEBODSEntityKey.enum").START);async function p(){var a=await b;if(a==null)return;a=d("EBSMHydrationUtils").loadEBdataToEphemeralRestore(a);return a.then(function(a){a.forEach(function(a,b){var c=g(b);a.forEach(function(a,b){c.set(b.key,b.value)})}),c("QPLUserFlow").endSuccess(c("qpl")._(521481876,"1407")),(h||(h=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_HYDRATION+c("MWEBODSEntityName.enum").MW_EBSM_WORKER_SUFFIX,c("MWEBODSEntityKey.enum").SUCCESS)},function(){c("QPLUserFlow").addPoint(c("qpl")._(521481876,"1407"),"EBSM_HYDRATION_FAILED"),m.MUSTFIX(i()),c("QPLUserFlow").endFailure(c("qpl")._(521481876,"1407"),"Hydration failed."),(h||(h=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_HYDRATION+c("MWEBODSEntityName.enum").MW_EBSM_WORKER_SUFFIX,c("MWEBODSEntityKey.enum").FAIL)})}j=p();return{flush:async function(e){if(e.size===0)return;e.size>0&&e.forEach(function(a,b){a.size===0&&e.delete(b)});if(e.size>0){e.forEach(function(a,b){var c=g(b);a.forEach(function(a,b){d("ReStorePersistence").isDeletedValue(a,d("ReStorePersistence").sentinelDeleted)?c.delete(b):c.set(b,a)})});if(a)return;var f=d("Random").uint32(),h=Array.from(e.keys());c("QPLUserFlow").start(c("qpl")._(521485383,"2200"),{annotations:{bool:{ebsmv2:!0,is_worker:!0},string_array:{tables:h}},instanceKey:f});await j;var i=await b;if(i==null)return;var k=i.transaction(i.objectStoreNames,"readwrite",{durability:"relaxed"});d("WAExceededStorageQuota").listenToQuotaExceededError(k);h=new window.Promise(function(a,b){k.oncomplete=function(b){c("QPLUserFlow").endSuccess(c("qpl")._(521485383,"2200"),{instanceKey:f}),a(b.target.result)},k.onerror=async function(a){var d,g=Array.from(e).map(function(a){a=a[0];return a}).join(", ");m.mustfix("[labyrinth_web] An error occured in flush. "+(a==null?void 0:(d=a.target)==null?void 0:d.error)+". Requested stores: "+g);c("QPLUserFlow").endFailure(c("qpl")._(521485383,"2200"),a==null?void 0:(d=a.target)==null?void 0:d.error,{instanceKey:f});b(a)}});await Promise.all(Array.from(e).map(async function(a){var b=a[0];a=a[1];if(b!=null&&i.objectStoreNames.contains(b)){var e=k.objectStore(b);await Promise.all(Array.from(a).map(async function(a){var f=a[0];a=a[1];if(d("ReStorePersistence").isDeletedValue(a))await c("promiseFromRequest")(e.delete(f));else{a=d("MAWLSDBEncryption").encryptLSDBObj(a,b);await c("promiseFromRequest")(e.put(a,f))}}))}else m.mustfix("[labyrinth_web][EB SM] EB SM tableName is "+b+" is missing in "+Array.from(i.objectStoreNames).toString())}));await h}},get:function(a,b,c){var d=g(b);if(k)return d.get(c);return j==null?Promise.reject("rehydration is not complete"):j.then(function(){k=!0;return d.get(c)})},logError:function(a,b,e,f){(h||(h=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_RESTORE_PERSISTENCE_ERROR+c("MWEBODSEntityName.enum").MW_EBSM_WORKER_SUFFIX,a);if(e==="dbCorruption"){(h||(h=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_CORRUPTION+c("MWEBODSEntityName.enum").MW_EBSM_WORKER_SUFFIX,a);e="Got unexpected undefined in worker ebsm, mode: "+b+", table: "+a+", id: "+((e=f==null?void 0:f.id)!=null?e:"")+", deletedInThisTxn: "+((b=f==null?void 0:f.deletedInThisTxn)!=null?b:"")+". Deleting EBSM db";m.mustfix(e);f=d("Random").uint32();d("MAWUnrecoverableDbErrors").setError(new(d("MAWUnrecoverableDbErrors").EbsmHydrationError)(e,!0,f,a),function(){c("promiseDone")(d("EBSMDBAPIDeferred").cleanupStateTables(d("MAWIndexedDbMetadata").EBSM_WORKER_DB_PREFIX),function(){(h||(h=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_CORRUPTION,"db_deleted.worker")})});l||(l=!0,d("MWEBUseLocalStorage").mwEBCreateLocalStorageEntry(c("MWEncryptedBackupsLocalStorageEntryEnum").EBSM_CORRUPTION_WIPE,"full"))}},queueCommitWork:void 0,runExclusively:function(a){return new Promise(function(b,c){e=e.then(async function(){var d=await a(),e=d[0];d[1];try{b(await e())}catch(a){c(a)}})})},shouldApplySync:function(){return!1},shouldInline:function(a,b){return!1},shouldSync:function(a,b){return a==="notifyInMemoryTable"?!1:!0},types:["ephemeral"],uniqueId:""}}g.default=a}),98);
__d("createReStoreTableNameAllowListPersistence",[],(function(a,b,c,d,e,f){"use strict";function a(a,b,c){var d;return{clearCache:function(){a.clearCache==null?void 0:a.clearCache(),b.clearCache==null?void 0:b.clearCache()},close:function(){a.close==null?void 0:a.close(),b.close==null?void 0:b.close()},flush:async function(d,e){var f=new Map(),g=new Map();d.forEach(function(a,b){c.has(b)?g.set(b,a):f.set(b,a)});await Promise.all([a.flush(f,e),b.flush(g,e)])},get:function(d,e,f,g){return c.has(e)?b.get(d,e,f,g):a.get(d,e,f,g)},isClosed:function(){return(a.isClosed==null?void 0:a.isClosed())||!1},isPersistenceSupported:a.isPersistenceSupported,logError:function(d,e,f,g){c.has(d)?b.logError==null?void 0:b.logError(d,e,f,g):a.logError==null?void 0:a.logError(d,e,f,g)},permitsSynchronousIO:function(d){if(c.has(d)){var e;return(e=b.permitsSynchronousIO==null?void 0:b.permitsSynchronousIO(d))!=null?e:!1}else{return(e=a.permitsSynchronousIO==null?void 0:a.permitsSynchronousIO(d))!=null?e:!1}},runExclusively:function(c,d){return a.runExclusively(function(){return new Promise(function(a,e){var f=b.runExclusively(async function(){var b=await c(),d=b[0],e=b[1],g=new Promise(function(b){a([function(){b();return f},e])});return[async function(){await g;return d()},e]},d);f.catch(e)})},d)},shouldApplySync:function(d,e){if(c.has(e))return b.shouldApplySync(d,e);else return a.shouldApplySync(d,e)},shouldInline:function(d,e){return c.has(d)?b.shouldInline(d,e):a.shouldInline(d,e)},shouldSync:function(d,e){if(c.has(e))return b.shouldSync(d,e);else return a.shouldSync(d,e)},tabTablesNotifier:(d=a.tabTablesNotifier)!=null?d:b.tabTablesNotifier,types:[].concat(a.types,b.types),uniqueId:b.uniqueId+a.uniqueId}}f.default=a}),66);
__d("LSJSEBInMemoryStorage",["EBSMProperties","createLSReStoreEphemeralPersistence","createReStoreEBSMTablesPersistence","createReStoreEBSMWorkerTablesPersistance","createReStoreTableNameAllowListPersistence"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=c("createReStoreTableNameAllowListPersistence")(d("createLSReStoreEphemeralPersistence").createLSReStoreEphemeralPersistence(),c("createReStoreEBSMTablesPersistence")(a),c("EBSMProperties").persistedTables);return a}function b(a,b){b===void 0&&(b=!1);b=c("createReStoreTableNameAllowListPersistence")(d("createLSReStoreEphemeralPersistence").createLSReStoreEphemeralPersistence(),c("createReStoreEBSMWorkerTablesPersistance")(b,a),c("EBSMProperties").persistedTables);return b}g.makeReStorePersistence=a;g.makeReStoreWorkerPersistence=b}),98);
__d("ReStoreCustomMigration",["ReStoreMigrateUtil","ReStorePersistedMetadata"],(function(a,b,c,d,e,f,g){"use strict";async function a(a,b){var c,e=b.storeTx;b=b.transaction;if(a==null)return d("ReStoreMigrateUtil").ReStoreMigrateResult.NO_UPGRADE_NEEDED;var f=new(d("ReStorePersistedMetadata").ReStorePersistedCustomMigrationVersion)();c=(c=await f.read(e))==null?void 0:c.customMigrationVersion;if(a.targetVersion===c)return d("ReStoreMigrateUtil").ReStoreMigrateResult.NO_UPGRADE_NEEDED;await a.migration(c!=null?c:0,b);f.write(e,{customMigrationVersion:a.targetVersion});return d("ReStoreMigrateUtil").ReStoreMigrateResult.UPGRADE_COMPLETE}g.runCustomMigration=a}),98);
__d("ReStoreHooks",["PromiseOrValue"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return{afterAdd:a.reduce(function(a,b){var c=b.onAfterAdd;return c?function(b){return(h||(h=d("PromiseOrValue"))).map(a(b),function(a){return c(babelHelpers.extends({},b,{value:a}))})}:a},function(a){a=a.value;return a}),afterEntriesNext:a.reduce(function(a,b){var c=b.onAfterEntriesNext;return c?function(b){return c({tableName:b.tableName,value:a(b)})}:a},function(a){a=a.value;return a}),afterGet:a.reduce(function(a,b){var c=b.onAfterGet;return c?function(b){return c({tableName:b.tableName,value:a(b)})}:a},function(a){a=a.value;return a}),afterPut:a.reduce(function(a,b){var c=b.onAfterPut;return c?function(b){return(h||(h=d("PromiseOrValue"))).map(a(b),function(a){return c(babelHelpers.extends({},b,{value:a}))})}:a},function(a){a=a.value;return a}),beforeAdd:a.reduce(function(a,b){var c=b.onBeforeAdd;return c?function(b){return(h||(h=d("PromiseOrValue"))).map(a(b),function(a){return c(babelHelpers.extends({},b,{value:a}))})}:a},function(a){a=a.value;return a}),beforeDelete:a.reduce(function(a,b){var c=b.onBeforeDelete;return c?function(b){return(h||(h=d("PromiseOrValue"))).map(a(b),function(a){return c(babelHelpers.extends({},b,{value:a}))})}:a},function(a){a=a.key;return a}),beforeNotify:a.reduce(function(a,b){var c=b.onBeforeNotify;return c?function(b){var d=a(b),e=d.newValue;d=d.prevValue;return c({newValue:e,prevValue:d,tableName:b.tableName})}:a},function(a){var b=a.newValue;a=a.prevValue;return{newValue:b,prevValue:a}}),beforePut:a.reduce(function(a,b){var c=b.onBeforePut;return c?function(b){return(h||(h=d("PromiseOrValue"))).map(a(b),function(a){return c(babelHelpers.extends({},b,{value:a}))})}:a},function(a){a=a.value;return a}),beforeUpsert:a.reduce(function(a,b){var c=b.onBeforeUpsert;return c?function(b){return(h||(h=d("PromiseOrValue"))).map(a(b),function(a){return c(babelHelpers.extends({},b,{value:a}))})}:a},function(a){a=a.value;return a})}}g.createHookManager=a}),98);
__d("ReStoreIndexeddbPersistenceInitFailure",[],(function(a,b,c,d,e,f){"use strict";var g="ReStoreIndexeddbPersistenceInitFailure";a=function(a){babelHelpers.inheritsLoose(b,a);function b(b){var c;c=a.call(this,b)||this;c.message=b;c.name=g;return c}return b}(babelHelpers.wrapNativeSuper(Error));f.ERROR_NAME=g;f.ReStoreIndexeddbPersistenceInitFailure=a}),66);
__d("ReStoreTransactionDelay",["setTimeout"],(function(a,b,c,d,e,f,g){"use strict";async function a(a){a=a==="background"?new Promise(function(a){return c("setTimeout")(a,0)}):Promise.resolve();await a}g.default=a}),98);
__d("createReStoreSubscriptionManager",["ExecutionEnvironment","FBLogger","IntervalList","PromiseOrValue","ReStoreKeyComparer","ReStoreUtils","isPromise","nullthrows","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;function a(a,b,e){var f=new Map(),g=new Map();function l(a,b){return(k||(k=d("ReStoreKeyComparer"))).compareValue(a,b)===0}function m(a,b,c,d){a=(a=x.get(a))!=null?a:[];var e=[];for(var f=0;f<b.length;f++){var g=b[f];for(var h=0;h<32&&g!==0;h++){if(g&1){var i=a[(f<<5)+h];if(!l(c[i],d[i])){e[f]=((i=e[f])!=null?i:0)|1<<h%32}}g=g>>>1}}return e}function n(a,b){for(var c=0;c<Math.max(a.length,b.length);c++)if((a[c]&b[c])!==0)return!0;return!1}function o(a,b,d,e){try{a=a(b,d,e);if((h||(h=c("isPromise")))(a))return a.catch(function(a){c("FBLogger")("messenger_web").catching(a).mustfix("error in ReStore subscription async handler")});else return a}catch(a){c("FBLogger")("messenger_web").catching(a).mustfix("error in ReStore subscription handlers")}}function p(a,b,c,e,f){var g=Array.from(b(e));if(f.operation==="put"&&f.prevValue!=null){b=function(){var b=f.prevValue,h=[];for(var i of g){i[0];var k=i[1];k!=null&&k.forEach(function(a,b){h[b]=((b=h[b])!=null?b:0)|a})}var l=m(a,h,b,f.value);return{v:(j||(j=d("PromiseOrValue"))).all(g.map(function(a){var b=a[0];a=a[1];if(a==null||n(l,a))return o(b,e,f,c)}))}}();if(typeof b==="object")return b.v}return Promise.all(g.map(function(a){var b=a[0];a[1];return o(b,e,f,c)}))}function q(b){return c("nullthrows")((f.has(b)?f:f.set(b,[c("IntervalList")((k||(k=d("ReStoreKeyComparer"))).compareKey,a.tableNames[b].primaryKeyIds.length),new Map()])).get(b))}function r(b,e){var f=q(b);f[0];f=f[1];return c("nullthrows")((f.has(e)?f:f.set(e,c("IntervalList")((k||(k=d("ReStoreKeyComparer"))).compareKey,a.tableNames[b].indexes[e].length))).get(e))}function s(b,e,f,g,h,i){var l=function(a,c){return p(e,b.findIntersecting,i,a,c)},m=f==null?void 0:d("ReStoreUtils").searchKey(a.tableNames[e],f,h),n=g==null?void 0:d("ReStoreUtils").searchKey(a.tableNames[e],g,h);if(n==null&&m!=null)return l(m,{operation:"delete",prevValue:c("nullthrows")(f)});if(m==null&&n!=null)return l(n,{operation:"add",value:c("nullthrows")(g)});if(m!=null&&n!=null)return(k||(k=d("ReStoreKeyComparer"))).compareKey(m,n)===0?l(m,{operation:"put",prevValue:c("nullthrows")(f),value:c("nullthrows")(g)}):(j||(j=d("PromiseOrValue"))).map(l(m,{operation:"delete",prevValue:c("nullthrows")(f)}),function(){return l(n,{operation:"add",value:c("nullthrows")(g)})})}function t(a,b,c,e){var f=q(a),g=f[0],h=f[1];return(j||(j=d("PromiseOrValue"))).map(s(g,a,b,c,null,e),function(){return(j||(j=d("PromiseOrValue"))).all(Array.from(h.entries()).map(function(d){var f=d[0];d=d[1];return s(d,a,b,c,f,e)}).filter(function(a){return a!=null}))})}function u(){g.forEach(function(a){return a()})}function v(a,d){function f(){var e=new Map();try{for(var f of a){var g=f[0],h=f[1];b(d,g)&&e.set(g,h)}}catch(a){c("FBLogger")("messenger_web").catching(a).mustfix("Couldnot format changes to broadcast")}return Array.from(e)}if((i||(i=c("ExecutionEnvironment"))).isInBrowser&&e!=null){f=f();if(f.length===0)return;e.postMessage(d,f)}}(i||(i=c("ExecutionEnvironment"))).isInBrowser&&(e!=null&&e.onEventReceive("notifyTableV2",function(a){c("promiseDone")(async function(){var b=new WeakMap(),c=a.values();await (j||(j=d("PromiseOrValue"))).loop(function(a){if(a.done)return{action:"break",value:void 0};a=a.value;var e=a[0];a=a[1];var f=a.values();return(j||(j=d("PromiseOrValue"))).map(j.loop(function(a){if(a.done)return{action:"break",value:void 0};a=a.value;var c=a[0];a=a[1];return(j||(j=d("PromiseOrValue"))).map(t(e,c,a,b),function(){return{action:"continue",value:f.next()}})},f.next()),function(){return{action:"continue",value:c.next()}})},c.next());u()}())}));var w=new Map(),x=new Map();function y(a,b){if(b==null)return null;var c=w.get(a);c==null&&(c=new Map(),w.set(a,c));var d=[];for(b of b){var e=c.get(b);if(e==null){e=c.size;c.set(b,e);var f=x.get(a);f==null&&(f=[],x.set(a,f));f.push(b)}f=e>>5;e=e&31;d[f]=((f=d[f])!=null?f:0)|1<<e}return d}return{dispose:function(){f.clear(),g.clear()},notifyCommit:u,notifyTableAndIndexSubscribers:t,notifyTableV2:v,subscribeIndex:function(a,b,c,d,e){var f=r(a,b),g=!1;b=function(a,b,d){return g?Promise.resolve():o(c,a,b,d)};var h=[b,y(a,e)];f.set(d,h);return function(){g=!0,f.delete(h)}},subscribeTable:function(a,b,c,d){var e=q(a),f=e[0],g=!1;e=function(a,c,d){return g?Promise.resolve():o(b,a,c,d)};var h=[e,y(a,d)];f.set(c,h);return function(){g=!0,f.delete(h)}},subscribeToCommit:function(a){g.set(a,a);return function(){g.delete(a)}}}}g.default=a}),98);
__d("ReStore",["ExecutionEnvironment","FBLogger","JSONStringifyBigIntSafe","ODS","PromiseOrValue","ReStoreCustomMigration","ReStoreHooks","ReStoreIndexeddbPersistenceInitFailure","ReStoreMigrateUtil","ReStoreOperationLock","ReStorePersistedMetadata","ReStorePersistence","ReStoreTable","ReStoreTransactionDelay","ReStoreUtils","clearTimeout","cr:1088","cr:6665","createReStoreSubscriptionManager","promiseDone","setImmediate","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=function(b){babelHelpers.inheritsLoose(a,b);function a(){return b.call(this,"ReStore transaction timed out")||this}return a}(babelHelpers.wrapNativeSuper(Error)),l={enableRejectingTransaction:!1,enableTransactionTimeout:!1,fbLoggerProject:"maw_db",odsCategoryID:600},m=12e4;function a(a){var e=a.persistence,f=a.hooks;f=f===void 0?[]:f;var g=a.customMigration,n=a.loggers,o=n===void 0?{logHistory:void 0,transactionQplLogger:void 0,userFlow:void 0}:n;n=a.config;var p=n===void 0?l:n,q=a.schema,r=o.logHistory,s=o.transactionQplLogger,t=o.userFlow,u=d("ReStorePersistence").createDbStore(e);n=e.tabTablesNotifier==null?void 0:e.tabTablesNotifier();var v=q.defaults,w=c("createReStoreSubscriptionManager")(q,e.shouldSync,n),x=d("ReStoreHooks").createHookManager(f),y=u.createTransaction("readonly"),z=e.types.includes("indexeddb"),A={background:{first:null,last:null},sync_script:{first:null,last:null},ui:{first:null,last:null}},B="<first_txn>";t==null?void 0:t.addPoint("migration_start");r==null?void 0:r.debug("restore migration start");var C=new(d("ReStoreOperationLock").WaitForPromiseLock)(e.types.includes("devtool")?Promise.resolve():u.runExclusively(function(){return Promise.resolve([async function(){t==null?void 0:t.addPoint("migration_execute_start");var a=new Map(),b=u.createTransaction("readwrite"),c=F(b,a);r==null?void 0:r.debug("migration transaction created");c={changedKeys:a,clearCache:E,hooksManager:x,loggers:o,storeTx:b,transaction:c};try{var e=await q.migrate(c);t==null?void 0:t.addPoint("migration_custom_start");c=await d("ReStoreCustomMigration").runCustomMigration(g,c);r==null?void 0:r.debug("migration custom end");t==null?void 0:t.addPoint("migration_custom_end");if(c===d("ReStoreMigrateUtil").ReStoreMigrateResult.NO_UPGRADE_NEEDED&&e===d("ReStoreMigrateUtil").ReStoreMigrateResult.NO_UPGRADE_NEEDED){b.close();r==null?void 0:r.debug("restore migration skipped");t==null?void 0:t.addPoint("migration_skipped");return}c=e!==d("ReStoreMigrateUtil").ReStoreMigrateResult.UPDATE_METADATA&&a.size!==0;await b.flush({upgrade:c});t==null?void 0:t.addPoint("migration_execute_end");r==null?void 0:r.debug("restore migration complete")}catch(a){b.close();throw a}t==null?void 0:t.addPoint("migration_end");r==null?void 0:r.debug("restore migration end")},"readwrite"])},"migration").catch(function(a){t==null?void 0:t.addAnnotations({string:{migration_error:a.message}});a instanceof d("ReStoreIndexeddbPersistenceInitFailure").ReStoreIndexeddbPersistenceInitFailure||(t==null?void 0:t.endFail("migration_error"));r==null?void 0:r.debug("restore migration error");c("FBLogger")("restore_init").catching(a).mustfix("migration failed");throw a}));async function D(a,b){var c=new WeakMap();await u.runExclusively(function(){return Promise.resolve([async function(){var e=new Map(),f=u.createTransaction("readwrite"),g=F(f,e),h=b.values();await (j||(j=d("PromiseOrValue"))).loop(function(b){if(b.done)return{action:"break",value:void 0};b=b.value;var e=b[0],f=b[1];return(j||(j=d("PromiseOrValue"))).map(j.map(f==null?g.table(a).delete(d("ReStoreUtils").searchKey(q.tableNames[a],e)):g.table(a).put(f),function(){return w.notifyTableAndIndexSubscribers(a,e,f,c)}),function(){return{action:"continue",value:h.next()}})},h.next());try{await f.flush({upgrade:!0})}catch(a){f.close();throw a}},"readwrite"])},"applyChangesToTable")}function E(){u.clearCache==null?void 0:u.clearCache()}function F(a,b,c){return d("ReStoreUtils").createReStoreTransaction(q,v,x,w,a,b,c)}var G;function H(a,b,c,d){return new Promise(function(e,f){p.enableRejectingTransaction&&(G=f);var g=function(){B=d;return a().then(e,f).finally(function(){return B=void 0})};A[b].last==null?A[b].first=A[b].last={value:{code:g,writemode:c}}:A[b].last=A[b].last.next={value:{code:g,writemode:c}}})}function I(a){return u.runExclusively(function(){var a=A.ui.first!=null?A.ui:A.sync_script.first!=null?A.sync_script:A.background;if(a.first==null){c("FBLogger")(p.fbLoggerProject).mustfix("Expected work is missing");return Promise.resolve([function(){return Promise.resolve({})},"readonly"])}var b=a.first;a.first===a.last&&(a.last=null);a.first=a.first.next;return Promise.resolve([b.value.code,b.value.writemode])},a)}async function J(a,b,d,e){var f;d===void 0&&(d="background");e===void 0&&(e={source:"unknown",type:"user_initiated"});var g,h=(f=arguments[4])!=null?f:"<unknown callsite>";h==="<unknown callsite>"&&e.type!=="test_env"&&c("FBLogger")(p.fbLoggerProject).info("Unknown callsite for runInTransaction, action source %s",e.source);e.type==="maw_ui_bridge"&&(h=h+":"+e.events.map(function(a){a=a.tag;return a}).join(","));try{g=await K(a,b,d,e,h)}catch(a){if(a instanceof k)throw c("FBLogger")(p.fbLoggerProject).blameToPreviousFrame().mustfixThrow("ReStore transaction took too long to execute: %s",h);throw a}return g}async function K(a,e,f,g,i){f===void 0&&(f="background");var k,l,n,o,q,r=s==null?void 0:s.startTracking(z,f);b("cr:1088")&&(k=Date.now());r==null?void 0:r.addAnnotations({string:{currentlyExecutingModuleAndLineNo:B,moduleAndLineNo:i}});async function t(){r==null?void 0:r.mark("execute_start");b("cr:1088")&&(l=Date.now());var e={ref:void 0},f=new Map(),m=u.createTransaction("readwrite",i),s;b("cr:1088")==null?void 0:b("cr:1088").trackingStoredProceduresForNewTransaction(g);b("cr:1088")==null?void 0:b("cr:1088").recordModuleName(i);try{var t=F(m,f,{qplFlow:r});(h||(h=c("ExecutionEnvironment"))).isInBrowser?s=await Promise.race([a(t),M(e,r,i)]):s=await a(t);e.ref!=null&&c("clearTimeout")(e.ref);r==null?void 0:r.mark("execute_end");r==null?void 0:r.mark("flush_start");await m.flush({actionSource:g,qplFlow:r});r==null?void 0:r.mark("flush_end");b("cr:1088")&&(n=Date.now())}catch(a){e.ref!=null&&c("clearTimeout")(e.ref);m.close();r==null?void 0:r.fail(a);c("FBLogger")(p.fbLoggerProject).catching(a).mustfix("Transaction failed: %s",i);b("cr:1088")==null?void 0:b("cr:1088").recordRestoreTransaction({broadcast:o,complete:n,flush:q,queue:k,start:l},{changedKeys:f});throw a}finally{b("cr:1088")==null?void 0:b("cr:1088").stopTrackingStoredProcedures()}b("cr:1088")&&(q=Date.now());r==null?void 0:r.mark("broadcast_start");var v=new WeakMap();t=new Map();for(e of f){m=e[0];var y=e[1];m=JSON.parse(m);var z=m[0];m[1];m=t.get(z);m==null&&(m=[],t.set(z,m));var A=y[0];y=y[1];y=x.beforeNotify({newValue:y,prevValue:A,tableName:z});A=y.newValue;z=y.prevValue;m.push([z,A])}var B=t.entries();await (j||(j=d("PromiseOrValue"))).loop(function(a){if(a.done)return{action:"break",value:void 0};a=a.value;var b=a[0];a=a[1];var c=a.values();return(j||(j=d("PromiseOrValue"))).map(j.loop(function(a){if(a.done)return{action:"break",value:void 0};a=a.value;var e=a[0];a=a[1];return(j||(j=d("PromiseOrValue"))).map(w.notifyTableAndIndexSubscribers(b,e,a,v),function(){return{action:"continue",value:c.next()}})},c.next()),function(){return{action:"continue",value:B.next()}})},B.next());w.notifyTableV2(t,"notifyTableV2");w.notifyTableV2(t,"notifyInMemoryTable");w.notifyCommit();if(b("cr:1088")){o=Date.now();y={broadcast:o,complete:n,flush:q,queue:k,start:l};b("cr:1088").recordRestoreTransaction(y,{changedKeys:f})}r==null?void 0:r.mark("broadcast_end");r==null?void 0:r.mark("post_commit_start");c("setImmediate")(function(){r==null?void 0:r.mark("post_commit_end"),r==null?void 0:r.end()});return s}await c("ReStoreTransactionDelay")(f);t=H(t,f,e,i);r==null?void 0:r.mark("enqueued");r==null?void 0:r.addAnnotations({string:{actionSourceSource:g.source,actionSourceType:g.type},string_array:{actionSourceEvents:(f=g.events)==null?void 0:f.map(function(a){return a.tag}),actionSourceTaskNames:g.taskNames}});c("promiseDone")(I(i),function(){},function(a){G==null?void 0:G(a)});if(!(h||(h=c("ExecutionEnvironment"))).isInBrowser)return t;var v=c("setTimeout")(function(){var a;c("FBLogger")("messenger_web").mustfix("Transaction not resolved after %s ms. Source: %s; currently processing: %s. Native ops: %s. Executed SP: %s, isInWorker: %s",m,i,B,(a=c("JSONStringifyBigIntSafe")(b("cr:6665")==null?void 0:b("cr:6665").getCurrentlyExecutingNativeOps()))!=null?a:"<devtools not running>",(a=b("cr:1088")==null?void 0:(a=b("cr:1088").getStoredProcedureCallLog())==null?void 0:a.sp.map(function(a){return a.spName}).join(","))!=null?a:"<devtools not running>",(h||(h=c("ExecutionEnvironment"))).isInWorker)},m);return t.finally(function(){return c("clearTimeout")(v)})}(h||(h=c("ExecutionEnvironment"))).isInBrowser&&(n!=null&&n.onEventReceive("notifyInMemoryTable",function(a){c("promiseDone")(async function(){for(var b of a){var c=b[0],d=b[1];e.shouldApplySync("notifyInMemoryTable",c)&&await D(c,d)}w.notifyCommit()}())}));var L=Object.keys(q.tableNames).reduce(function(a,b){return babelHelpers.extends({},a,(a={},a[b]=new(d("ReStoreTable").ReStoreTable)(q.tableNames[b],x,C,y,w),a))},{});return{clearCacheIfSupported:E,closeDb:function(){var a=u;a instanceof Object&&a.close!==void 0&&a.close()},getCustomMigrationVersion:async function(){var a=await new(d("ReStorePersistedMetadata").ReStorePersistedCustomMigrationVersion)().read(u.createTransaction("readonly"));return a==null?void 0:a.customMigrationVersion},getTableData:function(){return q},isClosed:function(){return u.isClosed()},isPersistenceSupported:function(){var a=u;return a instanceof Object&&a.isPersistenceSupported!==void 0&&a.isPersistenceSupported instanceof Function?a.isPersistenceSupported():Promise.resolve(!0)},persistence:e,persistenceTypes:e.types,runInTransaction:J,subscribeToCommit:function(a){return w.subscribeToCommit(a)},subscriptionManager:w,table:function(a){return L[a]},tables:L,uniqueId:e.uniqueId};function M(a,e,f){return!p.enableTransactionTimeout?new Promise(function(){var e=3e4;a.ref=c("setTimeout")(function(){var a;c("FBLogger")(p.fbLoggerProject).mustfix("ReStore transaction took longer than 30000ms to execute, check it: %s. Executed SP: %s. isInWorker: %s.",f,b("cr:1088")==null?void 0:(a=b("cr:1088").getStoredProcedureCallLog())==null?void 0:a.sp.map(function(a){return a.spName}).join(","),(h||(h=c("ExecutionEnvironment"))).isInWorker);(i||(i=d("ODS"))).bumpEntityKey(p.odsCategoryID,"messenger.restore.transaction","timeout_"+(f||"").replace(/:/g,"_"),1)},e)}):new Promise(function(b,d){b=5e3;a.ref=c("setTimeout")(function(){e==null?void 0:e.mark("slow_transaction"),d(new k())},b)})}}g.default=a}),98);
__d("ReStoreInstrumentation",["JSONStringifyBigIntSafe"],(function(a,b,c,d,e,f,g){"use strict";var h=new Map();function a(a){h.set(a.uniqueId,{instance:a,persistence:a.persistence,tableNames:a.getTableData().tableNames});return a}function b(){return Array.from(h.entries()).map(function(a){var b=a[0];a=a[1];return{key:b,value:JSON.parse(c("JSONStringifyBigIntSafe")(a.tableNames))}})}g.instrument=a;g.getReStoreTables=b;g.reStoreInstancesMap=h}),98);
__d("LSReStoreWrapper",["LSReStoreQplLogger","MessengerLogHistory","ReStore","ReStoreInstrumentation","gkx","qpl"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e,f,g){e===void 0&&(e=[]);f=d("ReStoreInstrumentation").instrument(c("ReStore")({config:{enableRejectingTransaction:c("gkx")("8566"),enableTransactionTimeout:c("gkx")("2947"),fbLoggerProject:"maw_db",odsCategoryID:3185},customMigration:f,hooks:e,loggers:{logHistory:d("MessengerLogHistory").getInstance("db_init"),transactionQplLogger:d("LSReStoreQplLogger").createQplLogger(c("qpl")._(25306500,"1488")),userFlow:g},persistence:a,schema:b}));return f}g.createLSReStore=a}),98);
__d("MAWLSVaultingHooks",["ReStoreVaulting"],(function(a,b,c,d,e,f,g){"use strict";a={onAfterEntriesNext:function(a){var b=a.tableName;a=a.value;return d("ReStoreVaulting").maybeVaultDbRow(a,b)},onAfterGet:function(a){var b=a.tableName;a=a.value;return d("ReStoreVaulting").maybeVaultDbRow(a,b)},onBeforeAdd:function(a){var b=a.tableName;a=a.value;return d("ReStoreVaulting").maybeUnvaultDbRow(a,b)},onBeforeNotify:function(a){var b=a.newValue,c=a.prevValue;a=a.tableName;return{newValue:d("ReStoreVaulting").maybeVaultDbRow(b,a),prevValue:d("ReStoreVaulting").maybeVaultDbRow(c,a)}},onBeforePut:function(a){var b=a.tableName;a=a.value;return d("ReStoreVaulting").maybeUnvaultDbRow(a,b)},onBeforeUpsert:function(a){var b=a.tableName;a=a.value;return d("ReStoreVaulting").maybeUnvaultDbRow(a,b)}};g["default"]=a}),98);
__d("LSJSInMemoryStorage",["LSPlatformLsInitLog","LSReStoreWrapper","MAWLSVaultingHooks","createLSReStoreEphemeralPersistence"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("LSReStoreWrapper").createLSReStore(d("createLSReStoreEphemeralPersistence").createLSReStoreEphemeralPersistence(),a,[c("MAWLSVaultingHooks")],void 0,d("LSPlatformLsInitLog").lsInitLogger)}g["default"]=a}),98);
__d("LSVoprfWasmPrewarmDeferred",["WAWasmModuleCache","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("LSVoprfWasm").__setRef("LSVoprfWasmPrewarmDeferred");async function a(){var a=await h.load();a=a.locateFile;await d("WAWasmModuleCache").loadWasmModule(a())}g.prewarmAcsVoprfWasmModule=a}),98);
__d("MAWAppVersion",["SiteData"],(function(a,b,c,d,e,f,g){"use strict";function a(){return"302.0."+c("SiteData").client_revision}function b(){return{primary:302,secondary:0,tertiary:c("SiteData").client_revision}}g.getVersionNumber=a;g.getAppVersionParts=b}),98);
__d("MAWBridgeDropAllSecureThreadsHandler",["I64","LSIntEnum","LSMessagingThreadTypeUtil","Promise","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(a){var c=d("ReQL").fromTableAscending(a.threads_ranges_v2__generated).filter(function(a){return(i||(i=d("I64"))).equal(a.parentThreadKey,(j||(j=d("LSIntEnum"))).ofNumber(-1))||(i||(i=d("I64"))).equal(a.parentThreadKey,(j||(j=d("LSIntEnum"))).ofNumber(-10))});return d("ReQL").toArrayAsync(c).then(function(c){return c.reduce(function(b,c){return b.then(function(){return a.threads_ranges_v2__generated["delete"](c.parentThreadKey,c.minThreadKey,c.minLastActivityTimestampMs)})},(h||(h=b("Promise"))).resolve())})}function l(a){var c=d("ReQL").fromTableAscending(a.threads).filter(function(a){return d("LSMessagingThreadTypeUtil").isArmadilloSecure(a.threadType)});return d("ReQL").toArrayAsync(c).then(function(c){return c.reduce(function(b,c){return b.then(function(){return a.threads["delete"](c.threadKey)})},(h||(h=b("Promise"))).resolve())})}function a(a){return(h||(h=b("Promise"))).all([k(a),l(a)]).then(function(){return(h||(h=b("Promise"))).resolve()})}g.call=a}),98);
__d("MAWConsoleLogger",["gkx"],(function(a,b,c,d,e,f,g){"use strict";var h=c("gkx")("2656");function a(a,b,c){if(h){var d=c.map(function(a){return"["+a+"]"}).join("");if(a==="count"){console.count(d+" "+String(b));return}for(var e=arguments.length,f=new Array(e>3?e-3:0),g=3;g<e;g++)f[g-3]=arguments[g];if(d){var i;(i=console)[a].apply(i,[d,b].concat(f))}else{var j;(j=console)[a].apply(j,[b].concat(f))}}}g.logToConsole=a}),98);
__d("MAWDeleteOldLogsFromDisk",["Deferred","MAWLogIndexedDb","MAWSaveLogToDisk","MAWTransactionMode","WALogger","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to delete old logs: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to delete old logs: ",""]);i=function(){return a};return a}var j=c("justknobx")._("1400"),k=c("justknobx")._("1401"),l=c("justknobx")._("1402"),m=(e=d("MAWLogIndexedDb")).makeLogMsgrTransactor("logs",(f=d("MAWTransactionMode")).READONLY)(function(a){var b=new(c("Deferred"))();a=a();a=a.count();a.onsuccess=function(a){a=a.target.result;b.resolve(a)};a.onerror=function(a){b.reject(a)};return b.getPromise()}),n=e.makeLogMsgrTransactor("logs",f.READONLY)(function(a,b){var d=new(c("Deferred"))();a=a();var e=[];a=a.index("date");a=a.openCursor();a.onsuccess=function(a){a=a.target.result;if(a==null||!b(a.value,e)){d.resolve(e);return}e.push(a.value.id);a.continue()};a.onerror=function(a){d.reject(a)};return d.getPromise()}),o=e.makeLogMsgrTransactor("logs",f.READWRITE)(function(a){var b=new(c("Deferred"))();a=a();a=a.clear();a.onsuccess=function(){return b.resolve()};a.onerror=function(a){return b.reject(a)};d("MAWSaveLogToDisk").clearLogEntryCache();return b.getPromise()}),p=e.makeLogMsgrTransactor("logs",f.READWRITE)(function(a,b){var d=new(c("Deferred"))(),e=a();b.forEach(function(a){return e.delete(a)});e.transaction.oncomplete=function(){return d.resolve()};e.transaction.onerror=function(a){return d.reject(a)};return d.getPromise()});function q(a,b){b=Date.now()-l;return a!=null&&a.date<=b}function r(a){return function(b,c){return c.length<a}}async function a(){try{var a=await m();if(a===0)return;a=a-k;if(a>0){a=await n(r(a));await p(a);return}a=await n(q);a.length>0&&await p(a)}catch(a){d("WALogger").ERROR(i(),a)}}async function b(){try{var a=await m();if(a===0)return;if(a>=j){await o();return}}catch(a){d("WALogger").ERROR(h(),a)}}g.clearLogs=o;g.deleteOldLogs=a;g.deleteOldLogsOnStartup=b}),98);
__d("MAWMainThreadLogger",["CurrentMessengerUser","FBLogger","MAWAppVersion","MAWConsoleLogger","MAWDeleteOldLogsFromDisk","MAWLeakDetection","MAWLoggerUtils","MAWLoggingSwitches","MAWSaveLogToDisk","WAJids","WATagsLogger","err","getErrorSafe","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h=!1;function a(){h=!1}function b(){h||(h=!0,d("WATagsLogger").initializeWaLogger(p))}var i=function(){return c("FBLogger")("messenger_web")};function j(a,b){a=k(a);a!=null&&d("MAWLoggerUtils").logToHistory("log",a,b,!1)}function k(a){if(!d("CurrentMessengerUser").isEmployee()&&!d("CurrentMessengerUser").isTestUser())return;a=d("WAJids").maybeSanitizeLogLineText(a);a=d("MAWLeakDetection").maybeReplaceVaultedString(a);return a}function e(a,b){a=d("WAJids").maybeSanitizeLogLineText(a);a=d("MAWLeakDetection").maybeReplaceVaultedString(a);d("MAWLoggerUtils").logToHistory("log",a,b,!1)}function l(a,b){a=d("WAJids").maybeSanitizeLogLineText(a);a=d("MAWLeakDetection").maybeReplaceVaultedString(a);d("MAWLoggerUtils").logToHistory("log",a,b,!1)}function m(a,b){a=d("WAJids").maybeSanitizeLogLineText(a);a=d("MAWLeakDetection").maybeReplaceVaultedString(a);i().tags(b.map(function(a){return String(a)})).warn(a)}function f(a,b,d,e,f,g){d=c("err")(d);d.stack=e;c("promiseDone")(o(a,b,d,f,g))}async function n(a,b){a=d("MAWLeakDetection").maybeReplaceVaultedString(d("WAJids").maybeSanitizeLogLineText(a));var c=d("MAWLoggingSwitches").removeLoggingFromBridge?d("MAWSaveLogToDisk").getLastNEntries(b):Promise.resolve([]);b=b===0?[]:[].concat((await c).map(function(a){return a.args}));return{logs:[].concat(b),sanitizedMessage:a}}async function o(a,b,e,f,g){a=d("MAWLeakDetection").maybeReplaceVaultedString(d("WAJids").maybeSanitizeLogLineText(a));a=e!=null?e:c("err")(a);f=f!=null?f:e==null?2:0;e=g!=null?g:0;g=await n(a.message,e);e=g.logs;g=g.sanitizedMessage;var h=c("getErrorSafe")(a);try{a.message=g}catch(b){h=c("err")(g,a.fileName,a.lineNumber)}f!==0&&(h.framesToPop=f);(a=i())==null?void 0:(f=a.addMetadata("MESSENGER_E2EE_WEB","APP_VERSION",d("MAWAppVersion").getVersionNumber()).tags(b.map(function(a){return String(a)})).catching(h)).mustfix.apply(f,[g].concat(e))}var p={count:function(a,b){d("MAWConsoleLogger").logToConsole("count",a,b)},debug:function(a,b){d("MAWConsoleLogger").logToConsole("log",a,b)},devConsole:function(a,b,c){for(var e=arguments.length,f=new Array(e>3?e-3:0),g=3;g<e;g++)f[g-3]=arguments[g];switch(a){case"COUNT":d("MAWConsoleLogger").logToConsole.apply(void 0,["count",b,c].concat(f));break;case"DEV":d("MAWConsoleLogger").logToConsole.apply(void 0,["log",b,c].concat(f));break;case"DEV_XMPP":d("MAWConsoleLogger").logToConsole.apply(void 0,["log",b,c].concat(f));break;case"LOG":d("MAWConsoleLogger").logToConsole.apply(void 0,["info",b,c].concat(f));break;case"WARN":d("MAWConsoleLogger").logToConsole.apply(void 0,["warn",b,c].concat(f));break;case"ERROR":d("MAWConsoleLogger").logToConsole.apply(void 0,["error",b,c].concat(f));break;case"CATCHING":d("MAWConsoleLogger").logToConsole.apply(void 0,["error",b,c].concat(f));break}},error:function(a,b,e){c("promiseDone")(o(a,b,e)),d("MAWConsoleLogger").logToConsole("error",a,b)},info:function(a,b){l(a,b),d("MAWConsoleLogger").logToConsole("info",a,b)},logRestricted:function(a,b){j(a,b),d("MAWConsoleLogger").logToConsole("log",a,b)},warn:function(a,b){m(a,b),d("MAWConsoleLogger").logToConsole("warn",a,b)}};function q(){return!d("MAWLoggingSwitches").removeLoggingFromBridge?Promise.resolve([]):d("MAWSaveLogToDisk").getEntriesFromDb()}async function r(){if(!d("MAWLoggingSwitches").removeLoggingFromBridge)return;await d("MAWDeleteOldLogsFromDisk").clearLogs()}function s(a){return new Date(typeof a==="string"?parseInt(a,10):a).toISOString().replace("T"," ").replace("Z","")}function t(a){return a.map(function(a){try{var b=s(a.date);return[b,a.level,a.category,a.event,a.args].join(" | ")}catch(a){return[s(Date.now()),"error","LOGGER","Error formatting log: "+((a==null?void 0:a.message)||"")].join(" | ")}}).filter(Boolean).join("\n")}g.__testClearLoggerSetup=a;g.setupMainWaLogger=b;g.logRestricted=j;g.count=e;g.info=l;g.warn=m;g.logError=f;g.getEntries=q;g.clearEntries=r;g.formatEntries=t}),98);
__d("MAWVaultMaterialsStorage",["FBLogger","MAWVaultMaterials","Promise","WebAsyncStorage"],(function(a,b,c,d,e,f,g){"use strict";var h,i="mw_exchange_vm";function j(){var a=d("MAWVaultMaterials").generateNewVaultMaterials(),e="newly-generated";return new(h||(h=b("Promise")))(function(b){c("WebAsyncStorage").getOrSetItem(i,a,function(f,g){if(f!=null){var h=c("FBLogger")("messenger_web");if(f instanceof Error)throw h.catching(f).mustfixThrow("Failed to store Vaulting Materials. %s",f.toString());else h.mustfix("Failed to store Vaulting Materials.")}g!==null&&(a=g,e="storage");b(d("MAWVaultMaterials").initializeVaultMaterials(a,e))})})}function a(){return d("MAWVaultMaterials").hasVaultBeenSetup()?(h||(h=b("Promise"))).resolve(d("MAWVaultMaterials").getVaultMaterials()):j()}g.setupVaultMaterials=a}),98);
__d("MWConditionallySetupEBStateDB",["EBDB","EBReadyNotifier","ExecutionEnvironment","MAWCurrentUser","MAWIndexedDbMetadata","MessengerWebInitData","ODS","WAHex","WAOdsEnums","WormGlobalConfig","cr:23151","cr:8233","gkx","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i;async function a(a){if(b("cr:23151")!=null&&(i||(i=c("ExecutionEnvironment"))).isInBrowser){d("WormGlobalConfig").setWormGlobalConfig({useNoWABinary:function(){return c("gkx")("14807")}});b("cr:8233")==null?void 0:b("cr:8233").setupMainWaLogger();void d("EBDB").makeEBDB(d("MAWIndexedDbMetadata").ebdbName(d("MAWCurrentUser").getID()),c("qpl")._(1056840657,"2716"),d("WAHex").parseHex(c("MessengerWebInitData").accountKeyV2),d("EBDB").EBDBEnvironment.UI,{log:function(a){return(h||(h=d("ODS"))).bumpEntityKey(3185,d("WAOdsEnums").Entity.WORM,a)}});a=await b("cr:23151").makeReStorePersistence(a);d("EBReadyNotifier").markEBReady();return a}}g.conditionallyMakeEBStateDB=a}),98);
__d("MWLSSchemaEphemeral",["EBDB","EBDBEbsmApi","FBLogger","LSJSInMemoryStorage","LSMetadata","LSPlatformLsInitLog","LSReStoreWrapper","MAWLSVaultingHooks","MWConditionallySetupEBStateDB","MessengerLogHistory"],(function(a,b,c,d,e,f,g){"use strict";var h=d("MessengerLogHistory").getInstance("db_init");async function a(a){d("LSPlatformLsInitLog").addPoint("init_start");var b;a={clearEbStores:d("EBDB").clearEbStores,flushEBSMtoEBDB:d("EBDBEbsmApi").flushEBSMtoEBDB,rehydrateEBSMFromEBDB:d("EBDBEbsmApi").rehydrateEBSMFromEBDB};try{var e=await d("MWConditionallySetupEBStateDB").conditionallyMakeEBStateDB(a);e!=null&&(h.debug("Creating EB State DB"),b=d("LSReStoreWrapper").createLSReStore(e,d("LSMetadata").schema,[c("MAWLSVaultingHooks")],void 0,d("LSPlatformLsInitLog").lsInitLogger),a.updateEBSM=d("EBDBEbsmApi").updateEBSM(b),h.debug("EB State DB inited"))}catch(a){c("FBLogger")("messenger_web_clients").catching(a).mustfix("EBSM failed")}b==null&&(h.debug("Creating EDB"),b=c("LSJSInMemoryStorage")(d("LSMetadata").schema),h.debug("EDB inited"));d("LSPlatformLsInitLog").addPoint("init_end");return b}g.createDB=a}),98);
__d("ReStoreLocalStorageQuotaExceed",["FBLogger","recoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h="Failed to execute 'setItem' on 'Storage'",i="ReStoreLocalStorageQuotaExceed";function j(){try{var a=window.localStorage,b=[],d=[];if(a!=null&&a.length!==0)for(var e in a){b.length===0&&d.length===0&&(e.includes("falco_queue_log")&&d.push(e));if(!Object.prototype.hasOwnProperty.call(a,e))continue;var f=((a[e]||"").length+e.length)*2;f/1024>2e3&&b.push(e)}c("FBLogger")("messenger_web").mustfix(h+": QuotaExceeded - trying to clean up %s or %s",b.join(","),d.join(","));return b.length!==0?b:d}catch(a){c("FBLogger")("messenger_web").mustfix("Error getting local storage big values for cleanup.");return[]}}function a(){try{var a=window.localStorage,b=j();b.forEach(function(b){a.removeItem(b)})}catch(a){c("recoverableViolation")("Couldn't remove vals from localStorage","maw_db",a)}}b=function(a){babelHelpers.inheritsLoose(b,a);function b(b){var c;b=h+": "+b+"; Keys to delete: "+j().join(",");c=a.call(this,b)||this;c.message=b;c.name=i;return c}return b}(babelHelpers.wrapNativeSuper(Error));g.ERROR_NAME=i;g.getLocalStorageValuesToRemoveOnExceed=j;g.clearLocalStorageBigValues=a;g.ReStoreLocalStorageQuotaExceed=b}),98);/*FB_PKG_DELIM*/
__d("CryptoLogger",["FBLogger"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return c("FBLogger")("labyrinth_web","crypto."+a)}function b(a,b){return b instanceof Error?a.catching(b):a}g.CryptoLogger=a;g.captureError=b}),98);
__d("EBAPIQPLPoints",["QPLUserFlow"],(function(a,b,c,d,e,f,g){"use strict";e={CREATE_WORKER_NETWORK_EXECUTE_END:"create_worker_network_execute_end",CREATE_WORKER_NETWORK_EXECUTE_START:"create_worker_network_execute_start",GRAPHQL_QUERY_END:"graphql_query_end",GRAPHQL_QUERY_START:"graphql_query_start"};f={CLIENT_STATE_RETRIEVED:"client_state_retrieved",EB_NOT_ENABLED:"eb_not_enabled",EBLS_NOT_INITIALIZED:"ebls_not_initialized",EMPTY_DECRYPTION_RESPONSE:"empty_decryption_response",INVALID_CLIENT_STATE:"invalid_client_state",INVALID_GRAPHQL_RESPONSE:"invalid_graphql_response",INVALID_PARAMETERS:"invalid_parameters",LSDB_SINGLETON_RETRIEVED:"lsdb_singleton_retrieved",NO_CLIENT_STATE:"no_client_state",NULL_CHAT_JID:"null_chat_jid",RUNTIME_ERROR:"runtime_error",UNSUPPORTED_CONTEXT:"unsupported_context"};var h=babelHelpers["extends"]({},e),i=babelHelpers["extends"]({},e,{},f,{BACKUP_ID_NULL:"backup_id_null",BATCH_RESTORE_AND_DECRYPT_FAILURE:"batch_restore_and_decrypt_failure",DECRYPT_MESSAGES_ECHO_AND_PROTOBUF_END:"decrypt_messages_echo_and_protobuf_end",DECRYPT_MESSAGES_ECHO_AND_PROTOBUF_START:"decrypt_messages_echo_and_protobuf_start",DECRYPT_MESSAGES_ECHO_END:"decrypt_messages_echo_end",DECRYPT_MESSAGES_ECHO_START:"decrypt_messages_echo_start",DECRYPT_MESSAGES_PROTOBUF_END:"decrypt_messages_protobuf_end",DECRYPT_MESSAGES_PROTOBUF_START:"decrypt_messages_protobuf_start",DECRYPTED_PROTOBUFS_NULL:"decrypted_protobufs_null",DELETE_MAILBOX:"delete_mailbox",DERIVE_AND_STORE_EPOCHS_END:"derive_and_store_epochs_end",DERIVE_AND_STORE_EPOCHS_START:"derive_and_store_epochs_start",ECHO_DECODE_END:"echo_decode_end",ECHO_DECODE_START:"echo_decode_start",ECHO_DECRYPTION_FAILURE:"echo_decryption_failure",ECHO_TO_PROTOBUF_CONVERSION_END:"echo_to_protobuf_conversion_end",ECHO_TO_PROTOBUF_CONVERSION_FAILURE:"echo_to_protobuf_conversion_failure",ECHO_TO_PROTOBUF_CONVERSION_START:"echo_to_protobuf_conversion_start",GRAPHQL_QUERY_EXCEPTION:"graphql_query_exception",MISSING_RANGE_INFO:"missing_range_info",NO_MESSAGES_TO_RESTORE:"no_messages_to_restore",NULL_MESSAGES:"null_messages",PROCESS_AND_DECRYPT_MESSAGES_END:"process_and_decrypt_messages_end",PROCESS_AND_DECRYPT_MESSAGES_FAILURE:"process_and_decrypt_messages_failure",PROCESS_AND_DECRYPT_MESSAGES_START:"process_and_decrypt_messages_start",PROTOBUF_DECRYPTION_FAILURE:"protobuf_decryption_failure",RESTORING_MIXED_ECHO_PROTOBUF_PAYLOAD:"restoring_mixed_echo_protobuf_payload",SERVER_SIDE_EXCEPTION:"server_side_exception",THREAD_NOT_FOUND_ON_SERVER:"thread_not_found_on_server"}),j={ADDED_ATTACHMENT_CONTEXT:"added_attachment_context",ADDED_ATTACHMENT_CONTEXT_LEGACY:"added_attachment_context_legacy",DEQUEUE:"added_to_queue_end",ENQUEUE:"added_to_queue_start",ENQUEUE_FAILURE:"enqueue_failure",GENERATE_BACKUP_DIRECTIVE_END:"generate_backup_directive_end",GENERATE_BACKUP_DIRECTIVE_START:"generate_backup_directive_start",GENERATE_REPORTING_META_END:"generate_reporting_meta_end",GENERATE_REPORTING_META_START:"generate_reporting_meta_start",GET_ATTACHMENT_CONTEXT_END:"get_attachment_context_end",GET_ATTACHMENT_CONTEXT_START:"get_attachment_context_start",MESSAGE_RESULT_FAILURE_OR_NULL:"message_result_failure_or_null",NO_INCOMING_MESSAGES:"no_incoming_messages",NO_PROCESSED_MESSAGES:"no_processed_messages",PROCESSED_MESSAGES:"processed_messages",RUNTIME_ERROR:"runtime_error",SUCCESSFULLY_PROCESSED_MESSAGE:"successfully_processed_message",UKNOWN_MESSAGE_VERSION_OR_PROTOCOL:"unknown_message_version_or_protocol",UNABLE_TO_CREATE_BACKUP_DIRECTIVE:"unable_to_create_backup_directive",UNKNOWN_MESSAGE_TYPE:"unknown_message_type",UNSUPPORTED_MESSAGE_TYPE:"unsupported_message_type",UPLOAD_DELETED_MESSAGE:"upload_deleted_message",UPLOAD_PAYLOAD_CREATED:"upload_payload_creation_success",UPLOAD_PAYLOAD_CREATION_FAILURE:"upload_payload_creation_failure",UPLOAD_PAYLOAD_CREATION_START:"upload_payload_creation_start"},k={ADD_DEVICE_CHECK_RC_STATUS:"add_device_check_rc_status",ADD_DEVICE_COULD_NOT_FIND_BACKUP:"add_device_could_not_find_backup",ADD_DEVICE_FAILED_DEVICE_REGISTRATION_ID_NULL:"add_device_failed_device_registration_id_null",ADD_DEVICE_FAILED_TO_GET_RC_STATUS:"add_device_failed_to_get_rc_status",ADD_DEVICE_FAILURE_BACKUP_NOT_FOUND:"add_device_failure_backup_not_found",ADD_DEVICE_OPTIMISTIC_STATUS:"add_device_optimistic_status",ADD_DEVICE_RUNTIME_ERROR:"add_device_runtime_error",ADD_DEVICE_SPROC_END:"add_device_sproc_end",ADD_DEVICE_SPROC_FAILURE:"add_device_sproc_failure",ADD_DEVICE_SPROC_START:"add_device_sproc_start",ADD_DEVICE_SUBSCRIPTION_END:"add_device_subscription_end",ADD_DEVICE_SUBSCRIPTION_START:"add_device_subscription_start",ADD_DEVICE_TASK_END:"add_device_task_end",ADD_DEVICE_TASK_START:"add_device_task_start",ADD_DEVICE_TIMEOUT:"add_device_timeout",INVALID_RECOVERY_CODE:"invalid_recovery_code",ON_START_BEGIN:"on_start_start",ON_START_SUCCESS:"on_start_end"},l={ADD_DEVICE_FETCH_VD_GRAPHQL_END:"add_device_fetch_vd_graphql_end",ADD_DEVICE_FETCH_VD_GRAPHQL_FAIL:"add_device_fetch_vd_graphql_fail",ADD_DEVICE_FETCH_VD_GRAPHQL_START:"add_device_fetch_vd_graphql_start",ADD_DEVICE_GQL_END:"add_device_gql_end",ADD_DEVICE_GQL_FAIL:"add_device_gql_fail",ADD_DEVICE_GQL_START:"add_device_gql_start",ADD_DEVICE_MISSING_GRAPHQL_FIELDS:"add_device_missing_graphql_fields",ADD_DEVICE_PARSE_RECOVERY_CODE_END:"add_device_parse_recovery_code_end",ADD_DEVICE_PARSE_RECOVERY_CODE_FAIL:"add_device_parse_recovery_code_fail",ADD_DEVICE_PARSE_RECOVERY_CODE_START:"add_device_parse_recovery_code_start",ADD_DEVICE_VIRTUAL_DEVICE_EXISTS:"add_device_virtual_device_exists",ADD_DEVICE_VIRTUAL_DEVICE_KEY_SPROC_END:"add_device_vd_key_sproc_end",ADD_DEVICE_VIRTUAL_DEVICE_KEY_SPROC_FAIL:"add_device_vd_key_sproc_fail",ADD_DEVICE_VIRTUAL_DEVICE_KEY_SPROC_START:"add_device_vd_key_sproc_start"},m={FETCH_BACKUP_IDS_END:"fetch_backup_ids_end",FETCH_BACKUP_IDS_START:"fetch_backup_ids_start",INITIALIZE_BACKUP_END:"initialize_backup_end",INITIALIZE_BACKUP_SPROC_END:"initialize_backup_sproc_end",INITIALIZE_BACKUP_SPROC_FAIL:"initialize_backup_sproc_fail",INITIALIZE_BACKUP_SPROC_START:"initialize_backup_sproc_start",INITIALIZE_BACKUP_START:"initialize_backup_start",OPTIMISTIC_CLIENT_STATE:"optimistic_client_state"},n={DELETE_EB_NON_DELETE_OPERATION:"delete_eb_non_delete_operation",DELETE_EB_NON_PUT_OPERATION:"delete_eb_non_put_operation",DELETE_EB_SPROC_FAIL:"delete_eb_sproc_fail",DELETE_EB_SPROC_START:"delete_eb_sproc_start",DELETE_EB_SPROC_SUCCESS:"delete_eb_sproc_success",DELETE_EB_TASK_FAIL:"delete_eb_task_fail",DELETE_EB_TASK_START:"delete_eb_task_start",DELETE_EB_TASK_SUCCESS:"delete_eb_task_success",FETCH_BACKUP_IDS_END:"fetch_backup_ids_end",FETCH_BACKUP_IDS_START:"fetch_backup_ids_start"},o={FETCH_BACKUP_IDS_END:"fetch_backup_ids_end",FETCH_BACKUP_IDS_START:"fetch_backup_ids_start",OPT_OUT_BACKUP_ROW_EXISTS:"opt_out_backup_row_exists",OPT_OUT_BACKUP_ROW_NULL:"opt_out_backup_row_null",OPT_OUT_BACKUP_SPROC_END:"opt_out_backup_sproc_end",OPT_OUT_BACKUP_SPROC_FAIL:"opt_out_backup_sproc_fail",OPT_OUT_BACKUP_SPROC_START:"opt_out_backup_sproc_start",OPT_OUT_BACKUP_TASK_END:"opt_out_backup_task_end",OPT_OUT_BACKUP_TASK_FAIL:"opt_out_backup_task_fail",OPT_OUT_BACKUP_TASK_START:"opt_out_backup_task_start"};function a(a,b,d,e,f){c("QPLUserFlow").addPoint(b,d,{data:babelHelpers["extends"]({},e,{bool:{runningInWorker:a}}),instanceKey:f})}function b(a,b,d,e,f){c("QPLUserFlow").endFailure(b,d,{annotations:babelHelpers["extends"]({},f,{bool:{runningInWorker:a}}),instanceKey:e})}function d(a,b,d,e){c("QPLUserFlow").endSuccess(b,{annotations:babelHelpers["extends"]({},e,{bool:{runningInWorker:a}}),instanceKey:d})}g.EBAPIQPLCommonPoints=e;g.EBAPIQPLCommonErrorPoints=f;g.EBMessageMetadataQPLPoints=h;g.EBMessageRestoreQueryQPLPoints=i;g.EBUploadQueueQPLPoints=j;g.EBAddDeviceQPLPoints=k;g.EBAddDeviceGraphqlQPLPoints=l;g.EBBackupInitQPLPoints=m;g.EBDeleteEBQPLPoints=n;g.EBOptOutQPLPoints=o;g.ebAPIAddQPLPoint=a;g.ebAPIEndFailure=b;g.ebAPIEndSuccess=d}),98);
__d("WorkerRelayNetwork",["ActorURIConfig","MAWCurrentUser","RelayAPIConfig","WAResolvable","createRelayFBNetwork","createRelayFBNetworkFetch","relay-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h=new(d("WAResolvable").Resolvable)();function a(){var a=i(d("MAWCurrentUser").getID());a={execute:a.execute};h.resolve(a);return a}function b(){return h.promise}function i(a,b){b={actorID:a,batchResponseChunks:!0,getAdditionalData:function(){var b={};a!=null&&(b[c("ActorURIConfig").PARAMETER_ACTOR]=a);c("RelayAPIConfig").useXController===!1&&c("RelayAPIConfig").accessToken!==""&&(b.access_token=c("RelayAPIConfig").accessToken);return b},graphURI:b};b=c("createRelayFBNetworkFetch")(b);var e=function(a,b,c){return d("relay-runtime").Observable.create(function(a){return a.complete()})};return c("createRelayFBNetwork")(b,e,null,null)}g.createWorkerNetworkExecute=a;g.getWorkerNetworkExecute=b}),98);
__d("executeGraphQLQuery",["DTSG","FBLogger","MAWBridge","relay-runtime"],(function(a,b,c,d,e,f,g){"use strict";async function a(a,b,e){b=d("relay-runtime").getRequest(b);if(b.params.operationKind==="subscription")throw c("FBLogger")("messenger_web").mustfixThrow("executeGraphQLQuery: Expected query or mutation operation");var f={force:!0},g=d("DTSG").getToken();if(g==null||g===""||typeof g!=="string"){g=await d("MAWBridge").getBridge().sendAndReceive("event","getDTSGToken").catch(function(a){throw c("FBLogger")("messenger_web").mustfixThrow("executeGraphQLQuery: Failed to get DTSG token from the main thread",a)});if(g==null||g===""||typeof g!=="string")throw c("FBLogger")("messenger_web").mustfixThrow("executeGraphQLQuery: Received an empty DTSG token from the main thread");d("DTSG").setToken(g)}g=d("relay-runtime").createOperationDescriptor(b,e,f);return a.execute(g.request.node.params,g.request.variables,f)}g.executeGraphQLQuery=a}),98);
__d("createWorkerMutation",["FBLogger","WorkerRelayNetwork","executeGraphQLQuery","relay-runtime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=d("relay-runtime").getRequest(a);if(b.params.operationKind!=="mutation")throw c("FBLogger")("messenger_web").mustfixThrow("createWorkerMutation: Expected mutation operation");var e=d("WorkerRelayNetwork").getWorkerNetworkExecute();b=async function(b){var c=await e;return d("executeGraphQLQuery").executeGraphQLQuery(c,a,b).then(function(a){return a.toPromise()}).then(function(a){if(Array.isArray(a)){return(a=a[0])==null?void 0:a.data}else return null})};return[b]}g.default=a}),98);
__d("MAWRotateDTSG",["CSRFGuard","DTSG","MWFBLogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error rotating DTSG"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Getting new DTSG token"]);i=function(){return a};return a}var j=d("MWFBLogger").MWLogger.tags(["RotateDTSG"]),k=async function(){var a;j.DEBUG(i());var b=new Request("/ajax/dtsg/?__a=true",{credentials:"include",method:"GET"});b=await self.fetch(b);if(b.status!==200)throw j.mustfixThrow("Unable to get new DTSG token: "+b.status);b=await b.text();b=d("CSRFGuard").clean(b);var c=JSON.parse(b);a=c==null?void 0:(a=c.payload)==null?void 0:a.token;c=c==null?void 0:(c=c.payload)==null?void 0:c.valid_for;if(a==null||c==null)throw j.mustfixThrow("DTSG response is not valid: "+b+"'");return{token:a,validFor:c}},l=null;async function m(){self.clearTimeout(l);try{var a=await k(),b=a.token;a=a.validFor;l=self.setTimeout(m,a/2*1e3);d("DTSG").setToken(b);return!0}catch(a){j.catching(a).MUSTFIX(h());l=self.setTimeout(m,10*60*1e3);return!1}}g.getNewDTSG=k;g.tryRotateDTSG=m}),98);
__d("WARetryableError",["WACustomError"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(b){var c;c=a.call(this,"see error at this.source")||this;c.source=b;return c}return b}(d("WACustomError").customError("RetryableError"));g["default"]=a}),98);
__d("createWorkerQuery",["FBLogger","IGDWebUtils","MAWRotateDTSG","WARetryableError","WorkerRelayNetwork","executeGraphQLQuery","relay-runtime"],(function(a,b,c,d,e,f,g){"use strict";async function a(a,b,e){var f=d("relay-runtime").getRequest(a);if(f.params.operationKind!=="query")throw c("FBLogger")("messenger_web").mustfixThrow("createWorkerQuery: Expected query operation");f=await d("WorkerRelayNetwork").getWorkerNetworkExecute();e==null?void 0:e.onExecute==null?void 0:e.onExecute();var g=d("IGDWebUtils").isOnInstagramWeb();f=await d("executeGraphQLQuery").executeGraphQLQuery(f,a,b).then(function(a){return a.toPromise()}).then(function(a){e==null?void 0:e.onResponse==null?void 0:e.onResponse(a);return Array.isArray(a)?a[0].data:(a=a.data)!=null?a:null}).catch(function(a){if(("code"in a&&a.code===1357004||"message"in a&&a.message.indexOf("1357004")!==-1||typeof a==="string"&&a.indexOf("1357004")!==-1)&&!g){c("FBLogger")("messenger_web").info("Failed with expired DTSG, attempting to rotate.");return d("MAWRotateDTSG").tryRotateDTSG().then(function(b){if(b)throw new(c("WARetryableError"))(a);throw a})}throw a});return f}g.default=a}),98);
__d("WorkerRelay",["WorkerRelayNetwork","createWorkerMutation","createWorkerQuery","executeGraphQLQuery","relay-runtime"],(function(a,b,c,d,e,f,g){"use strict";f.exports={createWorkerMutation:c("createWorkerMutation"),createWorkerQuery:c("createWorkerQuery"),executeGraphQLQuery:d("executeGraphQLQuery").executeGraphQLQuery,getWorkerRelayEnvironment:d("WorkerRelayNetwork").getWorkerNetworkExecute,graphql:d("relay-runtime").graphql}}),34);
__d("createMainThreadQuery",["FBLogger","IGDWebUtils","MAWRotateDTSG","WARetryableError","executeGraphQLQuery","relay-runtime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=a.getNetwork();a={execute:a.execute};return a}async function b(a,b,e){var f=d("relay-runtime").getRequest(a);if(f.params.operationKind!=="query")throw c("FBLogger")("messenger_web").mustfixThrow("createWorkerQuery: Expected query operation");var g=d("IGDWebUtils").isOnInstagramWeb();f=await d("executeGraphQLQuery").executeGraphQLQuery(e,a,b).then(function(a){return a.toPromise()}).then(function(a){return Array.isArray(a)?a[0].data:(a=a.data)!=null?a:null}).catch(function(a){if(("code"in a&&a.code===1357004||"message"in a&&a.message.indexOf("1357004")!==-1||typeof a==="string"&&a.indexOf("1357004")!==-1)&&!g){c("FBLogger")("messenger_web").info("Failed with expired DTSG, attempting to rotate.");return d("MAWRotateDTSG").tryRotateDTSG().then(function(b){if(b)throw new(c("WARetryableError"))(a);throw a})}throw a});return f}g.getWorkerLikeRelayEnvironment=a;g.createMainThreadQuery=b}),98);
__d("EBCreateGraphQLFetchFnUnified",["EBAPIWorkerCheck","WorkerRelay","WorkerRelayNetwork","createMainThreadQuery","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("CometRelayEnvironment").__setRef("EBCreateGraphQLFetchFnUnified");async function a(){var a=d("EBAPIWorkerCheck").runningInWorker();if(!a){var b=await h.load();return function(a,c){var e=d("createMainThreadQuery").getWorkerLikeRelayEnvironment(b);return d("createMainThreadQuery").createMainThreadQuery(a,c,e)}}else{await d("WorkerRelayNetwork").createWorkerNetworkExecute();return d("WorkerRelay").createWorkerQuery}}g.createGraphQlFetchFnUnified=a}),98);
__d("EBFormatUtils",["I64","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){if(a!=null)return(h||(h=d("I64"))).min(a,h.of_float(d("WATimeUtils").millisTime()));switch(b){case"before":return(h||(h=d("I64"))).of_float(d("WATimeUtils").millisTime());case"after":return(h||(h=d("I64"))).zero;default:b;return(h||(h=d("I64"))).max_int}}function b(a,b){switch(b){case"before":return[a,0];case"after":return[0,a];default:b;return[Math.ceil(a/2),Math.ceil(a/2)]}}g.adjustTs=a;g.adjustCount=b}),98);
__d("EBMessageMetadataQueryQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="9456956994433373"}),null);
__d("EBMessageMetadataQueryQuery.graphql",["EBMessageMetadataQueryQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"data"}],c={alias:null,args:null,concreteType:"XFBEncryptedBackupMailbox",kind:"LinkedField",name:"mailbox",plural:!1,selections:[{alias:null,args:[{kind:"Variable",name:"data",variableName:"data"}],concreteType:"XFBTDeanonMessagesResponse",kind:"LinkedField",name:"deanon_messages_metadata",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"offline_threading_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"sort_order_ms",storageKey:null}],storageKey:null}],storageKey:null};return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"EBMessageMetadataQueryQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[c],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"EBMessageMetadataQueryQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[c,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}],storageKey:null}]},params:{id:b("EBMessageMetadataQueryQuery_facebookRelayOperation"),metadata:{},name:"EBMessageMetadataQueryQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("EBMessageRangeQueryUtils",["WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=Math.pow(2,48)-1;function a(a){var b=Number(a);return isNaN(b)?a:i(b).toString()}function i(a){if(a<0)return 0;if(a<=h)return a;a=d("WATimeUtils").millisTime()+6e4;return a}g.safeTimestampMsString=a;g.safeTimestampMsNumber=i}),98);
__d("XFBLSEncryptedBackupsMessagesRangeQueryDirection.facebook",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum").Mirrored(["AFTER","BEFORE"]);c=a;f["default"]=c}),66);
__d("XPlatRelayEnvironment",["CometRelayEnvironment","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a){throw c("err")("RelayEnvironment is already set")}function b(){return c("CometRelayEnvironment")}g.setRelayEnvironment=a;g.getRelayEnvironment=b}),98);
__d("EBMessageMetadataQuery",["EBAPIQPLPoints","EBAPIWorkerCheck","EBCreateGraphQLFetchFnUnified","EBMessageMetadataQueryQuery.graphql","EBMessageRangeQueryUtils","FBLogger","I64","LSDatabaseSingleton","QPLUserFlow","ReQL","WAHashStringToNumber","WAJids","WAResultOrError","XPlatRelayEnvironment","gkx","qpl","relay-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=c("gkx")("10665"),l=h!==void 0?h:h=b("EBMessageMetadataQueryQuery.graphql"),m=new Map();async function n(a){if(m.has(a))return m.get(a);var b=await (i||(i=d("LSDatabaseSingleton"))).getLSDatabaseSingletonPromiseOrValue();b=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(b.tables.mi_act_mapping_table.index("jid")).getKeyRange((j||(j=d("I64"))).of_string(a)));if((b==null?void 0:b.serverThreadKey)!=null){m.set(a,(j||(j=d("I64"))).to_float(b.serverThreadKey));return j.to_float(b.serverThreadKey)}return}var o=0;async function a(a){var b=a.direction,e=a.fetchPolicy,f=a.includeAnonymizedMessages;f=f===void 0?!1:f;var g=a.instanceKey,h=a.networkCacheConfig,i=a.numberOfMessages,j=a.referenceTimestamp;j=j===void 0?null:j;a=a.threadId;if(d("EBAPIWorkerCheck").runningInWorker())return d("WAResultOrError").makeError("unsupported-context");if(!k)return d("WAResultOrError").makeError("unsupported-mailbox");var m=g!=null?d("WAHashStringToNumber").hashStringToNumber(g):++o;try{c("QPLUserFlow").start(c("qpl")._(521476771,"2454"),{annotations:{int:{number_of_messages:i}},instanceKey:m});var p=d("XPlatRelayEnvironment").getRelayEnvironment();b=b==="after"?"AFTER":"BEFORE";c("QPLUserFlow").addPoint(c("qpl")._(521476771,"2454"),d("EBAPIQPLPoints").EBMessageMetadataQPLPoints.GRAPHQL_QUERY_START,{instanceKey:m});var q=await n(a);p=await d("relay-runtime").fetchQuery(p,l,{data:{act_thread_id:a,direction:b,include_anonymized_messages:f,reference_timestamp:j==null?j:d("EBMessageRangeQueryUtils").safeTimestampMsNumber(j),requested_messages:i,server_thread_key:q}},{fetchPolicy:e!=null?e:void 0,networkCacheConfig:h!=null?h:void 0}).toPromise();c("QPLUserFlow").addPoint(c("qpl")._(521476771,"2454"),d("EBAPIQPLPoints").EBMessageMetadataQPLPoints.GRAPHQL_QUERY_END,{instanceKey:m});i=(j=p==null?void 0:(a=p.viewer)==null?void 0:(b=a.encrypted_backup)==null?void 0:(f=b.mailbox)==null?void 0:f.deanon_messages_metadata)!=null?j:[];q=i.map(function(a){var b=a.offline_threading_id;a=a.sort_order_ms;return{offlineThreadingId:b,sortOrderMs:a}});c("QPLUserFlow").endSuccess(c("qpl")._(521476771,"2454"),{instanceKey:m});return d("WAResultOrError").makeResult({instanceKey:g,messages:q})}catch(a){c("FBLogger")("labyrinth_web").catching(a).mustfix("Error querying messaging metadata from EBMessageMetadataQuery");c("QPLUserFlow").endFailure(c("qpl")._(521476771,"2454"),"error",{error:a,instanceKey:m});return d("WAResultOrError").DEPRECATED_makeError("error",a)}}function e(a){var b=a.chatJid,e=a.direction,f=a.numberOfMessages;a=a.referenceTimestamp;return p({chatJid:b,direction:e,numberOfMessages:f,referenceTimestamp:a}).catch(function(a){c("FBLogger")("labyrinth_web").catching(a).mustfix("Error querying messaging metadata from EBMessageMetadataQuery");return d("WAResultOrError").makeError("runtime-error")})}async function p(a){var b=a.chatJid,c=a.direction,e=a.numberOfMessages;a=a.referenceTimestamp;if(!k)return d("WAResultOrError").makeError("unsupported-mailbox");b=d("WAJids").threadIdForChatJid(b);var f=await d("EBCreateGraphQLFetchFnUnified").createGraphQlFetchFnUnified();f=await f(l,{data:{act_thread_id:b,direction:q(c),include_anonymized_messages:!1,reference_timestamp:a==null?a:d("EBMessageRangeQueryUtils").safeTimestampMsNumber(a),requested_messages:e}});b=(f=f==null?void 0:(b=f.viewer)==null?void 0:(c=b.encrypted_backup)==null?void 0:(a=c.mailbox)==null?void 0:(e=a.deanon_messages_metadata)==null?void 0:e.map(function(a){var b=a.offline_threading_id;a=a.sort_order_ms;return{offlineThreadingId:b,sortOrderMs:a}}))!=null?f:[];return d("WAResultOrError").makeResult(b)}function q(a){switch(a){case"before":return"BEFORE";case"after":return"AFTER"}}g.messageMetadataQueryForMainThreadMAWDeanon=a;g.messageMetadataQuery=e}),98);
__d("LSBase64Decode",["Base64Utils","CryptoLogger"],(function(a,b,c,d,e,f,g){"use strict";function h(a){a=a.replace(/-/g,"+").replace(/_/g,"/").replace(/\./g,"=").replace("/,/","=");var b=4-a.length%4;if(b<4)for(var c=0;c<b;c++)a+="=";return a}function a(a){var b=d("CryptoLogger").CryptoLogger("base64decode");try{return a!=null?d("Base64Utils").toArrayBuffer(h(a)):void 0}catch(c){if((c==null?void 0:c.message)==null)return;c instanceof Error?b.catching(c).mustfix(c.message):b.mustfix("Base64decode : empty error message for exception: %s, input string: %s",c.message,a!=null?a:"undefined")}}g.decode=a}),98);
__d("LSBase64Decode.nop",["LSBase64Decode","LSResult","LSSynchronousPromise"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b,e){return d("LSSynchronousPromise").makeSynchronousPromise(c("LSResult")(d("LSBase64Decode").decode(e)))};a.__nop_name__="LSBase64Decode";g["default"]=a}),98);
__d("LSClearMessagePlaceholderRange",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.filter(b.db.table(13).fetch([[[a[0],b.i64.cast([0,0])]]]),function(c){return b.i64.eq(c.threadKey,a[0])&&c.minMessageId===a[1]&&b.i64.eq(b.i64.cast([0,0]),c.minTimestampMs)&&b.i64.eq(a[2],c.maxTimestampMs)}),function(a){return a["delete"]()})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxClearMessagePlaceholderRangeStoredProcedure";a.__tables__=["messages_ranges_v2__generated"];e.exports=a}),null);
__d("LSComputeParticipantCapabilities",["LSGetViewerFBID"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(a){return c.storedProcedure(b("LSGetViewerFBID")).then(function(a){return a=a,d[0]=a[0],a})},function(b){return c.filter(c.db.table(14).fetch([[[a[1],d[0]]]]),function(b){return c.i64.eq(b.threadKey,a[1])&&c.i64.eq(c.i64.cast([0,0]),c.i64.cast([0,0]))&&c.i64.eq(b.contactId,d[0])}).next().then(function(a,b){var c=a.done;a=a.value;return c?(c=[!1,!1],d[1]=c[0],d[2]=c[1],c):(b=a.item,c=[b.isAdmin==null?!1:b.isAdmin,b.isModerator],d[1]=c[0],d[2]=c[1],c)})},function(b){return c.filter(c.db.table(14).fetch([[[a[1],a[0]]]]),function(b){return c.i64.eq(b.threadKey,a[1])&&c.i64.eq(c.i64.cast([0,0]),c.i64.cast([0,0]))&&c.i64.eq(b.contactId,a[0])}).next().then(function(a,b){var c=a.done;a=a.value;return c?(c=[!1,!1],d[4]=c[0],d[5]=c[1],c):(b=a.item,c=[b.isAdmin==null?!1:b.isAdmin,b.isModerator],d[4]=c[0],d[5]=c[1],c)})},function(b){return c.filter(c.db.table(7).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.id,a[0])&&c.i64.eq(c.i64.cast([0,1]),c.i64.cast([0,1]))}).next().then(function(a,b){var e=a.done;a=a.value;return e?(e=[c.i64.cast([0,1073741823]),c.i64.cast([0,0]),!1],d[7]=e[0],d[8]=e[1],d[9]=e[2],e):(b=a.item,e=[b.capabilities==null?c.i64.cast([0,1073741823]):b.capabilities,b.contactTypeExact==null?c.i64.cast([0,0]):b.contactTypeExact,b.isManagedByViewer==null?!1:b.isManagedByViewer],d[7]=e[0],d[8]=e[1],d[9]=e[2],e)})},function(a){return d[12]=c.i64.eq(d[8],c.i64.cast([0,4]))?d[9]?c.i64.cast([0,2612119]):c.i64.or_(c.i64.cast([0,2612119]),c.i64.lsl_(c.i64.cast([0,1]),c.i64.to_int32(c.i64.cast([0,3])))):d[7],c.storedProcedure(b("LSGetViewerFBID")).then(function(a){return a=a,d[11]=a[0],a})},function(e){return d[13]=c.i64.lsl_(c.i64.cast([0,1]),c.i64.to_int32(c.i64.cast([0,20]))),d[15]=d[1]&&!d[4]&&c.i64.neq(d[11],a[0])?d[12]:c.i64.eq(c.i64.and_(d[12],d[13]),c.i64.cast([0,0]))?d[12]:c.i64.sub(d[12],d[13]),c.storedProcedure(b("LSGetViewerFBID")).then(function(a){return a=a,d[14]=a[0],a})},function(e){return d[16]=c.i64.lsl_(c.i64.cast([0,1]),c.i64.to_int32(c.i64.cast([0,22]))),d[19]=d[4]&&d[1]&&c.i64.neq(d[14],a[0])?d[15]:c.i64.eq(c.i64.and_(d[15],d[16]),c.i64.cast([0,0]))?d[15]:c.i64.sub(d[15],d[16]),d[2]?d[17]=!(d[4]||d[5]):d[17]=!0,c.storedProcedure(b("LSGetViewerFBID")).then(function(a){return a=a,d[18]=a[0],a})},function(b){return d[20]=c.i64.lsl_(c.i64.cast([0,1]),c.i64.to_int32(c.i64.cast([0,21]))),e[0]=(d[1]||d[2])&&d[17]&&c.i64.neq(a[0],d[18])?d[19]:c.i64.eq(c.i64.and_(d[19],d[20]),c.i64.cast([0,0]))?d[19]:c.i64.sub(d[19],d[20])}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxComputeParticipantCapabilitiesStoredProcedure";a.__tables__=["participants","contacts"];e.exports=a}),null);
__d("LSLogMEBUploadSuccessEvent.nop",["Promise","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("EncryptedBackupUploadFailureFalcoEvent").__setRef("LSLogMEBUploadSuccessEvent.nop"),j=c("requireDeferred")("EncryptedBackupUploadSuccessFalcoEvent").__setRef("LSLogMEBUploadSuccessEvent.nop");a=function(a,c,d,e,f){if(d!=null){a=f?j.load():i.load();void a.then(function(a){return a.log(function(){return{message_id:d,trace_id:e}})})}return(h||(h=b("Promise"))).resolve()};a.__nop_name__="LSLogMEBUploadSuccessEvent";g["default"]=a}),98);
__d("LSQplAnnotateString.nop",["EBMarkerIdToQPLEvent","Promise","QPLUserFlow","WAHashStringToNumber","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,e,f,g,i,j){try{a=c("nullthrows")(d("EBMarkerIdToQPLEvent").markerIdToQPLEvent(f));e=d("WAHashStringToNumber").hashStringToNumber(g);c("QPLUserFlow").addAnnotations(a,{string:(f={},f[i]=j,f)},{instanceKey:e});return(h||(h=b("Promise"))).resolve()}catch(a){return(h||(h=b("Promise"))).resolve()}};a.__nop_name__="LSQplAnnotateString";g["default"]=a}),98);
__d("LSDeleteBackupOnClient",["LSAppendDataTraceAddon","LSIsMobileClient","LSLogMEBUploadSuccessEvent.nop","LSLogMebClientEvent.nop","LSQplAnnotateString.nop","LSQplMarkPoint.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(d){return a[3]!==void 0?c.nativeOperation(b("LSQplMarkPoint.nop"),c.i64.cast([0,1021646192]),a[3],"dasm_delete_backup_on_client_sproc_start"):c.resolve()},function(d){return a[3]!==void 0?a[4]!==void 0?c.nativeOperation(b("LSQplAnnotateString.nop"),c.i64.cast([0,1021646192]),a[3],"dasm_delete_backup_on_client_error_message",a[4]):c.resolve():c.resolve()},function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsDeleteBackupOnClientStoredProcedure] Beginning execution."),c.i64.neq(void 0,void 0)?(d[9]=["deleteBackupOnClient reason: "," ",c.i64.to_string(void 0)].join(""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsDeleteBackupOnClientStoredProcedure] ","",d[9]].join("")),d[10]=c.createArray(),void 0!==void 0?d[11]=(d[10].push(void 0),d[10]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDeleteBackupOnClientStoredProcedure",[d[9]].join(""),d[10],c.i64.cast([0,4]))):c.resolve()},function(a){return d[1]="Beginning deleteBackupOnClient stored procedure",function(a){c.logger(a).info(a)}(["[EncryptedBackups][deleteBackupOnClient] ","",d[1]].join("")),d[2]=c.createArray(),void 0!==void 0?d[9]=(d[2].push(void 0),d[2]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"deleteBackupOnClient",[d[1]].join(""),d[2],c.i64.cast([0,4]))},function(b){return c.i64.neq(a[0],void 0)?c.forEach(c.db.table(168).fetch([[[a[0]]]]),function(a){return a["delete"]()}):c.forEach(c.db.table(168).fetch(),function(a){return a["delete"]()})},function(b){return c.i64.neq(a[0],void 0)?c.forEach(c.db.table(169).fetch([[[a[0]]],"fk_secure_encrypted_backups_client_state"]),function(a){return a["delete"]()}):c.forEach(c.db.table(169).fetch(),function(a){return a["delete"]()})},function(a){return c.forEach(c.db.table(174).fetch(),function(a){return a["delete"]()})},function(b){return a[1]==="fetch_virtual_device"?c.db.table(178).put({pk:c.i64.cast([0,1]),recoveryCodeStatus:c.i64.cast([0,4])}):c.resolve()},function(e){return a[2]?c.sequence([function(a){return d[9]="Clearing state management backups tables",function(a){c.logger(a).info(a)}(["[EncryptedBackups][deleteBackupOnClient] ","",d[9]].join("")),d[10]=c.createArray(),void 0!==void 0?d[11]=(d[10].push(void 0),d[10]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"deleteBackupOnClient",[d[9]].join(""),d[10],c.i64.cast([0,4]))},function(a){return c.forEach(c.db.table(172).fetch([[[c.i64.cast([0,1])]]]),function(a){var b=a.update;a.item;return b({backupId:void 0})})},function(b){return c.i64.neq(a[0],void 0)?c.forEach(c.filter(c.db.table(184).fetch(),function(b){return c.i64.eq(b.backupId,a[0])}),function(a){return a["delete"]()}):c.forEach(c.db.table(184).fetch(),function(a){return a["delete"]()})},function(b){return c.i64.neq(a[0],void 0)?c.forEach(c.db.table(196).fetch([[[a[0]]]]),function(a){return a["delete"]()}):c.forEach(c.db.table(196).fetch(),function(a){return a["delete"]()})}]):c.resolve()},function(a){return!1===!1?c.sequence([function(a){return c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,1851]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[10]=a[0],a})},function(a){return d[10]?d[11]=!0:d[11]=!1,d[11]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[13]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[13]].join("")),d[12]=c.createArray(),void 0!==void 0?d[14]=(d[12].push(void 0),d[12]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[13],d[12],c.i64.cast([0,3]))):c.resolve()}])},function(a){return c.forEach(c.db.table(177).fetch(),function(a){var d=a.item;return c.sequence([function(a){return c.forEach(c.db.table(2).fetch([[[d.pendingBackupTaskId]]]),function(a){return a["delete"]()})},function(a){return c.i64.eq(d.contentType,c.i64.cast([0,1]))?c.nativeOperation(b("LSLogMEBUploadSuccessEvent.nop"),d.uniqueKey,d.lsTraceId,!0):c.resolve()}])})},function(a){return c.count(c.db.table(177).fetch()).then(function(a){return d[9]=a})},function(a){return c.i64.eq(d[9],c.i64.cast([0,0]))?c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,1852]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[10]=a[0],a})},function(a){return d[10]?d[11]=!0:d[11]=!1,d[11]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[13]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[13]].join("")),d[12]=c.createArray(),void 0!==void 0?d[14]=(d[12].push(void 0),d[12]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[13],d[12],c.i64.cast([0,3]))):c.resolve()}]):c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,1853]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[10]=a[0],a})},function(a){return d[10]?d[11]=!0:d[11]=!1,d[11]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[13]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[13]].join("")),d[12]=c.createArray(),void 0!==void 0?d[14]=(d[12].push(void 0),d[12]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[13],d[12],c.i64.cast([0,3]))):c.resolve()}])}]):c.resolve()},function(e){return a[2]?(d[9]="Clearing data flow backups tables",function(a){c.logger(a).info(a)}(["[EncryptedBackups][deleteBackupOnClient] ","",d[9]].join("")),d[10]=c.createArray(),void 0!==void 0?d[11]=(d[10].push(void 0),d[10]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"deleteBackupOnClient",[d[9]].join(""),d[10],c.i64.cast([0,4]))):c.resolve()},function(e){return a[5]?c.resolve(0):a[4]!==void 0?(function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsDeleteBackupOnClientStoredProcedure] ","",a[4]].join("")),d[9]=c.createArray(),void 0!==void 0?d[10]=(d[9].push(void 0),d[9]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDeleteBackupOnClientStoredProcedure",a[4],d[9],c.i64.cast([0,3]))):c.resolve()},function(a){return d[3]=c.i64.of_float(Date.now()),d[4]=c.i64.random(),d[6]="Finishing execution. Execution time: ",d[7]=c.i64.to_string(c.i64.sub(d[3],d[0])),d[8]=" ms",d[5]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsDeleteBackupOnClientStoredProcedure] ",d[5],d[6],d[5],d[7],d[5],d[8]].join("")),c.i64.eq(c.i64.mod_(d[4],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[9]=",",d[10]=c.createArray(),void 0!==void 0?d[11]=(d[10].push(void 0),d[10]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDeleteBackupOnClientStoredProcedure",[d[6],d[9],d[7],d[9],d[8]].join(""),d[10],c.i64.cast([0,4]))):c.resolve()},function(d){return a[3]!==void 0?c.nativeOperation(b("LSQplMarkPoint.nop"),c.i64.cast([0,1021646192]),a[3],"dasm_delete_backup_on_client_sproc_end"):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsDeleteBackupOnClientStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs","secure_encrypted_backups_generated_recovery_code","secure_encrypted_backups_recovery_code_status","encrypted_backups","encrypted_backups_virtual_devices","encrypted_backups_metadata","pending_backups_context_v2","pending_tasks"];e.exports=a}),null);
__d("LSGetFirstAvailableAttachmentCTAID",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(a){return b.sequence([function(a){return b.db.table(19).fetchDesc().next().then(function(a,d){var e=a.done;a=a.value;return e?c[0]=b.i64.cast([0,1]):(d=a.item,c[0]=b.i64.add(d.ctaId,b.i64.cast([0,1])))})},function(a){return d[0]=c[0]}])},function(a){return b.resolve(d)}])}a.__sproc_name__="LSMailboxGetFirstAvailableAttachmentCTAIDStoredProcedure";a.__tables__=["attachment_ctas"];e.exports=a}),null);
__d("LSInsertAttachmentItem",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.db.table(18).add({attachmentFbid:a[0],attachmentIndex:a[1],threadKey:a[2],messageId:a[4],defaultActionEnableExtensions:a[31],originalPageSenderId:a[7],titleText:a[8],subtitleText:a[9],bodyText:a[12],playableUrl:a[13],playableUrlFallback:a[14],playableUrlExpirationTimestampMs:a[15],playableUrlMimeType:a[16],dashManifest:a[17],previewUrl:a[18],previewUrlFallback:a[19],previewUrlExpirationTimestampMs:a[20],previewUrlMimeType:a[21],previewWidth:a[22],previewHeight:a[23],imageUrl:a[24],defaultCtaId:a[25],defaultCtaTitle:a[26],defaultCtaType:a[27],defaultButtonType:a[29],defaultActionUrl:a[30],defaultWebviewHeightRatio:a[33],attachmentCta1Id:a[35],cta1Title:a[36],cta1IconType:a[37],cta1Type:a[38],attachmentCta2Id:a[40],cta2Title:a[41],cta2IconType:a[42],cta2Type:a[43],attachmentCta3Id:a[45],cta3Title:a[46],cta3IconType:a[47],cta3Type:a[48],faviconUrl:a[49],faviconUrlFallback:a[50],faviconUrlExpirationTimestampMs:a[51],previewUrlLarge:a[52]})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxInsertAttachmentItemStoredProcedure";a.__tables__=["attachment_items"];e.exports=a}),null);
__d("LSInsertNewMessageRange",["LSClearMessagePlaceholderRange"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(d){return c.storedProcedure(b("LSClearMessagePlaceholderRange"),a[0],a[9],c.i64.cast([0,0]))},function(b){return c.filter(c.db.table(13).fetch([[[a[0],{lte:a[5]}]]]),function(b){return c.i64.eq(b.threadKey,a[0])&&c.i64.le(b.minTimestampMs,a[5])&&c.i64.ge(b.maxTimestampMs,a[5])}).next().then(function(b,c){var e=b.done;b=b.value;return e?(e=[a[1],a[3],a[7]],d[0]=e[0],d[1]=e[1],d[2]=e[2],e):(c=b.item,e=[c.minTimestampMs,c.minMessageId,c.hasMoreBefore],d[0]=e[0],d[1]=e[1],d[2]=e[2],e)})},function(b){return c.filter(c.db.table(13).fetch([[[a[0],{lte:a[6]}]]]),function(b){return c.i64.eq(b.threadKey,a[0])&&c.i64.le(b.minTimestampMs,a[6])&&c.i64.ge(b.maxTimestampMs,a[6])}).next().then(function(b,c){var e=b.done;b=b.value;return e?(e=[a[2],a[4],a[8]],d[4]=e[0],d[5]=e[1],d[6]=e[2],e):(c=b.item,e=[c.maxTimestampMs,c.maxMessageId,c.hasMoreAfter],d[4]=e[0],d[5]=e[1],d[6]=e[2],e)})},function(b){return c.forEach(c.filter(c.db.table(13).fetch([[[a[0],{lte:a[6]}]]]),function(b){return c.i64.eq(b.threadKey,a[0])&&c.i64.ge(a[6],b.minTimestampMs)&&c.i64.le(a[5],b.maxTimestampMs)}),function(a){return a["delete"]()})},function(b){return c.db.table(13).put({threadKey:a[0],minTimestampMs:d[0],minMessageId:d[1],maxTimestampMs:d[4],maxMessageId:d[5],isLoadingBefore:!1,isLoadingAfter:!1,hasMoreBefore:d[2],hasMoreAfter:d[6]})}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxInsertNewMessageRangeStoredProcedure";a.__tables__=["messages_ranges_v2__generated"];e.exports=a}),null);
__d("LSMailboxTaskCompletionApiOnTaskInsertion",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.islc(b.db.table(232).fetch(),0,b.i64.to_float(b.i64.cast([0,1]))),function(c){c=c.item;return b.db.table(233).add({taskId:a[0],notificationScopeKey:c.notificationScopeKey,notificationName:c.notificationName})})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSCoreMailboxTaskCompletionApiOnTaskInsertionStoredProcedure";a.__tables__=["mailbox_task_completion_notification_context","mailbox_task_completion_api_tasks"];e.exports=a}),null);
__d("LSIssueNewTaskWithExtraOperations",["LSIssueNewTaskAndGetTaskID","LSMailboxTaskCompletionApiOnTaskInsertion"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return c.storedProcedure(b("LSIssueNewTaskAndGetTaskID"),a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[11]).then(function(a){return a=a,d[0]=a[0],a})},function(a){return c.storedProcedure(b("LSMailboxTaskCompletionApiOnTaskInsertion"),d[0])}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSCoreIssueNewTaskWithExtraOperationsStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSIssueNextSync",["LSIssueNewTaskAndGetTaskID"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(b){return c.count(c.filter(c.db.table(310).fetch(),function(b){return b.projectName===a[1]})).then(function(a){return d[0]=a})},function(e){return c.i64.gt(d[0],c.i64.cast([0,0]))&&a[3]===!0?c.resolve(0):c.sequence([function(b){return c.forEach(c.filter(c.db.table(310).fetch(),function(b){return b.projectName===a[1]}),function(a){return a["delete"]()})},function(e){return c.i64.gt(a[2],c.i64.cast([0,0]))?(d[3]=c.i64.of_float(Date.now()),d[1]=c.i64.add(d[3],a[2])):d[1]=c.i64.cast([0,0]),c.storedProcedure(b("LSIssueNewTaskAndGetTaskID"),["acs_sync","_",a[1]].join(""),c.i64.cast([0,362]),"",void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,d[1],c.i64.cast([0,0])).then(function(a){return a=a,d[2]=a[0],a})},function(b){return c.db.table(310).add({taskId:d[2],projectName:a[1],maxClientTokenPoolSize:a[0]})}])}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSAnonymousCredentialsIssueNextSyncStoredProcedure";a.__tables__=["acs_request_context"];e.exports=a}),null);
__d("LSMailboxTaskCompletionApiOnTaskCompletion",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.db.table(233).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({success:a[1]})})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSCoreMailboxTaskCompletionApiOnTaskCompletionStoredProcedure";a.__tables__=["mailbox_task_completion_api_tasks"];e.exports=a}),null);
__d("LSQplMarkEnd.nop",["EBMarkerIdToQPLEvent","Promise","QPLUserFlow","WAHashStringToNumber","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,e,f,g,i){try{a=c("nullthrows")(d("EBMarkerIdToQPLEvent").markerIdToQPLEvent(f));e=d("WAHashStringToNumber").hashStringToNumber(g);i?c("QPLUserFlow").endSuccess(a,{instanceKey:e}):c("QPLUserFlow").endFailure(a,"failure",{instanceKey:e});return(h||(h=b("Promise"))).resolve()}catch(a){return(h||(h=b("Promise"))).resolve()}};a.__nop_name__="LSQplMarkEnd";g["default"]=a}),98);
__d("LSRemoveBlindedTokens",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.filter(b.db.table(308).fetch(),function(b){return b.configId===a[0]}),function(a){return a["delete"]()})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSAnonymousCredentialsRemoveBlindedTokensStoredProcedure";a.__tables__=["secure_acs_blinded_tokens"];e.exports=a}),null);
__d("LSSetMessageDisplayedContentTypes",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(d){return b.sequence([function(d){return b.db.table(16).fetch([[[a[0],a[1]]]]).next().then(function(a,b){var d=a.done;a=a.value;return d?(d=[void 0,void 0],c[0]=d[0],c[1]=d[1],d):(b=a.item,d=[b.attachmentType,b.xmaLayoutType],c[0]=d[0],c[1]=d[1],d)})},function(d){return b.filter(b.db.table(12).fetch([[[a[0],a[2],a[1]]]]),function(c){return b.i64.eq(c.threadKey,a[0])&&b.i64.eq(b.i64.cast([0,0]),b.i64.cast([0,0]))&&b.i64.eq(c.timestampMs,a[2])&&c.messageId===a[1]}).next().then(function(a,d){var e=a.done;a=a.value;return e?(e=[b.i64.cast([0,0]),void 0,void 0],c[3]=e[0],c[4]=e[1],c[5]=e[2],e):(d=a.item,e=[d.replySourceTypeV2,d.replySourceId,d.text],c[3]=e[0],c[4]=e[1],c[5]=e[2],e)})},function(d){return b.db.table(9).fetch([[[a[0]]]]).next().then(function(a,b){var d=a.done;a=a.value;return d?c[7]=void 0:(b=a.item,c[7]=b.customEmoji)})},function(d){return b.i64.eq(c[0],b.i64.cast([0,6]))?c[9]=b.i64.cast([0,64]):(b.i64.eq(c[0],b.i64.cast([0,5]))?c[16]=b.i64.cast([0,4]):(b.i64.eq(c[0],b.i64.cast([0,3]))?c[17]=b.i64.cast([0,16384]):(b.i64.eq(c[0],b.i64.cast([0,2]))?c[18]=b.i64.cast([0,2]):(b.i64.eq(c[0],b.i64.cast([0,4]))?c[19]=b.i64.cast([0,2]):c[19]=a[5]?b.i64.cast([0,4096]):b.i64.cast([0,0]),c[18]=c[19]),c[17]=c[18]),c[16]=c[17]),c[9]=c[16]),c[10]=c[5]!==void 0&&c[5]!==""&&c[5]!==c[7]?b.i64.or_(c[9],b.i64.cast([0,1])):c[9],c[11]=c[7]!==void 0&&c[7]===c[5]?b.i64.or_(c[10],b.i64.cast([0,128])):c[10],c[12]=b.i64.eq(c[0],b.i64.cast([0,7]))?b.i64.or_(c[11],b.i64.cast([0,8])):c[11],c[13]=b.i64.eq(c[1],b.i64.cast([0,0]))?b.i64.or_(c[12],b.i64.cast([0,1024])):b.i64.eq(c[1],b.i64.cast([0,1]))?b.i64.or_(c[12],b.i64.cast([0,2048])):c[12],c[14]=b.i64.eq(c[3],b.i64.cast([0,2]))&&c[4]!==void 0?b.i64.or_(c[13],b.i64.cast([0,512])):c[13],c[15]=c[5]!==void 0&&c[5]!==""&&c[5]!==c[7]&&b.i64.eq(c[3],b.i64.cast([0,5]))?b.i64.or_(c[14],b.i64.cast([0,512])):c[14],b.forEach(b.filter(b.db.table(12).fetch([[[a[0],a[2],a[1]]]]),function(c){return b.i64.eq(c.threadKey,a[0])&&b.i64.eq(b.i64.cast([0,0]),b.i64.cast([0,0]))&&b.i64.eq(c.timestampMs,a[2])&&c.messageId===a[1]}),function(d){var e=d.update;d.item;return e({displayedContentTypes:a[4]?b.i64.cast([0,32]):b.i64.eq(c[3],b.i64.cast([0,3]))?b.i64.or_(c[15],b.i64.cast([0,8192])):c[15]})})}])},function(a){return b.resolve(d)}])}a.__sproc_name__="LSMailboxSetMessageDisplayedContentTypesStoredProcedure";a.__tables__=["attachments","messages","threads"];e.exports=a}),null);
__d("LSUpsertReaction",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.db.table(8).put({threadKey:a[0],messageId:a[2],actorId:a[3],timestampMs:a[1],reaction:a[4],authorityLevel:a[5],reactionCreationTimestampMs:a[6]})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxUpsertReactionStoredProcedure";a.__tables__=["reactions"];e.exports=a}),null);
__d("LSXmaContentType",[],(function(a,b,c,d,e,f){a=Object.freeze({TEST:-1,NONE:0,IG_SINGLE_IMAGE_POST_SHARE:1e3,IG_MULTIPOST_SHARE:1001,IG_STORY_REPLY:1002,IG_STORY_PHOTO_SHARE:1003,IG_STORY_PHOTO_MENTION:1004,IG_CLIPS_SHARE:1005,IG_SINGLE_VIDEO_POST_SHARE:1006,IG_STORY_VIDEO_SHARE:1007,IG_STORY_REACTION:1008,IG_IGTV_SHARE:1009,IG_SHOP_SHARE:1010,IG_PROFILE_SHARE:1011,IG_STORY_PHOTO_HIGHLIGHT_SHARE:1012,IG_STORY_VIDEO_HIGHLIGHT_SHARE:1013,IG_STORY_VIDEO_MENTION:1014,IG_STORY_HIGHLIGHT_REPLY:1015,IG_STORY_HIGHLIGHT_REACTION:1016,IG_EXTERNAL_LINK:1017,IG_RECEIVER_FETCH:1018,IG_TEXT_POST_APP_SHARE:1019,IG_MULTI_MEDIA_RESPONSE:1020,FB_FEED_SHARE:2e3,FB_STORY_REPLY:2001,FB_STORY_SHARE:2002,FB_STORY_MENTION:2003,FB_FEED_VIDEO_SHARE:2004,FB_GAMING_CUSTOM_UPDATE:2005,FB_PRODUCER_STORY_REPLY:2006,FB_EVENT:2007,FB_FEED_POST_PRIVATE_REPLY:2008,FB_SHORT:2009,FB_COMMENT_MENTION_SHARE:2010,FB_STORY_LWI_REPLY:2011,FB_COMMENT_SHARE:2012,FB_POST_MENTION:2013,FB_PROFILE_DIRECTORY_ITEM:2014,FB_FEED_POST_REACTION_REPLY:2015,MSG_EXTERNAL_LINK_SHARE:3e3,MSG_P2P_PAYMENT:3001,MSG_LOCATION_SHARING:3002,MSG_LOCATION_SHARING_V2:3003,MSG_HIGHLIGHTS_TAB_FRIEND_UPDATES_REPLY:3004,MSG_HIGHLIGHTS_TAB_LOCAL_EVENT_REPLY:3005,MSG_RECEIVER_FETCH:3006,MSG_IG_MEDIA_SHARE:3007,MSG_GEN_AI_SEARCH_PLUGIN_RESPONSE:3008,MSG_REELS_LIST:3009,MSG_CONTACT:3010,MSG_THREADS_POST_SHARE:3011,MSG_FILE:3012,MSG_AVATAR_DETAILS:3013,MSG_AI_CONTACT:3014,MSG_MEMORIES_SHARE:3015,MSG_SHARED_ALBUM_REPLY:3016,MSG_SHARED_ALBUM:3017,MSG_OCCAMADILLO_XMA:3018,MSG_GEN_AI_1P_SEARCH_RESULT:3019,MSG_EARLY_ACCESS_FB_SHARE:3020,MSG_GEN_AI_SUBSCRIPTION:3021,MSG_GEN_AI_REMINDER:3022,MSG_GEN_AI_MEMU_ONBOARDING_RESPONSE:3023,MSG_MAGICAL_MESSENGER_PLACES:3024,MSG_RECEIVER_FETCH_FALLBACK:3025,MSG_MAGICAL_MESSENGER_TASKS:3026,MSG_NOTE_REPLY:3027,MSG_NOTE_MENTION:3028,MSG_PROMPT_REPLY:3029,MSG_GEN_AI_TASK:3030,MSG_GEN_AI_RICH_RESPONSE:3040,MSG_RECEIVER_FETCH_ENT_DELETED:3041,MSG_GEN_AI_APP_DOWNLOAD_LINK:3042,MSG_GEN_AI_ENTITY:3043,MSG_OPG_P2P_PAYMENT:3044,RTC_AUDIO_CALL:4e3,RTC_VIDEO_CALL:4001,RTC_MISSED_AUDIO_CALL:4002,RTC_MISSED_VIDEO_CALL:4003,RTC_GROUP_AUDIO_CALL:4004,RTC_GROUP_VIDEO_CALL:4005,RTC_MISSED_GROUP_AUDIO_CALL:4006,RTC_MISSED_GROUP_VIDEO_CALL:4007,RTC_ONGOING_AUDIO_CALL:4008,RTC_ONGOING_VIDEO_CALL:4009,DATACLASS_SENDER_COPY:5e3,OC_AVATAR_STATIC_STICKER:6e3,LIVE_LOCATION:7e3});f["default"]=a}),66);
__d("MAWChatJid",["FBLogger","I64","MAWJids","MAWMiActMappingTableAPI","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b){try{return d("MAWMiActMappingTableAPI").getMappingRowForIntJid(a,d("MAWJids").convertChatJidToIntJid(b)).then(function(a){return a==null?void 0:a.serverThreadKey})}catch(a){c("FBLogger")("messenger_web").catching(a).warn("Invalid chatJid: "+b);return Promise.reject(a)}}function a(a,b,d){return i(a,b).then(function(a){if(a!=null)return a;throw c("FBLogger")("messenger_web").mustfixThrow("[toThreadKey] No mapping record for chatJid, source: %s",d)})}async function b(a,b){b=await i(a,b);return b==null?void 0:d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(b))}function e(a,b){try{return d("MAWMiActMappingTableAPI").getMappingRowForIntJid(a,b).then(function(a){return a==null?void 0:a.serverThreadKey})}catch(a){c("FBLogger")("messenger_web").catching(a).warn("Invalid integer jid: "+(h||(h=d("I64"))).to_string(b));return Promise.reject(a)}}g.toThreadKeyMaybe=i;g.toThreadKey=a;g.toThreadMaybe=b;g.toThreadKeyMaybeForChatJidInteger=e}),98);
__d("MAWDbChatId__UNSAFE_DO_NOT_USE",["I64"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return(h||(h=d("I64"))).of_float(a)}function b(a,b){return a+"_"+b}g.convertToChatId64__DEPRECATED=a;g.craftAltIndex__DEPRECATED=b}),98);
__d("WADirectPath",["WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h="0_0_0_.enc";function a(a){return a}function b(a){if(a==null)return d("WAResultOrError").makeError("direct-path-undefined");if(a==="")return d("WAResultOrError").makeError("direct-path-empty");return a.includes(h)?d("WAResultOrError").makeError("direct-path-corrupted"):d("WAResultOrError").makeResult(a)}g.unsafeCastToDirectPath=a;g.validateDirectPath=b}),98);
__d("WAMediaEntryData.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};a.internalSpec={fileSha256:[1,(e=d("WAProtoConst")).TYPES.BYTES],mediaKey:[2,e.TYPES.BYTES],fileEncSha256:[3,e.TYPES.BYTES],directPath:[4,e.TYPES.STRING],mediaKeyTimestamp:[5,e.TYPES.INT64],serverMediaType:[6,e.TYPES.STRING],uploadToken:[7,e.TYPES.BYTES],validatedTimestamp:[8,e.TYPES.BYTES],sidecar:[9,e.TYPES.BYTES],objectId:[10,e.TYPES.STRING],fbid:[11,e.TYPES.STRING],downloadableThumbnail:[12,e.TYPES.MESSAGE,c],handle:[13,e.TYPES.STRING],filename:[14,e.TYPES.STRING],progressiveJpegDetails:[15,e.TYPES.MESSAGE,b],size:[16,e.TYPES.INT64],lastDownloadAttemptTimestamp:[17,e.TYPES.INT64]};b.internalSpec={scanLengths:[1,e.FLAGS.REPEATED|e.TYPES.UINT32],sidecar:[2,e.TYPES.BYTES]};c.internalSpec={fileSha256:[1,e.TYPES.BYTES],fileEncSha256:[2,e.TYPES.BYTES],directPath:[3,e.TYPES.STRING],mediaKey:[4,e.TYPES.BYTES],mediaKeyTimestamp:[5,e.TYPES.INT64],objectId:[6,e.TYPES.STRING]};g.MediaEntrySpec=a;g.MediaEntry$ProgressiveJpegDetailsSpec=b;g.MediaEntry$DownloadableThumbnailSpec=c}),98);
__d("WAProgressiveJpegMarkers",[],(function(a,b,c,d,e,f){"use strict";a=255;b=0;c={SOF0:192,SOF1:193,SOF2:194,SOF3:195,DHT:196,SOF5:197,SOF6:198,SOF7:199,JPG:200,SOF9:201,SOF10:202,SOF11:203,SOF13:205,SOF14:206,SOF15:207,RST0:208,RST1:209,RST2:210,RST3:211,RST4:212,RST5:213,RST6:214,RST7:215,SOI:216,EOI:217,SOS:218,DQT:219,DRI:221,APP0:224,APP1:225,APP2:226,APP3:227,APP4:228,APP5:229,APP6:230,APP7:231,APP8:232,APP9:233,APP10:234,APP11:235,APP12:236,APP13:237,APP14:238,APP15:239,COM:254,TEM:1};d=[b,c.RST0,c.RST1,c.RST2,c.RST3,c.RST4,c.RST5,c.RST6,c.RST7];f.MARKER_PREFIX=a;f.MARKER_ESCAPE_BYTE=b;f.MARKERS=c;f.SOS_STREAM=d}),66);
__d("WAProgressiveJpegGetScanOffsets",["WAProgressiveJpegMarkers","WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Non-progressive JPEG marker found"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Ending marker found before end of image"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Scan found at offset ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Not a JPEG image"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["starting"]);l=function(){return a};return a}var m=d("WATagsLogger").TAGS(["media","progressiveJpegUtils"]);function a(a){m.DEV(l());if(!n(a)){m.DEV(k());return[]}var b=[],c=2,e="READ_MARKER_FIRST_BYTE_OR_ENTROPY_DATA",f=null,g=0,r=!1,s=!1,t=!1;function u(){t=!1,m.DEV(j(),c-1),b.push(c-1)}while(c<a.byteLength){f=a[c];if(r){m.ERROR(i());return[]}switch(e){case"READ_MARKER_FIRST_BYTE_OR_ENTROPY_DATA":f===d("WAProgressiveJpegMarkers").MARKER_PREFIX&&(e="READ_MARKER_SECOND_BYTE");break;case"READ_MARKER_SECOND_BYTE":if(f===d("WAProgressiveJpegMarkers").MARKER_PREFIX)e="READ_MARKER_SECOND_BYTE";else if(f===d("WAProgressiveJpegMarkers").MARKER_ESCAPE_BYTE)e="READ_MARKER_FIRST_BYTE_OR_ENTROPY_DATA";else if(f===d("WAProgressiveJpegMarkers").MARKERS.EOI)r=!0,t&&u();else if(!s&&p(f)){m.LOG(h());return[]}else o(f)?(s=!0,e="READ_MARKER_FIRST_BYTE_OR_ENTROPY_DATA"):(t&&u(),f===d("WAProgressiveJpegMarkers").MARKERS.SOS&&(t=!0),q(f)?e="READ_SIZE_FIRST_BYTE":e="READ_MARKER_FIRST_BYTE_OR_ENTROPY_DATA");break;case"READ_SIZE_FIRST_BYTE":e="READ_SIZE_SECOND_BYTE";break;case"READ_SIZE_SECOND_BYTE":c+=g*256;c+=f;c-=2;e="READ_MARKER_FIRST_BYTE_OR_ENTROPY_DATA";break}c+=1;g=f}return b}function n(a){if(a.byteLength<=2)return!1;if(a[0]!==d("WAProgressiveJpegMarkers").MARKER_PREFIX)return!1;return a[1]!==d("WAProgressiveJpegMarkers").MARKERS.SOF2&&a[1]!==d("WAProgressiveJpegMarkers").MARKERS.SOI?!1:!0}function o(a){return a===d("WAProgressiveJpegMarkers").MARKERS.SOF2||a===d("WAProgressiveJpegMarkers").MARKERS.SOF6||a===d("WAProgressiveJpegMarkers").MARKERS.SOF10||a===d("WAProgressiveJpegMarkers").MARKERS.SOF14}function p(a){return a===d("WAProgressiveJpegMarkers").MARKERS.SOF0||a===d("WAProgressiveJpegMarkers").MARKERS.SOF1||a===d("WAProgressiveJpegMarkers").MARKERS.SOF3||a===d("WAProgressiveJpegMarkers").MARKERS.SOF5||a===d("WAProgressiveJpegMarkers").MARKERS.SOF7||a===d("WAProgressiveJpegMarkers").MARKERS.JPG||a===d("WAProgressiveJpegMarkers").MARKERS.SOF9||a===d("WAProgressiveJpegMarkers").MARKERS.SOF11||a===d("WAProgressiveJpegMarkers").MARKERS.SOF13||a===d("WAProgressiveJpegMarkers").MARKERS.SOF15}function q(a){if(a===d("WAProgressiveJpegMarkers").MARKERS.TEM)return!1;return a>=d("WAProgressiveJpegMarkers").MARKERS.RST0&&a<=d("WAProgressiveJpegMarkers").MARKERS.RST7?!1:a!==d("WAProgressiveJpegMarkers").MARKERS.EOI&&a!==d("WAProgressiveJpegMarkers").MARKERS.SOI}g.getProgressiveJpegScanOffsets=a}),98);
__d("WAProgressiveJpegGetScanLengths",["WAProgressiveJpegGetScanOffsets"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=d("WAProgressiveJpegGetScanOffsets").getProgressiveJpegScanOffsets(a);return h(a)}function b(a){return a}function h(a){var b=[],c=0;for(a of a)b.push(a-c),c=a;return b}g.getProgressiveJpegScanLengths=a;g.asProgressiveJpegScanLength=b}),98);
__d("WAServerMediaType",["WAAssertUnreachable"],(function(a,b,c,d,e,f,g){"use strict";d=["image","sticker","ptt","audio","document","video","gif","ppic","md-app-state","md-msg-hist","kyc-id","template","thumbnail-image","thumbnail-video","thumbnail-gif","thumbnail-document","thumbnail-link","payment-bg-image","novi-video","novi-image","product","product-catalog-image","xma-image","biz-cover-photo","preview","newsletter-audio","newsletter-document","newsletter-image","newsletter-gif","newsletter-ptt","newsletter-sticker","newsletter-thumbnail-link","newsletter-video","sticker-pack","thumbnail-sticker-pack","music-artwork"];function a(a){switch(a){case"image":case"sticker":case"ptt":case"audio":case"document":case"video":case"gif":case"ppic":case"md-app-state":case"md-msg-hist":case"kyc-id":case"thumbnail-image":case"thumbnail-video":case"thumbnail-gif":case"thumbnail-document":case"thumbnail-link":case"payment-bg-image":case"novi-video":case"novi-image":case"template":case"product":case"product-catalog-image":case"xma-image":case"biz-cover-photo":case"preview":case"newsletter-audio":case"newsletter-document":case"newsletter-image":case"newsletter-gif":case"newsletter-ptt":case"newsletter-sticker":case"newsletter-thumbnail-link":case"newsletter-video":case"sticker-pack":case"thumbnail-sticker-pack":case"music-artwork":return a;default:return null}}function b(a){switch(a){case"Image":return"image";case"Video":return"video";case"Ptt":return"ptt";case"Gif":return"gif";case"Sticker":return"sticker";case"DocumentFile":return"document";case"Text":case"Futureproof":case"Ciphertext":case"Unavailable":case"ExpiredEphemeral":case"Admin":case"Revoked":case"DeleteForMe":case"EphemeralSettingAdmin":case"EphemeralSyncResponse":case"EphemeralSettingChangeFromCurrentDevice":case"AlertICDC":case"GroupInvite":case"SenderKeyDistribution":case"Reaction":case"EditAction":case"ReceiverFetch":case"Raven":case"GroupPollCreate":case"GroupPollUpdate":return null;default:return c("WAAssertUnreachable")(a)}}g.SERVER_MEDIA=d;g.castToServerMediaType=a;g.getMediaType=b}),98);
__d("WAMediaUtils",["WACryptoDependencies","WADirectPath","WAGlobals","WALongInt","WAMediaEntryData.pb","WAProgressiveJpegGetScanLengths","WAResultOrError","WAServerMediaType","WATimeUtils","decodeProtobuf","encodeProtobuf","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=new Uint8Array(32);d("WACryptoDependencies").getCrypto().getRandomValues(a);return a.buffer}function i(a){return a}function a(){return h()}function j(a){return a}function k(a){return a}function b(a){return a}function e(a){return a}function f(a,b){a=d("decodeProtobuf").decodeProtobuf(d("WAMediaEntryData.pb").MediaEntrySpec,b);b=a.fileSha256;var c=a.mediaKey,e=a.fileEncSha256,f=a.directPath,g=a.mediaKeyTimestamp,h=a.sidecar,i=a.objectId,j=a.fbid,l=a.serverMediaType,m=a.downloadableThumbnail,n=a.filename,o=a.progressiveJpegDetails;a=a.size;f=d("WADirectPath").validateDirectPath(f);return{fileSha256:b,mediaKey:c,fileEncSha256:e,directPath:f.success?f.value:null,mediaKeyTimestamp:d("WALongInt").maybeNumberOrThrowIfTooLarge(g),sidecar:h&&k(h),objectId:i,fbid:j,downloadableThumbnail:m==null?void 0:{directPath:m.directPath,fileEncSha256:m.fileEncSha256,fileSha256:m.fileSha256,mediaKey:m.mediaKey,mediaKeyTimestamp:d("WALongInt").maybeNumberOrThrowIfTooLarge(m.mediaKeyTimestamp),objectId:m.objectId},serverMediaType:l,filename:n,progressiveJpegDetails:o&&s(o),size:a==null?void 0:d("WALongInt").numberOrThrowIfTooLarge(a)}}function l(a){var b=a.fileSha256,c=a.fileEncSha256,e=a.mediaKey,f=a.directPath,g=a.mediaKeyTimestamp,h=a.serverMediaType,i=a.objectId,j=a.fbid,k=a.downloadableThumbnail,l=a.filename,m=a.progressiveJpegDetails;a=a.size;b=d("encodeProtobuf").encodeProtobuf(d("WAMediaEntryData.pb").MediaEntrySpec,{fileSha256:b,fileEncSha256:c,mediaKey:e,directPath:f,mediaKeyTimestamp:g,serverMediaType:h,objectId:i,fbid:j,downloadableThumbnail:k,filename:l,progressiveJpegDetails:m,size:a});return b.readByteArrayView()}function m(a){return d("encodeProtobuf").encodeProtobuf(d("WAMediaEntryData.pb").MediaEntrySpec,a).readByteArrayView()}function n(a,b){return d("encodeProtobuf").encodeProtobuf(d("WAMediaEntryData.pb").MediaEntrySpec,babelHelpers["extends"]({},a,{directPath:b})).readByteArrayView()}function o(a,b){return d("encodeProtobuf").encodeProtobuf(d("WAMediaEntryData.pb").MediaEntrySpec,babelHelpers["extends"]({},a,{downloadableThumbnail:babelHelpers["extends"]({},a.downloadableThumbnail,{directPath:b})})).readByteArrayView()}function p(a,b){a=babelHelpers["extends"]({},a,{fbid:b});return d("encodeProtobuf").encodeProtobuf(d("WAMediaEntryData.pb").MediaEntrySpec,a).readByteArrayView()}function q(a,b){a=babelHelpers["extends"]({},a,{objectId:b});return d("encodeProtobuf").encodeProtobuf(d("WAMediaEntryData.pb").MediaEntrySpec,a).readByteArrayView()}function r(a){if(a==null)return null;a.$$unknownFieldCount;var b=a.directPath,c=a.objectId,e=babelHelpers.objectWithoutPropertiesLoose(a,["$$unknownFieldCount","directPath","objectId"]);b=d("WADirectPath").validateDirectPath(b);return babelHelpers["extends"]({},e,{directPath:b.success?b.value:null,objectId:c,mediaKey:a.mediaKey&&i(a.mediaKey),mediaKeyTimestamp:a.mediaKeyTimestamp==null?null:d("WATimeUtils").castToUnixTime(d("WALongInt").numberOrThrowIfTooLarge(a.mediaKeyTimestamp))})}function s(a){if(a==null)return null;return a.scanLengths==null||a.sidecar==null?null:{sidecar:a.sidecar,scanLengths:a.scanLengths.map(function(a){return d("WAProgressiveJpegGetScanLengths").asProgressiveJpegScanLength(d("WALongInt").numberOrThrowIfTooLarge(a))})}}function t(a){a=d("decodeProtobuf").decodeProtobuf(d("WAMediaEntryData.pb").MediaEntrySpec,a);var b=a.serverMediaType,c=a.mediaKey,e=a.mediaKeyTimestamp,f=a.uploadToken,g=a.downloadableThumbnail,h=a.progressiveJpegDetails,k=a.size,l=a.lastDownloadAttemptTimestamp,m=a.sidecar,n=a.directPath,o=a.objectId;a=babelHelpers.objectWithoutPropertiesLoose(a,["serverMediaType","mediaKey","mediaKeyTimestamp","uploadToken","downloadableThumbnail","progressiveJpegDetails","size","lastDownloadAttemptTimestamp","sidecar","directPath","objectId"]);var p=null;h!=null&&h.scanLengths!=null&&h.sidecar!=null&&(p={sidecar:h.sidecar,scanLengths:h.scanLengths.map(function(a){return d("WAProgressiveJpegGetScanLengths").asProgressiveJpegScanLength(d("WALongInt").numberOrThrowIfTooLarge(a))})});h=d("WADirectPath").validateDirectPath(n);return babelHelpers["extends"]({},a,{objectId:o,directPath:h.success?h.value:void 0,sidecar:m,serverMediaType:b==null?null:d("WAServerMediaType").castToServerMediaType(b),mediaKey:c&&i(c),mediaKeyTimestamp:e==null?null:d("WATimeUtils").castToUnixTime(d("WALongInt").numberOrThrowIfTooLarge(e)),uploadToken:f&&j(f),progressiveJpegDetails:p,downloadableThumbnail:g&&r(g),size:d("WALongInt").maybeNumberOrThrowIfTooLarge(k),lastDownloadAttemptTimestamp:l==null?null:d("WATimeUtils").castToUnixTime(d("WALongInt").numberOrThrowIfTooLarge(l))})}function u(a){var b=a.directPath,c=a.fileEncSha256,e=a.fileSha256,f=a.mediaKey,g=a.serverMediaType;if(f==null)return d("WAResultOrError").makeError("media-entry-invalid-media-key");else if(b==null)return d("WAResultOrError").makeError("media-entry-invalid-direct-path");else if(c==null)return d("WAResultOrError").makeError("media-entry-invalid-file-enc-sha256");else if(e==null)return d("WAResultOrError").makeError("media-entry-invalid-file-sha256");else if(g==null)return d("WAResultOrError").makeError("media-entry-invalid-server-media-type");return d("WAResultOrError").makeResult(babelHelpers["extends"]({},a,{directPath:b,fileEncSha256:c,fileSha256:e,mediaKey:f,serverMediaType:g}))}function v(a){var b=a.directPath,c=a.fileEncSha256,e=a.fileSha256,f=a.mediaKey,g=[];f==null?g.push("media-entry-invalid-media-key"):b==null?g.push("media-entry-invalid-direct-path"):c==null?g.push("media-entry-invalid-file-enc-sha256"):e==null&&g.push("media-entry-invalid-file-sha256");return f!=null&&b!=null&&c!=null&&e!=null?d("WAResultOrError").makeResult(babelHelpers["extends"]({},a,{directPath:b,fileEncSha256:c,fileSha256:e,mediaKey:f})):d("WAResultOrError").makeError(g)}function w(a){var b="image/jpeg";switch(a){case"image":b="image/jpeg";break;case"ptt":b="audio/wav";break;case"video":b="video/mp4";break;case"gif":b="image/gif";break;case"sticker":b="image/webp";break;case"preview":b="image/jpeg";break;case"document":b=d("WAGlobals").getConfig().isOctetStreamAttachmentMimeTypeEnabled()===!0?"application/octet-stream":"application/pdf";break;case"xma-image":b="image/jpeg";break;default:throw c("err")("Unsupported server media type: "+a)}return b}var x=function(){return"TransformStream"in self};g.createMediaKey=h;g.castToMediaKey=i;g.createUploadToken=a;g.castToUploadToken=j;g.castToStreamingSidecar=k;g.stringToDeliveryObjectId=b;g.stringToBackupEntFbid=e;g.mediaEntryDataToRawData=f;g.rawDataToMediaEntry=l;g.encodeMediaEntryForUpload=m;g.encodeMediaEntryWithUpdatedPath=n;g.encodeMediaEntryDownloadableThumbnailWithUpdatedPath=o;g.encodeMediaEntryWithUpdatedFbid=p;g.encodeMediaEntryWithUpdatedObjectId=q;g.convertMediaDownloadableThumbnailToDownloadableThumbnail=r;g.decodeMediaEntryData=t;g.validateDecodedMediaEntryForDownload=u;g.validateDownloadableThumbnailForDownload=v;g.getMimeTypeFromServerMediaType=w;g.isTransformStreamSupported=x}),98);
__d("MAWDbMedia",["I64","WAMediaUtils","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h,i="Image",j="Video",k="Ptt",l="Gif",m="Sticker",n="DocumentFile",o={DOCUMENT_FILE:n,GIF:l,IMAGE:i,PTT:k,STICKER:m,VIDEO:j};function a(a){return a}function b(a){return a}function c(a){return(h||(h=d("I64"))).of_float(a)}function e(a){return(h||(h=d("I64"))).to_float(a)}function f(a,b){a=a.mediaEntries.get(b);if(a==null)return d("WAResultOrError").makeError("missing-media-entry");b=d("WAMediaUtils").decodeMediaEntryData(a);a=b.serverMediaType;return a==null?d("WAResultOrError").makeError("missing-server-media-type"):d("WAResultOrError").makeResult(a)}g.IMAGE=i;g.VIDEO=j;g.PTT=k;g.GIF=l;g.STICKER=m;g.DOCUMENT_FILE=n;g.MEDIA_TYPE=o;g.convertNumberToMediaId=a;g.convertToMediaId64=b;g.convertMediaIdToMediaId64=c;g.convertMediaId64ToMediaId=e;g.getServerMediaType=f}),98);
__d("MAWHexUtils",["FBLogger"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=a.toString(16);return(a.length-1).toString(16)+a}function b(a){for(var b=1;b<a.length;b++){var d=a.substring(0,b),e=a.substring(b);if(e.length-1===parseInt(d,16))return parseInt(e,16)}throw c("FBLogger")("messenger_web").mustfixThrow("Cannot convert the order-preserving-hex back to number")}g.orderPreservingHex=a;g.reverseOrderPreservingHex=b}),98);
__d("WAMsg",["WAAssertUnreachable","WAJids","WAMsgType","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.author,c=a.chat;a=a.externalId;return c+"_"+a+"_"+b}function h(a){switch(a.type){case d("WAMsgType").MSG_TYPE.TEXT:case d("WAMsgType").MSG_TYPE.IMAGE:case d("WAMsgType").MSG_TYPE.VIDEO:case d("WAMsgType").MSG_TYPE.PTT:case d("WAMsgType").MSG_TYPE.GIF:case d("WAMsgType").MSG_TYPE.STICKER:case d("WAMsgType").MSG_TYPE.RECEIVER_FETCH:return{author:a.id.author,deleteTs:a.deleteTs,ephemeralSetting:a.ephemeralSetting,expirationTs:a.expirationTs,externalId:a.id.externalId,sentTs:a.sentTs,serverTs:a.serverTs,ts:a.ts};case d("WAMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("WAMsgType").MSG_TYPE.UNAVAILABLE:return{author:a.id.author,externalId:a.id.externalId,sentTs:a.sentTs,ts:a.ts};default:a.type;return null}}function b(a){var b=h(a);if(b==null)return null;switch(a.type){case d("WAMsgType").MSG_TYPE.TEXT:return babelHelpers["extends"]({},b,{msgContent:a.msgContent,type:d("WAMsgType").MSG_TYPE.TEXT});case d("WAMsgType").MSG_TYPE.IMAGE:return babelHelpers["extends"]({},b,{mediaId:a.mediaId,type:d("WAMsgType").MSG_TYPE.IMAGE});case d("WAMsgType").MSG_TYPE.VIDEO:return babelHelpers["extends"]({},b,{mediaId:a.mediaId,type:d("WAMsgType").MSG_TYPE.VIDEO});case d("WAMsgType").MSG_TYPE.PTT:return babelHelpers["extends"]({},b,{mediaId:a.mediaId,type:d("WAMsgType").MSG_TYPE.PTT});case d("WAMsgType").MSG_TYPE.STICKER:return babelHelpers["extends"]({},b,{mediaId:a.mediaId,type:d("WAMsgType").MSG_TYPE.STICKER});case d("WAMsgType").MSG_TYPE.RECEIVER_FETCH:return babelHelpers["extends"]({},b,{type:d("WAMsgType").MSG_TYPE.RECEIVER_FETCH});case d("WAMsgType").MSG_TYPE.GIF:return babelHelpers["extends"]({},b,{mediaId:a.mediaId,type:d("WAMsgType").MSG_TYPE.PTT});case d("WAMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:return babelHelpers["extends"]({},b,{type:d("WAMsgType").MSG_TYPE.EXPIRED_EPHEMERAL});case d("WAMsgType").MSG_TYPE.UNAVAILABLE:return babelHelpers["extends"]({},b,{type:d("WAMsgType").MSG_TYPE.UNAVAILABLE});case d("WAMsgType").MSG_TYPE.REVOKED:case d("WAMsgType").MSG_TYPE.REACTION:case d("WAMsgType").MSG_TYPE.ICDC_ALERT:case d("WAMsgType").MSG_TYPE.ADMIN:case d("WAMsgType").MSG_TYPE.FUTUREPROOF:case d("WAMsgType").MSG_TYPE.CIPHERTEXT:case d("WAMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("WAMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:case d("WAMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE:case d("WAMsgType").MSG_TYPE.GROUP_INVITE:case d("WAMsgType").MSG_TYPE.DELETE_FOR_ME:case d("WAMsgType").MSG_TYPE.DOCUMENT_FILE:case d("WAMsgType").MSG_TYPE.EDIT_ACTION:return null;default:return c("WAAssertUnreachable")(a.type)}}function e(a){if(d("WAJids").isAuthorSystem(a.author))throw c("err")("Cannot send @system messages");else return{author:a.author,chat:a.chat,externalId:a.externalId}}g.craftWAMsgIdString=a;g.asQuotedMsg=b;g.asProtocolMsgId=e}),98);
__d("MAWDbMsg",["FBLogger","I64","MAWDbChatId__UNSAFE_DO_NOT_USE","MAWHexUtils","MAWMsgType","WAMsg"],(function(a,b,c,d,e,f,g){"use strict";var h,i;i=[(i=d("MAWMsgType")).MSG_TYPE.REVOKED,i.MSG_TYPE.EPHEMERAL_SYNC_RESPONSE,i.MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE,i.MSG_TYPE.GROUP_INVITE,i.MSG_TYPE.SK_DISTRIBUTION,i.MSG_TYPE.RAVEN_ACTION];var j=0,k=Number.MAX_SAFE_INTEGER;function a(a){return a}function b(a){return a}function e(a){return y(a)?a:null}function f(a){return a}function l(a){return a}var m="futureproof",n="futureproof_spam",o="spam",p="toBeRead",q="e2ee_admin_msg",r="cutover_admin_msg";function s(a,b){return d("MAWHexUtils").orderPreservingHex(a)+"_"+d("MAWHexUtils").orderPreservingHex(b)+"_m"}function t(a,b,c){a=d("MAWHexUtils").orderPreservingHex(a)+"_"+d("MAWHexUtils").orderPreservingHex(b)+"_m";return a+"_"+c.externalId}function u(a,b){return d("MAWHexUtils").orderPreservingHex(a)+"_"+d("MAWHexUtils").orderPreservingHex(b)+"_um"}function v(a,b){return d("MAWHexUtils").orderPreservingHex(a)+"_"+d("MAWHexUtils").orderPreservingHex(b)+"_r"}function w(a,b,c){c=c!=null?c:d("MAWHexUtils").orderPreservingHex(Math.floor(Math.random()*1e4));return d("MAWHexUtils").orderPreservingHex(a)+"_"+d("MAWHexUtils").orderPreservingHex(b)+"_DEBUG_"+c+")}"}function x(a){a=a.split("_");return a.length>=3&&a[0]!==""&&a[1]!==""&&a[2]==="m"}function y(a){var b=/^(.*)\..*?$/;b=b.test(a);return x(a)||b}function z(a){return d("MAWDbChatId__UNSAFE_DO_NOT_USE").craftAltIndex__DEPRECATED(a,p)}function A(a){return d("MAWDbChatId__UNSAFE_DO_NOT_USE").craftAltIndex__DEPRECATED(a,q)}function B(a){return d("MAWDbChatId__UNSAFE_DO_NOT_USE").craftAltIndex__DEPRECATED(a,r)}function C(a){if(!x(a))return 0;a=a.split("_");a[0];a=a[1];return d("MAWHexUtils").reverseOrderPreservingHex(a)}function D(a){return d("MAWHexUtils").orderPreservingHex(a)+"_"}function E(a){return d("MAWHexUtils").orderPreservingHex(a)+"_z"}function F(a){switch(a.type){case d("MAWMsgType").MSG_TYPE.XMA:return!0;case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case d("MAWMsgType").MSG_TYPE.TEXT:case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.REVOKED:case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:case d("MAWMsgType").MSG_TYPE.RAVEN:case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_UPDATE:return!1}throw c("FBLogger")("messenger_web").mustfixThrow('Invalid msg type for isXMAMsg check: "%s"',a.type)}function G(a){switch(a.type){case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case d("MAWMsgType").MSG_TYPE.RAVEN:return!0;case d("MAWMsgType").MSG_TYPE.TEXT:case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.REVOKED:case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:case d("MAWMsgType").MSG_TYPE.XMA:case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_UPDATE:return!1}throw c("FBLogger")("messenger_web").mustfixThrow('Invalid msg type for isMediaMsg check: "%s"',a.type)}function H(a){return a.type===d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH}function I(a){switch(a.type){case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:return!0;case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case d("MAWMsgType").MSG_TYPE.RAVEN:case d("MAWMsgType").MSG_TYPE.TEXT:case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.REVOKED:case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:case d("MAWMsgType").MSG_TYPE.XMA:case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:return!1;default:c("FBLogger")("messenger_web").mustfix('Invalid msg type for isPhotoOrVideoMediaMsg check: "%s"',a.type);return!1}}function J(a){switch(a.type){case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return!0;case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.RAVEN:case d("MAWMsgType").MSG_TYPE.TEXT:case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.REVOKED:case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:case d("MAWMsgType").MSG_TYPE.XMA:case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:return!1;default:c("FBLogger")("messenger_web").mustfix('Invalid msg type for isDocumentFileMediaMsg check: "%s"',a.type);return!1}}function K(a){switch(a.type){case d("MAWMsgType").MSG_TYPE.TEXT:case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case d("MAWMsgType").MSG_TYPE.REVOKED:case d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME:case d("MAWMsgType").MSG_TYPE.XMA:case d("MAWMsgType").MSG_TYPE.RAVEN:case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:return!0;case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE:case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:case d("MAWMsgType").MSG_TYPE.SK_DISTRIBUTION:case d("MAWMsgType").MSG_TYPE.RAVEN_ACTION:case d("MAWMsgType").MSG_TYPE.EDIT_ACTION:return!1}throw c("FBLogger")("messenger_web").mustfixThrow('Invalid msg type for isContentMsg check: "%s"',a.type)}function L(a){switch(a.type){case d("MAWMsgType").MSG_TYPE.TEXT:case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case d("MAWMsgType").MSG_TYPE.XMA:case d("MAWMsgType").MSG_TYPE.RAVEN:case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:return!0;case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE:case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:case d("MAWMsgType").MSG_TYPE.REVOKED:case d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME:case d("MAWMsgType").MSG_TYPE.SK_DISTRIBUTION:case d("MAWMsgType").MSG_TYPE.EDIT_ACTION:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:return!1}throw c("FBLogger")("messenger_web").mustfixThrow('Invalid msg type for isMsgEligibleForTriggeringEphemeralSyncResponse check: "%s"',a.type)}function M(a){return O(a.type)}function N(a){return a.type===d("MAWMsgType").MSG_TYPE.ADMIN}function O(a){return a==="EphemeralSyncResponse"||a==="EphemeralSettingChangeFromCurrentDevice"||a==="GroupInvite"||a==="SenderKeyDistribution"||a==="RavenAction"||a==="EditAction"}function P(a){return a==="RavenAction"}function Q(a){return a.originalTs!=null?a.originalTs:R(a)}function R(a){return a.serverTs!=null?a.serverTs:a.ts}function S(a){if(a.sortOrderMs!=null)return a.sortOrderMs;else return R(a)*1e3}function T(a,b){if(a.serverTs!=null)return Math.max(b+1,a.serverTs*1e3);else return b+1}function U(a){switch(a.type){case d("MAWMsgType").MSG_TYPE.TEXT:return a.msgContent;case d("MAWMsgType").MSG_TYPE.EDIT_ACTION:return a.editMsgContent;case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case d("MAWMsgType").MSG_TYPE.REVOKED:case d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME:case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE:case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:case d("MAWMsgType").MSG_TYPE.XMA:case d("MAWMsgType").MSG_TYPE.RAVEN:case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:return}throw c("FBLogger")("messenger_web").mustfixThrow('Invalid msg type for getMsgContent check: "%s"',a.type)}function V(a){return d("WAMsg").craftWAMsgIdString({author:a.author,chat:a.threadJid,externalId:a.externalId})}function W(a){return(h||(h=d("I64"))).to_float(a)}g.NO_CONTENT_MESSAGE_TYPES_ALLOWLIST=i;g.MIN_MSG_SORT_ORDER=j;g.MAX_MSG_SORT_ORDER=k;g.toCachedMsgId__UNSAFE_DO_NOT_USE=a;g.toMsgId__UNSAFE_DO_NOT_USE=b;g.toMsgId=e;g.stanzaIdToMsgId=f;g.instamadilloMsgIdToMsgId=l;g.FUTUREPROOF_ALT_INDEX=m;g.FUTUREPROOF_SPAM_ALT_INDEX=n;g.SPAM_ALT_INDEX=o;g.craftMsgId__DEPRECATED=s;g.craftMsgIdV2=t;g.craftUnrenderedMsgId=u;g.craftReactionId=v;g.craftDebugMsgId=w;g.isValidMsgId=y;g.craftToBeReadAltIndex=z;g.craftE2eeAdminMsgAltIndex=A;g.craftCutoverAdminMsgAltIndex=B;g.getInChatMsgIdFromMsgId=C;g.msgIdsInChatLowerBound=D;g.msgIdsInChatUpperBound=E;g.isXMAMsg=F;g.isMediaMsg=G;g.isReceiverFetchStickerMsg=H;g.isPhotoOrVideoMediaMsg=I;g.isDocumentFileMediaMsg=J;g.isContentMsg=K;g.isMsgEligibleForTriggeringEphemeralSyncResponse=L;g.isUnrenderedMsg=M;g.isAdminMsg=N;g.isUnrenderedMsgType=O;g.isRavenActionMsgType=P;g.getOriginalTsFromMsg=Q;g.getCanonicalTsFromMsg=R;g.getSortOrderWithFallback=S;g.getSortOrderFromPrevious=T;g.getMsgContent=U;g.getWAMsgId=V;g.convertMsgRowId64=W}),98);
__d("MAWMessagesDirection",["I64","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){return c("err")("Unhandled direction: "+a)}function a(a,b){return k(a,{asc:b.maxTimestampMs,desc:b.minTimestampMs})}function b(a,b){return k(a,{asc:b.maxMessageId,desc:b.minMessageId})}function e(a,b){return b==="desc"&&(h||(h=d("I64"))).equal(a.maxTimestampMs,(h||(h=d("I64"))).max_int)&&a.minMessageId===a.maxMessageId&&a.hasMoreBefore&&!a.hasMoreAfter}function f(a){return k(a,{asc:"after",desc:"before"})}function j(a){return l(a,{after:"asc",before:"desc"})}function k(a,b){var c=b.asc;b=b.desc;switch(a){case"asc":return c;case"desc":return b;default:a;throw i(a)}}function l(a,b){var c=b.after;b=b.before;switch(a){case"after":return c;case"before":return b;default:a;throw i(a)}}g.unhandledDirectionError=i;g.getI64RangeTimestampForDirection=a;g.getRangeMsgIdForDirection=b;g.isFirstPageRange=e;g.translateMwpDirectionToMawDirection=f;g.translateMawDirectionToMwpDirection=j;g.switchOnMWPMessagesDirection=k;g.switchOnMAWMessagesDirection=l}),98);
__d("MAWMessagesCompare",["MAWMessagesDirection"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return function(b,c){if(c.sortOrderMs==null||b.sortOrderMs==null)return 0;if(b.sortOrderMs===c.sortOrderMs){var d,e;d=(d=b.externalId)!=null?d:"";e=(e=c.externalId)!=null?e:"";if(a!=null){d=a.has(d);e=a.has(e);if(d&&!e)return-1;else if(!d&&e)return 1}return((d=c.externalId)!=null?d:"").localeCompare((e=b.externalId)!=null?e:"")}return c.sortOrderMs-b.sortOrderMs}}var i=h(),j=function(a,b){return-1*h()(a,b)};function a(a){return d("MAWMessagesDirection").switchOnMWPMessagesDirection(a,{asc:j,desc:i})}g.makeCompareMessageMetadataForDescOrderFn=h;g.getSortComparisonFunctionForDirection=a}),98);
__d("MAWEBMsgsWithSameSortOrderFix",["MAWMessagesCompare","MAWMessagesDirection","qex"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(b==null)return a;b=(b=c("qex")._("23"))!=null?b:0;return a+b}function b(a){var b=a.direction,d=a.ebFetchResult,e=a.msgCount;a=a.referenceExternalId;if(!c("qex")._("18"))return d;e=h({direction:b,includeReferenceExternalId:!0,msgCount:e,referenceExternalId:a,sourceMsgs:[].concat(d.messages)});return babelHelpers["extends"]({},d,{hasMoreAfter:l({ebFetchResult:d,fetchDirection:b,fixedMessages:e,hasMoreDirection:"after"}),hasMoreBefore:l({ebFetchResult:d,fetchDirection:b,fixedMessages:e,hasMoreDirection:"before"}),messages:e})}function h(a){var b=a.direction,e=a.includeReferenceExternalId,f=a.msgCount,g=a.referenceExternalId;a=a.sourceMsgs;if(!c("qex")._("18"))return a;var h=k(a,b),l=d("MAWMessagesCompare").getSortComparisonFunctionForDirection(h);a=a.toSorted(l);l=a.findIndex(function(a){return a.externalId===g});if(m({fetchDirection:b,msgsDirection:h})){l=i({includeReferenceExternalId:e,referenceMsgIndex:l});return a.slice(l,l+f)}else{l=j({includeReferenceExternalId:e,msgsCount:a.length,referenceMsgIndex:l});b=Math.max(0,l-f+1);return a.slice(b,l+1)}}function i(a){var b=a.includeReferenceExternalId;a=a.referenceMsgIndex;return a===-1?0:b?a:a+1}function j(a){var b=a.includeReferenceExternalId,c=a.msgsCount;a=a.referenceMsgIndex;return a===-1?c-1:b?a:a-1}function k(a,b){var c;c=(c=a.find(function(a){return a.sortOrderMs!=null}))==null?void 0:c.sortOrderMs;a=(a=a.findLast(function(a){return a.sortOrderMs!=null}))==null?void 0:a.sortOrderMs;return c==null||a==null?d("MAWMessagesDirection").translateMawDirectionToMwpDirection(b):c>=a?"desc":"asc"}function l(a){var b=a.ebFetchResult,c=a.fetchDirection,e=a.fixedMessages;a=a.hasMoreDirection;if(c!==a||b.messages.length===0)return d("MAWMessagesDirection").switchOnMAWMessagesDirection(a,{after:b.hasMoreAfter,before:b.hasMoreBefore});if(e.length===0)return!0;var f=k(b.messages,c),g=d("MAWMessagesCompare").getSortComparisonFunctionForDirection(f);g=b.messages.toSorted(g);m({fetchDirection:c,msgsDirection:f})?(c=g[0],f=e[0]):(c=g[g.length-1],f=e[e.length-1]);return c.externalId===f.externalId?d("MAWMessagesDirection").switchOnMAWMessagesDirection(a,{after:b.hasMoreAfter,before:b.hasMoreBefore}):!0}function m(a){var b=a.fetchDirection;a=a.msgsDirection;return b==="before"&&a==="desc"||b==="after"&&a==="asc"}g.overFetchEBMsgsIfNeeded=a;g.fixEBFetchResultPagination=b;g.fixEBMessagesPagination=h}),98);
__d("MAWEBDeanonFetch",["EBMessageMetadataQuery","FBLogger","MAWEBMsgsWithSameSortOrderFix","WAJids","WAResultOrError","getErrorSafe"],(function(a,b,c,d,e,f,g){"use strict";async function a(a){var b=a.chatJid,e=a.count,f=a.direction,g=a.includeReferenceTimestamp,h=a.referenceExternalId,i=a.referenceTimestampMs;a=a.sortFn;try{var j=d("MAWEBMsgsWithSameSortOrderFix").overFetchEBMsgsIfNeeded(e,h);j=await d("EBMessageMetadataQuery").messageMetadataQueryForMainThreadMAWDeanon({direction:f,includeAnonymizedMessages:!1,numberOfMessages:j,referenceTimestamp:i,threadId:d("WAJids").threadIdForChatJid(b)});if(j.success===!1)return d("WAResultOrError").DEPRECATED_makeError("error",j.payload);b=j.value.messages;j=b.reduce(function(a,b){var c=b.offlineThreadingId;b=b.sortOrderMs;if(c==null||b==null)return a;b=Number(b);if(g!==!0&&b===i)return a;a.push({externalId:c,msgType:"unknown-deanon",sortOrderMs:b});return a},[]);b=d("MAWEBMsgsWithSameSortOrderFix").fixEBMessagesPagination({direction:f,includeReferenceExternalId:g,msgCount:e,referenceExternalId:h,sourceMsgs:j});f=a==null?b:b.sort(a);return d("WAResultOrError").makeResult(f)}catch(a){e=c("getErrorSafe")(a);c("FBLogger")("messenger_web_missing_messages").catching(e).mustfix("Deanon GraphQL fails with error");return d("WAResultOrError").DEPRECATED_makeError("request-error",e)}}g.fetchMessagesMetadataFromEBDeanon=a}),98);
__d("MAWEphemeralMsgAutoResetSystemId",[],(function(a,b,c,d,e,f){"use strict";a="-111111";b=a;f["default"]=b}),66);
__d("MAWFetchExternalIdUsingCache",["FBLogger","LSDatabaseSingleton","MAWBridgeSendAndReceive","MAWDbMsg","WAStanzaUtils"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new Map();async function a(a){if(a==="")return null;var b=k(a);if(b!=null)return b;b=await j(a);if(b!=null){l(a,b);return b}try{b=d("MAWDbMsg").toMsgId(a);if(b==null){c("FBLogger")("messenger_web").warn("[MAWFetchProtocolMessageIdUsingCache] failed fetch external id, invalid msgId %s",a);return null}b=await d("MAWBridgeSendAndReceive").sendAndReceive("backend","getProtocolMsgIdByMsgId",{msgId:b});if((b==null?void 0:b.externalId)==null){c("FBLogger")("messenger_web").warn("[MAWFetchProtocolMessageIdUsingCache] external id for msgId %s not found",a);return null}l(a,b.externalId);return b.externalId}catch(a){c("FBLogger")("messenger_web").catching(a).mustfix("[MAWFetchProtocolMessageIdUsingCache] getProtocolMsgIdByMsgId bridge call failed");throw a}}async function j(a){var b=await (h||(h=d("LSDatabaseSingleton"))).LSDatabaseSingleton;b=await b.tables.messages.index("messageId").get(a);return b!=null?d("WAStanzaUtils").toStanzaId(b.offlineThreadingId):null}function k(a){return i.get(a)}function l(a,b){if(a==="")return!1;i.set(a,b);return!0}g.fetchExternalIdUsingCache=a;g.populateExternalIdCache=l}),98);
__d("MAWFrontendMediaUtils",["MAWDbMedia"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){if(a==="image/gif")return{mediaType:d("MAWDbMedia").MEDIA_TYPE.GIF,serverMediaType:"gif"};if(a==="image/webp"&&b!==!0)return{mediaType:d("MAWDbMedia").MEDIA_TYPE.STICKER,serverMediaType:"sticker"};c=c!=null?c:a.split("/")[0];switch(c){case"image":if(b===!0)return{mediaType:d("MAWDbMedia").MEDIA_TYPE.IMAGE,serverMediaType:"xma-image"};else return{mediaType:d("MAWDbMedia").MEDIA_TYPE.IMAGE,serverMediaType:"image"};case"video":return{mediaType:d("MAWDbMedia").MEDIA_TYPE.VIDEO,serverMediaType:"video"};case"audio":return{mediaType:d("MAWDbMedia").MEDIA_TYPE.PTT,serverMediaType:"ptt"};case"application":default:return{mediaType:d("MAWDbMedia").MEDIA_TYPE.DOCUMENT_FILE,serverMediaType:"document"}}}g.getMediaTypeAndServerMediaTypeFromBlob=a}),98);
__d("WALRUMap",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a){a=a.max;this.$1=new Map();this.$2=a}var b=a.prototype;b.has=function(a){return this.$1.has(a)};b.get=function(a){return this.$1.get(a)};b.set=function(a,b){this.$1["delete"](a);this.$1.set(a,b);if(this.$1.size>this.$2){a=this.$1.keys().next().value;a!=null&&this.$1["delete"](a)}};b["delete"]=function(a){this.$1["delete"](a)};b.clear=function(){this.$1.clear()};b.size=function(){return this.$1.size};return a}();f.LRUMap=a}),66);
__d("WARandomHex",["WACryptoDependencies","WAHex"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=new Uint8Array(a);d("WACryptoDependencies").getCrypto().getRandomValues(a);return d("WAHex").toHex(a)}g.randomHex=a}),98);
__d("MAWJobActionsV2",["MAWTransactionMode","Promise","WALRUMap","WARandomHex","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){return new(h||(h=b("Promise")))(function(b,c){a.onsuccess=b,a.onerror=c})}function j(a){return i(a).then(function(a){return a.target.result})}function k(a,c,e){return new(h||(h=b("Promise")))(function(b,f){var g=a(d("MAWTransactionMode").READONLY).index(c);g=g.openCursor(IDBKeyRange.only(e));var h=[];g.onsuccess=function(a){a=a.target.result;if(!a){b(h);return}h.push(a.value);a["continue"]()};g.onerror=function(a){return f(a)}})}var l=new(d("WALRUMap").LRUMap)({max:100});function a(a,c){var e=c.args,f=c.scheduleConfig,g=c.type,i=c.uniqKey;c=c.version;c=c===void 0?1:c;var l=JSON.stringify([g,i!=null?i:d("WARandomHex").randomHex(32)]),n={backedOffCount:0,current:e,original:e,scheduleConfig:f,startTime:d("WATimeUtils").unixTime(),step:"$unstarted",stepFirstStartTime:null,stepHardStartCountAfterTimeout:0,stepUnexpectedErrorCount:0,type:g,uniqKey:l,version:c,waitUntil:null},o=function(){var b,c=a().add(n),d=j(c);if(n.uniqKey==null&&typeof ((b=c.transaction)==null?void 0:b.commit)==="function")try{c.transaction.commit()}catch(a){}return d.then(function(a){return{id:a,newlyCreated:!0}})};if(i!=null)return k(a,"uniqKey",l).then(function(c){if(c.length===0)return o();var d=[],e=null;c.forEach(function(b){b.step!=="$finished"?e=b:d.push(m(a,b.jobId))});return(h||(h=b("Promise"))).all(d).then(function(){return e!=null?{id:e.jobId,newlyCreated:!1}:o()})});else return o()}function m(a,b){return j(a()["delete"](b))}function e(a,b){return j(a().get(b))}function f(a,b){return j(a().put(b))}function n(a){return j(a().getAll())}function o(a){try{return i(a().clear()).then(c("emptyFunction"))}catch(a){if(a.name==="NotFoundError")return(h||(h=b("Promise"))).resolve();throw a}}g.recentFinishedJobsCache=l;g.maybeCreateJob=a;g.deletePersistedJob=m;g.readPersistedJob=e;g.updatePersistedJob=f;g.readAllPersistedJobs=n;g.clearJobs=o}),98);
__d("MAWMessagesPaginationUtils",["FBLogger","MAWFetchExternalIdUsingCache","MAWMessagesDirection","WAStanzaUtils","qex"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){a=d("MAWMessagesDirection").getRangeMsgIdForDirection(a,b);return h(a)}function b(a){c("qex")._("18")&&a.forEach(function(a){return d("MAWFetchExternalIdUsingCache").populateExternalIdCache(a.msgId.toString(),d("WAStanzaUtils").toStanzaId(a.externalId))})}async function h(a){if(a==null||a==="")return null;if(!c("qex")._("18"))return null;var b=await d("MAWFetchExternalIdUsingCache").fetchExternalIdUsingCache(a);b==null&&c("FBLogger")("messenger_web").mustfix("[MAWMessagesPaginationUtils] getExternalIdByMsgId for msgId: %s returned null",a);return b}function e(a,b,c){if(a===b)return Promise.resolve(c);else return i(b)}async function i(a){if(!c("qex")._("18"))return{maxExternalId:null,minExternalId:null};var b=await h(a.minMessageId);a=await h(a.maxMessageId);return{maxExternalId:a==null?void 0:a.toString(),minExternalId:b==null?void 0:b.toString()}}g.getRangeExternalIdForDirection=a;g.populateExternalIdCache=b;g.getExternalIdByMsgId=h;g.getMessagesRangesV2ExternalIdsIfChanged=e;g.getMessagesRangesV2ExternalIds=i}),98);
__d("MAWMiActOnActThreadReadyWithoutValidator",["I64","MAWMiActGetThreadLifecycleState","MAWMiActOnActThreadReadyInstrumentation","MAWMiActOnActThreadReadyQueue","MAWMiActThreadLifecycleState","MWFBLogger","emptyFunction","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MiActMapping] Enqueue by thread key: ",", threadState: ",", threadKey: "," on act thread ready"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MiActMapping] Executing thread action: ",", threadState: ",", threadKey: "," on act thread ready"]);j=function(){return a};return a}var k=d("MWFBLogger").MWLogger.tags(["Occam","MiActMapping"]);async function l(a,b,e,f,g,l){var m=d("MAWMiActOnActThreadReadyInstrumentation").getOnActThreadReadyInstanceKey(e);d("MAWMiActOnActThreadReadyInstrumentation").startQPL(m,e,b,"onActThreadReady");d("MAWMiActOnActThreadReadyInstrumentation").addPointQPL(m,"get_thread_lifecycle_state_by_thread_key_start");l=l||await d("MAWMiActGetThreadLifecycleState").getThreadLifecycleStateByThreadKey(a,b,e);d("MAWMiActOnActThreadReadyInstrumentation").addPointQPL(m,"get_thread_lifecycle_state_by_thread_key_end");d("MAWMiActOnActThreadReadyInstrumentation").addAnnotationsQPL(m,{string:{threadState:l.type}});switch(l.type){case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.MI_AND_ACT_THREAD_COMPLETE:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.OPTIMISTIC_THREAD_WITH_ACT:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.CLIENT_PARTIAL_MI_THREAD_WITH_ACT:k.DEBUG(j(),e,l.type,(h||(h=d("I64"))).to_string(b));d("MAWMiActOnActThreadReadyInstrumentation").endSuccessQPL(m);return f(b,l.jid);case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.THREAD_KEY_ONLY:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.AUTHORITATIVE_THREAD_MISSING_MAPPING_ROW:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.OPTIMISTIC_THREAD_NO_ACT:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.AUTHORITATIVE_THREAD_ONLY:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.CLIENT_PARTIAL_MI_THREAD:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.SERVER_PARTIAL_MI_THREAD:k.DEBUG(i(),e,l.type,(h||(h=d("I64"))).to_string(b));return d("MAWMiActOnActThreadReadyQueue").enqueueByThreadKey(b,f,g!=null?g:c("emptyFunction"),e,l.type,m);case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.JID_MISSING_MI_THREAD:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.JID_MISSING_MAPPING_ROW:d("MAWMiActOnActThreadReadyInstrumentation").endFailureQPL(m,"jid_missing_mi_or_mapping_state");throw k.mustfixThrow("Unhandled onActThreadReady for threadKey:%s, thread action: %s",(h||(h=d("I64"))).to_string(b),e);default:l.type;throw k.mustfixThrow(" Unreachable miActThreadState.type: %s",l.type)}}function a(a,b,d){return new Promise(function(e,f){l(a,b,d,function(a,b){e({chatJid:b,serverThreadKey:a});return Promise.resolve()},function(a){return f(c("err")("Timed out waiting for ACT thread to be ready in %s. Thread state: %s",d,a))}).catch(function(){return f()})})}g.onActThreadReadyWithoutValidator=l;g.waitForACTThreadReadyWithoutValidator=a}),98);
__d("MAWMiActOnActThreadReady",["MAWMIC","MAWMiActGetThreadLifecycleState","MAWMiActOnActThreadReadyWithoutValidator","cr:7542","err","promiseDone","sendToSentQPLLogger"],(function(a,b,c,d,e,f,g){"use strict";async function h(a,c,e,f,g){var h=await d("MAWMiActGetThreadLifecycleState").getThreadLifecycleStateByThreadKey(a,c,e),i=h.type,j=async function(d,g){b("cr:7542")&&await b("cr:7542").load().then(function(b){b=b.validateActThreadReady;return b({chatJid:g,description:e,initialMappingStateType:i,tables:a,threadKey:c})});return f==null?void 0:f(d,g)};return d("MAWMiActOnActThreadReadyWithoutValidator").onActThreadReadyWithoutValidator(a,c,e,j,g,h)}function a(a,b,e,f){return new Promise(function(g,i){h(a,b,e,function(a,b){g({chatJid:b,serverThreadKey:a});return Promise.resolve()},function(a){i(c("err")("Timed out waiting for ACT thread to be ready in %s. Thread state: %s",e,a)),c("promiseDone")(d("MAWMIC").getState().then(function(a){f!=null&&d("sendToSentQPLLogger").addSendToSentAnnotations(f,{string:{mic_state:a}})}))}).catch(function(){return i()})})}g.onActThreadReady=h;g.waitForACTThreadReady=a}),98);
__d("MAWXMAUtils",["I64","LSIntEnum","LSXmaContentType","MAWMsgType","WAArmadilloXMA.pb","WALogger","WATimeUtils","gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Hit Unreachable XMAType "," - checking isXMAShare"]);j=function(){return a};return a}function a(a){return!a||a.type!==d("MAWMsgType").MSG_TYPE.XMA?null:a}function b(a){if(a==null)return!1;switch(a){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_CLIPS_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_MULTIPOST_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_IMAGE_POST_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_MENTION:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_MENTION:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_POST_PRIVATE_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_HIGHLIGHTS_TAB_FRIEND_UPDATES_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_HIGHLIGHTS_TAB_LOCAL_EVENT_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_HIGHLIGHT_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_HIGHLIGHT_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_SHORT:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_MEMORIES_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_EVENT:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_PROFILE_DIRECTORY_ITEM:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_RECEIVER_FETCH:return!0;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_POST_MENTION:return c("gkx")("2605");case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_MENTION:return!0;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_LOCATION_SHARING_V2:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_LOCATION_SHARING:return c("gkx")("6952");case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_CONTACT:return c("gkx")("4902");case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_AI_CONTACT:return c("gkx")("9339");case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_PRODUCER_STORY_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_VIDEO_POST_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_IGTV_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SHOP_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REACTION:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_VIDEO_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_GAMING_CUSTOM_UPDATE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_AUDIO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_VIDEO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_AUDIO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_VIDEO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_AUDIO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_VIDEO_CALL:return!1;default:d("WALogger").ERROR(j(),a);return!1}}function e(a){return a!=null&&((h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(c("LSXmaContentType").FB_STORY_REPLY))||(h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(c("LSXmaContentType").FB_STORY_SHARE))||(h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(c("LSXmaContentType").FB_STORY_MENTION))||(h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(c("LSXmaContentType").FB_PRODUCER_STORY_REPLY)))}function f(a){return a===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_SHARE||a===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_SHARE||a===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_SHARE}function k(a){return a===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE}function l(a){return a!=null&&(h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(c("LSXmaContentType").MSG_CONTACT))}function m(a){return a===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_RECEIVER_FETCH}function n(a){return a==null?!1:a===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_SHARE||a===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_SHARE}function o(a){return a===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_POST_PRIVATE_REPLY}function p(a,b){return a!=null&&a||b!=null&&b<d("WATimeUtils").unixTime()}function q(a){a=a.ctas;a!=null&&(a=a.filter(function(a){return a.buttonType!==d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_CTA_BUTTON_TYPE.OPEN_NATIVE}));return a}function r(a){return babelHelpers["extends"]({},a,{ctas:void 0,defaultCTA:void 0,headerTitle:void 0,isTombstoned:!0,maxSubtitleNumOfLines:void 0,maxTitleNumOfLines:void 0,overlayDescription:void 0,overlayIconGlyph:void 0,overlayTitle:void 0,subtitleText:void 0,targetId:void 0,targetUsername:void 0,titleText:void 0})}function s(a){a=babelHelpers["extends"]({},a,{ctas:void 0,defaultCTA:void 0,defaultPreviewMediaId:void 0,defaultPreviewMediaPlaintextHash:void 0,faviconMediaId:void 0,faviconPlaintextHash:void 0,headerMediaId:void 0,headerMediaPlaintextHash:void 0,headerTitle:void 0,isTombstoned:!0,maxSubtitleNumOfLines:void 0,maxTitleNumOfLines:void 0,overlayDescription:void 0,overlayIconGlyph:void 0,overlayTitle:void 0,previewMediaIds:void 0,subtitleText:void 0,targetId:void 0,targetUsername:void 0,titleText:void 0});c("justknobx")._("3897")&&(a.targetExpiringAtSec=void 0);return a}function t(a){switch(a){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_PRODUCER_STORY_REPLY:return!0;default:return!1}}function u(a){return a===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_PRODUCER_STORY_REPLY}function v(a){return a===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REACTION}function w(a){return a===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_MENTION?!0:!1}function x(a){return a===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_POST_MENTION}function y(a){switch(a){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_MENTION:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_MENTION:return!0;default:return!1}}function z(a){return w(a)||y(a)}function A(a){return a===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_IMAGE_POST_SHARE||a===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_MULTIPOST_SHARE||a===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_VIDEO_POST_SHARE}function B(a){return a===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_HIGHLIGHT_SHARE||a===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_HIGHLIGHT_SHARE}function C(a){return a===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_HIGHLIGHTS_TAB_FRIEND_UPDATES_REPLY}function D(a){switch(a){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_AUDIO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_VIDEO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_AUDIO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_VIDEO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_AUDIO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_VIDEO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_GROUP_AUDIO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_GROUP_VIDEO_CALL:return!0;default:return!1}}g.maybeXMAMessage=a;g.isXMAShare_DO_NOT_USE=b;g.isXMAFBStory=e;g.isXMAStoryShare=f;g.isXMAExternalLinkShare=k;g.isXMAContactShare=l;g.isReceiverFetchXMA=m;g.isIGXMAStoryShare=n;g.isXMAPostPrivateReply=o;g.isXMAExpired=p;g.removeCTAsForStoryMentionXMA=q;g.buildUnstoredTombstonedXMA=r;g.buildTombstonedDbXMA=s;g.isXMAStoryReply=t;g.isXMAStoryProducerReply=u;g.isXMAStoryReaction=v;g.isFBXMAStoryMention=w;g.isFBXMAPostMention=x;g.isIGXMAStoryMention=y;g.isXMAStoryMention=z;g.isIGXMAPostShare=A;g.isXMAStoryHighlightShare=B;g.isXMAMsgHighlightsTabFriendUpdatesReply=C;g.isRtcXMA=D}),98);
__d("RetUtil",["LSResult"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return c("LSResult")(a)}g.getNullableRetResult=a}),98);
__d("WAMapWithDefault",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a,b){this.$1=a,b!=null?this.$2=new Map(b):this.$2=new Map()}var b=a.prototype;b.size=function(){return this.$2.size};b.clear=function(){this.$2.clear()};b["delete"]=function(a){return this.$2["delete"](a)};b.get=function(a){var b=this.$2.get(a);if(b!=null)return b;else{b=this.$1(a);this.$2.set(a,b);return b}};b.keys=function(){return this.$2.keys()};b.entries=function(){return this.$2.entries()};b.update=function(b,c){c=new Map(this.$2).set(b,c(this.get(b)));return new a(this.$1,c)};b.toMap=function(){return new Map(this.$2)};return a}();f.MapWithDefault=a}),66);
__d("XPlatReactVoprf",["WAWasmModuleCache","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("LSVoprfWasm").__setRef("XPlatReactVoprf");async function i(){var a=await h.load(),b=a.LSVoprfWasm,c=a.locateFile;a=await b({getWasmModule:function(){return d("WAWasmModuleCache").loadWasmModule(c())}});var e,f;try{e=a.createCurveRistretto();f=a.createVoprfExpTwohashdh(e);b={voprfInfo:{curvePtr:e,voprfPtr:f},voprfWasm:a};return{voprfInstance:b}}catch(b){e!=null&&a.freeCurve(e);f!=null&&a.freeVoprf(f);throw b}}function a(){return Promise.resolve(i())}function b(a){var b=a.voprfInfo;a=a.voprfWasm;var c=b.curvePtr;b=b.voprfPtr;a.freeCurve(c);a.freeVoprf(b)}g.loadXPlatReactVoprf=a;g.freeVoprfInstance=b}),98);/*FB_PKG_DELIM*/
__d("BaseCalloutImpl.react",["BaseContextualLayer.react","BaseContextualLayerAnchorRootContext","BasePopoverReflowSheet.react","LayoutAnimationBoundaryContext","react","react-compiler-runtime","useCometDisplayTimingTrackerForInteraction","useMatchViewport"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react")),j=h.useEffect;function a(a){var b=d("react-compiler-runtime").c(18),e=a.anchorRef,f=a.anchorRefOverride,g=a.anchorRootRefContext,h=a.animationContext,l=a.children,m=a.contextualLayerProps,n=a.imperativeRef,o=a.scrollableAreaContext;a=f===void 0?!1:f;f=c("useCometDisplayTimingTrackerForInteraction")("FDSCalloutManager");var p=c("useMatchViewport")("max","width",600)?c("BasePopoverReflowSheet.react"):i.Fragment,q,r;b[0]!==n||b[1]!==o?(q=function(){var a=o.map(k).filter(Boolean),b=function(){var a;return(a=n.current)==null?void 0:a.reposition()};if(a.length>0){a.forEach(function(a){return a.addEventListener("scroll",b,{passive:!0})});return function(){a.forEach(function(a){return a.removeEventListener("scroll",b,{passive:!0})})}}},r=[n,o],b[0]=n,b[1]=o,b[2]=q,b[3]=r):(q=b[2],r=b[3]);j(q,r);if(m==null||e==null)return null;b[4]!==p||b[5]!==e||b[6]!==a||b[7]!==l||b[8]!==m||b[9]!==n||b[10]!==f?(q=m!=null?i.jsx(p,{children:i.jsx(c("BaseContextualLayer.react"),{align:m.align,anchorRef:a?e:void 0,contextRef:e,disableAutoAlign:m.disableAutoAlign,disableAutoFlip:m.disableAutoFlip,imperativeRef:n,position:m.position,ref:f,reflowToPosition:p!==i.Fragment,children:l})}):null,b[4]=p,b[5]=e,b[6]=a,b[7]=l,b[8]=m,b[9]=n,b[10]=f,b[11]=q):q=b[11];b[12]!==g||b[13]!==q?(r=i.jsx(c("BaseContextualLayerAnchorRootContext").Provider,{value:g,children:q}),b[12]=g,b[13]=q,b[14]=r):r=b[14];b[15]!==h||b[16]!==r?(p=i.jsx(c("LayoutAnimationBoundaryContext").Provider,{value:h,children:r}),b[15]=h,b[16]=r,b[17]=p):p=b[17];return p}function k(a){return a.getDOMNode()}g["default"]=a}),98);
__d("CometNotificationsBadgeCountFragment_viewer.graphql",[],(function(a,b,c,d,e,f){"use strict";a={argumentDefinitions:[{kind:"RootArgument",name:"environment"}],kind:"Fragment",metadata:null,name:"CometNotificationsBadgeCountFragment_viewer",selections:[{alias:null,args:[{kind:"Variable",name:"environment",variableName:"environment"}],kind:"ScalarField",name:"notifications_unseen_count",storageKey:null}],type:"Viewer",abstractKey:null};e.exports=a}),null);
__d("CometNotificationsBadgeCountQuery.graphql",["relay-runtime"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"environment"}];return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"CometNotificationsBadgeCountQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"CometNotificationsBadgeCountFragment_viewer"}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"CometNotificationsBadgeCountQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:[{kind:"Variable",name:"environment",variableName:"environment"}],kind:"ScalarField",name:"notifications_unseen_count",storageKey:null}],storageKey:null}]},params:{id:"10004682126249141",metadata:{},name:"CometNotificationsBadgeCountQuery",operationKind:"query",text:null}}}();b("relay-runtime").PreloadableQueryRegistry.set(a.params.id,a);e.exports=a}),null);
__d("CometNotificationsBadgeCount.react",["fbt","CometNotificationsBadgeCountFragment_viewer.graphql","CometNotificationsBadgeCountQuery.graphql","CometPlaceholder.react","CometRelay","FDSNumberedBadge.react","hero-tracing","react","react-compiler-runtime","setupNotificationsLiveQuery","unrecoverableViolation","updateWidgetServiceWorker","useMaybeZeroNotificationsBadgeCount"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k,l=k||(k=d("react")),m=k.useEffect;function a(a){var e=d("react-compiler-runtime").c(14),f=d("CometRelay").useLazyLoadQuery(i!==void 0?i:i=b("CometNotificationsBadgeCountQuery.graphql"),{environment:"MAIN_SURFACE"});f=f.viewer;if(f==null)throw c("unrecoverableViolation")("The viewer recieving these notifications cannot be null","comet_feed");f=d("CometRelay").useFragment(j!==void 0?j:j=b("CometNotificationsBadgeCountFragment_viewer.graphql"),f);var g=c("useMaybeZeroNotificationsBadgeCount")(f==null?void 0:f.notifications_unseen_count);f=a.isBadgeHidden;var k=a.overflow,n=a.setBadgeCount,o=d("CometRelay").useRelayEnvironment(),p;e[0]!==o?(a=function(){var a=c("setupNotificationsLiveQuery")(o);return function(){return a.dispose()}},p=[o],e[0]=o,e[1]=a,e[2]=p):(a=e[1],p=e[2]);m(a,p);e[3]!==g||e[4]!==n?(a=function(){n&&n(g),c("updateWidgetServiceWorker")()},p=[g,n],e[3]=g,e[4]=n,e[5]=a,e[6]=p):(a=e[5],p=e[6]);m(a,p);e[7]===Symbol["for"]("react.memo_cache_sentinel")?(a=l.jsx("span",{}),e[7]=a):a=e[7];e[8]!==g||e[9]!==f||e[10]!==k?(p=f!==!0&&g>0?l.jsx(d("hero-tracing").HeroPagelet,{name:"NotificationsBadge",children:function(a,b){return l.jsxs(l.Fragment,{children:[l.jsx(c("FDSNumberedBadge.react"),{accessibilityText:h._(/*BTDS*/"Number of unread notifications"),overflow:k,ref:a,testid:void 0,value:g}),l.jsx(b,{})]})}}):null,e[8]=g,e[9]=f,e[10]=k,e[11]=p):p=e[11];e[12]!==p?(f=l.jsx(c("CometPlaceholder.react"),{fallback:a,children:p}),e[12]=p,e[13]=f):f=e[13];return f}g["default"]=a}),226);
__d("CometRouterUIComponentsDefaultErrorRoot.react",["cr:12338","react"],(function(a,b,c,d,e,f,g){"use strict";var h;h||d("react");g["default"]=b("cr:12338")}),98);
__d("CometTopNavTabBadge.react",["fbt","FDSNumberedBadge.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react")),k=i.useEffect;function a(a){var b=d("react-compiler-runtime").c(12),e=a.testid,f=a.value,g=a.isBadgeHidden,i=a.isTab,l=a.overflow,m=a.setBadgeCount,n;b[0]!==m||b[1]!==f?(a=function(){m==null?void 0:m(f)},n=[f,m],b[0]=m,b[1]=f,b[2]=a,b[3]=n):(a=b[2],n=b[3]);k(a,n);if(g===!0||f===0)return null;a=i===!0?"red":void 0;b[4]!==f?(n=h._(/*BTDS*/"_j{\"*\":\"{number} items\",\"_1\":\"1 item\"}",[h._plural(f,"number")]),b[4]=f,b[5]=n):n=b[5];b[6]!==a||b[7]!==l||b[8]!==n||b[9]!==e||b[10]!==f?(g=j.jsx(c("FDSNumberedBadge.react"),{accessibilityText:n,color:a,overflow:l,testid:void 0,value:f}),b[6]=a,b[7]=l,b[8]=n,b[9]=e,b[10]=f,b[11]=g):g=b[11];return g}g["default"]=a}),226);
__d("FDSCalloutEdgeArrow.svg.react",["react","stylex"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=i||d("react");function a(a){var b=a.children,d=a.xstyle;a=babelHelpers.objectWithoutPropertiesLoose(a,["children","xstyle"]);return j.jsxs("svg",babelHelpers["extends"]({"aria-hidden":!0,className:(h||(h=c("stylex")))(d),height:"12px",viewBox:"0 0 21 12",width:"21px"},a,{children:[a.title!=null&&j.jsx("title",{children:a.title}),b!=null&&j.jsx("defs",{children:b}),j.jsx("path",{d:"M20.685.12c-2.229.424-4.278 1.914-6.181 3.403L5.4 10.94c-2.026 2.291-5.434.62-5.4-2.648V.12h20.684z"})]}))}a.displayName=a.name+" [from "+f.id+"]";a._isSVG=!0;g["default"]=a}),98);
__d("FDSCalloutEdge.react",["BaseContextualLayerContextSizeContext","BaseContextualLayerLayerAdjustmentContext","BaseContextualLayerOrientationContext","BaseRow.react","BaseView.react","CometHideLayerOnEscape.react","FDSCalloutEdgeArrow.svg.react","FocusRegionStrictMode.react","Locale","focusScopeQueries","react","react-compiler-runtime","useOnOutsideClick"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react")),j=h.useContext,k={arrow:{position:"x10l6tqk",$$css:!0},container:{display:"x78zum5",$$css:!0},content:{backgroundColor:"x1h0vfkc",borderStartStartRadius:"x1obq294",borderStartEndRadius:"x5a5i1n",borderEndEndRadius:"xde0f50",borderEndStartRadius:"x15x8krk",borderTopWidth:"x178xt8z",borderInlineEndWidth:"x1lun4ml",borderBottomWidth:"xso031l",borderInlineStartWidth:"xpilrb4",boxShadow:"xofhs1l",paddingTop:"xyamay9",paddingBottom:"x1l90r2v",paddingInlineStart:"x1g0dm76",paddingInlineEnd:"xpdmqnj",paddingLeft:null,paddingRight:null,$$css:!0}},l={accent:{backgroundColor:"xdk9wry",$$css:!0},"default":{backgroundColor:"x9bbmet",$$css:!0}},m={end:{borderEndEndRadius:"x16uus16",marginBottom:"xieb3on",$$css:!0},middle:{marginBottom:"x12nagc",$$css:!0},start:{borderEndStartRadius:"xbiv7yw",marginBottom:"xieb3on",$$css:!0}},n={end:{borderStartEndRadius:"x1ga7v0g",marginTop:"x1sy10c2",$$css:!0},middle:{marginTop:"x1gslohp",$$css:!0},start:{borderStartStartRadius:"x15mokao",marginTop:"x1sy10c2",$$css:!0}},o={end:{bottom:"x7ofzsv",insetInlineEnd:"xtijo5x",left:null,right:null,transform:"xpk2tj9",$$css:!0},middle:{bottom:"x7ofzsv",insetInlineEnd:"xtijo5x",left:null,right:null,$$css:!0},start:{bottom:"x7ofzsv",insetInlineStart:"x1o0tod",left:null,right:null,$$css:!0}},p={end:{$$css:!0},middle:{$$css:!0},start:{$$css:!0}},q={end:{bottom:"x7ofzsv",insetInlineEnd:"xtijo5x",left:null,right:null,transform:"xpk2tj9",$$css:!0},middle:{bottom:"x7ofzsv",insetInlineEnd:"xtijo5x",left:null,right:null,$$css:!0},start:{bottom:"x7ofzsv",insetInlineStart:"x1o0tod",left:null,right:null,$$css:!0}},r={end:{$$css:!0},middle:{$$css:!0},start:{$$css:!0}},s={end:{insetInlineEnd:"xtijo5x",left:null,right:null,top:"x1nl0pjx",transform:"x19jd1h0",$$css:!0},middle:{insetInlineEnd:"xtijo5x",left:null,right:null,top:"x1nl0pjx",transform:"x1oihik5",$$css:!0},start:{insetInlineStart:"x1o0tod",left:null,right:null,top:"x1nl0pjx",transform:"x1oihik5",$$css:!0}},t={end:{transform:"x19jd1h0",$$css:!0},middle:{transform:"x1oihik5",$$css:!0},start:{transform:"x1oihik5",$$css:!0}},u={end:{insetInlineEnd:"xtijo5x",left:null,right:null,top:"x1nl0pjx",transform:"x19jd1h0",$$css:!0},middle:{insetInlineEnd:"xtijo5x",left:null,right:null,top:"x1nl0pjx",transform:"x1oihik5",$$css:!0},start:{insetInlineStart:"x1o0tod",left:null,right:null,top:"x1nl0pjx",transform:"x1oihik5",$$css:!0}},v={end:{transform:"x19jd1h0",$$css:!0},middle:{transform:"x1oihik5",$$css:!0},start:{transform:"x1oihik5",$$css:!0}};function w(a){if(a==="start")return"end";return a==="end"?"start":a}function a(a){var b,e=d("react-compiler-runtime").c(41),f,g,h,o,p,q,r,s;e[0]!==a?(g=a.children,q=a.disableAutoFocus,h=a.id,o=a.onClose,p=a.onOutsideClick,r=a.type,s=a.xstyle,f=babelHelpers.objectWithoutPropertiesLoose(a,["children","disableAutoFocus","id","onClose","onOutsideClick","type","xstyle"]),e[0]=a,e[1]=f,e[2]=g,e[3]=h,e[4]=o,e[5]=p,e[6]=q,e[7]=r,e[8]=s):(f=e[1],g=e[2],h=e[3],o=e[4],p=e[5],q=e[6],r=e[7],s=e[8]);a=q===void 0?!1:q;q=r===void 0?"default":r;r=j(c("BaseContextualLayerOrientationContext"));var t=r.align;r=r.position;t=t==="stretch"?"start":t;r=r==="start"?"above":r==="end"?"below":r;var u=j(c("BaseContextualLayerContextSizeContext"));b=(b=j(c("BaseContextualLayerLayerAdjustmentContext")))!=null?b:0;var v;e[9]!==t||e[10]!==b?(v=b!==0?w(t):t,e[9]=t,e[10]=b,e[11]=v):v=e[11];t=v;u=(v=u==null?void 0:u.width)!=null?v:0;e[12]!==t||e[13]!==b||e[14]!==u?(v=z(t,u,b),e[12]=t,e[13]=b,e[14]=u,e[15]=v):v=e[15];b=v;u=c("useOnOutsideClick")(p);p=(v=h)!=null?v:void 0;h=a?void 0:d("focusScopeQueries").tabbableScopeQuery;v=l[q];a=r==="above"&&m[t];var x=r==="below"&&n[t],A;e[16]!==x||e[17]!==v||e[18]!==a||e[19]!==s?(A=[k.content,v,a,x,s],e[16]=x,e[17]=v,e[18]=a,e[19]=s,e[20]=A):A=e[20];e[21]!==g||e[22]!==u||e[23]!==A?(x=i.jsx(c("BaseRow.react"),{ref:u,xstyle:A,children:g}),e[21]=g,e[22]=u,e[23]=A,e[24]=x):x=e[24];e[25]!==t||e[26]!==r||e[27]!==q?(v=i.jsx(y,{align:t,position:r,type:q}),e[25]=t,e[26]=r,e[27]=q,e[28]=v):v=e[28];e[29]!==o||e[30]!==x||e[31]!==v?(a=i.jsxs(c("CometHideLayerOnEscape.react"),{onHide:o,children:[x,v]}),e[29]=o,e[30]=x,e[31]=v,e[32]=a):a=e[32];e[33]!==a||e[34]!==h?(s=i.jsx(d("FocusRegionStrictMode.react").FocusRegion,{autoFocusQuery:h,children:a}),e[33]=a,e[34]=h,e[35]=s):s=e[35];e[36]!==f||e[37]!==b||e[38]!==s||e[39]!==p?(g=i.jsx(c("BaseView.react"),babelHelpers["extends"]({},f,{id:p,role:"dialog",style:b,xstyle:k.container,children:s})),e[36]=f,e[37]=b,e[38]=s,e[39]=p,e[40]=g):g=e[40];return g}var x=c("Locale").isRTL();function y(a){var b=d("react-compiler-runtime").c(8),e=a.align,f=a.position;a=a.type;var g=a==="default"?"var(--popover-background)":"var(--callout-background-color-accent, var(--accent))",h=f==="above"&&a==="default"&&(x?p[e]:o[e]),j=f==="above"&&a==="accent"&&(x?r[e]:q[e]),l=f==="below"&&a==="default"&&(x?t[e]:s[e]);f=f==="below"&&a==="accent"&&(x?v[e]:u[e]);b[0]!==h||b[1]!==j||b[2]!==l||b[3]!==f?(a=[k.arrow,h,j,l,f],b[0]=h,b[1]=j,b[2]=l,b[3]=f,b[4]=a):a=b[4];b[5]!==g||b[6]!==a?(e=i.jsx(c("FDSCalloutEdgeArrow.svg.react"),{fill:g,xstyle:a}),b[5]=g,b[6]=a,b[7]=e):e=b[7];return e}function z(a,b,c){c=c===0?b/2:0;if(c===0)return void 0;if(a==="start")return{transform:"translateX("+(x?-1*c:c)+"px)"};return a==="end"?{transform:"translateX("+(x?c:-1*c)+"px)"}:void 0}g["default"]=a}),98);
__d("FDSCalloutInsetArrow.svg.react",["react","stylex"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=i||d("react");function a(a){var b=a.children,d=a.xstyle;a=babelHelpers.objectWithoutPropertiesLoose(a,["children","xstyle"]);return j.jsxs("svg",babelHelpers["extends"]({"aria-hidden":!0,className:(h||(h=c("stylex")))(d),height:"12px",viewBox:"0 0 21 12",width:"21px"},a,{children:[a.title!=null&&j.jsx("title",{children:a.title}),b!=null&&j.jsx("defs",{children:b}),j.jsx("path",{d:"M20.685.12c-2.229.424-4.278 1.914-6.181 3.403L5.4 10.94c-2.026 2.291-5.434.62-5.4-2.648V.12h20.684z"})]}))}a.displayName=a.name+" [from "+f.id+"]";a._isSVG=!0;g["default"]=a}),98);
__d("FDSCalloutInset.react",["BaseContextualLayerContextSizeContext","BaseContextualLayerLayerAdjustmentContext","BaseContextualLayerOrientationContext","BaseRow.react","BaseView.react","CometHideLayerOnEscape.react","FDSCalloutInsetArrow.svg.react","FocusRegionStrictMode.react","Locale","focusScopeQueries","react","react-compiler-runtime","useOnOutsideClick"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react")),j=h.useContext,k={arrow:{position:"x10l6tqk",$$css:!0},container:{display:"x78zum5",$$css:!0},content:{backgroundColor:"x1h0vfkc",borderStartStartRadius:"x1obq294",borderStartEndRadius:"x5a5i1n",borderEndEndRadius:"xde0f50",borderEndStartRadius:"x15x8krk",borderTopWidth:"x178xt8z",borderInlineEndWidth:"x1lun4ml",borderBottomWidth:"xso031l",borderInlineStartWidth:"xpilrb4",boxShadow:"xofhs1l",paddingTop:"xyamay9",paddingBottom:"x1l90r2v",paddingInlineStart:"x1g0dm76",paddingInlineEnd:"xpdmqnj",paddingLeft:null,paddingRight:null,$$css:!0}},l={accent:{backgroundColor:"xdk9wry",$$css:!0},"default":{backgroundColor:"x9bbmet",$$css:!0}},m={above:{marginBottom:"x1yztbdb",$$css:!0},below:{marginTop:"xw7yly9",$$css:!0},end:{marginInlineStart:"xyqm7xq",$$css:!0}},n={above:{bottom:"x1wa3icf",$$css:!0},below:{top:"x1jzctok",transform:"x1oihik5",$$css:!0},end:{$$css:!0}},o={above:{bottom:"x1wa3icf",$$css:!0},below:{top:"x1jzctok",transform:"x1oihik5",$$css:!0},end:{$$css:!0}};function a(a){var b,e=d("react-compiler-runtime").c(38),f,g,h,n,o,q,s,t;e[0]!==a?(g=a.children,q=a.disableAutoFocus,h=a.id,n=a.onClose,o=a.onOutsideClick,s=a.type,t=a.xstyle,f=babelHelpers.objectWithoutPropertiesLoose(a,["children","disableAutoFocus","id","onClose","onOutsideClick","type","xstyle"]),e[0]=a,e[1]=f,e[2]=g,e[3]=h,e[4]=n,e[5]=o,e[6]=q,e[7]=s,e[8]=t):(f=e[1],g=e[2],h=e[3],n=e[4],o=e[5],q=e[6],s=e[7],t=e[8]);a=q===void 0?!1:q;q=s===void 0?"default":s;s=j(c("BaseContextualLayerOrientationContext"));var u=s.align;s=s.position;u=u==="stretch"?"start":u;s=s==="start"?"above":s==="end"?"below":s;var v=j(c("BaseContextualLayerContextSizeContext"));b=(b=j(c("BaseContextualLayerLayerAdjustmentContext")))!=null?b:0;v=(v=v==null?void 0:v.width)!=null?v:0;var w;e[9]!==u||e[10]!==b||e[11]!==s||e[12]!==v?(w=r(u,s,v,b),e[9]=u,e[10]=b,e[11]=s,e[12]=v,e[13]=w):w=e[13];u=w;b=u[0];v=u[1];w=c("useOnOutsideClick")(o);o=(u=h)!=null?u:void 0;h=a?void 0:d("focusScopeQueries").tabbableScopeQuery;u=l[q];a=m[s];var x;e[14]!==u||e[15]!==a||e[16]!==t?(x=[k.content,u,a,t],e[14]=u,e[15]=a,e[16]=t,e[17]=x):x=e[17];e[18]!==g||e[19]!==w||e[20]!==x?(u=i.jsx(c("BaseRow.react"),{ref:w,xstyle:x,children:g}),e[18]=g,e[19]=w,e[20]=x,e[21]=u):u=e[21];e[22]!==v||e[23]!==s||e[24]!==q?(a=i.jsx(p,{arrowStyles:v,position:s,type:q}),e[22]=v,e[23]=s,e[24]=q,e[25]=a):a=e[25];e[26]!==n||e[27]!==u||e[28]!==a?(t=i.jsxs(c("CometHideLayerOnEscape.react"),{onHide:n,children:[u,a]}),e[26]=n,e[27]=u,e[28]=a,e[29]=t):t=e[29];e[30]!==t||e[31]!==h?(g=i.jsx(d("FocusRegionStrictMode.react").FocusRegion,{autoFocusQuery:h,children:t}),e[30]=t,e[31]=h,e[32]=g):g=e[32];e[33]!==f||e[34]!==b||e[35]!==g||e[36]!==o?(w=i.jsx(c("BaseView.react"),babelHelpers["extends"]({},f,{id:o,role:"dialog",style:b,xstyle:k.container,children:g})),e[33]=f,e[34]=b,e[35]=g,e[36]=o,e[37]=w):w=e[37];return w}function p(a){var b=d("react-compiler-runtime").c(7),e=a.arrowStyles,f=a.position;a=a.type;var g=a==="default"?"var(--popover-background)":"var(--callout-background-color-accent, var(--accent))",h=n[f];a=a==="accent"&&o[f];b[0]!==h||b[1]!==a?(f=[k.arrow,h,a],b[0]=h,b[1]=a,b[2]=f):f=b[2];b[3]!==e||b[4]!==g||b[5]!==f?(h=i.jsx(c("FDSCalloutInsetArrow.svg.react"),{fill:g,style:e,xstyle:f}),b[3]=e,b[4]=g,b[5]=f,b[6]=h):h=b[6];return h}var q=c("Locale").isRTL();function r(a,b,c,d){var e=Math.max(c/2-8,16)+Math.abs(d),f=c/2-8<16;c=24-c/2;if(b==="above")if(a==="start"){var g;b=q?"right":"left";return[f?{transform:"translateX("+(q?c:-c)+"px)"}:void 0,(g={},g[b]="min(calc(100% - 32px), "+e+"px)",g)]}else if(a==="end"){b=q?"left":"right";return[f?{transform:"translateX("+(q?-c:c)+"px)"}:void 0,(g={},g[b]="min(calc(100% - 32px), "+e+"px)",g)]}else{var h;b=q?"left":"right";g=(q?-d:d)-8;return[void 0,(h={},h[b]="calc(50% + "+g+"px)",h)]}else if(a==="start"){b=q?"right":"left";return[f?{transform:"translateX("+(q?c:-c)+"px)"}:void 0,(g={},g[b]="min(calc(100% - 32px), "+e+"px)",g)]}else if(a==="end"){h=q?"left":"right";return[f?{transform:"translateX("+(q?-c:c)+"px)"}:void 0,(b={},b[h]="min(calc(100% - 32px), "+e+"px)",b)]}else{g=q?"left":"right";a=(q?-d:d)-8;return[void 0,(f={},f[g]="calc(50% + "+a+"px)",f)]}}g["default"]=a}),98);
__d("FDSCallout.react",["fbt","ix","BaseContextualLayerOrientationContext","BasePopoverReflowSheetContext","BaseRow.react","BaseRowItem.react","BaseView.react","CometColumn.react","CometColumnItem.react","CometErrorBoundary.react","CometHideLayerOnEscape.react","FDSCalloutEdge.react","FDSCalloutInset.react","FDSIcon.react","FDSTextPairing.react","FocusRegionStrictMode.react","fbicon","focusScopeQueries","react","react-compiler-runtime","unrecoverableViolation","useOnOutsideClick","useVisibilityObserver"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j,k=j||(j=d("react"));b=j;var l=b.useContext;b.useMemo;var m={container:{display:"x78zum5",$$css:!0},content:{backgroundColor:"x1h0vfkc",borderStartStartRadius:"x1obq294",borderStartEndRadius:"x5a5i1n",borderEndEndRadius:"xde0f50",borderEndStartRadius:"x15x8krk",borderTopWidth:"x178xt8z",borderInlineEndWidth:"x1lun4ml",borderBottomWidth:"xso031l",borderInlineStartWidth:"xpilrb4",boxShadow:"xofhs1l",paddingTop:"xyamay9",paddingBottom:"x1l90r2v",paddingInlineStart:"x1g0dm76",paddingInlineEnd:"xpdmqnj",paddingLeft:null,paddingRight:null,$$css:!0},crossoutButton:{marginInlineEnd:"x1lxpwgx",marginTop:"x9otpla",$$css:!0},fitContent:{width:"xeq5yr9",$$css:!0},item:{paddingTop:"x1yrsyyn",paddingBottom:"x10b6aqq",paddingInlineStart:"x25sj25",paddingInlineEnd:"x1icxu4v",paddingLeft:null,paddingRight:null,$$css:!0}},n={accent:{backgroundColor:"xdk9wry",$$css:!0},"default":{backgroundColor:"x9bbmet",$$css:!0}},o={above:{marginBottom:"x12nagc",$$css:!0},below:{marginTop:"x1gslohp",$$css:!0},end:{marginInlineStart:"xdwrcjd",$$css:!0},start:{$$css:!0}};function a(a){var b=d("react-compiler-runtime").c(66),e=a.arrowStyle,f=a.calloutID,g=a.content,j=a.contentID,q=a.disableAutoFocus,r=a.onClose,s=a.onHide,t=a.onOutsideClick,u=a.onShow,v=a.titleID,w=a.type,x=a.xstyle,y=a.addOn,z=a["aria-label"],A=a.hasCloseButton;a=a.title;e=e===void 0?"none":e;q=q===void 0?!1:q;w=w===void 0?"default":w;A=A===void 0?!0:A;var B=l(c("BaseContextualLayerOrientationContext"));B=B.position;var C=c("useOnOutsideClick")(t),D=l(c("BasePopoverReflowSheetContext"));D=D.isReflowSheet;var E;b[0]!==s||b[1]!==u?(E={onHidden:s,onVisible:u},b[0]=s,b[1]=u,b[2]=E):E=b[2];s=c("useVisibilityObserver")(E);u=w==="default"?"primary":"white";if(B==="end"&&(e==="inset"||e==="edge"))throw c("unrecoverableViolation")('"end" position with arrow is not supported yet',"comet_ui");b[3]!==z||b[4]!==j||b[5]!==a||b[6]!==v?(E=a!=null?{"aria-describedby":j,"aria-labelledby":v}:{"aria-describedby":j,"aria-label":z},b[3]=z,b[4]=j,b[5]=a,b[6]=v,b[7]=E):E=b[7];z=E;E=z;b[8]!==u||b[9]!==g||b[10]!==j||b[11]!==a||b[12]!==v?(z=k.jsx(c("FDSTextPairing.react"),{body:g,bodyColor:u,bodyId:j,headline:a,headlineColor:u,headlineId:v,isSemanticHeading:!0,level:3}),b[8]=u,b[9]=g,b[10]=j,b[11]=a,b[12]=v,b[13]=z):z=b[13];b[14]!==z||b[15]!==s?(u=k.jsx(c("BaseRowItem.react"),{expanding:!0,ref:s,verticalAlign:"center",xstyle:m.item,children:z}),b[14]=z,b[15]=s,b[16]=u):u=b[16];b[17]!==A||b[18]!==r||b[19]!==w?(g=A&&k.jsx(c("BaseRowItem.react"),{xstyle:[m.crossoutButton,m.item],children:k.jsx(c("FDSIcon.react"),{"aria-label":h._(/*BTDS*/"Close"),color:w==="default"?"secondary":"white",focusable:!0,icon:d("fbicon")._(i("478232"),16),onPress:r,size:16})}),b[17]=A,b[18]=r,b[19]=w,b[20]=g):g=b[20];b[21]!==g||b[22]!==u?(j=k.jsx(c("CometColumnItem.react"),{children:k.jsxs(c("BaseRow.react"),{children:[u,g]})}),b[21]=g,b[22]=u,b[23]=j):j=b[23];b[24]!==y?(a=y!=null&&k.jsx(c("CometColumnItem.react"),{paddingTop:12,children:k.jsx(c("BaseRow.react"),{children:k.jsx(c("BaseRowItem.react"),{expanding:!0,verticalAlign:"center",xstyle:m.item,children:y})})}),b[24]=y,b[25]=a):a=b[25];b[26]!==j||b[27]!==a?(v=k.jsxs(c("CometColumn.react"),{children:[j,a]}),b[26]=j,b[27]=a,b[28]=v):v=b[28];z=v;if(!D&&e==="inset"){b[29]!==E||b[30]!==f||b[31]!==z||b[32]!==q||b[33]!==r||b[34]!==t||b[35]!==w||b[36]!==x?(s=k.jsx(c("FDSCalloutInset.react"),babelHelpers["extends"]({},E,{disableAutoFocus:q,id:f,onClose:r,onOutsideClick:t,type:w,xstyle:x,children:z})),b[29]=E,b[30]=f,b[31]=z,b[32]=q,b[33]=r,b[34]=t,b[35]=w,b[36]=x,b[37]=s):s=b[37];return s}if(!D&&e==="edge"){b[38]!==E||b[39]!==f||b[40]!==z||b[41]!==q||b[42]!==r||b[43]!==t||b[44]!==w||b[45]!==x?(A=k.jsx(c("FDSCalloutEdge.react"),babelHelpers["extends"]({},E,{disableAutoFocus:q,id:f,onClose:r,onOutsideClick:t,type:w,xstyle:x,children:z})),b[38]=E,b[39]=f,b[40]=z,b[41]=q,b[42]=r,b[43]=t,b[44]=w,b[45]=x,b[46]=A):A=b[46];return A}g=f!=null?f:void 0;u=q?void 0:d("focusScopeQueries").tabbableScopeQuery;y=n[w];j=e==="none"&&o[B];a=D&&m.fitContent;b[47]!==y||b[48]!==j||b[49]!==a||b[50]!==x?(v=[m.content,y,j,x,a],b[47]=y,b[48]=j,b[49]=a,b[50]=x,b[51]=v):v=b[51];b[52]!==z||b[53]!==C||b[54]!==v?(s=k.jsx(c("BaseRow.react"),{ref:C,xstyle:v,children:z}),b[52]=z,b[53]=C,b[54]=v,b[55]=s):s=b[55];b[56]!==r||b[57]!==s?(t=k.jsx(c("CometHideLayerOnEscape.react"),{onHide:r,children:s}),b[56]=r,b[57]=s,b[58]=t):t=b[58];b[59]!==u||b[60]!==t?(A=k.jsx(d("FocusRegionStrictMode.react").FocusRegion,{autoFocusQuery:u,children:t}),b[59]=u,b[60]=t,b[61]=A):A=b[61];b[62]!==E||b[63]!==g||b[64]!==A?(f=k.jsx(c("CometErrorBoundary.react"),{fallback:p,children:k.jsx(c("BaseView.react"),babelHelpers["extends"]({},E,{id:g,role:"dialog",xstyle:m.container,children:A}))}),b[62]=E,b[63]=g,b[64]=A,b[65]=f):f=b[65];return f}function p(){return k.jsx("div",{})}p.displayName=p.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("FDSCalloutImpl.react",["BaseCalloutImpl.react","FDSCallout.react","FDSCalloutContext","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react")),j=h.useContext;function a(a){var b=d("react-compiler-runtime").c(23),e=a.calloutID,f=a.calloutProps,g=a.contentID,h=a.titleID,k=j(c("FDSCalloutContext"));if(k==null||f==null)return null;var l,m,n;b[0]!==f?(m=f.disableOutsideClick,n=f.onClose,l=babelHelpers.objectWithoutPropertiesLoose(f,["disableOutsideClick","onClose"]),b[0]=f,b[1]=l,b[2]=m,b[3]=n):(l=b[1],m=b[2],n=b[3]);b[4]!==k||b[5]!==e||b[6]!==n?(f=function(){k.removeCallout(e),n==null?void 0:n()},b[4]=k,b[5]=e,b[6]=n,b[7]=f):f=b[7];var o;b[8]!==k||b[9]!==e||b[10]!==m||b[11]!==n?(o=function(){m!==!0&&(k.removeCallout(e),n==null?void 0:n())},b[8]=k,b[9]=e,b[10]=m,b[11]=n,b[12]=o):o=b[12];var p;b[13]!==e||b[14]!==l||b[15]!==g||b[16]!==f||b[17]!==o||b[18]!==h?(p=i.jsx(c("FDSCallout.react"),babelHelpers["extends"]({},l,{calloutID:e,contentID:g,onClose:f,onOutsideClick:o,titleID:h})),b[13]=e,b[14]=l,b[15]=g,b[16]=f,b[17]=o,b[18]=h,b[19]=p):p=b[19];b[20]!==a||b[21]!==p?(l=i.jsx(c("BaseCalloutImpl.react"),babelHelpers["extends"]({},a,{children:p})),b[20]=a,b[21]=p,b[22]=l):l=b[22];return l}g["default"]=a}),98);
__d("GlobalVideoPortsManager",["addToMap","emptyFunction","gkx","removeFromMap"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){var d=a.get(b);d!=null&&(d.portablePlaceContainer=null);return c("removeFromMap")(a,b)}a=c("emptyFunction");function i(a){return a.unlinkedAtTimestampMs!==null}var j=1e4;b=function(){function a(a){var b=this;this.$1=function(c){var d=function(a){return c(b.$2(a))};a(d)}}var b=a.prototype;b.addOrUpdatePlace=function(a){var b=this,d=a.coreVideoPlayerMetaData,e=a.fullscreenController,f=a.implementations,g=a.injectCoreVideoStatesRef,j=a.isFullscreen,k=a.portablePlaceContainer,l=a.portablePlaceID,m=a.portablePlaceMetaData,n=a.portableVideoID,o=a.renderComponents,p=a.renderPlaceholder,q=a.trackingDataEncrypted,r=a.trackingNodes,s=a.viewportMarginsForViewability;this.$1(function(a){var t,u=b.getPortableVideoState(a,n),v=(t=a.places.get(l))!=null?t:null;t=v!=null&&!i(v)?v.sequenceNumber:a.placesSequenceNumberNext;var w=t===a.placesSequenceNumberNext?a.placesSequenceNumberNext+1:a.placesSequenceNumberNext,x=m||{},y=a.places;if(n!=null){var z=b.getPlacesBorrowingThisVideo(y,n);z.forEach(function(a){i(a)&&a.portablePlaceID!==(v==null?void 0:v.portablePlaceID)&&(y=h(y,a.portablePlaceID))})}y=c("addToMap")(y,l,babelHelpers["extends"]({},v,{coreVideoPlayerMetaData:d,currentVideoID:n,fullscreenController:e,implementations:f,injectCoreVideoStatesRef:g,isFullscreen:j,portablePlaceContainer:k,portablePlaceID:l,portablePlaceMetaData:x,renderComponents:o,renderPlaceholder:p!=null?p:null,sequenceNumber:t,trackingDataEncrypted:q,trackingNodes:r,unlinkedAtTimestampMs:null,viewportMarginsForViewability:s}));z=v!==null&&n===null?v.currentVideoID:null;x=a.videos;if(z!==null){t=b.getPlacesBorrowingThisVideo(y,z);t=0===t.length;t&&(x=c("removeFromMap")(a.videos,z))}if(n!==null){t=b.updatePreviousPlaceMetaDataInfoForVideo({existingVideoState:u,places:a.places,setPreferredPlaceForVideo:!1,updatedPlaces:y,videoID:n});z=t.nextPreviousPlaceMetaData;x=c("addToMap")(x,n,u?babelHelpers["extends"]({},u,{portableVideoID:n,previousPlaceMetaData:z}):{portableVideoID:n,preferredPlaceID:null,previousPlaceMetaData:z})}return y===a.places&&w===a.placesSequenceNumberNext&&x===a.videos?a:babelHelpers["extends"]({},a,{places:y,placesSequenceNumberNext:w,videos:x})})};b.removePlace=function(a){var b=this,d=a.portablePlaceID,e=Date.now();this.$1(function(a){var f;f=(f=a.places.get(d))!=null?f:null;var g=f!==null?f.currentVideoID:null;if(f===null)return a;var i=a.places,j=g!==null?b.skipUnlinkedPlaces(b.getPlacesBorrowingThisVideo(i,g)).filter(function(a){return a.portablePlaceID!==d}):[];g!==null&&j.length===0?i=c("addToMap")(i,d,babelHelpers["extends"]({},f,{unlinkedAtTimestampMs:e})):i=h(i,d);j=a.videos;if(g!==null){f=b.getPlacesBorrowingThisVideo(i,g);f=0===f.length;if(f)j=c("removeFromMap")(j,g);else{f=b.getPortableVideoState(a,g);var k=b.updatePreviousPlaceMetaDataInfoForVideo({existingVideoState:f,places:a.places,setPreferredPlaceForVideo:!1,updatedPlaces:i,videoID:g}),l=k.nextPreviousPlaceMetaData;k=k.shouldUpdatePreviousPlaceMetaDataForVideo;f!=null&&k&&(j=c("addToMap")(j,g,babelHelpers["extends"]({},f,{portableVideoID:g,previousPlaceMetaData:l})))}}return i===a.places&&j===a.videos?a:babelHelpers["extends"]({},a,{places:i,videos:j})})};b.setPreferredPlaceForVideo=function(a){var b=this,d=a.portablePlaceID,e=a.portableVideoID;this.$1(function(a){var f=b.getPortableVideoState(a,e),g=d!=null?a.places.get(d):null,h=b.updatePreviousPlaceMetaDataInfoForVideo({existingPlaceStateForSetPreferredPlaceForVideo:g,existingVideoState:f,places:a.places,preferredPlaceID:d,setPreferredPlaceForVideo:!0,updatedPlaces:a.places,videoID:e});h=h.nextPreviousPlaceMetaData;f=f!=null?c("addToMap")(a.videos,e,babelHelpers["extends"]({},f,{preferredPlaceID:g!=null&&d!=null?d:null,previousPlaceMetaData:h})):a.videos;return f===a.videos?a:babelHelpers["extends"]({},a,{videos:f})})};b.getPlacesBorrowingThisVideo=function(a,b){var c=[];a.forEach(function(a){a.currentVideoID===b&&c.push(a)});return c};b.skipUnlinkedPlaces=function(a){return a.filter(function(a){return!i(a)})};b.selectCurrentPlaceFromThesePlaces=function(a,b){var c;a=a.slice().sort(function(a,b){return a.sequenceNumber-b.sequenceNumber});c=(c=a.find(function(a){return a.portablePlaceID===b}))!=null?c:null;a=a.length>0?a[a.length-1]:null;return(c=c!=null?c:a)!=null?c:null};b.getCurrentPlaceStateForVideo=function(a,b){var c=this.getPortableVideoState(a,b);if(c!=null&&b!=null){a=this.selectCurrentPlaceFromThesePlaces(this.skipUnlinkedPlaces(this.getPlacesBorrowingThisVideo(a.places,b)),c.preferredPlaceID);return a!=null?a:null}else return null};b.getPortableVideoState=function(a,b){if(b!=null){a=a.videos.get(b);return a!=null?a:null}return null};b.updatePreviousPlaceMetaDataInfoForVideo=function(a){var b=this,c=a.existingPlaceStateForSetPreferredPlaceForVideo,d=a.existingVideoState,e=a.places,f=a.preferredPlaceID,g=a.setPreferredPlaceForVideo,h=a.updatedPlaces,i=a.videoID;a=function(a,c){return b.selectCurrentPlaceFromThesePlaces(b.skipUnlinkedPlaces(b.getPlacesBorrowingThisVideo(a,i)),c!=null?c:null)};var j=a(e,d==null?void 0:d.preferredPlaceID);g?g=c!=null?a(e,f):null:g=a(h,d==null?void 0:d.preferredPlaceID);e=j!=null&&(j==null?void 0:j.portablePlaceID)!==((c=g)==null?void 0:c.portablePlaceID);return{nextPreviousPlaceMetaData:e&&j!=null?j.portablePlaceMetaData:(f=d==null?void 0:d.previousPlaceMetaData)!=null?f:null,shouldUpdatePreviousPlaceMetaDataForVideo:e}};b.collectGarbage=function(){this.$1(function(a){return a})};b.$2=function(a){var b=Date.now(),d=new Set(),e=a.places;a.places.forEach(function(a){a.unlinkedAtTimestampMs!==null&&b-a.unlinkedAtTimestampMs>=j?e=h(e,a.portablePlaceID):a.currentVideoID!==null&&d.add(a.currentVideoID)});var f=a.videos;a.videos.forEach(function(a){d.has(a.portableVideoID)||(f=c("removeFromMap")(f,a.portableVideoID))});return e===a.places&&f===a.videos?a:babelHelpers["extends"]({},a,{places:e,videos:f})};return a}();g.isUnlinkedGlobalVideoPortsPlace=i;g.UNLINKED_PLACE_TIMEOUT_MS=j;g.GlobalVideoPortsManager=b}),98);
__d("GlobalVideoPortsPortalerErrorBoundary.react",["react"],(function(a,b,c,d,e,f,g){"use strict";var h;a=h||d("react");b=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b;for(var c=arguments.length,d=new Array(c),e=0;e<c;e++)d[e]=arguments[e];return(b=a.call.apply(a,[this].concat(d))||this,b.state={errorRaw:null},b.suppressReactDefaultErrorLoggingIUnderstandThisWillMakeBugsHarderToFindAndFix=!0,babelHelpers.assertThisInitialized(b))||babelHelpers.assertThisInitialized(b)}b.getDerivedStateFromError=function(a){return{errorRaw:a}};var c=b.prototype;c.componentDidCatch=function(a,b){b=this.props.onError;b!=null&&b(a)};c.render=function(){var a=this.props,b=a.children;a=a.fallback;var c=this.state.errorRaw;return c!=null?typeof a==="function"?a(b):a:b};return b}(a.PureComponent);g["default"]=b}),98);
__d("everySet",[],(function(a,b,c,d,e,f){"use strict";function a(a,b,c){var d=a.entries(),e=d.next();while(!e.done){var f=e.value;if(!b.call(c,f[1],f[0],a))return!1;e=d.next()}return!0}f["default"]=a}),66);
__d("equalsSet",["everySet"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return a.size!==b.size?!1:c("everySet")(a,function(a){return b.has(a)})}g["default"]=a}),98);
__d("GlobalVideoPortsPortaler.react",["CoreVideoPlayerFitParentContainer.react","GlobalVideoPortsPortalerErrorBoundary.react","GlobalVideoPortsRenderers.react","ReactDOM","equalsSet","react","react-compiler-runtime","useUnsafeRef_DEPRECATED"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=i||(i=d("react"));b=i;var k=b.useEffect,l=b.useRef,m=b.useState;function n(a,b,e,f,g){var h=d("react-compiler-runtime").c(6),i=l(null),j;h[0]!==b||h[1]!==e||h[2]!==f||h[3]!==g||h[4]!==a?(j=function(){var d,h=i.current;d=new Set((d=a.map(o))!=null?d:[]);if(h==null||!c("equalsSet")(h,d)){i.current=d;h=b.current;d=e.current;h!=null&&f(h);d!=null&&g(d)}},h[0]=b,h[1]=e,h[2]=f,h[3]=g,h[4]=a,h[5]=j):j=h[5];k(j,void 0)}function o(a){return a.portablePlaceID}function a(a){var b=a.globalVideoPortsManager,e=a.globalVideoPortsState,f=a.thisVideoID;a=m(function(){return d("CoreVideoPlayerFitParentContainer.react").createFitParentContainerDiv({debugRole:null})});var g=a[0],i=l(null),k=(h||(h=c("useUnsafeRef_DEPRECATED")))(null),o=(a=e.videos.get(f))!=null?a:null,p=b.getPlacesBorrowingThisVideo(e.places,f);a=p.length<=0;e=a?null:b.selectCurrentPlaceFromThesePlaces(p,o?o.preferredPlaceID:null);var q=a?null:b.selectCurrentPlaceFromThesePlaces(b.skipUnlinkedPlaces(p),o?o.preferredPlaceID:null);b=function(a){k.current=a,p.forEach(function(b){b=b.injectCoreVideoStatesRef.current;b&&b(i.current,a)})};var r=function(){return null},s=function(a){i.current=a,p.forEach(function(a){a=a.injectCoreVideoStatesRef.current;a&&a(i.current,k.current)})};n(p,k,i,b,s);return a?null:j.jsxs(j.Fragment,{children:[d("ReactDOM").createPortal(e?j.jsx(c("GlobalVideoPortsPortalerErrorBoundary.react"),{description:"GlobalVideoPortsPortaler",fallback:r,onError:s,children:j.jsx(d("GlobalVideoPortsRenderers.react").GlobalVideoPortsPlayerRenderer,{coreVideoPlayerMetaData:e.coreVideoPlayerMetaData,currentPlaceID:e.portablePlaceID,currentVideoID:f,fullscreenController:e.fullscreenController,implementations:e.implementations,isFullscreen:e.isFullscreen,onCoreVideoStatesChanged:b,previousPlaceMetaData:(a=o==null?void 0:o.previousPlaceMetaData)!=null?a:null,trackingDataEncrypted:e.trackingDataEncrypted,trackingNodes:e.trackingNodes,viewportMarginsForViewability:e.viewportMarginsForViewability})}):null,g),p.map(function(a){var b;return d("ReactDOM").createPortal(a.portablePlaceID===(q==null?void 0:q.portablePlaceID)?j.jsx(d("CoreVideoPlayerFitParentContainer.react").CoreVideoPlayerFitParentDOMContainer,{debugRole:null,domElement:g}):j.jsx(d("GlobalVideoPortsRenderers.react").GlobalVideoPortsPlaceholderRenderer,{currentPlaceID:(b=q==null?void 0:q.portablePlaceID)!=null?b:null,currentVideoID:f,previousPlaceMetaData:(b=o==null?void 0:o.previousPlaceMetaData)!=null?b:null,renderPlaceholder:a.renderPlaceholder,thisPlaceID:a.portablePlaceID,videoPixelsAspectRatio:(b=a.coreVideoPlayerMetaData.videoPixelsAspectRatio)!=null?b:null}),a.portablePlaceContainer)})]})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("GlobalVideoPortsImpl.react",["CometErrorBoundary.react","GlobalVideoPortsContexts","GlobalVideoPortsManager","GlobalVideoPortsPortaler.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react")),j=h.useEffect;function a(a){var b=d("react-compiler-runtime").c(3),e=a.setGlobalVideoPortsManager,f;b[0]!==e?(a=function(){var a=k;e(a)},f=[e],b[0]=e,b[1]=a,b[2]=f):(a=b[1],f=b[2]);j(a,f);var g=[],h=d("GlobalVideoPortsContexts").useGlobalVideoPortsManager(),l=d("GlobalVideoPortsContexts").useGlobalVideoPortsState();h&&l&&l.videos.forEach(function(a,b){g.push(i.jsx(c("CometErrorBoundary.react"),{children:i.jsx(c("GlobalVideoPortsPortaler.react"),{globalVideoPortsManager:h,globalVideoPortsState:l,thisVideoID:b})},b))});return i.jsx(i.Fragment,{children:g})}function k(a){return new(d("GlobalVideoPortsManager").GlobalVideoPortsManager)(a)}g["default"]=a}),98);
__d("LSPlatformClientSingleton",[],(function(a,b,c,d,e,f){"use strict";var g={contents:void 0};function a(a){g.contents=a}f.saveInstance=a}),66);
__d("maybeSetupMAWMainThreadLogger",["MessengerLogHistory","cr:6999","cr:7350","isArmadillo","isRegisterArmadilloOnIgEnabled"],(function(a,b,c,d,e,f,g){"use strict";var h=d("MessengerLogHistory").getInstance("client_init"),i=(a=b("cr:6999"))!=null?a:b("cr:7350");e=function(){i!=null&&(c("isArmadillo")()||c("isRegisterArmadilloOnIgEnabled")())&&(h.debug("Starting MAW main thread logger setup..."),i.setupMainWaLogger(),h.debug("Starting MAW main thread logger setup success"))};g.maybeSetupMAWMainThreadLogger=e}),98);
__d("LSPlatformClientInstances",["ExecutionEnvironment","FBLogger","LSLocalize","LSPlatformArmadilloUtils","LSPlatformClientSingleton","LSPlatformLsInitLog","LSSuspense","MAWLoggerUtils","MAWMIC","MessengerLogHistory","PromiseAnnotate","cr:19622","getErrorSafe","maybeSetupMAWMainThreadLogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;b("LSLocalize");d("MAWLoggerUtils").initMessengerWebLogging();var k=d("MessengerLogHistory").getInstance("client_init"),l=(j||(j=c("LSSuspense"))).makeCollection(),m=!1;function a(a,e,f){d("MAWMIC").startMAWMICFlow();m||(k.debug("[Occamadillo] Beginning hardcoded init sync"),m=!0,d("maybeSetupMAWMainThreadLogger").maybeSetupMAWMainThreadLogger());d("LSPlatformArmadilloUtils").reportInitStart();var g=function(a){a=c("getErrorSafe")(a);k.debug("Initializing LSPlatformClient failed");d("LSPlatformLsInitLog").fail("client_setup_failure",a);d("MAWMIC").fail("client_setup_failure",a);c("FBLogger")("messenger_web").catching(a).warn("[LS] LSPlatformClient initialization failure");throw a};return(j||(j=c("LSSuspense"))).getFromCollection(l,a,function(){return(h||(h=d("PromiseAnnotate"))).setDisplayName(async function(){d("LSPlatformLsInitLog").addAnnotations({bool:{canUseDOM:(i||(i=c("ExecutionEnvironment"))).canUseDOM,fromReact:f==null?void 0:f.fromReact},string:{configAppId:a.appId,configPlatformName:a.platformName}});k.debug("Messenger loading UI suspending");try{var h=b("cr:19622")!=null?await b("cr:19622").maybeEvaluateInitSyncEagerly(a):!1;if(!(i||(i=c("ExecutionEnvironment"))).isInBrowser)return await a.getDb();h=e(a,{didEvaluateInitSyncEagerly:h}).then(function(a){d("LSPlatformLsInitLog").addPoint("start_client");return a.start().then(function(){k.debug("Initializing LSPlatformClient success");d("LSPlatformClientSingleton").saveInstance(a);d("LSPlatformArmadilloUtils").reportInitEnd();return a.db})});return await h}catch(a){g(a)}finally{k.debug("Messenger loading UI unsuspending")}}(),"InitLSPlatformClient")})}e={getOrInit:a};g.default=e}),98);
__d("LSPlatformClientProviderAddons.react",["CometPlaceholder.react","cr:6495","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(){var a=d("react-compiler-runtime").c(1),e;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(e=i.jsx(c("CometPlaceholder.react"),{fallback:null,name:"LSPlatformClientProviderAddons",children:b("cr:6495")!=null&&i.jsx(b("cr:6495"),{})}),a[0]=e):e=a[0];return e}g["default"]=a}),98);
__d("MAWCondSetup.react",["cr:3921","gkx","react"],(function(a,b,c,d,e,f,g){"use strict";var h;a=h||d("react");f=c("gkx")("20836")?a.Fragment:(e=b("cr:3921"))!=null?e:a.Fragment;d=f;g["default"]=d}),98);
__d("MAWCondWrapper.react",["MAWCondSetup.react","MAWSetupWrapperOnce.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){var b=d("react-compiler-runtime").c(3);a=a.children;var e;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(e=i.jsx(c("MAWCondSetup.react"),{}),b[0]=e):e=b[0];b[1]!==a?(e=i.jsx(c("MAWSetupWrapperOnce.react"),{setupComponent:e,children:a}),b[1]=a,b[2]=e):e=b[2];return e}g["default"]=a}),98);
__d("LSPlatformClientProvider.react",["CometDOMOnlyBoundary.react","CometPlaceholder.react","LSPlatformClientInstances","LSPlatformClientProviderAddons.react","LSPlatformErrorsCatcher.react","LSSuspense","MAWCondWrapper.react","ReStoreProvider.react","gkx","qex","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=j||d("react");function l(a,b){var e=d("react-compiler-runtime").c(3);if(e[0]!==a||e[1]!==b){var f=(h||(h=c("LSSuspense"))).getOrSuspend(a);f=c("LSPlatformClientInstances").getOrInit(f,b,{fromReact:!0});e[0]=a;e[1]=b;e[2]=f}else f=e[2];return f}function m(a){var b=d("react-compiler-runtime").c(3),c=a.children,e=a.config;a=a.loadLSPlatformClient;e=l(e,a);b[0]!==c||b[1]!==e?(a=e!=null?k.jsx((i||(i=d("ReStoreProvider.react"))).ReStoreProvider,{db:e,children:c}):c,b[0]=c,b[1]=e,b[2]=a):a=b[2];return a}function a(a){var b=d("react-compiler-runtime").c(16),e=a.children,f=a.config,g=a.errorFallback,h=a.loadLSPlatformClient;a=a.placeholder;var i;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(i=k.jsx(c("LSPlatformClientProviderAddons.react"),{}),b[0]=i):i=b[0];var j;b[1]!==e||b[2]!==a?(j=k.jsx(c("CometPlaceholder.react"),{fallback:a,name:"LSPlatformClientProvider.UISuspense",children:e}),b[1]=e,b[2]=a,b[3]=j):j=b[3];b[4]!==f||b[5]!==h||b[6]!==j?(e=k.jsxs(m,{config:f,loadLSPlatformClient:h,children:[i,j]}),b[4]=f,b[5]=h,b[6]=j,b[7]=e):e=b[7];b[8]!==a||b[9]!==e?(i=k.jsx(c("MAWCondWrapper.react"),{children:k.jsx(c("CometPlaceholder.react"),{fallback:a,name:"LSPlatformClientProvider.ClientProvider",children:e})}),b[8]=a,b[9]=e,b[10]=i):i=b[10];b[11]!==g||b[12]!==i?(f=k.jsx(c("LSPlatformErrorsCatcher.react"),{fallback:g,children:i}),b[11]=g,b[12]=i,b[13]=f):f=b[13];h=f;b[14]!==h?(j=c("gkx")("12254")&&!c("qex")._("3809")?k.jsx(c("CometDOMOnlyBoundary.react"),{children:h}):h,b[14]=h,b[15]=j):j=b[15];return j}g["default"]=a}),98);
__d("LSPlatformClientProviderWithDeferredLoadingStrategy.react",["LSPlatformClientProvider.react","LSPlatformLsInitLog","cr:2542","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");async function j(a,c){d("LSPlatformLsInitLog").addPoint("load_ls_platform_client");var e=await b("cr:2542").load();d("LSPlatformLsInitLog").addPoint("load_ls_platform_client_loaded");return e.make(a,c)}function a(a){var b=d("react-compiler-runtime").c(5),e=a.children,f=a.config,g=a.errorFallback;a=a.placeholder;var h;b[0]!==e||b[1]!==f||b[2]!==g||b[3]!==a?(h=i.jsx(c("LSPlatformClientProvider.react"),{config:f,errorFallback:g,loadLSPlatformClient:j,placeholder:a,children:e}),b[0]=e,b[1]=f,b[2]=g,b[3]=a,b[4]=h):h=b[4];return h}g.default=a}),98);
__d("LSPlatformGraphQLLightspeedRequestQuery.graphql",["relay-runtime"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"deviceId"},{defaultValue:null,kind:"LocalArgument",name:"requestId"},{defaultValue:null,kind:"LocalArgument",name:"requestPayload"},{defaultValue:null,kind:"LocalArgument",name:"requestType"}],b=[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:[{kind:"Variable",name:"device_id",variableName:"deviceId"},{kind:"Variable",name:"request_id",variableName:"requestId"},{kind:"Variable",name:"request_payload",variableName:"requestPayload"},{kind:"Variable",name:"request_type",variableName:"requestType"}],concreteType:"LightspeedWebResponse",kind:"LinkedField",name:"lightspeed_web_request",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"payload",storageKey:null},{alias:null,args:null,concreteType:"LightspeedWebRequestDependency",kind:"LinkedField",name:"dependencies",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"experiments",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"target",storageKey:null}],storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"LSPlatformGraphQLLightspeedRequestQuery",selections:b,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"LSPlatformGraphQLLightspeedRequestQuery",selections:b},params:{id:"8996647210435532",metadata:{},name:"LSPlatformGraphQLLightspeedRequestQuery",operationKind:"query",text:null}}}();b("relay-runtime").PreloadableQueryRegistry.set(a.params.id,a);e.exports=a}),null);
__d("LSPlatformGraphQLLightspeedRequestQuery",["LSPlatformGraphQLLightspeedRequestQuery.graphql"],(function(a,b,c,d,e,f,g){"use strict";var h;a=h!==void 0?h:h=b("LSPlatformGraphQLLightspeedRequestQuery.graphql");g.query=a}),98);
__d("LSPlatformGraphQLLightspeedRequest",["CometRelay","LSPlatformGraphQLLightspeedRequestQuery","XPlatRelayEnvironment"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e){return d("CometRelay").fetchQuery(d("XPlatRelayEnvironment").getRelayEnvironment(),d("LSPlatformGraphQLLightspeedRequestQuery").query,{deviceId:a,requestId:b,requestPayload:c,requestType:e}).toPromise().then(function(a){a=a==null?void 0:(a=a.viewer)==null?void 0:a.lightspeed_web_request;if(a!=null)return babelHelpers["extends"]({dependencies:void 0},a)})}g["default"]=a}),98);
__d("LSPlatformMessengerConfig",["LSDatabaseSingleton","LSDatascriptEvaluatorMaybeDeferred","LSPlatformGraphQLLightspeedRequest","LSPlatformMessengerSyncParams","LSSuspense","LSVersion","ServerAppID","cr:19623","cr:2132","cr:2207","cr:3239","getMWLSRegion","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;h=(h=b("cr:19623"))!=null?h:b("cr:2207");i=(i=b("cr:3239"))!=null?i:c("LSPlatformGraphQLLightspeedRequest");function a(){return(k||(k=d("LSDatabaseSingleton"))).LSDatabaseSingleton}function e(){return b("cr:2132")().then(function(a){return function(b,d){return 3===b?a.dgw(c("LSVersion"),d):a.mqtt(c("LSVersion"),d)}})}function f(){return c("LSDatascriptEvaluatorMaybeDeferred")()}h={appId:c("ServerAppID").app_id,eagerEvaluatorForInitSync:h,executeGraphQLLightSpeedRequest:c("gkx")("3889")?i:c("LSPlatformGraphQLLightspeedRequest"),getDb:a,getEval:f,platformName:"Messenger",realtimeUnderylingTransport:e,region:c("getMWLSRegion")(),schemaVersion:c("LSVersion"),sendHardcodedInitSync:!0,syncParams:c("LSPlatformMessengerSyncParams")};i=(j||(j=c("LSSuspense"))).makeWithValue(h);g.config=h;g.configEagerlyLoaded=i}),98);
__d("LSPlatformCometClientStartEagerly",["LSPlatformClientInstances","LSPlatformLsInitLog","LSPlatformMessengerConfig","cr:2542"],(function(a,b,c,d,e,f,g){"use strict";async function h(a,c){d("LSPlatformLsInitLog").addPoint("load_ls_platform_client");var e=await b("cr:2542").load();d("LSPlatformLsInitLog").addPoint("load_ls_platform_client_loaded");return e.make(a,c)}function a(){try{c("LSPlatformClientInstances").getOrInit(d("LSPlatformMessengerConfig").config,h)}catch(a){return}}g.start=a}),98);
__d("LSPlatformEvaluateInitSyncEagerly",["ExecutionEnvironment","LSClearEpochBeforeResumeSync","LSDatabaseProviderType","LSPlatformDeviceId","LSPlatformHardcodedInitSync","LSPlatformLsInitLog","cr:3411","qex","recoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h,i=async function(a,e){d("LSPlatformLsInitLog").addPoint("ds_eval_registration");e=await e();var f;try{f=b("cr:3411")!=null?b("cr:3411").registerEval(e)()(a):e()(a)}catch(b){c("recoverableViolation")("fail to register datascriptEvaluator","ls_web_init",{error:b}),f=e()(a)}d("LSPlatformLsInitLog").addPoint("ds_eval_registration_end");return f};async function a(a){if(!(h||(h=c("ExecutionEnvironment"))).canUseDOM&&!c("qex")._("3809"))return!1;if(!a.sendHardcodedInitSync)return!1;var b=a.eagerEvaluatorForInitSync;if(b==null)return!1;var e=await a.getDb();if(d("LSDatabaseProviderType").isProviderPersisted(e))return!1;d("LSPlatformLsInitLog").addPoint("evaluate_init_sync_start");var f=d("LSPlatformDeviceId").getDeviceIdForProviderType("ephemeral");b=await i(e,b);await d("LSClearEpochBeforeResumeSync").call(e);await d("LSPlatformHardcodedInitSync").sendHardcodedInitSync(a,b,e,f);d("LSPlatformLsInitLog").addPoint("evaluate_init_sync_end");return!0}g.getDatascriptEvaluator=i;g.maybeEvaluateInitSyncEagerly=a}),98);
__d("MWChatBadgeCountQuery.graphql",["relay-runtime"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"suppress_xac_groups"}],b=[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"ViewerMessageThreadsConnection",kind:"LinkedField",name:"message_threads",plural:!1,selections:[{alias:null,args:[{kind:"Variable",name:"suppress_xac_groups",variableName:"suppress_xac_groups"}],kind:"ScalarField",name:"unseen_count",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"recent_unread_count_with_e2ee",storageKey:null},{kind:"ClientExtension",selections:[{alias:null,args:null,kind:"ScalarField",name:"is_loading_client_threads",storageKey:null}]}],storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"MWChatBadgeCountQuery",selections:b,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"MWChatBadgeCountQuery",selections:b},params:{id:"9649973961748511",metadata:{},name:"MWChatBadgeCountQuery",operationKind:"query",text:null}}}();b("relay-runtime").PreloadableQueryRegistry.set(a.params.id,a);e.exports=a}),null);
__d("useMWJewelStopLoadingLogger",["QPLEvent","interaction-tracing","qpl","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(h||d("react")).useEffect,k=c("qpl")._(30616158,"2565");function a(a,b,e){var f=d("react-compiler-runtime").c(5),g,h;f[0]!==b||f[1]!==a||f[2]!==e?(g=function(){e||c("interaction-tracing").InteractionTracingCore.getPendingInteractions().forEach(function(c){var e=c.getTrace();if(((e=e==null?void 0:e.completed)!=null?e:0)>0)return;c.getQPLEventMarkerId()===(i||(i=d("QPLEvent"))).getMarkerId(k)&&(c.addAnnotationInt("badgeCount",a),c.addAnnotationInt("badgeUnreadCount",b),a===0&&c.forceCompleteTrace())})},h=[e,a,b],f[0]=b,f[1]=a,f[2]=e,f[3]=g,f[4]=h):(g=f[3],h=f[4]);j(g,h)}g["default"]=a}),98);
__d("MWChatBadgeCount.react",["fbt","CometHeroHoldTrigger.react","CometPlaceholder.react","CometRelay","FDSNumberedBadge.react","HeroInteractionIgnoreWithDiv.react","MWChatBadgeCountQuery.graphql","MWChatBadgeCountUpdates.react","cr:2290","gkx","hero-tracing","react","react-compiler-runtime","useMWJewelStopLoadingLogger"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=j||(j=d("react"));f=j;var l=f.useEffect,m=f.useRef;function a(){return null}var n=(f=b("cr:2290"))!=null?f:a;function o(a){var e,f=d("react-compiler-runtime").c(12),g=a.overflow,j=a.setBadgeCount;a=d("CometRelay").useLazyLoadQuery(i!==void 0?i:i=b("MWChatBadgeCountQuery.graphql"),{suppress_xac_groups:!1},{fetchPolicy:"store-or-network"});e=((e=a.viewer)==null?void 0:(e=e.message_threads)==null?void 0:e.is_loading_client_threads)!==!1;a=(a=a.viewer)==null?void 0:a.message_threads;var n=a!=null&&a.unseen_count!=null&&a.unseen_count>0?Math.min(d("MWChatBadgeCountUpdates.react").minSyncedThreads,a.unseen_count):0;a=a!=null&&a.recent_unread_count_with_e2ee!=null&&a.recent_unread_count_with_e2ee>0?Math.min(d("MWChatBadgeCountUpdates.react").minSyncedThreads,a.recent_unread_count_with_e2ee):0;var o=c("gkx")("15622")?a:n,p=m(null),q;f[0]!==o||f[1]!==j?(n=function(){j&&p.current!==o&&(p.current=o,j(o))},q=[o,j],f[0]=o,f[1]=j,f[2]=n,f[3]=q):(n=f[2],q=f[3]);l(n,q);c("useMWJewelStopLoadingLogger")(o,a,e);f[4]!==o||f[5]!==g?(n=o>0?k.jsx(c("FDSNumberedBadge.react"),{accessibilityText:h._(/*BTDS*/"{count} Unread Chats",[h._param("count",o)]),overflow:g,testid:void 0,value:o,vcIgnore:!0}):null,f[4]=o,f[5]=g,f[6]=n):n=f[6];f[7]!==e?(q=k.jsx(c("CometHeroHoldTrigger.react"),{description:"MessengerBadgeLoadingHold",hold:e}),f[7]=e,f[8]=q):q=f[8];f[9]!==n||f[10]!==q?(a=k.jsxs(k.Fragment,{children:[n,q]}),f[9]=n,f[10]=q,f[11]=a):a=f[11];return a}function e(a){var b=d("react-compiler-runtime").c(7),e=a.overflow;a=a.setBadgeCount;var f=n(),g;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(g=k.jsx("span",{}),b[0]=g):g=b[0];b[1]!==e||b[2]!==a?(g=k.jsx(c("CometPlaceholder.react"),{fallback:g,name:"MWChatBadgeCount",children:k.jsx(o,{overflow:e,setBadgeCount:a})}),b[1]=e,b[2]=a,b[3]=g):g=b[3];b[4]!==f||b[5]!==g?(e=k.jsx(c("HeroInteractionIgnoreWithDiv.react"),{children:k.jsx(d("hero-tracing").HeroInteraction,{alwaysMarkMutationRootAsVisualChange:!0,interactionDesc:"MSGR_JEWEL_BADGE",interactionUUID:f,pageletName:"MessengerJewelBadge",children:g})}),b[4]=f,b[5]=g,b[6]=e):e=b[6];return e}g["default"]=e}),226);
__d("MWChatBadgeUpdaterImpl.react",["CometErrorBoundary.react","ExecutionEnvironment","FBLogger","cr:21415","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=i||d("react");function k(a){var b=c("FBLogger")("messenger_web_entrypoints");a!=null&&(b=b.catching(a));b.debug("Error loading MWChatBadgeCountUpdater")}function a(){var a=d("react-compiler-runtime").c(1),e;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(e=(h||(h=c("ExecutionEnvironment"))).canUseDOM?j.jsx(c("CometErrorBoundary.react"),{onError:k,children:b("cr:21415")&&j.jsx(b("cr:21415"),{})}):null,a[0]=e):e=a[0];return e}g["default"]=a}),98);
__d("MWChatHeadError.react",["fbt","CometHeroFailTrigger.react","CometHeroInteractionWithDiv.react","FDSCautionTriangleFilled24Icon","MWChatInteraction","MWXIcon_DEPRECATED.react","MWXPressable.react","MWXTooltip.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react"),k={compose:{alignItems:"x6s0dn4",backgroundColor:"xcrg951",borderStartStartRadius:"x1c9tyrk",borderStartEndRadius:"xeusxvb",borderEndEndRadius:"x1pahc9y",borderEndStartRadius:"x1ertn4p",display:"x78zum5",height:"xsdox4t",justifyContent:"xl56j7k",position:"x1n2onr6",width:"x1useyqa",$$css:!0},dropShadow:{boxShadow:"x1qeybcx",":hover_boxShadow":"x19xcq9t",$$css:!0}},l=h._(/*BTDS*/"Something went wrong while loading chat");function a(a){var b=d("react-compiler-runtime").c(7),e=a.contextRef;a=a.onPress;var f,g;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(f=d("MWChatInteraction").get(d("MWChatInteraction").MW_CHATHEADS_LOAD),g=j.jsx(c("CometHeroFailTrigger.react"),{description:"Error while loading chatheads",fail:!0}),b[0]=f,b[1]=g):(f=b[0],g=b[1]);var h=a==null,i;b[2]===Symbol["for"]("react.memo_cache_sentinel")?(i=j.jsx(c("MWXIcon_DEPRECATED.react"),{icon:c("FDSCautionTriangleFilled24Icon")}),b[2]=i):i=b[2];b[3]!==e||b[4]!==a||b[5]!==h?(f=j.jsxs(c("CometHeroInteractionWithDiv.react"),{interactionDesc:"Comet initial load to chatheads VC",interactionUUID:f,children:[g,j.jsx(c("MWXTooltip.react"),{align:"end",position:"above",tooltip:l,children:j.jsx(c("MWXPressable.react"),{"aria-label":l,disabled:h,display:"inline",onPress:a,ref:e,xstyle:m,children:i})})]}),b[3]=e,b[4]=a,b[5]=h,b[6]=f):f=b[6];return f}function m(a){return[k.compose,k.dropShadow]}g["default"]=a}),226);
__d("MWChatDisabled.react",["MWChatHeadError.react","react","react-compiler-runtime","useShouldShowMessagingEntrypointInCometRoot"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){var b=d("react-compiler-runtime").c(4),e=a.contextRef;a=a.onPress;var f=c("useShouldShowMessagingEntrypointInCometRoot")("CHAT"),g;b[0]!==e||b[1]!==a||b[2]!==f?(g=f?i.jsx("div",babelHelpers["extends"]({className:"x1ey2m1c xtijo5x xixxii4"},{children:i.jsx("div",babelHelpers["extends"]({className:"x191j7n5 xdg88n9 x10l6tqk"},{children:i.jsx(c("MWChatHeadError.react"),{contextRef:e,onPress:a})}))})):null,b[0]=e,b[1]=a,b[2]=f,b[3]=g):g=b[3];return g}g["default"]=a}),98);
__d("MWV2Chat.react",["CometErrorBoundary.react","FBLogger","JSResourceForInteraction","LSDatabaseAfterInitSyncSingleton","LSDatabaseSingleton","LSPlatformClientProviderWithDeferredLoadingStrategy.react","LSPlatformMessengerConfig","MWChatDisabled.react","MWChatInteraction","MWXLazyPopoverTrigger.react","cr:11569","gkx","react","react-compiler-runtime","shouldHideChatOnAppsSubdomain"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=h||(h=d("react"));e=h;var k=e.useEffect,l=e.useLayoutEffect;function m(a){var b=c("FBLogger")("messenger_web");a!=null&&(b=b.catching(a));b.warn("Error loading MWV2Chat")}var n=c("JSResourceForInteraction")("MWChatErrorStatePopover.react").__setRef("MWV2Chat.react"),o=function(a){return j.jsx(c("MWXLazyPopoverTrigger.react"),{align:"end",popoverProps:{error:a},popoverResource:n,position:"above",visibleOnLoad:!0,children:function(a,b){return j.jsx(c("MWChatDisabled.react"),{contextRef:a,onPress:b})}})},p=!c("gkx")("22788")||c("shouldHideChatOnAppsSubdomain")();function a(){var a=d("react-compiler-runtime").c(3),e;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(e=[],a[0]=e):e=a[0];l(r,e);a[1]===Symbol["for"]("react.memo_cache_sentinel")?(e=[],a[1]=e):e=a[1];k(q,e);a[2]===Symbol["for"]("react.memo_cache_sentinel")?(e=j.jsx(c("CometErrorBoundary.react"),{fallback:o,onError:m,children:p?j.jsx(c("MWChatDisabled.react"),{}):b("cr:11569")&&j.jsx(c("LSPlatformClientProviderWithDeferredLoadingStrategy.react"),{config:d("LSPlatformMessengerConfig").configEagerlyLoaded,errorFallback:o,children:j.jsx(b("cr:11569"),{})})}),a[2]=e):e=a[2];return e}function q(){(p||b("cr:11569")==null)&&d("LSDatabaseAfterInitSyncSingleton").resolveInitSync((i||(i=d("LSDatabaseSingleton"))).LSDatabaseSingleton)}function r(){d("MWChatInteraction").addAutoChatTabMarkerPoint("mwv2_chat_rendered")}g["default"]=a}),98);
__d("SearchCometGlobalTypeaheadInputStrategy.react",["CometTypeaheadInputRoundedStrategy.react","SearchCometTypeaheadEventEmitterContext","cr:2012305","react","react-compiler-runtime","useMergeRefs","useRefEffect","useSearchCometEventEmitterContext"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react"));e=h;var j=e.useEffect,k=e.useRef;function a(a){var e=d("react-compiler-runtime").c(14),f,g,h;e[0]!==a?(h=a.ref,f=a.onChange,g=babelHelpers.objectWithoutPropertiesLoose(a,["ref","onChange"]),e[0]=a,e[1]=f,e[2]=g,e[3]=h):(f=e[1],g=e[2],h=e[3]);a=(a=c("useSearchCometEventEmitterContext")(c("SearchCometTypeaheadEventEmitterContext")))!=null?a:{};var l=a.subscribeToGlobalTypeaheadFocus,m;e[4]!==f||e[5]!==l?(a=function(a){return l==null?void 0:l(function(){if(a==null)return;a.value="";a.focus();f("")})},m=[f,l],e[4]=f,e[5]=l,e[6]=a,e[7]=m):(a=e[6],m=e[7]);a=c("useRefEffect")(a,m);var n=k(null),o=k(!1),p;e[8]===Symbol["for"]("react.memo_cache_sentinel")?(m=function(){var a=n.current;if(b("cr:2012305")!=null&&a!=null&&o.current===!1){b("cr:2012305").trackTypingPerf(a,"top_tab_serp_typeahead");o.current=!0;return function(){b("cr:2012305").unregisterTypingPerf(a),o.current=!1}}},p=[],e[8]=m,e[9]=p):(m=e[8],p=e[9]);j(m,p);m=c("useMergeRefs")(a,n);p=c("useMergeRefs")(m,h);e[10]!==p||e[11]!==f||e[12]!==g?(a=i.jsx(c("CometTypeaheadInputRoundedStrategy.react"),babelHelpers["extends"]({},g,{onChange:f,ref:p})),e[10]=p,e[11]=f,e[12]=g,e[13]=a):a=e[13];return a}g["default"]=a}),98);
__d("useCometInternalTypeaheadHeroTracing",["react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(h||d("react")).useMemo;function a(a,b){var c=a?a.getInteractionUUID():null,d=a?a.getVCTrackerRef():null,e=c!=null&&a!=null&&!a.isResolved();return i(function(){var f=function(c,d){a&&d!=null&&a.setEventStartTime(d.timeStamp),b(c,d)};return{interactionUUID:c,onTracedChange:f,shouldHoldHeroTracing:e,vcTrackerRef:d}},[c,b,e,a,d])}g["default"]=a}),98);
__d("SearchCometGlobalTypeaheadLayoutContextualStrategy.react",["CometHeroHoldTrigger.react","CometHeroInteractionWithDiv.react","CometTypeaheadInternalLayoutInlineStrategy.react","react","react-compiler-runtime","useBaseTypeaheadLayoutContextualStrategyStateContext","useCometInternalTypeaheadFetch","useCometInternalTypeaheadHeroTracing","useCometInternalTypeaheadState","useCometTypeaheadInputRefs","useCometTypeaheadInternalLayoutContextualStrategyHandlers","useCometTypeaheadLayoutContextualStrategyARIAProps","useSearchCometGlobalTypeaheadStyles"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){var b=d("react-compiler-runtime").c(74),e,f,g,h,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B;b[0]!==a?(y=a.extraLayoutProps,f=a.helperText,g=a.label,h=a.onAbandonTypeahead_DO_NOT_USE,j=a.onBlur,k=a.onChange,l=a.onClick,m=a.onDownArrow,n=a.onEnter,o=a.onEscape,p=a.onHighlightEntry,r=a.onOutsideClick,s=a.onPressEntry,u=a.onShiftTab,v=a.onTab,w=a.onUpArrow,z=a.traceProvider,q=a.onLeftArrow,t=a.onRightArrow,A=a.viewRole,e=a.inputRef,B=a.xstyles,x=babelHelpers.objectWithoutPropertiesLoose(a,["extraLayoutProps","helperText","label","onAbandonTypeahead_DO_NOT_USE","onBlur","onChange","onClick","onDownArrow","onEnter","onEscape","onHighlightEntry","onOutsideClick","onPressEntry","onShiftTab","onTab","onUpArrow","traceProvider","onLeftArrow","onRightArrow","viewRole","inputRef","xstyles"]),b[0]=a,b[1]=e,b[2]=f,b[3]=g,b[4]=h,b[5]=j,b[6]=k,b[7]=l,b[8]=m,b[9]=n,b[10]=o,b[11]=p,b[12]=q,b[13]=r,b[14]=s,b[15]=t,b[16]=u,b[17]=v,b[18]=w,b[19]=x,b[20]=y,b[21]=z,b[22]=A,b[23]=B):(e=b[1],f=b[2],g=b[3],h=b[4],j=b[5],k=b[6],l=b[7],m=b[8],n=b[9],o=b[10],p=b[11],q=b[12],r=b[13],s=b[14],t=b[15],u=b[16],v=b[17],w=b[18],x=b[19],y=b[20],z=b[21],A=b[22],B=b[23]);b[24]!==y?(a=y===void 0?{}:y,b[24]=y,b[25]=a):a=b[25];y=a;a=y.afterViewContent;y=y.beforeViewContent;var C=c("useBaseTypeaheadLayoutContextualStrategyStateContext")();C=C.isOpened;var D=c("useCometInternalTypeaheadState")(),E=D.activeEntries,F=D.highlightedEntry;D=D.secondaryActionHighlighted;var G=c("useCometInternalTypeaheadFetch")();G=G.isLoading;e=c("useCometTypeaheadInputRefs")(e);var H=e.composedRef;e=e.inputRef;var I=c("useSearchCometGlobalTypeaheadStyles")();B=(B=B)!=null?B:I;I=c("useCometInternalTypeaheadHeroTracing")(z,k);z=I.interactionUUID;k=I.onTracedChange;var J=I.shouldHoldHeroTracing;I=I.vcTrackerRef;var K;b[26]!==h||b[27]!==j||b[28]!==l||b[29]!==m||b[30]!==n||b[31]!==o||b[32]!==p||b[33]!==q||b[34]!==r||b[35]!==s||b[36]!==t||b[37]!==u||b[38]!==v||b[39]!==k||b[40]!==w?(K={onAbandonTypeahead_DO_NOT_USE:h,onBlur:j,onChange:k,onClick:l,onDownArrow:m,onEnter:n,onEscape:o,onHighlightEntry:p,onLeftArrow:q,onOutsideClick:r,onPressEntry:s,onRightArrow:t,onShiftTab:u,onTab:v,onUpArrow:w},b[26]=h,b[27]=j,b[28]=l,b[29]=m,b[30]=n,b[31]=o,b[32]=p,b[33]=q,b[34]=r,b[35]=s,b[36]=t,b[37]=u,b[38]=v,b[39]=k,b[40]=w,b[41]=K):K=b[41];b[42]!==e||b[43]!==K?(h={handlers:K,inputRef:e},b[42]=e,b[43]=K,b[44]=h):h=b[44];j=c("useCometTypeaheadInternalLayoutContextualStrategyHandlers")(h);b[45]!==E||b[46]!==f||b[47]!==F||b[48]!==C||b[49]!==g||b[50]!==D||b[51]!==A?(l={activeEntries:E,helperText:f,highlightedEntry:F,inputLabel:g,isOpened:C,secondaryActionHighlighted:D,viewRole:A},b[45]=E,b[46]=f,b[47]=F,b[48]=C,b[49]=g,b[50]=D,b[51]=A,b[52]=l):l=b[52];m=c("useCometTypeaheadLayoutContextualStrategyARIAProps")(l);b[53]!==J?(n=i.jsx(c("CometHeroHoldTrigger.react"),{description:"SearchInternalTypeahead",hold:J}),b[53]=J,b[54]=n):n=b[54];b[55]!==a||b[56]!==m||b[57]!==y||b[58]!==G||b[59]!==C?(o={afterViewContent:a,ariaProps:m,beforeViewContent:y,helperTextComponent:null,isLoading:G,isOpened:C},b[55]=a,b[56]=m,b[57]=y,b[58]=G,b[59]=C,b[60]=o):o=b[60];b[61]!==H||b[62]!==j||b[63]!==g||b[64]!==x||b[65]!==o||b[66]!==A||b[67]!==B?(p=i.jsx(c("CometTypeaheadInternalLayoutInlineStrategy.react"),babelHelpers["extends"]({},x,j,{extraLayoutProps:o,inputRef:H,label:g,viewRole:A,xstyles:B})),b[61]=H,b[62]=j,b[63]=g,b[64]=x,b[65]=o,b[66]=A,b[67]=B,b[68]=p):p=b[68];b[69]!==z||b[70]!==n||b[71]!==p||b[72]!==I?(q=i.jsxs(c("CometHeroInteractionWithDiv.react"),{interactionDesc:"Search_Typeahead",interactionUUID:z,ref:I,children:[n,p]}),b[69]=z,b[70]=n,b[71]=p,b[72]=I,b[73]=q):q=b[73];return q}g["default"]=a}),98);
__d("SearchCometInterestsDeepDiveExperiments",["gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("gkx")("24247")}g.hasTypeaheadRedirection=a}),98);
__d("useSearchCometGlobalTypeaheadURLBuilderForKeywordEntry",["Base64","ConstUriUtils","SearchCometInterestsDeepDiveExperiments","SearchCometInterestsDeepDiveUtil","XCometSearchResultsControllerRouteBuilder","react-compiler-runtime","searchCometTypeaheadGetHighConfidenceResult","searchCometTypeaheadGetStsDisambiguation","useSearchCometHashtagRouteUrlBuilder","useSearchCometResultsEntryPointSurface","useSearchCometResultsURLBuilder"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a=d("react-compiler-runtime").c(5),b;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(b={routeBuilder:c("XCometSearchResultsControllerRouteBuilder")},a[0]=b):b=a[0];var e=c("useSearchCometResultsURLBuilder")(b),f=c("useSearchCometHashtagRouteUrlBuilder")(),g=c("useSearchCometResultsEntryPointSurface")();a[1]!==f||a[2]!==g||a[3]!==e?(b=function(a){var b=a.entry,h=a.queryString;a=a.typeaheadSessionID;var i=b.label.toLowerCase(),j=b.metaData;j=j==null?void 0:j.markers;var k=d("SearchCometInterestsDeepDiveUtil").getHashtagTag(i);if(d("SearchCometInterestsDeepDiveExperiments").hasTypeaheadRedirection()&&k!=null&&!j.has("see_all"))return f({entryPointAction:"SEARCH_BOX",exploreEntryPoint:h===""?3:4,hashtag:k,typeaheadSessionID:a});else{h=b.rawData;k=(k=c("searchCometTypeaheadGetStsDisambiguation")(b))!=null?k:void 0;if(b.subtype==="keyword"&&j.has("disambiguation")){h=(j=(j=h.structuredInfo)==null?void 0:(h=j.disambiguation_result)==null?void 0:h.disambiguation_info_list[0])!=null?j:{};j=h.link_url;if(j!=null){h=d("ConstUriUtils").getUri(j);if(h!=null){j=new Map();g!=null&&j.set("__eps__",g);k!==void 0&&j.set("__stsd__",c("Base64").encode(JSON.stringify(k)));var l=new Map();for(j of j){var m=j[0],n=j[1];l.set(m,n)}m=h.addQueryParams(l);if(m!=null)return m.toString()}}}return e({entryPointAction:"SEARCH_BOX",highConfidenceResult:c("searchCometTypeaheadGetHighConfidenceResult")(b),query:i,stsDisambiguation:k,typeaheadSessionID:a})}},a[1]=f,a[2]=g,a[3]=e,a[4]=b):b=a[4];return b}g["default"]=a}),98);
__d("useSearchCometGlobalTypeaheadKeywordViewItemLinkProps",["react","react-compiler-runtime","useCometRouterDispatcher","useSearchCometGlobalTypeaheadURLBuilderForKeywordEntry"],(function(a,b,c,d,e,f,g){"use strict";var h;b=h||d("react");var i=b.useEffect;b.useMemo;function a(a){var b=d("react-compiler-runtime").c(10),e=a.entry;a=a.queryString;var f=c("useCometRouterDispatcher")(),g=c("useSearchCometGlobalTypeaheadURLBuilderForKeywordEntry")(),h;b[0]!==g||b[1]!==e||b[2]!==a?(h=g({entry:e,queryString:a}),b[0]=g,b[1]=e,b[2]=a,b[3]=h):h=b[3];g=h;var j=g;b[4]!==f||b[5]!==j?(e=function(){f!=null&&f.preloadRouteCode(j)},a=[f,j],b[4]=f,b[5]=j,b[6]=e,b[7]=a):(e=b[6],a=b[7]);i(e,a);b[8]!==j?(h={preloadCodeOnMount:!0,preventLocalNavigation:!0,url:j},b[8]=j,b[9]=h):h=b[9];g=h;return g}g["default"]=a}),98);
__d("useSearchCometGlobalTypeaheadViewStrategy",["fbt","CometSearchTypeaheadBaseViewRecentEmptyState.react","react","searchCometTypeaheadSTSMappings","useSearchCometGlobalTypeaheadKeywordViewItemLinkProps","useSearchCometTypeaheadViewListStrategy"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react")),k=i.useMemo,l={view:{backgroundColor:"x1jx94hy",borderEndEndRadius:"xde0f50",borderEndStartRadius:"x15x8krk",boxSizing:"x9f619",display:"x78zum5",flexDirection:"xdt5ytf",flexGrow:"x1iyjqo2",maxHeight:"x1iofjn4",paddingTop:"x1y1aw1k",paddingInlineEnd:"xf159sx",paddingBottom:"xwib8y2",paddingInlineStart:"xmzvs34",$$css:!0}};function a(a){a=a.onHeaderActionPress;var b=k(function(){return[l.view]},[]),d=k(function(){return j.jsx(c("CometSearchTypeaheadBaseViewRecentEmptyState.react"),{})},[]);return c("useSearchCometTypeaheadViewListStrategy")({additionalEntryMappings:c("searchCometTypeaheadSTSMappings"),emptyStateContent:d,getLinkProps:c("useSearchCometGlobalTypeaheadKeywordViewItemLinkProps"),isScrollable:!0,onHeaderActionPress:a,seeAllLabelBuilder:m,xstyle:b})}function m(a){return h._(/*BTDS*/"Search for {=m1}",[h._implicitParam("=m1",j.jsx("strong",{children:h._(/*BTDS*/"{query}",[h._param("query",a)])}))])}m.displayName=m.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("useSearchCometTypeaheadBootstrapValidationQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="9365993650171871"}),null);
__d("useSearchCometTypeaheadBootstrapValidationQuery.graphql",["useSearchCometTypeaheadBootstrapValidationQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"input"}],c=[{alias:null,args:[{kind:"Variable",name:"params",variableName:"input"}],concreteType:"SearchClientCachePolicyCheckResult",kind:"LinkedField",name:"search_client_cache_policy_check",plural:!1,selections:[{alias:null,args:null,concreteType:"SearchClientCachePolicyDecision",kind:"LinkedField",name:"policy_decision",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"cache_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"ids_to_remove",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"force_cache_refresh",storageKey:null}],storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"useSearchCometTypeaheadBootstrapValidationQuery",selections:c,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"useSearchCometTypeaheadBootstrapValidationQuery",selections:c},params:{id:b("useSearchCometTypeaheadBootstrapValidationQuery_facebookRelayOperation"),metadata:{},name:"useSearchCometTypeaheadBootstrapValidationQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("useSearchCometTypeaheadBootstrapValidation",["CometRelay","CometRelayErrorHandling","filterNulls","react","react-compiler-runtime","recoverableViolation","useSearchCometTypeaheadBootstrapValidationQuery.graphql"],(function(a,b,c,d,e,f,g){"use strict";var h,i;(i||d("react")).useMemo;function a(a){var e=d("react-compiler-runtime").c(3),f=a.bootstrapDatasource,g=d("CometRelay").useRelayEnvironment();e[0]!==f||e[1]!==g?(a={validate:function(a){a=c("filterNulls")(a.map(k));d("CometRelay").fetchQuery(g,h!==void 0?h:h=b("useSearchCometTypeaheadBootstrapValidationQuery.graphql"),{input:{cache_types:["KEYWORD_BOOTSTRAP"],shown_suggestions:a}}).subscribe({error:j,next:function(a){a=a.search_client_cache_policy_check;for(a of(a=a==null?void 0:a.policy_decision)!=null?a:[]){var b=a.cache_type,c=a.force_cache_refresh,d=a.ids_to_remove;if(b==="KEYWORD_BOOTSTRAP"){for(b of d)f.removeEntriesByEntID(b);c===!0&&(f.clear(),f.bootstrap())}}}})}},e[0]=f,e[1]=g,e[2]=a):a=e[2];e=a;return e}function j(a){d("CometRelayErrorHandling").markErrorAsHandled(a)}function k(a){if(a.subtype!=="bootstrap")return null;a=(a=a.rawData.structuredInfo)!=null?a:{};a=a.direct_nav_result;if(a==null)return null;var b=a.ent_id;a=a.title;if(b==null||a==null){c("recoverableViolation")("Unexpected missing ent_id or title on direct_nav_result","search");return null}return{id:b,keyword:a}}g["default"]=a}),98);
__d("withSearchCometGlobalTypeaheadCleanStateOnEntrySelection",["react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react"));h.useCallback;function a(a){function b(b){var c=d("react-compiler-runtime").c(15),e,f,g,h,j;c[0]!==b?(e=b.inputRef,f=b.onChange,g=b.onPressEntry,j=b.shouldQueryStringUpdateFromSelectedEntryOnClick,h=babelHelpers.objectWithoutPropertiesLoose(b,["inputRef","onChange","onPressEntry","shouldQueryStringUpdateFromSelectedEntryOnClick"]),c[0]=b,c[1]=e,c[2]=f,c[3]=g,c[4]=h,c[5]=j):(e=c[1],f=c[2],g=c[3],h=c[4],j=c[5]);b=j===void 0?!1:j;c[6]!==f||c[7]!==g?(j=function(b,c){var a=b.metaData,d=b.subtype;a=a.markers;d=d==="recent"&&a.has("entity")||a.has("direct_nav");f(d?"":b.label);g==null?void 0:g(b,c)},c[6]=f,c[7]=g,c[8]=j):j=c[8];j=j;var k;c[9]!==e||c[10]!==j||c[11]!==f||c[12]!==h||c[13]!==b?(k=i.jsx(a,babelHelpers["extends"]({},h,{inputRef:e,onChange:f,onPressEntry:j,shouldQueryStringUpdateFromSelectedEntryOnClick:b})),c[9]=e,c[10]=j,c[11]=f,c[12]=h,c[13]=b,c[14]=k):k=c[14];return k}return b}g["default"]=a}),98);
__d("withSearchCometGlobalTypeaheadFocusKeyboardShortcut",["cometGetKeyCommandConfig","react","react-compiler-runtime","useBaseTypeaheadLayoutContextualStrategyStateContext","useCometTypeaheadInputRefs","useGlobalKeyCommands"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react"));b=h;b.useCallback;b.useMemo;function a(a){function b(b){var e=d("react-compiler-runtime").c(13),f,g;e[0]!==b?(f=b.inputRef,g=babelHelpers.objectWithoutPropertiesLoose(b,["inputRef"]),e[0]=b,e[1]=f,e[2]=g):(f=e[1],g=e[2]);b=c("useCometTypeaheadInputRefs")(f);f=b.composedRef;var h=b.inputRef;b=c("useBaseTypeaheadLayoutContextualStrategyStateContext")();var j=b.dispatchIsOpened;e[3]!==j||e[4]!==h?(b=function(){h.current!=null&&(h.current.focus(),j(!0))},e[3]=j,e[4]=h,e[5]=b):b=e[5];b=b;var k;e[6]!==b?(k=d("cometGetKeyCommandConfig").getCometKeyCommandConfig("global","search",b),e[6]=b,e[7]=k):k=e[7];e[8]!==k?(b=[k],e[8]=k,e[9]=b):b=e[9];k=b;b=k;c("useGlobalKeyCommands")(b);e[10]!==f||e[11]!==g?(k=i.jsx(a,babelHelpers["extends"]({},g,{inputRef:f})),e[10]=f,e[11]=g,e[12]=k):k=e[12];return k}return b}g["default"]=a}),98);
__d("withSearchCometTypeaheadTraceEndReasonDecorator",["react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react"));h.useCallback;function a(a){function b(b){var c=d("react-compiler-runtime").c(13),e,f,g,h;c[0]!==b?(e=b.inputRef,f=b.onPressEntry,h=b.traceProvider,g=babelHelpers.objectWithoutPropertiesLoose(b,["inputRef","onPressEntry","traceProvider"]),c[0]=b,c[1]=e,c[2]=f,c[3]=g,c[4]=h):(e=c[1],f=c[2],g=c[3],h=c[4]);c[5]!==f||c[6]!==h?(b=function(a,b){h&&h.setEndReason("successful_user_action"),f==null?void 0:f(a,b)},c[5]=f,c[6]=h,c[7]=b):b=c[7];b=b;var j;c[8]!==e||c[9]!==b||c[10]!==g||c[11]!==h?(j=i.jsx(a,babelHelpers["extends"]({},g,{inputRef:e,onPressEntry:b,traceProvider:h})),c[8]=e,c[9]=b,c[10]=g,c[11]=h,c[12]=j):j=c[12];return j}return b}g["default"]=a}),98);
__d("SearchCometGlobalTypeahead.react",["fbt","BaseTypeahead.react","CometErrorBoundary.react","CometTypeaheadErrorFallback.react","FBLogger","SearchCometGlobalTypeaheadInputStrategy.react","SearchCometGlobalTypeaheadLayoutContextualStrategy.react","SearchCometInterestsDeepDiveExperiments","SearchCometInterestsDeepDiveUtil","SearchCometTypeaheadLoggingContextProvider","XCometSearchResultsControllerRouteBuilder","emptyFunction","qex","react","react-compiler-runtime","requireDeferred","searchCometGlobalTypeahead.config","unrecoverableViolation","useCometSearchTypeaheadTraceProvider","useCometTypeaheadNavigate","useCometTypeaheadStateQueryString","useSearchCometGlobalTypeaheadCompositeDataSource","useSearchCometGlobalTypeaheadNullStateDataSource","useSearchCometGlobalTypeaheadURLBuilderForKeywordEntry","useSearchCometGlobalTypeaheadViewStrategy","useSearchCometHashtagRouteUrlBuilder","useSearchCometResultsURLBuilder","useSearchCometTypeaheadBootstrapValidation","useSearchCometTypeaheadLoggingProvider","useSearchCometTypeaheadRecentDataSourceContextDecorator","useStable","withSearchCometGlobalTypeaheadCleanStateOnEntrySelection","withSearchCometGlobalTypeaheadFocusKeyboardShortcut","withSearchCometTypeaheadBaseNavigationDecorator","withSearchCometTypeaheadSERPWarmCallDecorator","withSearchCometTypeaheadTraceEndReasonDecorator"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react"));b=i;b.useCallback;var k=b.useContext,l=b.useEffect;b.useMemo;var m=b.useRef,n=c("requireDeferred")("ODS").__setRef("SearchCometGlobalTypeahead.react"),o=(e=c("qex")._("7"))!=null?e:!1;function a(a){var b=d("react-compiler-runtime").c(77),e,f,g,i,t,u,v,w,x,y;b[0]!==a?(y=a.autoOpen,e=a.inputXStyle,g=a.onClose,i=a.onEscape,t=a.onFocus,u=a.onHeaderActionPress,v=a.onPressEntry,w=a.onSelectFreeformQuery,f=a.queryString,x=babelHelpers.objectWithoutPropertiesLoose(a,["autoOpen","inputXStyle","onClose","onEscape","onFocus","onHeaderActionPress","onPressEntry","onSelectFreeformQuery","queryString"]),b[0]=a,b[1]=e,b[2]=f,b[3]=g,b[4]=i,b[5]=t,b[6]=u,b[7]=v,b[8]=w,b[9]=x,b[10]=y):(e=b[1],f=b[2],g=b[3],i=b[4],t=b[5],u=b[6],v=b[7],w=b[8],x=b[9],y=b[10]);a=y===void 0?!1:y;y=c("useCometTypeaheadStateQueryString")(f);var z=y[0];f=y[1];var A=c("useSearchCometGlobalTypeaheadURLBuilderForKeywordEntry")();b[11]===Symbol["for"]("react.memo_cache_sentinel")?(y={routeBuilder:c("XCometSearchResultsControllerRouteBuilder")},b[11]=y):y=b[11];var B=c("useSearchCometResultsURLBuilder")(y),C=c("useSearchCometHashtagRouteUrlBuilder")();b[12]===Symbol["for"]("react.memo_cache_sentinel")?(y={tapPoint:"tap_search_bar"},b[12]=y):y=b[12];var D=c("useCometTypeaheadNavigate")(y),E=m(!1);y=c("useSearchCometGlobalTypeaheadNullStateDataSource")();var F;b[13]!==y?(F={config:c("searchCometGlobalTypeahead.config"),recentDataSource:y},b[13]=y,b[14]=F):F=b[14];var G=c("useSearchCometGlobalTypeaheadCompositeDataSource")(F);b[15]!==G?(y=G.getBootstrapKeywordsDataSource(),b[15]=G,b[16]=y):y=b[16];F=y;if(F==null)throw c("unrecoverableViolation")("Bootstrap datasource is missing","search");b[17]!==F?(y={bootstrapDatasource:F},b[17]=F,b[18]=y):y=b[18];F=c("useSearchCometTypeaheadBootstrapValidation")(y);var H=F.validate;b[19]!==H?(y=function(a){a=a.shownEntries;H(a)},b[19]=H,b[20]=y):y=b[20];var I=y;F=k(d("SearchCometTypeaheadLoggingContextProvider").CometLoggingProviderContext);y=F.logger;var J=F.onSessionStart,K=F.setSessionEndCallback;F=F.traceProvider;var L=y;F=F;var M;b[21]!==I?(M={context:"search_global",onSessionEnd:I},b[21]=I,b[22]=M):M=b[22];M=c("useSearchCometTypeaheadLoggingProvider")(M);c("useCometSearchTypeaheadTraceProvider")(y||M);var N;b[23]!==I||b[24]!==K?(y=function(){K(I)},N=[K,I],b[23]=I,b[24]=K,b[25]=N,b[26]=y):(N=b[25],y=b[26]);l(y,N);if(L==null){L=M;n.onReady(r);throw c("FBLogger")("search").mustfix("Typeahead used without logger in context")}if(F==null)throw c("FBLogger")("search").mustfix("Typeahead used without traceProvider in context");y=c("useSearchCometTypeaheadRecentDataSourceContextDecorator")(G,!1);b[27]===Symbol["for"]("react.memo_cache_sentinel")?(N={decorate:c("withSearchCometGlobalTypeaheadFocusKeyboardShortcut")},b[27]=N):N=b[27];b[28]!==y?(M=[y,N].filter(Boolean),b[28]=y,b[29]=M):M=b[29];N=M;y=N;b[30]!==G?(M=function(){G.bootstrap()},N=[G],b[30]=G,b[31]=M,b[32]=N):(M=b[31],N=b[32]);l(M,N);b[33]!==t||b[34]!==J?(M=function(){E.current=!0,J(),t&&t()},b[33]=t,b[34]=J,b[35]=M):M=b[35];N=M;b[36]!==L||b[37]!==D||b[38]!==v||b[39]!==z||b[40]!==A?(M=function(a,b){var c;if(b===!0)return;b=a.metaData;b=b==null?void 0:b.markers;var d=b!=null&&b.has("entity");b=b!=null&&b.has("direct_nav");c=A({entry:a,queryString:z,typeaheadSessionID:(c=L)==null?void 0:c.getSessionID()});c=s(a,c,d,b);D(c);v==null?void 0:v(a)},b[36]=L,b[37]=D,b[38]=v,b[39]=z,b[40]=A,b[41]=M):M=b[41];L;M=M;var O;b[42]!==C||b[43]!==L||b[44]!==D||b[45]!==w||b[46]!==z||b[47]!==B?(O=function(a){var b=d("SearchCometInterestsDeepDiveUtil").getHashtagTag(a);if(d("SearchCometInterestsDeepDiveExperiments").hasTypeaheadRedirection()&&b!=null){b=C({entryPointAction:"SEARCH_BOX",exploreEntryPoint:z===""?3:4,hashtag:b,typeaheadSessionID:(b=L)==null?void 0:b.getSessionID()})}else{var c;b=B({entryPointAction:"SEARCH_BOX",query:a,typeaheadSessionID:(c=L)==null?void 0:c.getSessionID()})}D(b);w==null?void 0:w(a)},b[42]=C,b[43]=L,b[44]=D,b[45]=w,b[46]=z,b[47]=B,b[48]=O):O=b[48];L;O=O;var P;b[49]!==G||b[50]!==g?(P=function(){G.clearQueryCache(),g&&g()},b[49]=G,b[50]=g,b[51]=P):P=b[51];P=P;var Q=c("useStable")(q),R;b[52]===Symbol["for"]("react.memo_cache_sentinel")?(R=h._(/*BTDS*/"Search Facebook"),b[52]=R):R=b[52];R=R;var S=z==="";S=S?"grid":"listbox";var T;b[53]===Symbol["for"]("react.memo_cache_sentinel")?(T={bypassCacheRenderLimitCheck:o},b[53]=T):T=b[53];var U=x.inputEndContent,V;b[54]!==e?(V={hideIconOnFocus:!0,size:"large",xstyle:e},b[54]=e,b[55]=V):V=b[55];e=x.inputStartContent;var W;b[56]===Symbol["for"]("react.memo_cache_sentinel")?(W=h._(/*BTDS*/"Search Facebook"),b[56]=W):W=b[56];var X=L,Y;b[57]!==u?(Y={onHeaderActionPress:u},b[57]=u,b[58]=Y):Y=b[58];u=c("useSearchCometGlobalTypeaheadViewStrategy")(Y);b[59]!==Q||b[60]!==a||b[61]!==G||b[62]!==P||b[63]!==N||b[64]!==M||b[65]!==O||b[66]!==L||b[67]!==i||b[68]!==x||b[69]!==z||b[70]!==f||b[71]!==y||b[72]!==V||b[73]!==u||b[74]!==F||b[75]!==S?(Y=j.jsx(c("CometErrorBoundary.react"),{fallback:p,children:j.jsx(Q,babelHelpers["extends"]({},x,{autoOpen:a,dataSource:G,dataSourceFetchConfigParams:T,decorators:y,inputEndContent:U,inputExtraProps:V,inputStartContent:e,inputStrategyRenderer:c("SearchCometGlobalTypeaheadInputStrategy.react"),label:W,layoutStrategyRenderer:c("SearchCometGlobalTypeaheadLayoutContextualStrategy.react"),loggingProvider:X,onChange:f,onClose:P,onEscape:i,onFocus:N,onPressEntry:M,onSelectFreeformQuery:O,placeholder:R,queryString:z,testid:void 0,traceProvider:F,viewRole:S,viewStrategyRenderer:u}))}),b[59]=Q,b[60]=a,b[61]=G,b[62]=P,b[63]=N,b[64]=M,b[65]=O,b[66]=L,b[67]=i,b[68]=x,b[69]=z,b[70]=f,b[71]=y,b[72]=V,b[73]=u,b[74]=F,b[75]=S,b[76]=Y):Y=b[76];return Y}function p(){return j.jsx(c("CometTypeaheadErrorFallback.react"),{})}p.displayName=p.name+" [from "+f.id+"]";function q(){return(c("withSearchCometTypeaheadSERPWarmCallDecorator")!=null?c("withSearchCometTypeaheadSERPWarmCallDecorator"):c("emptyFunction").thatReturnsArgument)(c("withSearchCometTypeaheadTraceEndReasonDecorator")(c("withSearchCometGlobalTypeaheadCleanStateOnEntrySelection")(c("withSearchCometTypeaheadBaseNavigationDecorator")(c("BaseTypeahead.react")))))}function r(a){a.bumpEntityKey(354,"typeahead.missing_logger_context","focused")}function s(a,b,c,d){var e=a.rawData,f;if(e!=null&&a.subtype==="recent"&&c){f=e==null?void 0:(c=e.profile)==null?void 0:c.url}if(e!=null&&(a.subtype==="keyword"||a.subtype==="bootstrap"||a.subtype==="recent")&&d){f=e==null?void 0:(c=e.structuredInfo)==null?void 0:(a=c.direct_nav_result)==null?void 0:a.link_url}return(d=f)!=null?d:b}g["default"]=a}),226);/*FB_PKG_DELIM*/
__d("EBGetMinosWasm",["WAWasmModuleCache","bx"],(function(a,b,c,d,e,f,g){"use strict";var h=c("bx").getURL(c("bx")("31853"));a=function(){return d("WAWasmModuleCache").loadWasmModule(h)};g.getMinosWasm=a}),98);
__d("EBMinosDBDev",["MAWWormOdsLogger","QPLFlow","WALogger","WAResolvable","Worm","WormEAR","WormIDbDriver"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error performing makeEBMinosDevDB: ",""]);h=function(){return a};return a}var i={secure_minos_mailbox_keys:{indexes:{},primaryKey:"contact_id",secure:!0},secure_minos_thread_message_encryption_keys:{indexes:{"[roster_hash+minos_thread_id]":{fields:["roster_hash","minos_thread_id"],unique:!1}},primaryKey:"mek_id_blob",secure:!0}},j=new(d("WAResolvable").Resolvable)(),k=1e4;async function a(a,b,c){var e=d("QPLFlow").startQPLFlow(b,{annotations:{string:{operationType:"initEBMinosDevDbSchema"}},timeoutInMs:k});try{var f="ebMinosDev";c=new(d("WormEAR").WormEAR)(i,f,c);a=new(d("Worm").WormDatabase)(new(d("WormIDbDriver").WormIDbDriver)(a,f,i,c,d("MAWWormOdsLogger").wormOdsWorkerLogger,{}),b);await a.init({eventFlow:e});e.endSuccess();j.resolve(a)}catch(a){j.reject(a);e.endFail("error");d("WALogger").ERROR(h(),a);throw a}}function l(){return j.promise}async function b(){var a=Object.keys(i),b=await l();return b.runInTransaction(a,"readonly",async function(b){var c={};await Promise.all(a.map(async function(a){var d=await b.stores[a].readAll();c[a]=d}));return c},"EBMinosDevDb - Dump").catch(function(){return{}})}g.ebdbDescriptor=i;g.makeEBMinosDevDB=a;g.getEBMinosDevDb=l;g.getDbDump=b}),98);
__d("EBMinosLogger",["WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";a=d("WATagsLogger").TAGS(["minos"]);g.minosLogger=a}),98);
__d("EBMinosTypes",["$InternalEnum","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return a}function c(a){return a.endsWith(d("WAJids").MSGR_USER_DOMAIN)?a.slice(0,-d("WAJids").MSGR_USER_DOMAIN.length):null}var h=d("WAJids").createJidUtils({platform:"msgr"});function e(a){return h.toUserJid(a)}function f(a){return a}function i(a){return a}function j(a){return a}function k(a){return a}function l(a){return a}function m(a){return a}function n(a){return a}function o(a){return a}function p(a){return a}function q(a){return a}function r(a){return a}function s(a){return a}function t(a){return a}function u(a){return a}function v(a){return a}function w(a){return a}function x(a){return a}function y(a){return a}function z(a){return a}function A(a){return a}function B(a){return a}function C(a){return a}function D(a){return a}function E(a){return a}function F(a){return a}function G(a){return a}function H(a){return a}function I(a){return a}function J(a){return a}function K(a){return a}b=b("$InternalEnum")({INVALID:"-1",IMAGE:"0",PTT:"1",DOCUMENT:"3",VIDEO:"4",GIF:"5",STICKER:"6",XMA:"22",MESSENGER_PREVIEW:"25"});g.unsafeCastToUserFbId=a;g.userJidToUserFbId=c;g.userFbidToUserJid=e;g.unsafeCastToMinosThreadId=f;g.unsafeCastToEpochHead=i;g.unsafeCastToEpochSignature=j;g.unsafeCastToEpochNumber=k;g.unsafeCastToEpochCreationTime=l;g.unsafeCastToExportRootKey=m;g.unsafeCastToMekId=n;g.unsafeCastMekKey=o;g.unsafeCastMekRosterHash=p;g.unsafeCastToEncryptedMek=q;g.unsafeCastToMekFbId=r;g.unsafeCastToMekMiThreadId=s;g.unsafeCastToEncryptedMessage=t;g.unsafeCastToEncryptedMessageSignature=u;g.unsafeCastToDecryptedMessage=v;g.unsafeCastToMailboxFbId=w;g.unsafeCastToMailboxSigningPK=x;g.unsafeCastToMailboxSigningSK=y;g.unsafeCastToMailboxEncryptionPK=z;g.unsafeCastToMailboxEncryptionSK=A;g.unsafeCastToMailboxAuthPK=B;g.unsafeCastToMailboxAuthSK=C;g.unsafeCastToTransportSenderEphemeralPK=D;g.unsafeCastToTransportSenderEphemeralKeySig=E;g.unsafeCastToTransportSigningPK=F;g.unsafeCastToTransportSigningSK=G;g.unsafeCastToEpochFbId=H;g.castToSupplementalOpToken=I;g.unsafeCastToAttachmentAccessTokenSecret=J;g.unsafeCastToAttachmentPrimaryKeySecret=K;g.MinosAttachmentMediaType=b}),98);
__d("EBMinosWasm.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};e={};f={};var h={},i={},j={},k={},l={},m={},n={},o={},p={},q={},r={},s={},t={},u={},v={},w={},x={},y={},z={},A={},B={},C={},D={},E={},F={},G={},H={},I={},J={},K={},L={},M={},N={},O={},P={},Q={},R={},S={},T={},U={},V={},W={},X={},Y={},Z={};a.name="MinosMessageMetadata";a.internalSpec={mekId:[1,(d=d("WAProtoConst")).FLAGS.REQUIRED|d.TYPES.BYTES],timestamp:[2,d.FLAGS.REQUIRED|d.TYPES.UINT64],messageId:[3,d.FLAGS.REQUIRED|d.TYPES.STRING],threadId:[4,d.FLAGS.REQUIRED|d.TYPES.BYTES]};b.name="MinosEncryptAndSignMessageInput";b.internalSpec={transportSigningSk:[1,d.FLAGS.REQUIRED|d.TYPES.BYTES],mek:[2,d.FLAGS.REQUIRED|d.TYPES.BYTES],plaintext:[3,d.FLAGS.REQUIRED|d.TYPES.BYTES],metadata:[4,d.FLAGS.REQUIRED|d.TYPES.MESSAGE,a]};c.name="MinosEncryptAndSignMessageResult";c.internalSpec={ciphertext:[1,d.FLAGS.REQUIRED|d.TYPES.BYTES],signature:[2,d.FLAGS.REQUIRED|d.TYPES.BYTES]};e.name="MinosDecryptAndVerifyMessageInput";e.internalSpec={transportSigningPk:[1,d.FLAGS.REQUIRED|d.TYPES.BYTES],mek:[2,d.FLAGS.REQUIRED|d.TYPES.BYTES],encryptedMessageCiphertext:[3,d.FLAGS.REQUIRED|d.TYPES.BYTES],encryptedMessageSignature:[4,d.FLAGS.REQUIRED|d.TYPES.BYTES],metadata:[5,d.FLAGS.REQUIRED|d.TYPES.MESSAGE,a]};f.name="MinosDecryptAndVerifyMessageResult";f.internalSpec={plaintext:[1,d.FLAGS.REQUIRED|d.TYPES.BYTES]};h.name="MekBundle";h.internalSpec={key:[1,d.FLAGS.REQUIRED|d.TYPES.BYTES],mekId:[2,d.FLAGS.REQUIRED|d.TYPES.BYTES],rosterHash:[3,d.FLAGS.REQUIRED|d.TYPES.BYTES]};i.name="GenerateMekInput";i.internalSpec={epochHeads:[1,d.FLAGS.REPEATED|d.TYPES.BYTES]};j.name="GenerateMekResult";j.internalSpec={mek:[1,d.FLAGS.REQUIRED|d.TYPES.MESSAGE,h]};k.name="GenerateMekRosterHashInput";k.internalSpec={epochHeads:[1,d.FLAGS.REPEATED|d.TYPES.BYTES]};l.name="GenerateMekRosterHashResult";l.internalSpec={rosterHash:[1,d.FLAGS.REQUIRED|d.TYPES.BYTES]};m.name="EncryptMekForDistributionInput";m.internalSpec={senderEpochHead:[1,d.FLAGS.REQUIRED|d.TYPES.BYTES],toMailboxPk:[2,d.FLAGS.REQUIRED|d.TYPES.BYTES],fromKeypair:[3,d.FLAGS.REQUIRED|d.TYPES.MESSAGE,n],mek:[4,d.FLAGS.REQUIRED|d.TYPES.MESSAGE,h]};n.name="EncryptMekForDistributionInput$MailboxAuthKP";n.internalSpec={sk:[1,d.FLAGS.REQUIRED|d.TYPES.BYTES],pk:[2,d.FLAGS.REQUIRED|d.TYPES.BYTES]};o.name="EncryptMekForDistributionResult";o.internalSpec={ciphertext:[1,d.FLAGS.REQUIRED|d.TYPES.BYTES]};p.name="DecryptMekForDistributionInput";p.internalSpec={toMailboxSk:[1,d.FLAGS.REQUIRED|d.TYPES.BYTES],fromPk:[2,d.FLAGS.REQUIRED|d.TYPES.BYTES],mekId:[3,d.FLAGS.REQUIRED|d.TYPES.BYTES],senderEpochHead:[4,d.FLAGS.REQUIRED|d.TYPES.BYTES],rosterHash:[5,d.FLAGS.REQUIRED|d.TYPES.BYTES],ciphertext:[6,d.FLAGS.REQUIRED|d.TYPES.BYTES]};q.name="DecryptMekForDistributionResult";q.internalSpec={mek:[1,d.FLAGS.REQUIRED|d.TYPES.BYTES]};r.name="EncryptMeksForDistributionFromTransportSenderInput";r.internalSpec={mek:[1,d.FLAGS.REQUIRED|d.TYPES.MESSAGE,h],transportSigningKp:[2,d.FLAGS.REQUIRED|d.TYPES.MESSAGE,s],recipientMailboxEncryptionPks:[3,d.FLAGS.REPEATED|d.TYPES.BYTES],recipientEpochHeads:[4,d.FLAGS.REPEATED|d.TYPES.BYTES]};s.name="EncryptMeksForDistributionFromTransportSenderInput$TransportSigningKP";s.internalSpec={sk:[1,d.FLAGS.REQUIRED|d.TYPES.BYTES],pk:[2,d.FLAGS.REQUIRED|d.TYPES.BYTES]};t.name="EncryptMeksForDistributionFromTransportSenderResult";t.internalSpec={encryptedMeks:[1,d.FLAGS.REPEATED|d.TYPES.BYTES],ephemeralEncryptionPk:[2,d.FLAGS.REQUIRED|d.TYPES.BYTES],signingPk:[3,d.FLAGS.REQUIRED|d.TYPES.BYTES],signature:[4,d.FLAGS.REQUIRED|d.TYPES.BYTES]};u.name="DecryptMekForDistributionFromTransportSenderInput";u.internalSpec={mekDistribution:[1,d.FLAGS.REQUIRED|d.TYPES.MESSAGE,v],mekId:[2,d.FLAGS.REQUIRED|d.TYPES.BYTES],rosterHash:[3,d.FLAGS.REQUIRED|d.TYPES.BYTES],recipientEncSk:[4,d.FLAGS.REQUIRED|d.TYPES.BYTES]};v.name="DecryptMekForDistributionFromTransportSenderInput$TransportSenderMEKDistributionSingleRecipient";v.internalSpec={encryptedMek:[1,d.FLAGS.REQUIRED|d.TYPES.BYTES],ephemeralEncryptionPk:[2,d.FLAGS.REQUIRED|d.TYPES.BYTES],signingPk:[3,d.FLAGS.REQUIRED|d.TYPES.BYTES],signature:[4,d.FLAGS.REQUIRED|d.TYPES.BYTES]};w.name="DecryptMekForDistributionFromTransportSenderResult";w.internalSpec={mek:[1,d.FLAGS.REQUIRED|d.TYPES.BYTES]};x.name="WrapTransportSigningPublicKeyInput";x.internalSpec={keyBytes:[1,d.FLAGS.REQUIRED|d.TYPES.BYTES]};y.name="WrapTransportSigningPublicKeyResult";y.internalSpec={prefixedKey:[1,d.FLAGS.REQUIRED|d.TYPES.BYTES]};z.name="WrapTransportSigningSecretKeyInput";z.internalSpec={keyBytes:[1,d.FLAGS.REQUIRED|d.TYPES.BYTES]};A.name="WrapTransportSigningSecretKeyResult";A.internalSpec={prefixedKey:[1,d.FLAGS.REQUIRED|d.TYPES.BYTES]};B.name="DeriveMailboxSigningKeypairInput";B.internalSpec={exportRootKey:[1,d.FLAGS.REQUIRED|d.TYPES.BYTES],epochNumber:[2,d.FLAGS.REQUIRED|d.TYPES.UINT64]};C.name="DeriveMailboxSigningKeypairResult";C.internalSpec={mailboxSigningPublicKey:[1,d.FLAGS.REQUIRED|d.TYPES.BYTES],mailboxSigningPrivateKey:[2,d.FLAGS.REQUIRED|d.TYPES.BYTES]};D.name="DeriveMailboxEncryptionKeypairInput";D.internalSpec={exportRootKey:[1,d.FLAGS.REQUIRED|d.TYPES.BYTES],epochNumber:[2,d.FLAGS.REQUIRED|d.TYPES.UINT64]};E.name="DeriveMailboxEncryptionKeypairResult";E.internalSpec={mailboxEncryptionPublicKey:[1,d.FLAGS.REQUIRED|d.TYPES.BYTES],mailboxEncryptionPrivateKey:[2,d.FLAGS.REQUIRED|d.TYPES.BYTES]};F.name="DeriveMailboxAuthKeypairInput";F.internalSpec={exportRootKey:[1,d.FLAGS.REQUIRED|d.TYPES.BYTES],epochNumber:[2,d.FLAGS.REQUIRED|d.TYPES.UINT64]};G.name="DeriveMailboxAuthKeypairResult";G.internalSpec={mailboxAuthPublicKey:[1,d.FLAGS.REQUIRED|d.TYPES.BYTES],mailboxAuthPrivateKey:[2,d.FLAGS.REQUIRED|d.TYPES.BYTES]};H.name="DeriveAttachmentAccessTokenSecretInput";H.internalSpec={mediaKey:[1,d.FLAGS.REQUIRED|d.TYPES.BYTES]};I.name="DeriveAttachmentAccessTokenSecretResult";I.internalSpec={attachmentAccessTokenSecret:[1,d.FLAGS.REQUIRED|d.TYPES.BYTES]};J.name="DeriveAttachmentPrimaryKeySecretInput";J.internalSpec={mediaKey:[1,d.FLAGS.REQUIRED|d.TYPES.BYTES]};K.name="DeriveAttachmentPrimaryKeySecretResult";K.internalSpec={attachmentPrimaryKeySecret:[1,d.FLAGS.REQUIRED|d.TYPES.BYTES]};L.name="EpochPublicData";L.internalSpec={epochNumber:[1,d.FLAGS.REQUIRED|d.TYPES.UINT64],userFbid:[2,d.FLAGS.REQUIRED|d.TYPES.STRING],mailboxSigningPk:[3,d.FLAGS.REQUIRED|d.TYPES.BYTES],mailboxEncryptionPk:[4,d.FLAGS.REQUIRED|d.TYPES.BYTES],mailboxAuthPk:[5,d.FLAGS.REQUIRED|d.TYPES.BYTES],previousEpochHead:[6,d.TYPES.BYTES]};M.name="EpochSignatures";M.internalSpec={selfSignature:[1,d.FLAGS.REQUIRED|d.TYPES.BYTES],prevSignature:[2,d.TYPES.BYTES]};N.name="MinosSignedEpoch";N.internalSpec={epochPublicData:[1,d.FLAGS.REQUIRED|d.TYPES.MESSAGE,L],signatures:[2,d.FLAGS.REQUIRED|d.TYPES.MESSAGE,M],epochHead:[3,d.FLAGS.REQUIRED|d.TYPES.BYTES]};O.name="MinosOpenInitialEpochInput";O.internalSpec={userFbid:[1,d.FLAGS.REQUIRED|d.TYPES.STRING],epochNumber:[2,d.FLAGS.REQUIRED|d.TYPES.UINT64],exportRootKey:[3,d.FLAGS.REQUIRED|d.TYPES.BYTES]};P.name="MinosOpenInitialEpochResult";P.internalSpec={minosSignedEpoch:[1,d.FLAGS.REQUIRED|d.TYPES.MESSAGE,N]};Q.name="MinosOpenEpochInput";Q.internalSpec={userFbid:[1,d.FLAGS.REQUIRED|d.TYPES.STRING],epochNumber:[2,d.FLAGS.REQUIRED|d.TYPES.UINT64],exportRootKey:[3,d.FLAGS.REQUIRED|d.TYPES.BYTES],previousExportRootKey:[4,d.FLAGS.REQUIRED|d.TYPES.BYTES],previousEpochNumber:[5,d.FLAGS.REQUIRED|d.TYPES.UINT64],previousEpochHead:[6,d.FLAGS.REQUIRED|d.TYPES.BYTES]};R.name="MinosOpenEpochResult";R.internalSpec={minosSignedEpoch:[1,d.FLAGS.REQUIRED|d.TYPES.MESSAGE,N]};S.name="MinosValidateEpochInput";S.internalSpec={epochPublicData:[1,d.FLAGS.REQUIRED|d.TYPES.MESSAGE,L],previousEpochPublicData:[2,d.FLAGS.REQUIRED|d.TYPES.MESSAGE,L],signatures:[3,d.FLAGS.REQUIRED|d.TYPES.MESSAGE,M]};T.name="MinosValidateEpochResult";T.internalSpec={valid:[1,d.TYPES.BOOL],errorMessage:[2,d.TYPES.STRING],__oneofs__:{result:["valid","errorMessage"]}};U.name="MinosVerifySingleEpochInput";U.internalSpec={epochPublicData:[1,d.FLAGS.REQUIRED|d.TYPES.MESSAGE,L],signature:[2,d.FLAGS.REQUIRED|d.TYPES.BYTES]};V.name="MinosVerifySingleEpochResult";V.internalSpec={valid:[1,d.FLAGS.REQUIRED|d.TYPES.BOOL]};W.name="MinosThreadIdFromOneToOneThreadInput";W.internalSpec={actThreadId:[1,d.FLAGS.REQUIRED|d.TYPES.STRING],selfFbid:[2,d.FLAGS.REQUIRED|d.TYPES.STRING]};X.name="MinosThreadIdFromOneToOneThreadResult";X.internalSpec={threadId:[1,d.FLAGS.REQUIRED|d.TYPES.BYTES]};Y.name="MinosThreadIdFromActThreadIdInput";Y.internalSpec={actThreadId:[1,d.FLAGS.REQUIRED|d.TYPES.STRING]};Z.name="MinosThreadIdFromActThreadIdResult";Z.internalSpec={threadId:[1,d.FLAGS.REQUIRED|d.TYPES.BYTES]};g.MinosMessageMetadataSpec=a;g.MinosEncryptAndSignMessageInputSpec=b;g.MinosEncryptAndSignMessageResultSpec=c;g.MinosDecryptAndVerifyMessageInputSpec=e;g.MinosDecryptAndVerifyMessageResultSpec=f;g.MekBundleSpec=h;g.GenerateMekInputSpec=i;g.GenerateMekResultSpec=j;g.GenerateMekRosterHashInputSpec=k;g.GenerateMekRosterHashResultSpec=l;g.EncryptMekForDistributionInputSpec=m;g.EncryptMekForDistributionInput$MailboxAuthKPSpec=n;g.EncryptMekForDistributionResultSpec=o;g.DecryptMekForDistributionInputSpec=p;g.DecryptMekForDistributionResultSpec=q;g.EncryptMeksForDistributionFromTransportSenderInputSpec=r;g.EncryptMeksForDistributionFromTransportSenderInput$TransportSigningKPSpec=s;g.EncryptMeksForDistributionFromTransportSenderResultSpec=t;g.DecryptMekForDistributionFromTransportSenderInputSpec=u;g.DecryptMekForDistributionFromTransportSenderInput$TransportSenderMEKDistributionSingleRecipientSpec=v;g.DecryptMekForDistributionFromTransportSenderResultSpec=w;g.WrapTransportSigningPublicKeyInputSpec=x;g.WrapTransportSigningPublicKeyResultSpec=y;g.WrapTransportSigningSecretKeyInputSpec=z;g.WrapTransportSigningSecretKeyResultSpec=A;g.DeriveMailboxSigningKeypairInputSpec=B;g.DeriveMailboxSigningKeypairResultSpec=C;g.DeriveMailboxEncryptionKeypairInputSpec=D;g.DeriveMailboxEncryptionKeypairResultSpec=E;g.DeriveMailboxAuthKeypairInputSpec=F;g.DeriveMailboxAuthKeypairResultSpec=G;g.DeriveAttachmentAccessTokenSecretInputSpec=H;g.DeriveAttachmentAccessTokenSecretResultSpec=I;g.DeriveAttachmentPrimaryKeySecretInputSpec=J;g.DeriveAttachmentPrimaryKeySecretResultSpec=K;g.EpochPublicDataSpec=L;g.EpochSignaturesSpec=M;g.MinosSignedEpochSpec=N;g.MinosOpenInitialEpochInputSpec=O;g.MinosOpenInitialEpochResultSpec=P;g.MinosOpenEpochInputSpec=Q;g.MinosOpenEpochResultSpec=R;g.MinosValidateEpochInputSpec=S;g.MinosValidateEpochResultSpec=T;g.MinosVerifySingleEpochInputSpec=U;g.MinosVerifySingleEpochResultSpec=V;g.MinosThreadIdFromOneToOneThreadInputSpec=W;g.MinosThreadIdFromOneToOneThreadResultSpec=X;g.MinosThreadIdFromActThreadIdInputSpec=Y;g.MinosThreadIdFromActThreadIdResultSpec=Z}),98);
__d("LSContactUserBlockAction",[],(function(a,b,c,d,e,f){a=Object.freeze({MN_UNBLOCK:0,MN_BLOCK:1,FB_UNBLOCK:2,FB_BLOCK:3});f["default"]=a}),66);
__d("LSCoreClientFolderType",[],(function(a,b,c,d,e,f){a=Object.freeze({INBOX:0,PENDING:1,OTHER:2,SPAM:3,ARCHIVED:4,HIDDEN:5,MARKETPLACE:12,RESTRICTED:15,INTEROP:19});f["default"]=a}),66);
__d("LSCreateE2EEMetadataThread",["LSArrayGetObjectAt","LSBase64Encode.nop","LSIsEncryptionVersionSecure","LSIssueNewTask","LSLogMebClientEvent.nop","LSQplMarkPoint.nop","LSQplStartTrace.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][createE2EEMetadataThread] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[21]=new c.Map(),d[21].set("error_msg","Expected a nonempty query result"),d[21].set("code",c.i64.cast([0,3])),d[21].set("src_line","MEBClientStateUtils.php:247 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[22]=c.createArray(),d[23]=(d[22].push(d[21]),d[22]),e=[void 0,d[22]],d[2]=e[0],d[3]=e[1],e):(b=a.item,d[21]=new c.Map(),d[21].set("backup_id",b.backupId),d[21].set("device_public_key_blob",b.devicePublicKeyBlob),d[21].set("device_private_key_blob",b.devicePrivateKeyBlob),d[21].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[21].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[21].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[21].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[21].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[21].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[21].set("orf_client_state_v2_blob",void 0),d[21].set("orf_v2_authority_level",void 0),d[21].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[21].set("device_id",b.deviceId),d[21].set("backup_tenancy",b.backupTenancy),d[21].set("encryption_version",b.encryptionVersion),d[21].set("revision_version",b.revisionVersion),d[21].set("initialize_restore_result",void 0),d[21].set("device_creation_timestamp_sec",void 0),d[21].set("authority_level",b.authorityLevel),e=[d[21],void 0],d[2]=e[0],d[3]=e[1],e)})},function(a){return d[5]=new c.Map(),d[5].set("value",d[2]),d[5].set("errors",d[3]),d[6]=d[5].get("value"),d[6]!==void 0?c.sequence([function(a){return d[21]=d[6].get("backup_id"),d[22]=d[6].get("device_public_key_blob"),d[23]=d[6].get("device_private_key_blob"),d[24]=d[6].get("epoch_storage_public_key_blob"),d[25]=d[6].get("epoch_storage_private_key_blob"),d[26]=d[6].get("epoch_auth_public_key_blob"),d[27]=d[6].get("epoch_auth_private_key_blob"),d[28]=d[6].get("mailbox_root_key_blob"),d[29]=d[6].get("ocmf_client_state_blob"),d[30]=d[6].get("orf_client_state_v2_blob"),d[31]=d[6].get("orf_v2_authority_level"),d[32]=d[6].get("oblivious_validation_token_blob"),d[33]=d[6].get("device_id"),d[34]=d[6].get("backup_tenancy"),d[35]=d[6].get("encryption_version"),d[36]=d[6].get("revision_version"),d[37]=d[6].get("initialize_restore_result"),d[38]=d[6].get("device_creation_timestamp_sec"),d[39]=d[6].get("authority_level"),c.i64.neq(d[33],void 0)?c.sequence([function(a){return d[41]=void 0,c.i64.neq(d[41],void 0)?c.resolve(d[42]=d[41]):c.sequence([function(a){return d[54]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[55]=a[0],a})},function(a){return d[55]?d[64]=(d[54].push(c.i64.cast([0,0])),d[54]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[56]=a[0],a})},function(a){return d[56]?d[64]=(d[54].push(c.i64.cast([0,2])),d[54]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[57]=a[0],a})},function(a){return d[57]?d[64]=(d[54].push(c.i64.cast([0,3])),d[54]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[58]=a[0],a})},function(a){return d[58]?d[64]=(d[54].push(c.i64.cast([0,4])),d[54]):0,d[59]=c.createArray(),d[60]=c.i64.of_int32(d[54].length),c.i64.gt(d[60],c.i64.cast([0,0]))?c.loopAsync(d[60],function(a){return d[64]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[54],d[64]).then(function(a){return a=a,d[65]=a[0],d[66]=a[1],a})},function(a){return d[67]=(d[59].push(d[65]),d[59])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[64]=c.createArray(),d[65]=c.i64.of_int32(d[59].length),c.i64.gt(d[65],c.i64.cast([0,0]))?c.loopAsync(d[65],function(a){return d[67]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[59],d[67]).then(function(a){return a=a,d[68]=a[0],d[69]=a[1],a})},function(a){return d[70]=(d[64].push(c.i64.to_string(d[68])),d[64])}])}):c.resolve()},function(a){return d[66]=d[64].join(","),d[61]=d[66]}])},function(a){return d[59].some(function(a){return c.i64.eq(d[35],a)})?d[62]=d[35]:d[62]=void 0,c.i64.neq(d[62],void 0)?d[63]=d[62]:d[63]=void 0,d[42]=d[63]}])},function(a){return c.i64.neq(d[42],void 0)?d[43]=d[42]:d[43]=c.i64.cast([0,0]),c.i64.neq(d[34],void 0)?d[44]=d[34]:d[44]=c.i64.cast([0,1]),c.nativeOperation(b("LSBase64Encode.nop"),d[29]).then(function(a){return a=a,d[45]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[28]).then(function(a){return a=a,d[46]=a[0],a})},function(a){return d[47]=new c.Map(),d[47].set("ocmf_client_state_blob",d[45]==null?"":d[45]),d[47].set("mailbox_root_key",d[46]==null?"":d[46]),d[48]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[54]=(d[48].push(a.epochId),d[48])})},function(a){return d[52]="Queried locally available epochs. Count: ",d[49]=c.i64.of_int32(d[48].length),d[53]=c.i64.to_string(d[49]),d[50]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",d[50],d[52],d[50],d[53]].join("")),c.resolve()},function(a){return d[51]=new c.Map(),d[51].set("device_id",d[33]),d[51].set("raw_tokens",d[47]),d[51].set("locally_available_epochs",d[48]),d[40]=d[51]}]):c.resolve(d[40]=void 0)},function(a){return d[7]=d[40]}]):c.resolve((d[21]=d[5].get("errors"),d[22]=d[5].get("errors"),d[7]=void 0))},function(a){return d[8]=c.i64.random(),d[9]=c.i64.to_string(d[8]),d[16]=d[9],d[16]!==void 0?c.nativeOperation(b("LSQplStartTrace.nop"),c.i64.cast([0,679687327]),d[16],!0,void 0):c.resolve()},function(a){return d[17]=d[9],d[17]!==void 0?c.nativeOperation(b("LSQplMarkPoint.nop"),c.i64.cast([0,679687327]),d[17],"LSE2EEMessagingMetadataMailboxCreateE2EEMetadataThreadStoredProcedure_start"):c.resolve()},function(e){return d[10]=new c.Map(),d[10].set("wa_jid",a[0]),d[10].set("offline_thread_key",a[1]),d[10].set("thread_type",a[2]),d[10].set("folder_type",a[3]),d[10].set("bump_timestamp_ms",a[4]),d[10].set("tam_thread_subtype",c.i64.cast([0,0])),d[10].set("created_by_local_device",a[5]),d[10].set("device_context",d[7]),d[10].set("qpl_instance_key",d[9]),d[11]=d[10].get("offline_thread_key"),d[12]=c.toJSON(d[10]),c.storedProcedure(b("LSIssueNewTask"),c.i64.to_string(d[11]),c.i64.cast([0,388]),d[12],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))},function(a){return d[13]=c.i64.of_float(Date.now()),d[14]=c.i64.random(),d[18]="Finishing execution. Execution time: ",d[19]=c.i64.to_string(c.i64.sub(d[13],d[0])),d[20]=" ms",d[15]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][createE2EEMetadataThread] ",d[15],d[18],d[15],d[19],d[15],d[20]].join("")),c.i64.eq(c.i64.mod_(d[14],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[21]=",",d[22]=c.createArray(),void 0!==void 0?d[23]=(d[22].push(void 0),d[22]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"createE2EEMetadataThread",[d[18],d[21],d[19],d[21],d[20]].join(""),d[22],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxCreateE2EEMetadataThreadStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"];e.exports=a}),null);
__d("LSCreateE2EEMetadataThreadStoredProcedure",["LSCreateE2EEMetadataThread","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSCreateE2EEMetadataThread"),e.waJid,e.offlineThreadKey,e.threadType,e.folderType,e.bumpTimestampMs,e.createdByLocalDevice);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSCreateOfflineThreadingIDStoredProcedure",["LSCreateOfflineThreadingID","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSCreateOfflineThreadingID"),e.timestampMs);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSThreadPointQueryAndRestoreMessagesWithJID",["LSArrayGetObjectAt","LSBase64Encode.nop","LSIsEncryptionVersionSecure","LSIssueNewTask","LSLogMebClientEvent.nop","LSQplMarkPoint.nop","LSQplStartTrace.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][ThreadPointQueryAndRestoreMessagesWithJID] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[21]=new c.Map(),d[21].set("error_msg","Expected a nonempty query result"),d[21].set("code",c.i64.cast([0,3])),d[21].set("src_line","MEBClientStateUtils.php:247 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[22]=c.createArray(),d[23]=(d[22].push(d[21]),d[22]),e=[void 0,d[22]],d[2]=e[0],d[3]=e[1],e):(b=a.item,d[21]=new c.Map(),d[21].set("backup_id",b.backupId),d[21].set("device_public_key_blob",b.devicePublicKeyBlob),d[21].set("device_private_key_blob",b.devicePrivateKeyBlob),d[21].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[21].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[21].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[21].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[21].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[21].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[21].set("orf_client_state_v2_blob",void 0),d[21].set("orf_v2_authority_level",void 0),d[21].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[21].set("device_id",b.deviceId),d[21].set("backup_tenancy",b.backupTenancy),d[21].set("encryption_version",b.encryptionVersion),d[21].set("revision_version",b.revisionVersion),d[21].set("initialize_restore_result",void 0),d[21].set("device_creation_timestamp_sec",void 0),d[21].set("authority_level",b.authorityLevel),e=[d[21],void 0],d[2]=e[0],d[3]=e[1],e)})},function(a){return d[5]=new c.Map(),d[5].set("value",d[2]),d[5].set("errors",d[3]),d[6]=d[5].get("value"),d[6]!==void 0?c.sequence([function(a){return d[21]=d[6].get("backup_id"),d[22]=d[6].get("device_public_key_blob"),d[23]=d[6].get("device_private_key_blob"),d[24]=d[6].get("epoch_storage_public_key_blob"),d[25]=d[6].get("epoch_storage_private_key_blob"),d[26]=d[6].get("epoch_auth_public_key_blob"),d[27]=d[6].get("epoch_auth_private_key_blob"),d[28]=d[6].get("mailbox_root_key_blob"),d[29]=d[6].get("ocmf_client_state_blob"),d[30]=d[6].get("orf_client_state_v2_blob"),d[31]=d[6].get("orf_v2_authority_level"),d[32]=d[6].get("oblivious_validation_token_blob"),d[33]=d[6].get("device_id"),d[34]=d[6].get("backup_tenancy"),d[35]=d[6].get("encryption_version"),d[36]=d[6].get("revision_version"),d[37]=d[6].get("initialize_restore_result"),d[38]=d[6].get("device_creation_timestamp_sec"),d[39]=d[6].get("authority_level"),c.i64.neq(d[33],void 0)?c.sequence([function(a){return d[41]=void 0,c.i64.neq(d[41],void 0)?c.resolve(d[42]=d[41]):c.sequence([function(a){return d[54]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[55]=a[0],a})},function(a){return d[55]?d[64]=(d[54].push(c.i64.cast([0,0])),d[54]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[56]=a[0],a})},function(a){return d[56]?d[64]=(d[54].push(c.i64.cast([0,2])),d[54]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[57]=a[0],a})},function(a){return d[57]?d[64]=(d[54].push(c.i64.cast([0,3])),d[54]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[58]=a[0],a})},function(a){return d[58]?d[64]=(d[54].push(c.i64.cast([0,4])),d[54]):0,d[59]=c.createArray(),d[60]=c.i64.of_int32(d[54].length),c.i64.gt(d[60],c.i64.cast([0,0]))?c.loopAsync(d[60],function(a){return d[64]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[54],d[64]).then(function(a){return a=a,d[65]=a[0],d[66]=a[1],a})},function(a){return d[67]=(d[59].push(d[65]),d[59])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[64]=c.createArray(),d[65]=c.i64.of_int32(d[59].length),c.i64.gt(d[65],c.i64.cast([0,0]))?c.loopAsync(d[65],function(a){return d[67]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[59],d[67]).then(function(a){return a=a,d[68]=a[0],d[69]=a[1],a})},function(a){return d[70]=(d[64].push(c.i64.to_string(d[68])),d[64])}])}):c.resolve()},function(a){return d[66]=d[64].join(","),d[61]=d[66]}])},function(a){return d[59].some(function(a){return c.i64.eq(d[35],a)})?d[62]=d[35]:d[62]=void 0,c.i64.neq(d[62],void 0)?d[63]=d[62]:d[63]=void 0,d[42]=d[63]}])},function(a){return c.i64.neq(d[42],void 0)?d[43]=d[42]:d[43]=c.i64.cast([0,0]),c.i64.neq(d[34],void 0)?d[44]=d[34]:d[44]=c.i64.cast([0,1]),c.nativeOperation(b("LSBase64Encode.nop"),d[29]).then(function(a){return a=a,d[45]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[28]).then(function(a){return a=a,d[46]=a[0],a})},function(a){return d[47]=new c.Map(),d[47].set("ocmf_client_state_blob",d[45]==null?"":d[45]),d[47].set("mailbox_root_key",d[46]==null?"":d[46]),d[48]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[54]=(d[48].push(a.epochId),d[48])})},function(a){return d[52]="Queried locally available epochs. Count: ",d[49]=c.i64.of_int32(d[48].length),d[53]=c.i64.to_string(d[49]),d[50]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",d[50],d[52],d[50],d[53]].join("")),c.resolve()},function(a){return d[51]=new c.Map(),d[51].set("device_id",d[33]),d[51].set("raw_tokens",d[47]),d[51].set("locally_available_epochs",d[48]),d[40]=d[51]}]):c.resolve(d[40]=void 0)},function(a){return d[7]=d[40]}]):c.resolve((d[21]=d[5].get("errors"),d[22]=d[5].get("errors"),d[7]=void 0))},function(a){return d[8]=c.i64.random(),d[9]=c.i64.to_string(d[8]),d[16]=d[9],d[16]!==void 0?c.nativeOperation(b("LSQplStartTrace.nop"),c.i64.cast([0,679687327]),d[16],!0,void 0):c.resolve()},function(a){return d[17]=d[9],d[17]!==void 0?c.nativeOperation(b("LSQplMarkPoint.nop"),c.i64.cast([0,679687327]),d[17],"LSE2EEMessagingMetadataMailboxThreadPointQueryAndRestoreMessagesWithJIDStoredProcedure_start"):c.resolve()},function(e){return d[10]=new c.Map(),d[10].set("wa_jid",a[0]),d[10].set("tam_thread_subtype",c.i64.cast([0,0])),d[10].set("enable_logging_for_tpq",!1),d[10].set("device_context",d[7]),d[10].set("qpl_instance_key",d[9]),d[11]=d[10].get("wa_jid"),d[12]=c.toJSON(d[10]),c.storedProcedure(b("LSIssueNewTask"),c.i64.to_string(d[11]),c.i64.cast([0,556]),d[12],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))},function(a){return d[13]=c.i64.of_float(Date.now()),d[14]=c.i64.random(),d[18]="Finishing execution. Execution time: ",d[19]=c.i64.to_string(c.i64.sub(d[13],d[0])),d[20]=" ms",d[15]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][ThreadPointQueryAndRestoreMessagesWithJID] ",d[15],d[18],d[15],d[19],d[15],d[20]].join("")),c.i64.eq(c.i64.mod_(d[14],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[21]=",",d[22]=c.createArray(),void 0!==void 0?d[23]=(d[22].push(void 0),d[22]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"ThreadPointQueryAndRestoreMessagesWithJID",[d[18],d[21],d[19],d[21],d[20]].join(""),d[22],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxThreadPointQueryAndRestoreMessagesWithJIDStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"];e.exports=a}),null);
__d("LSThreadPointQueryAndRestoreMessagesWithJIDStoredProcedure",["LSSynchronousPromise","LSThreadPointQueryAndRestoreMessagesWithJID","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSThreadPointQueryAndRestoreMessagesWithJID"),e.waJid);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("MAWBridgeGroupInviteLoadedHandler",["fbt","I64","LSMessagingThreadTypeUtil","MAWMiActMappingTableAPI","ReQL","justknobx"],(function(a,b,c,d,e,f,g,h){"use strict";var i;function a(a,b,c){return k(a,c,b.actorId)}function j(a,b,c){return d("MAWMiActMappingTableAPI").getThreadKeyForChatJid(a,b).then(function(b){return b==null?Promise.resolve():k(a,b,c)})}async function k(a,b,e){var f=a.threads,g=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(f).getKeyRange(b));if(g==null)return;var j=d("LSMessagingThreadTypeUtil").isGroup(g.threadType);if(!j)return;j=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.group_invites).getKeyRange(b));if(j==null){c("justknobx")._("1162")&&await f.put(babelHelpers.extends({},g,{additionalThreadContext:void 0}));return}b=(i||(i=d("I64"))).equal((i||(i=d("I64"))).of_string(e),j.inviterId)?null:await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.contacts,["name"]).getKeyRange(j.inviterId));if(b==null)return;e=h._(/*BTDS*/"{Inviter Name} invited you to join",[h._param("Inviter Name",b.name)]).toString();a=g.folderName==="inbox"?h._(/*BTDS*/"Message request").toString():g.additionalThreadContext;await f.put(babelHelpers.extends({},g,{additionalThreadContext:a,snippet:e}))}function b(a,b){return j(a,b.threadJid,b.actorId)}function e(a,b,c){return j(a,b,c)}g.callForOneDb=a;g.call=b;g.callFromMainThread=e}),226);
__d("WADbContact",[],(function(a,b,c,d,e,f){"use strict";a=0;b=1;c=2;d=3;f.NON_CONTACT=a;f.ONE_WAY_CONTACT=b;f.REVERSED_ONE_WAY_CONTACT=c;f.TWO_WAY_CONTACT=d}),66);
__d("MAWContactRelationshipType",["I64","LSContactBitOffset","WADbContact"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){var b=d("LSContactBitOffset").hasWithDefault(64,a,!0);a=(h||(h=d("I64"))).ge(a.contactViewerRelationship,h.of_string("2"));if(a&&b)return d("WADbContact").ONE_WAY_CONTACT;else if(!a&&!b)return d("WADbContact").REVERSED_ONE_WAY_CONTACT;else if(a&&!b)return d("WADbContact").TWO_WAY_CONTACT;return d("WADbContact").NON_CONTACT}g.getContactRelationshipType=a}),98);
__d("MAWMessageRequestUtil",["I64","LSContactBitOffset","LSContactViewerRelationship","LSIntEnum","LSMessagingThreadTypeUtil","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,b,e){if(a==="pending"||a==="other")return!0;var f=d("LSContactBitOffset").hasWithDefault(64,e,!0);return a==="inbox"&&(h||(h=d("I64"))).equal(e.contactViewerRelationship,(i||(i=d("LSIntEnum"))).ofNumber(c("LSContactViewerRelationship").NOT_CONTACT))&&!f?b:!1}function k(a){return a==="pending"||a==="other"}function a(a){return d("LSMessagingThreadTypeUtil").isOneToOne(a.threadType)?k(a.folderName):!1}function l(a,b){return b!=null?j(a.folderName,c("gkx")("13333")?(h||(h=d("I64"))).gt(a.lastActivityTimestampMs,(h||(h=d("I64"))).zero):!(h||(h=d("I64"))).equal(a.lastActivityTimestampMs,(h||(h=d("I64"))).zero),b[1]):!1}function b(a,b){return d("LSMessagingThreadTypeUtil").isOneToOne(a.threadType)?l(a,b):!1}function e(a){return d("LSMessagingThreadTypeUtil").isGroup(a.threadType)?k(a.folderName):!1}f=[8,18,19,34,24,25,122];var m=[21,48];g.isMessageRequestV2=j;g.isOneOnOneMessageRequest=a;g.isOneOnOneMessageRequestV2=b;g.isGroupMessageRequest=e;g.disabledThreadCapabilitiesForIncomingRequest=f;g.enabledThreadCapabilitiesForIncomingRequest=m}),98);
__d("MAWBridgeOneToOneMessageRequestLoadedHandler",["fbt","I64","LSAuthorityLevel","LSIntEnum","LSMessagingThreadTypeUtil","LSThreadBitOffset","MAWContactRelationshipType","MAWJids","MAWMessageRequestUtil","MAWMiActMappingTableAPI","ODS","ReQL","WADbContact"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k;function a(a,b){b=b.threadJid;return l(a,b)}function b(a,b){return l(a,b)}async function l(a,b){var c=d("MAWJids").convertChatJidToIntJid(b);b=await d("MAWMiActMappingTableAPI").getThreadKeyForChatJid(a,b);if(b==null)return;b=await Promise.all([d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(b)),d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.contacts).getKeyRange(c))]);c=b[0];b=b[1];if(c==null||b==null||!d("LSMessagingThreadTypeUtil").isOneToOne(c.threadType))return;b=m(c,b);b=c.folderName==="pending"||c.folderName==="other"||c.folderName==="spam"||b;if(!b)return;b=c.folderName==="inbox"?h._(/*BTDS*/"Message request").toString():void 0;b=babelHelpers.extends({},c,{additionalThreadContext:b},n(c));await a.threads.put(b)}function m(a,b){var e=d("MAWContactRelationshipType").getContactRelationshipType(b);e=a.folderName==="inbox"&&e===d("WADbContact").REVERSED_ONE_WAY_CONTACT&&!(i||(i=d("I64"))).equal(a.lastActivityTimestampMs,(i||(i=d("I64"))).zero);a=(i||(i=d("I64"))).lt(b.authorityLevel,(j||(j=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE));e&&!a&&(k||(k=d("ODS"))).bumpEntityKey(3185,"e2ee.message_request_loaded_failure","contacts_not_yet_loaded",1);return e&&a}function n(a){a=d("LSThreadBitOffset").clear(d("MAWMessageRequestUtil").disabledThreadCapabilitiesForIncomingRequest,a.capabilities,a.capabilities2,a.capabilities3,a.capabilities4,a.capabilities5);a=d("LSThreadBitOffset").set(d("MAWMessageRequestUtil").enabledThreadCapabilitiesForIncomingRequest,a[0],a[1],a[2],a[3],a[4]);return{capabilities:a[0],capabilities2:a[1],capabilities3:a[2],capabilities4:a[3],capabilities5:a[4]}}g.call=a;g.callFromMainThread=b}),226);
__d("MAWBlockUtils",["I64","LSContactUserBlockAction","LSIntEnum","LSThreadBitOffset","ReQL","promiseDone","react","react-compiler-runtime","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;(k||d("react")).useCallback;var l=[0,31,35,55,56,58,24,25,19,85],m=[0,31,35,55,56,58,24,25,19,85,8,22],n=[35,19,85,56,24,25];function a(){var a=d("react-compiler-runtime").c(2),b=(h||(h=c("useReStore")))(),e;a[0]!==b?(e=function(a,e){c("promiseDone")(async function(){var g=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(b.tables.participants).getKeyRange(a));if(g==null)return;var h=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(b.tables.threads).getKeyRange(g.threadKey).filter(o));if(h==null)return;g=(i||(i=d("I64"))).equal(e,(j||(j=d("LSIntEnum"))).ofNumber(c("LSContactUserBlockAction").MN_BLOCK))?d("LSThreadBitOffset").clear(l,h.capabilities,h.capabilities2,h.capabilities3,h.capabilities4,h.capabilities5):(i||(i=d("I64"))).equal(e,(j||(j=d("LSIntEnum"))).ofNumber(c("LSContactUserBlockAction").FB_BLOCK))?d("LSThreadBitOffset").clear(m,h.capabilities,h.capabilities2,h.capabilities3,h.capabilities4,h.capabilities5):d("LSThreadBitOffset").set(n,h.capabilities,h.capabilities2,h.capabilities3,h.capabilities4,h.capabilities5);var k=g[0],p=g[1];await b.runInTransaction(function(a){var b=babelHelpers.extends({},h,{capabilities:k,capabilities2:p});return a.threads.put(b)},"readwrite",void 0,void 0,f.id+":137")}())},a[0]=b,a[1]=e):e=a[1];return e}function o(a){return(i||(i=d("I64"))).equal(a.threadType,(j||(j=d("LSIntEnum"))).ofNumber(15))}g.clearedMnBlockCapabilities=l;g.clearedFbBlockCapabilities=m;g.useChangeThreadBlockCapabilities=a}),98);
__d("clearedMAWMnRestrictCapabilities",[],(function(a,b,c,d,e,f){"use strict";a=[0,31,35,55,56,58,24,25,35,19];b=a;f["default"]=b}),66);
__d("MAWUpdateLSThreadCapabilities",["fbt","I64","LSBitOffset","LSContactBitOffset","LSContactBlockedByViewerStatus","LSIntEnum","LSMessagingThreadTypeUtil","LSThreadBitOffset","MAWBlockUtils","MAWCurrentUser","MAWMessageRequestUtil","ReQL","clearedMAWMnRestrictCapabilities","emptyFunction"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=d("MAWCurrentUser").getID(),l=(i||(i=d("I64"))).of_string(k);function a(a,b){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(b)).then(function(b){if(b==null)return Promise.resolve();var c=d("LSBitOffset").set((j||(j=d("LSIntEnum"))).ofNumber(27),b.capabilities);b=babelHelpers.extends({},b,{capabilities:c});return a.threads.put(b)}).then(c("emptyFunction"))}function b(a,b){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(b)).then(function(b){if(b==null)return Promise.resolve();var c=d("LSBitOffset").clear((j||(j=d("LSIntEnum"))).ofNumber(27),b.capabilities);b=babelHelpers.extends({},b,{capabilities:c});return a.threads.put(b)}).then(c("emptyFunction"))}function e(a,b){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(b)).then(function(c){if(c==null)return Promise.resolve([void 0,void 0]);var e=d("ReQL").firstAsync(d("LSMessagingThreadTypeUtil").isOneToOne(c.threadType)?d("ReQL").mergeJoin(d("ReQL").fromTableAscending(a.participants).getKeyRange(b),d("ReQL").fromTableAscending(a.contacts)).filter(function(a){a=a[1];return!(i||(i=d("I64"))).equal(a.id,l)}).map(function(a){a=a[1];return a}):d("ReQL").empty());return Promise.all([Promise.resolve(c),e])}).then(function(b){var e=b[0];if(e==null)return Promise.resolve();b=b[1];if(b==null)return Promise.resolve();var f=(i||(i=d("I64"))).equal(b.blockedByViewerStatus,(j||(j=d("LSIntEnum"))).ofNumber(c("LSContactBlockedByViewerStatus").MESSAGE_BLOCKED)),g=i.equal(b.blockedByViewerStatus,j.ofNumber(c("LSContactBlockedByViewerStatus").FULLY_BLOCKED));b=d("LSContactBitOffset").has(66,b);g=g?d("LSThreadBitOffset").clear(d("MAWBlockUtils").clearedFbBlockCapabilities,e.capabilities,e.capabilities2,e.capabilities3,e.capabilities4,e.capabilities5):f?d("LSThreadBitOffset").clear(d("MAWBlockUtils").clearedMnBlockCapabilities,e.capabilities,e.capabilities2,e.capabilities3,e.capabilities4,e.capabilities5):b?d("LSThreadBitOffset").clear(c("clearedMAWMnRestrictCapabilities"),e.capabilities,e.capabilities2,e.capabilities3,e.capabilities4,e.capabilities5):[e.capabilities,e.capabilities2,e.capabilities3,e.capabilities4,e.capabilities5];f=g[0];b=g[1];var h=g[2],k=g[3];g=g[4];return a.threads.put(babelHelpers.extends({},e,{capabilities:f,capabilities2:b,capabilities3:h,capabilities4:k,capabilities5:g})).then(c("emptyFunction"))})}async function f(a,b){a=a.threads;b=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a).getKeyRange(b));if(b==null)return Promise.resolve();var c=d("LSThreadBitOffset").set.apply(d("LSThreadBitOffset"),[d("MAWMessageRequestUtil").disabledThreadCapabilitiesForIncomingRequest].concat(d("LSThreadBitOffset").clear(d("MAWMessageRequestUtil").enabledThreadCapabilitiesForIncomingRequest,b.capabilities,b.capabilities2,b.capabilities3,b.capabilities4,b.capabilities5))),e=c[0],f=c[1],g=c[2],h=c[3];c=c[4];await a.put(babelHelpers.extends({},b,{additionalThreadContext:void 0,capabilities:e,capabilities2:f,capabilities3:g,capabilities4:h,capabilities5:c}))}async function m(a,b,c){b=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(b));if(b==null)return;c=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.contacts,["name"]).getKeyRange(c));if(c==null)return;c=h._(/*BTDS*/"{Inviter Name} invited you to join",[h._param("Inviter Name",c.name)]).toString();var e=d("LSThreadBitOffset").set([105],b.capabilities,b.capabilities2,b.capabilities3,b.capabilities4,b.capabilities5),f=e[0],g=e[1],i=e[2],j=e[3];e=e[4];await a.threads.put(babelHelpers.extends({},b,{capabilities:f,capabilities2:g,capabilities3:i,capabilities4:j,capabilities5:e,snippet:c}))}async function n(a,b){var c=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(b));if(c==null)return;b=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.group_invites).getKeyRange(b));var e=d("LSThreadBitOffset").clear([105],c.capabilities,c.capabilities2,c.capabilities3,c.capabilities4,c.capabilities5),f=e[0],g=e[1],h=e[2],i=e[3];e=e[4];await a.threads.put(babelHelpers.extends({},c,{capabilities:f,capabilities2:g,capabilities3:h,capabilities4:i,capabilities5:e,snippet:void 0}));await b.map(async function(b){await a.group_invites.delete(b.threadKey,b.inviterId,b.inviteeId)})}g.enableAddMembersTxn=a;g.disableAddMembersTxn=b;g.disableBlockerCapabilitiesTxn=e;g.updateNonMessageRequestThreadTxn=f;g.setGroupInviteTxn=m;g.clearGroupInviteTxn=n}),226);
__d("uniqueArray",[],(function(a,b,c,d,e,f){"use strict";function g(a){return a}function a(a,b){var c=b!=null?b:g,d=[],e=new Set();a.forEach(function(a){var b=c(a);if(e.has(b))return;e.add(b);d.push(a)});return d}f["default"]=a}),66);
__d("MAWBridgeParticipantsUpdatedHandler",["fbt","I64","LSAuthorityLevel","LSContactBlockedByViewerStatus","LSContactGender","LSContactIdType","LSContactType","LSContactViewerRelationship","LSContactWorkForeignEntityType","LSFactory","LSGroupParticipantJoinState","LSIntEnum","LSVerifyContactRowExistsStoredProcedure","MAWCurrentUser","MAWJids","MAWMiActMappingTableAPI","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","MAWTimeUtils","MAWUpdateLSThreadCapabilities","ReQLTable","gkx","uniqueArray","vulture"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=d("MAWCurrentUser").getID(),l=(i||(i=d("I64"))).of_string(k);function a(a,b){b=b.map(function(a){var b=a.chatJid,c=a.type;a=a.userJid;return babelHelpers.extends({chatJid:b},u(c),{userJid:a})});return m(a,b)}function b(a,b){if(!c("gkx")("13628"))return t(a,b);b=b.participants.map(function(a){a.deliveredWatermarkTs;var b=a.fbid;a.lastReadActionTs;a.readWatermarkTs;var c=a.threadJid;a=babelHelpers.objectWithoutPropertiesLoose(a,["deliveredWatermarkTs","fbid","lastReadActionTs","readWatermarkTs","threadJid"]);return babelHelpers.extends({chatJid:c,userJid:d("MAWJids").toUserJid(b)},a)});return m(a,b)}async function m(a,b){b=await p(a,b);await Promise.all(b.map(function(b){var c=b.mawParticipant,e=b.threadKey,f=d("MAWJids").convertChatJidToIntJid(c.userJid);return[a.participants.get(e,f).then(function(b){var d=r(b,c,e);return b!=null?a.participants.put(d):Promise.all([a.participants.add(d),o(a,f)])}),q(a,f,e,c.isAdmin)]}).flat(Infinity))}function n(a,b){return(i||(i=d("I64"))).equal(a,(i||(i=d("I64"))).zero)?b:a}async function o(a,b){await c("LSVerifyContactRowExistsStoredProcedure")(c("LSFactory")(a),{authorityLevel:(j||(j=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").OPTIMISTIC),blockedByViewerStatus:j.ofNumber(c("LSContactBlockedByViewerStatus").UNBLOCKED),contactIdType:j.ofNumber(c("LSContactIdType").FBID),contactType:j.ofNumber(c("LSContactType").USER),contactViewerRelationship:j.ofNumber(c("LSContactViewerRelationship").UNKNOWN),gender:j.ofNumber(c("LSContactGender").UNKNOWN),id:b,isBlocked:!1,isMemorialized:!1,isSelf:k===(i||(i=d("I64"))).to_string(b),workForeignEntityType:j.ofNumber(c("LSContactWorkForeignEntityType").UNKNOWN)})}async function p(a,b){var e=c("uniqueArray")(b.map(function(a){return a.chatJid})),f=new Map();await Promise.all(e.map(function(b){return d("MAWMiActMappingTableAPI").getThreadKeyForChatJid(a,b).then(function(a){return a!=null&&f.set(b,a)})}));return b.map(function(a){var b=f.get(a.chatJid);return b==null?null:{mawParticipant:a,threadKey:b}}).filter(Boolean)}async function q(a,b,c,e){await d("MAWUpdateLSThreadCapabilities").disableBlockerCapabilitiesTxn(a,c),(i||(i=d("I64"))).equal(l,b)&&(e?await d("MAWUpdateLSThreadCapabilities").enableAddMembersTxn(a,c):await d("MAWUpdateLSThreadCapabilities").disableAddMembersTxn(a,c))}function r(a,b,c){return a==null?babelHelpers.extends({},s(b),{authorityLevel:(i||(i=d("I64"))).zero,contactId:d("MAWJids").convertChatJidToIntJid(b.userJid),deliveredWatermarkTimestampMs:i.zero,isSuperAdmin:b.isSuperAdmin,nickname:void 0,normalizedSearchTerms:void 0,participantCapabilities:void 0,readActionTimestampMs:i.zero,readWatermarkTimestampMs:i.zero,threadKey:c,threadRoles:i.zero}):babelHelpers.extends({},a,{},s(b))}function s(a){return{groupParticipantJoinState:a.isInvited?(j||(j=d("LSIntEnum"))).ofNumber(c("LSGroupParticipantJoinState").INVITED):(j||(j=d("LSIntEnum"))).ofNumber(c("LSGroupParticipantJoinState").MEMBER),isAdmin:a.isAdmin,isModerator:!1,subscribeSource:a.isSuperAdmin?h._(/*BTDS*/"Group creator").toString():void 0}}async function t(a,b){b=b.participants.filter(function(a){a=!a.fbid.startsWith("shadow_");a||c("vulture")("Yo_bP2RGeN3xZlA5MJbxDlcF808=");return a});await Promise.all(b.map(function(b){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b.threadJid,"MAWBridgeParticipantsUpdatedHandler",async function(a,e){var f=(i||(i=d("I64"))).of_string(b.fbid),g=[b.readWatermarkTs,b.deliveredWatermarkTs,b.lastReadActionTs].map(d("MAWTimeUtils").toTimestamp),k=g[0],l=g[1],m=g[2],p={groupParticipantJoinState:b.isInvited?(j||(j=d("LSIntEnum"))).ofNumber(c("LSGroupParticipantJoinState").INVITED):(j||(j=d("LSIntEnum"))).ofNumber(c("LSGroupParticipantJoinState").MEMBER),isAdmin:b.isAdmin,isModerator:!1,subscribeSource:b.isSuperAdmin?h._(/*BTDS*/"Group creator").toString():void 0};g=!1;var r=!1;await d("ReQLTable").update(a.participants,[e,f],function(a){r=!0;if(a!=null){var c={deliveredWatermarkTimestampMs:n(l,a.deliveredWatermarkTimestampMs),readActionTimestampMs:n(m,a.readActionTimestampMs),readWatermarkTimestampMs:n(k,a.readWatermarkTimestampMs)};return babelHelpers.extends({},a,{},c,{},p)}else{g=!0;return babelHelpers.extends({},p,{authorityLevel:(i||(i=d("I64"))).zero,contactId:f,deliveredWatermarkTimestampMs:l,isSuperAdmin:b.isSuperAdmin,nickname:void 0,normalizedSearchTerms:void 0,participantCapabilities:void 0,readActionTimestampMs:i.zero,readWatermarkTimestampMs:k,threadKey:e})}});r&&await q(a,f,e,b.isAdmin);g&&await o(a,f)})}))}function u(a){return{isAdmin:a==="superadmin"||a==="admin",isInvited:a==="invitedParticipant",isSuperAdmin:a==="superadmin"}}g.callFromMainThread=a;g.call=b;g.mawToLsParticipantTypeConversion=u}),226);
__d("MessagingFolderTag",[],(function(a,b,c,d,e,f){a=Object.freeze({INBOX:"inbox",OTHER:"other",SPAM:"spam",PENDING:"pending",MONTAGE:"montage",HIDDEN:"hidden",LEGACY:"legacy",DISABLED:"disabled",PAGE_BACKGROUND:"page_background",PAGE_DONE:"page_done",BLOCKED:"blocked",COMMUNITY:"community",RESTRICTED:"restricted",BC_PARTNERSHIP:"bc_partnership",E2EE_CUTOVER:"e2ee_cutover",E2EE_CUTOVER_ARCHIVED:"e2ee_cutover_archived",E2EE_CUTOVER_PENDING:"e2ee_cutover_pending",E2EE_CUTOVER_OTHER:"e2ee_cutover_other",E2EE_CUTOVER_RESTRICTED:"e2ee_cutover_restricted",INTEROP:"interop",INTEROP_PENDING:"interop_pending",ARCHIVED:"archived",AI_ACTIVE:"ai_active",SALSA_RESTRICTED:"salsa_restricted",MESSENGER_MARKETING_MESSAGE:"messenger_marketing_message",SECRET_CONVERSATIONS:"secret_conversations",WEBCHAT_PLUGIN:"webchat_plugin",NFB_OVERFLOW:"nfb_overflow",UNKNOWN:""});f["default"]=a}),66);
__d("MAWFolderUtils",["FBLogger","I64","LSCoreClientFolderType","LSIntEnum","MAWFolderTypes","MessagingFolderTag"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a){switch(a){case d("MAWFolderTypes").PENDING:return c("MessagingFolderTag").PENDING;case d("MAWFolderTypes").OTHER:return c("MessagingFolderTag").OTHER;case d("MAWFolderTypes").SPAM:return c("MessagingFolderTag").SPAM;case d("MAWFolderTypes").ARCHIVED:return c("MessagingFolderTag").UNKNOWN;default:return c("MessagingFolderTag").INBOX}}function b(a){switch(a){case d("MAWFolderTypes").PENDING:return(h||(h=d("LSIntEnum"))).ofNumber(-101);case d("MAWFolderTypes").OTHER:return(h||(h=d("LSIntEnum"))).ofNumber(-102);case d("MAWFolderTypes").SPAM:return(h||(h=d("LSIntEnum"))).ofNumber(-103);case d("MAWFolderTypes").ARCHIVED:return(h||(h=d("LSIntEnum"))).ofNumber(-110);default:return(h||(h=d("LSIntEnum"))).ofNumber(-100)}}function e(a){switch(a){case d("MAWFolderTypes").ARCHIVED:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSCoreClientFolderType").ARCHIVED);case d("MAWFolderTypes").INBOX:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSCoreClientFolderType").INBOX);case d("MAWFolderTypes").OTHER:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSCoreClientFolderType").SPAM);case d("MAWFolderTypes").PENDING:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSCoreClientFolderType").OTHER);case d("MAWFolderTypes").RESTRICTED:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSCoreClientFolderType").RESTRICTED);case d("MAWFolderTypes").SPAM:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSCoreClientFolderType").PENDING);default:a;throw c("FBLogger")("messenger_web").mustfixThrow("Unhandled folder ID: "+a)}}function f(a){switch(a){case(h||(h=d("LSIntEnum"))).ofNumber(-1):return(h||(h=d("LSIntEnum"))).ofNumber(-101);case(h||(h=d("LSIntEnum"))).ofNumber(-2):return(h||(h=d("LSIntEnum"))).ofNumber(-102);case(h||(h=d("LSIntEnum"))).ofNumber(-3):return(h||(h=d("LSIntEnum"))).ofNumber(-103);case(h||(h=d("LSIntEnum"))).ofNumber(-10):return(h||(h=d("LSIntEnum"))).ofNumber(-110);default:return(h||(h=d("LSIntEnum"))).ofNumber(-100)}}function j(a){switch(a){case"inbox":return d("MAWFolderTypes").FOLDER_ID.INBOX;case"pending":return d("MAWFolderTypes").FOLDER_ID.PENDING;case"spam":return d("MAWFolderTypes").FOLDER_ID.SPAM;case"archived":return d("MAWFolderTypes").FOLDER_ID.ARCHIVED;case"other":return d("MAWFolderTypes").FOLDER_ID.OTHER;case"restricted":return d("MAWFolderTypes").FOLDER_ID.RESTRICTED;default:return null}}function k(a){switch((i||(i=d("I64"))).to_int32(a)){case d("MAWFolderTypes").FOLDER_ID.INBOX:return 0;case d("MAWFolderTypes").FOLDER_ID.PENDING:return-1;case d("MAWFolderTypes").FOLDER_ID.SPAM:return-3;case d("MAWFolderTypes").FOLDER_ID.ARCHIVED:return-10;case d("MAWFolderTypes").FOLDER_ID.OTHER:return-2;default:return null}}g.getMessagingFolderTag=a;g.getClientSystemFolder=b;g.systemFolderToLSCoreClientFolder=e;g.systemFolderToClientSystemFolder=f;g.folderTagToFolderId=j;g.parentThreadKeyToLsSystemFolder=k}),98);
__d("MAWRemoveCorruptedParticipantsFromOneToOneChat",["I64","ReQL","WAJids"],(function(a,b,c,d,e,f,g){"use strict";var h;async function a(a,b,c,e){c=d("WAJids").extractUserId(c);var f=[c];e!==c&&f.push(e);c=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.participants).getKeyRange(b));e=c.filter(function(a){return!f.includes((h||(h=d("I64"))).to_string(a.contactId))}).map(function(a){return a.contactId});await Promise.all(e.map(function(c){return a.participants.delete(b,c)}))}g.default=a}),98);
__d("MAWActThreadMapping",["I64","JSResourceForInteraction","MAWBridgeGroupInviteLoadedHandler","MAWBridgeOccamadilloVerifyThreadExistsHandler","MAWBridgeOneToOneMessageRequestLoadedHandler","MAWBridgeParticipantsUpdatedHandler","MAWBridgeSendAndReceive","MAWFolderTypes","MAWFolderUtils","MAWJids","MAWMiActMappingTableAPI","MAWMiActOnActThreadReadyQueue","MAWRemoveCorruptedParticipantsFromOneToOneChat","MAWThreadMappingQPL","MAWUserJidWrapper","MWFBLogger","ReQL","WAArrayZip","WAJids","emptyFunction","getErrorSafe","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("JSResourceForInteraction")("MAWSyncThreadDescriptionAdminMsg").__setRef("MAWActThreadMapping"),j=new Map(),k=null;function l(){return c("gkx")("14178")}function m(a,b,e,g){var h=g.then(function(g){c("promiseDone")(a.runInTransaction(function(a){return q(a,o(g),e)},"readwrite",void 0,void 0,f.id+":91").catch(function(a){b.forEach(function(a){return j.delete(a)}),d("MWFBLogger").MWLogger.warn("MAWActThreadMapping","Post processing transaction not committed due to error "+a.message)}));for(var h of g)h.status==="rejected"&&j.delete(h.jid);return g},function(a){b.forEach(function(a){return j.delete(a)});return b.map(function(b){return{jid:b,reason:c("getErrorSafe")(a).message,status:"rejected"}})});b.forEach(function(a){return j.set(a,h.then(function(b){b=b.find(function(b){var c;return((c=b.value)==null?void 0:c.chatJid)===a||b.jid===a});if(b==null)throw d("MWFBLogger").MWLogger.tags(["MiActMapping","Occam"]).mustfixThrow("Should have thread creation result for every thread");return b}))})}function n(a){var b=new Map(),c=[];a.threads.forEach(function(a){var e=j.get(a.chatJid),f=a.instanceKey;e!=null?(f!=null&&(d("MAWThreadMappingQPL").addPoint("reuse_existing_promise_for_act_mapping",f),d("MAWThreadMappingQPL").endCancel("act_mapping_is_already_in_progress",f)),c.push(e)):b.set(a.chatJid,a)});return{cachedPromises:c,threadsToVerifyByJid:b}}function o(a){var b=new Map();a.forEach(function(a){if(a.status==="fulfilled"){b.set(a.value.chatJid,babelHelpers.extends({},a.value,{adminMsgParams:(a=a.value.adminMsgParams)!=null?a:null}))}});return b}async function p(a,b){var e=await d("MAWBridgeSendAndReceive").sendAndReceive("backend","bulkCreateOrUpdateThread",b);c("promiseDone")(a.runInTransaction(function(a){return q(a,o(e),b)},"readwrite",void 0,void 0,f.id+":209"));return e}function a(a,b){if(!l())return p(a,b);k==null&&(k=r(a));b.withoutSnippetRecalculation;var c=babelHelpers.objectWithoutPropertiesLoose(b,["withoutSnippetRecalculation"]);b=n(b);var e=b.cachedPromises;b=b.threadsToVerifyByJid;if(b.size===0)return Promise.all(e).then(function(a){return a.map(function(a){if(a.status==="fulfilled"){var b=a.value;b.adminMsgParams;b=babelHelpers.objectWithoutPropertiesLoose(b,["adminMsgParams"]);return{status:a.status,value:b}}else return{reason:a.reason,status:a.status}})});var f=d("MAWBridgeSendAndReceive").sendAndReceive("backend","bulkMaybeCreateOrUpdateThread",babelHelpers.extends({},c,{threads:Array.from(b.values())}));m(a,Array.from(b.keys()),c,f);return Promise.all([f].concat(e)).then(function(a){return a.flat(1).map(function(a){if(a.status==="fulfilled"){var b=a.value;b.adminMsgParams;b=babelHelpers.objectWithoutPropertiesLoose(b,["adminMsgParams"]);return{status:a.status,value:b}}else return{reason:a.reason,status:a.status}})})}function b(a){var b=a.authoritativeThreadKey,e=a.description,f=a.instanceKey,g=a.jid;a=a.optimisticThreadKey;f!=null&&d("MAWMiActOnActThreadReadyQueue").logOnFlushQueue(a,b,f,e);a!=null&&c("promiseDone")(d("MAWMiActOnActThreadReadyQueue").processQueueOnActThreadReady((h||(h=d("I64"))).of_string(a),g,e,"clientThreadKey"));b!=null&&c("promiseDone")(d("MAWMiActOnActThreadReadyQueue").processQueueOnActThreadReady((h||(h=d("I64"))).of_string(b),g,e,"authoritativeThreadKey"))}async function q(a,b,e){if(e.threads.length===0)return;var f=[],g=d("WAJids").extractUserId(d("MAWUserJidWrapper").getMyUserJid()),j=c("gkx")("14386"),k=l();await Promise.all(e.threads.map(function(e){var m=e.authoritativeThreadKey,n=e.chatJid,o=e.instanceKey;e=b.get(n);if(e==null)return Promise.resolve();var p=[],q=e.adminMsgParams,r=e.clientThreadKey,t=e.folder,u=e.isCreated,v=e.lastActivityTs;e=e.participants;e.forEach(function(a){f.push(babelHelpers.extends({},a,{chatJid:n}))});var w=d("WAJids").switchOnMsgrChatJidType(n,{group:function(a){return!0},user:function(a){return!1}});j&&p.push(w?d("MAWBridgeGroupInviteLoadedHandler").callFromMainThread(a,n,g):d("MAWBridgeOneToOneMessageRequestLoadedHandler").callFromMainThread(a,n));e=d("WAJids").interpretAsUserJid(n);e!=null&&l()&&p.push(c("MAWRemoveCorruptedParticipantsFromOneToOneChat")(a,(h||(h=d("I64"))).of_string(m),e,g));!u&&k&&p.push(s(a,m,t!=null?t:d("MAWFolderTypes").FOLDER_ID.INBOX));q!=null&&k&&p.push(i.load().then(function(b){return b(a,n,m,q)}));return Promise.all(p).then(function(){return d("MAWBridgeOccamadilloVerifyThreadExistsHandler").callFromMainThread(a,{authoritativeThreadKey:m,clientThreadKey:r,description:"bulkCreateThreadWithoutAfterTxn",folder:t,instanceKey:o,isGroup:w,jid:n,lastActivityTs:v})})}));c("gkx")("13628")&&await d("MAWBridgeParticipantsUpdatedHandler").callFromMainThread(a,f)}function r(a){return d("MAWMiActMappingTableAPI").subscribeToMappingDeletion(a,function(a,b){b=d("MAWJids").convertIntJidToOneToOneChatJid(a);j.has(b)&&j.delete(b);b=d("MAWJids").convertIntJidToGroupJid(a);j.has(b)&&j.delete(b)})}function e(a,b){j.clear(),d("WAArrayZip").zip(a,b).forEach(function(a){var b=a[0],c=a[1];return j.set(b,new Promise(function(a,b){return a(c)}))})}function s(a,b,e){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange((h||(h=d("I64"))).of_string(b))).then(function(b){if(b==null)return;var c=d("MAWFolderUtils").getMessagingFolderTag(e);c=c==="inbox"?void 0:b.cannotReplyReason;return a.threads.put(babelHelpers.extends({},b,{cannotReplyReason:c}))}).then(c("emptyFunction"))}g.isActThreadMappingDedupEnabled=l;g.bulkVerifyThreadExistsInWorker=a;g.executePromisesBlockedOnActThreadMapping=b;g.setCache_TEST_ONLY=e}),98);
__d("MAWCreateOptimisticThread",["I64","LSAuthorityLevel","LSCreateOfflineThreadingIDStoredProcedure","LSFactory","LSIntEnum","LSMailboxType","LSRtcCallState"],(function(a,b,c,d,e,f,g){"use strict";var h,i;async function j(a){a=await c("LSCreateOfflineThreadingIDStoredProcedure")(c("LSFactory")(a),{timestampMs:(h||(h=d("I64"))).of_float(Date.now())});a=a[0];return a}async function k(a,b){var e={authorityLevel:(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").OPTIMISTIC),folderName:"inbox",lastReadWatermarkTimestampMs:(h||(h=d("I64"))).of_float(0),mailboxType:i.ofNumber(c("LSMailboxType").MESSENGER),ongoingCallState:i.ofNumber(c("LSRtcCallState").NO_ONGOING_CALL),parentThreadKey:h.zero,threadKey:b,threadType:i.ofNumber(15)};await a.threads.put(e);return b}async function a(a){var b=await j(a);await k(a,b);return b}g.createOfflineThreadingId=j;g.createOptimisticThreadWithThreadKey=k;g.createOptimisticThread=a}),98);
__d("MAWCreateOptimisticMiThreadForActThread",["DateConsts","I64","LSCoreClientFolderType","LSCreateE2EEMetadataThreadStoredProcedure","LSFactory","LSIntEnum","LSThreadPointQueryAndRestoreMessagesWithJIDStoredProcedure","MAWCreateOptimisticThread","MAWFolderUtils","MAWThreadMappingQPL","MAWThreadMappingState","MAWThreadUpdateMiddlewareGatingUtil","MAWTimeUtils","MWFBLogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Creating e2ee metadata optimistic thread. threadKey: ",", bumpTimestampMs: ",", description: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Notifying MI server about thread: int jid ",", state: ",". "]);k=function(){return a};return a}var l=d("MWFBLogger").MWLogger.tags(["Occam","MiActMapping","GetOrCreateThread"]),m=(h||(h=d("I64"))).of_int32(c("LSCoreClientFolderType").INBOX);function n(a){if(a==null){l.warn("No folder ID was supplied to Occamadillo verify thread exists handler");return m}return d("MAWFolderUtils").systemFolderToLSCoreClientFolder(a)}async function a(a,b,e){var f=b.authoritativeThreadKey,g=b.clientThreadKey,i=b.description,j=b.folder,k=b.instanceKey,l=b.intJid,m=b.isGroup;b=b.lastActivityTs;var n=d("MAWThreadUpdateMiddlewareGatingUtil").isNewMiThreadCreationFlowEnabled();k!=null&&(d("MAWThreadMappingQPL").addAnnotations({bool:{isNewServerThreadCreationFlowEnabled:n}},k),n&&d("MAWThreadMappingQPL").allowToSkipUpgradingOptimisticThreadInMI(k));if(n){n=d("MAWThreadUpdateMiddlewareGatingUtil").isThreadCreationOptimisationEnabled()?f!=null?f:g:g;n!=null&&(await d("MAWThreadMappingState").markActThreadMappingAsCompleted(a,{intJid:l,threadKey:(h||(h=d("I64"))).of_string(n)},k),await d("MAWThreadMappingQPL").measurePerformanceForNullableInstanceKey("thread_point_query_sproc",k,function(){return c("LSThreadPointQueryAndRestoreMessagesWithJIDStoredProcedure")(c("LSFactory")(a),{waJid:l})}))}else{n=g!=null?(h||(h=d("I64"))).of_string(g):await d("MAWCreateOptimisticThread").createOptimisticThread(a);await Promise.all([await p(a,{i64ClientThreadKey:n,intJid:l,mawThread:{authoritativeThreadKey:f,description:i,folder:j,instanceKey:k,isGroup:m,lastActivityTs:b},threadLifecycleState:e}),await d("MAWThreadMappingState").markActThreadMappingAsCompleted(a,{intJid:l,threadKey:n},k)])}}function o(a){a=d("MAWTimeUtils").millisTimeToTimestamp(a);return(h||(h=d("I64"))).equal(a,(h||(h=d("I64"))).zero)?d("MAWTimeUtils").millisTimeToTimestamp(d("WATimeUtils").millisTime()):a}function p(a,b){var e=b.i64ClientThreadKey,f=b.intJid,g=b.mawThread;b=b.threadLifecycleState;l.DEBUG(k(),(h||(h=d("I64"))).to_string(f),b==null?void 0:b.type);var m=c("LSFactory")(a),p=o(g.lastActivityTs),q=n(g.folder),r=g.isGroup?(i||(i=d("LSIntEnum"))).ofNumber(16):(i||(i=d("LSIntEnum"))).ofNumber(15);a=h.to_string(e);var s=g.description;l.DEBUG(j(),a,h.to_string(p),s);a=d("WATimeUtils").millisTime();var t=h.to_float(p);Math.abs(t-a)<d("DateConsts").MS_PER_SEC&&l.warn("bumpTimestampMs is too close to now. bumpTimestampMs: %s, lastActivityTs: %s, now: %s, description: %s, threadLifecycleState: %s, mawThread.authoritativeThreadKey is null: %s",t,g.lastActivityTs,a,s,b==null?void 0:b.type,g.authoritativeThreadKey==null?"true":"false");t=g.instanceKey;t!=null&&d("MAWThreadMappingQPL").pendingThreadCreationOnServer.set((h||(h=d("I64"))).to_string(f),t);return d("MAWThreadMappingQPL").measurePerformanceForNullableInstanceKey("create_e2ee_metadata_thread_sproc",t,function(){return c("LSCreateE2EEMetadataThreadStoredProcedure")(m,{bumpTimestampMs:p,createdByLocalDevice:null,folderType:q,offlineThreadKey:e,threadType:r,waJid:f})})}g.maybeUpdateMappingTableAndUpgradeOptimisticActThreadInMI=a;g.upgradeOptimisticActThreadInMI=p}),98);
__d("MAWThreadDefaults",["fbt","I64","LSBitOffset","LSIntEnum","qex"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j;function k(){if(c("qex")._("327")===!0)return!0;else return c("qex")._("121")===!0}function a(a){if(k())return d("LSBitOffset").set((j||(j=d("LSIntEnum"))).ofNumber(42),a);else return a}function b(a){return d("LSBitOffset").set((j||(j=d("LSIntEnum"))).ofNumber(4),a)}e=d("LSBitOffset").set((j||(j=d("LSIntEnum"))).ofNumber(18),d("LSBitOffset").set(j.ofNumber(56),d("LSBitOffset").set(j.ofNumber(14),d("LSBitOffset").set(j.ofNumber(23),d("LSBitOffset").set(j.ofNumber(8),d("LSBitOffset").set(j.ofNumber(15),d("LSBitOffset").set(j.ofNumber(2),d("LSBitOffset").empty)))))));f=a(b(d("LSBitOffset").set(j.ofNumber(7),d("LSBitOffset").set(j.ofNumber(6),d("LSBitOffset").set(j.ofNumber(9),d("LSBitOffset").set(j.ofNumber(10),d("LSBitOffset").set(j.ofNumber(19),d("LSBitOffset").set(j.ofNumber(35),d("LSBitOffset").set(j.ofNumber(3),d("LSBitOffset").set(j.ofNumber(43),e))))))))));a=d("LSBitOffset").set(j.ofNumber(17),d("LSBitOffset").set(j.ofNumber(60),d("LSBitOffset").set(j.ofNumber(16),d("LSBitOffset").set(j.ofNumber(26),d("LSBitOffset").set(j.ofNumber(28),d("LSBitOffset").clear(j.ofNumber(27),f))))));b=d("LSBitOffset").set((i||(i=d("I64"))).sub(j.ofNumber(103),i.of_string("64")),d("LSBitOffset").set(i.sub(j.ofNumber(85),i.of_string("64")),d("LSBitOffset").set(i.sub(j.ofNumber(109),i.of_string("64")),d("LSBitOffset").set(i.sub(j.ofNumber(74),i.of_string("64")),d("LSBitOffset").set(i.sub(j.ofNumber(65),i.of_string("64")),d("LSBitOffset").set(i.sub(j.ofNumber(64),i.of_string("64")),d("LSBitOffset").set(i.sub(j.ofNumber(106),i.of_string("64")),d("LSBitOffset").empty)))))));e=h._(/*BTDS*/"Messages are secured with end-to-end encryption.").toString();h=d("LSBitOffset").set(i.sub(j.ofNumber(172),i.of_string("64")),d("LSBitOffset").set(i.sub(j.ofNumber(170),i.of_string("64")),d("LSBitOffset").empty));g.defaultThreadCapabilities=f;g.defaultGroupThreadCapabilities=a;g.defaultThreadCapabilities_2=b;g.nullstateDescriptionText1=e;g.defaultThreadCapabilities_3=h;g.defaultThreadCapabilities_4=d("LSBitOffset").empty;g.defaultThreadCapabilities_5=d("LSBitOffset").empty}),226);
__d("MAWBridgeOccamadilloVerifyThreadExistsHandler",["I64","LSAuthorityLevel","LSThreadBitOffset","MAWActThreadMapping","MAWBridgeFireAndForget","MAWCreateOptimisticMiThreadForActThread","MAWJids","MAWMiActGetThreadLifecycleState","MAWMiActThreadLifecycleState","MAWThreadDefaults","MAWThreadMappingQPL","MAWThreadMappingState","MAWTimeUtils","MWFBLogger","WATimeUtils","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Thread loading complete: jid ",", threadKey ",", lastActivityTs: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["New authoritative thread: jid ",", threadKey: ","), state: ",", lastActivityTs: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Authoritative thread not found for clientThreadKey: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Non-positive last activity ts from MI: "," for thread: ",", using local state ts: ",""]);l=function(){return a};return a}var m=d("MWFBLogger").MWLogger.tags(["Occam","VerifyThreadExists"]);function n(a,b,c){a=a;(h||(h=d("I64"))).le(a,(h||(h=d("I64"))).zero)&&(m.WARN(l(),(h||(h=d("I64"))).to_string(a),h.to_string(c),h.to_string(b)),a=b);return a}var o=c("gkx")("16094")?[105,17,25,24,61,267,27]:[105,17,25,24,61,267];function p(a,b){var c=o.filter(function(b){return d("LSThreadBitOffset").has(b,a)});return d("LSThreadBitOffset").set(c,b?d("MAWThreadDefaults").defaultGroupThreadCapabilities:d("MAWThreadDefaults").defaultThreadCapabilities,d("MAWThreadDefaults").defaultThreadCapabilities_2,d("MAWThreadDefaults").defaultThreadCapabilities_3,d("MAWThreadDefaults").defaultThreadCapabilities_4,d("MAWThreadDefaults").defaultThreadCapabilities_5)}async function q(a,b,e){var f=await a.threads.get(b);if(f==null){m.mustfix("Thread missing in verify thread exists");return Promise.resolve()}var g=e.clientThreadKey!=null?(h||(h=d("I64"))).of_string(e.clientThreadKey):f.clientThreadKey,i=c("gkx")("695")?f.lastActivityTimestampMs:n(f.lastActivityTimestampMs,d("MAWTimeUtils").millisTimeToTimestamp(e.lastActivityTs),b);e=p(f,e.isGroup);return a.threads.upsert([b],babelHelpers.extends({},f,{capabilities:e[0],capabilities2:e[1],capabilities3:e[2],capabilities4:e[3],capabilities5:e[4],clientThreadKey:g,lastActivityTimestampMs:i}))}async function r(a,b,c,e){await Promise.all([d("MAWThreadMappingState").markActThreadMappingAsCompleted(a,{intJid:c,threadKey:b},e.instanceKey),t(a,b,e)])}async function s(a,b,c){(h||(h=d("I64"))).equal(b,c)||await a.threads.delete(c)}async function t(a,b,c){var e=c.clientThreadKey,f=c.instanceKey,g=c.isGroup,i=c.lastActivityTs;await d("MAWThreadMappingQPL").measurePerformanceForNullableInstanceKey("handle_existing_thread",f,function(){return Promise.all([q(a,b,{clientThreadKey:e,isGroup:g,lastActivityTs:i}),e!=null&&s(a,b,(h||(h=d("I64"))).of_string(e))])})}async function u(a,b,e){var f=await a.threads.get(b);f!=null&&(h||(h=d("I64"))).to_int32(f.authorityLevel)===c("LSAuthorityLevel").AUTHORITATIVE?await t(a,b,e):e.instanceKey!=null&&d("MAWThreadMappingQPL").handleExistingThreadFail(e.instanceKey,f);f==null&&m.DEBUG(k(),e.clientThreadKey)}async function v(a,b){var c=b.authoritativeThreadKey,e=b.clientThreadKey,f=b.description,g=b.folder,k=b.instanceKey,l=b.isGroup,n=b.jid;b=b.lastActivityTs;var o=d("MAWJids").convertChatJidToIntJid(n),p=await d("MAWMiActGetThreadLifecycleState").getThreadLifecycleStateByJidOrThreadKey(a,o,c,"MAWBridgeOccamadilloVerifyThreadExistsHandler");k!=null&&d("MAWThreadMappingQPL").addAnnotations({string:{threadStateInOccamVTE:p.type.toString()}},k);switch(p.type){case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.JID_MISSING_MAPPING_ROW:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.JID_MISSING_MI_THREAD:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.OPTIMISTIC_THREAD_WITH_ACT:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.CLIENT_PARTIAL_MI_THREAD:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.CLIENT_PARTIAL_MI_THREAD_WITH_ACT:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.SERVER_PARTIAL_MI_THREAD:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.THREAD_KEY_ONLY:return d("MAWCreateOptimisticMiThreadForActThread").maybeUpdateMappingTableAndUpgradeOptimisticActThreadInMI(a,{authoritativeThreadKey:c,clientThreadKey:e,description:f,folder:g,instanceKey:k,intJid:o,isGroup:l,lastActivityTs:b},p).then(function(){return{previousState:p.type}});case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.AUTHORITATIVE_THREAD_ONLY:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.AUTHORITATIVE_THREAD_MISSING_MAPPING_ROW:c=(h||(h=d("I64"))).to_string(p.serverThreadKey);m.DEBUG(j(),n,c,p.type,b);return r(a,p.serverThreadKey,o,{clientThreadKey:e,instanceKey:k,isGroup:l,lastActivityTs:b}).then(function(){return{previousState:p.type}});case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.MI_AND_ACT_THREAD_COMPLETE:g=(h||(h=d("I64"))).to_string(p.serverThreadKey);m.DEBUG(i(),n,g,b);return u(a,p.serverThreadKey,{clientThreadKey:e,instanceKey:k,isGroup:l,lastActivityTs:b}).then(function(){return{previousState:p.type}});case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.OPTIMISTIC_THREAD_NO_ACT:throw m.mustfixThrow("[Unimplemented VerifyThreadExists state: %s for JID: %s, from %s",p.type,n,f);default:p.type;throw m.mustfixThrow("Unhandled VerifyThreadExists state: %s for JID: %s, from %s",p.type,n,f)}}async function w(a,b,c,e){await d("MAWThreadMappingQPL").measurePerformanceForNullableInstanceKey("insert_ephemeral_cache",e,async function(){var e=await a.threads.get(b);if(e!=null){var f;e={ephemeralExpirationInSec:(h||(h=d("I64"))).to_int32((f=e.disappearingSettingTtl)!=null?f:(h||(h=d("I64"))).zero),ephemeralLastUpdatedOrSetTimestamp:d("WATimeUtils").castMilliSecondsToUnixTime(h.to_float((f=e.disappearingSettingUpdatedTs)!=null?f:(h||(h=d("I64"))).zero))};d("MAWBridgeFireAndForget").fireAndForget("backend","setEphemeralSettingCache",{jid:c,settings:e})}})}async function a(a,b){var c=b.authoritativeThreadKey,d=b.clientThreadKey,e=b.description,f=b.folder,g=b.instanceKey,h=b.isGroup,i=b.jid;b=b.lastActivityTs;await x(a,{authoritativeThreadKey:c,clientThreadKey:d,description:e!=null?e:"unknown",folder:f,instanceKey:g,isGroup:h,jid:i,lastActivityTs:b})}async function b(a,b){var c=b.authoritativeThreadKey,d=b.clientThreadKey,e=b.description,f=b.folder,g=b.instanceKey,h=b.isGroup,i=b.jid;b=b.lastActivityTs;await x(a,{authoritativeThreadKey:c,clientThreadKey:d,description:e,folder:f,instanceKey:g,isGroup:h,jid:i,lastActivityTs:b})}async function x(a,b){var e=b.authoritativeThreadKey,f=b.clientThreadKey,g=b.description,i=b.instanceKey,j=b.jid;i!=null&&d("MAWThreadMappingQPL").addPoint("occam_verify_thread_exists_start",i);var k=c("gkx")("11539");k&&d("MAWActThreadMapping").executePromisesBlockedOnActThreadMapping({authoritativeThreadKey:e,description:g,instanceKey:i,jid:j,optimisticThreadKey:f});var l=await v(a,b);l=l.previousState;k||d("MAWActThreadMapping").executePromisesBlockedOnActThreadMapping({authoritativeThreadKey:e,description:g,instanceKey:i,jid:j,optimisticThreadKey:f});k=e!=null?e:f;g=k!=null?(h||(h=d("I64"))).of_string(k):null;g!=null&&l!==d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.MI_AND_ACT_THREAD_COMPLETE&&await w(a,g,j,i);if(i!=null){d("MAWThreadMappingQPL").addPoint("occam_verify_thread_exists_end",i);e=d("MAWJids").convertChatJidToIntJid(b.jid);d("MAWThreadMappingQPL").pendingThreadCreationOnServer.has((h||(h=d("I64"))).to_string(e))||await d("MAWThreadMappingQPL").end({instanceKey:i,intJid:e,tables:a,threadKey:g})}}g.genUpdatesForAuthoritativeThread=t;g.insertEphemeralCache=w;g.call=a;g.callFromMainThread=b}),98);
__d("WASIContext",[],(function(a,b,c,d,e,f){"use strict";a=function(a){var b;this.fs=(b=a==null?void 0:a.fs)!=null?b:{};this.args=(b=a==null?void 0:a.args)!=null?b:[];this.env=(b=a==null?void 0:a.env)!=null?b:{};this.stdin=(b=a==null?void 0:a.stdin)!=null?b:function(){return null};this.stdout=(b=a==null?void 0:a.stdout)!=null?b:function(){};this.stderr=(b=a==null?void 0:a.stderr)!=null?b:function(){};this.debug=a==null?void 0:a.debug;this.isTTY=!!(a==null?void 0:a.isTTY)};f.WASIContext=a}),66);
__d("WASISnapshotPreview1",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=Object.freeze({SUCCESS:0,E2BIG:1,EACCESS:2,EADDRINUSE:3,EADDRNOTAVAIL:4,EAFNOSUPPORT:5,EAGAIN:6,EALREADY:7,EBADF:8,EBADMSG:9,EBUSY:10,ECANCELED:11,ECHILD:12,ECONNABORTED:13,ECONNREFUSED:14,ECONNRESET:15,EDEADLK:16,EDESTADDRREQ:17,EDOM:18,EDQUOT:19,EEXIST:20,EFAULT:21,EFBIG:22,EHOSTUNREACH:23,EIDRM:24,EILSEQ:25,EINPROGRESS:26,EINTR:27,EINVAL:28,EIO:29,EISCONN:30,EISDIR:31,ELOOP:32,EMFILE:33,EMLINK:34,EMSGSIZE:35,EMULTIHOP:36,ENAMETOOLONG:37,ENETDOWN:38,ENETRESET:39,ENETUNREACH:40,ENFILE:41,ENOBUFS:42,ENODEV:43,ENOENT:44,ENOEXEC:45,ENOLCK:46,ENOLINK:47,ENOMEM:48,ENOMSG:49,ENOPROTOOPT:50,ENOSPC:51,ENOSYS:52,ENOTCONN:53,ENOTDIR:54,ENOTEMPTY:55,ENOTRECOVERABLE:56,ENOTSOCK:57,ENOTSUP:58,ENOTTY:59,ENXIO:60,EOVERFLOW:61,EOWNERDEAD:62,EPERM:63,EPIPE:64,EPROTO:65,EPROTONOSUPPORT:66,EPROTOTYPE:67,ERANGE:68,EROFS:69,ESPIPE:70,ESRCH:71,ESTALE:72,ETIMEDOUT:73,ETXTBSY:74,EXDEV:75,ENOTCAPABLE:76});d=(c=b("$InternalEnum"))({REALTIME:0,MONOTONIC:1,PROCESS_CPUTIME_ID:2,THREAD_CPUTIME_ID:3});e=c({SET:0,CUR:1,END:2});b=c({UNKNOWN:0,BLOCK_DEVICE:1,CHARACTER_DEVICE:2,DIRECTORY:3,REGULAR_FILE:4,SOCKET_DGRAM:5,SOCKET_STREAM:6,SYMBOLIC_LINK:7});var g=c({DIR:0});c=c({CLOCK:0,FD_READ:1,FD_WRITE:2});var h={SYMLINK_FOLLOW:1<<0},i={CREAT:1<<0,DIRECTORY:1<<1,EXCL:1<<2,TRUNC:1<<3},j={APPEND:1<<0,DSYNC:1<<1,NONBLOCK:1<<2,RSYNC:1<<3,SYNC:1<<4},k={FD_DATASYNC:BigInt(1)<<BigInt(0),FD_READ:BigInt(1)<<BigInt(1),FD_SEEK:BigInt(1)<<BigInt(2),FD_FDSTAT_SET_FLAGS:BigInt(1)<<BigInt(3),FD_SYNC:BigInt(1)<<BigInt(4),FD_TELL:BigInt(1)<<BigInt(5),FD_WRITE:BigInt(1)<<BigInt(6),FD_ADVISE:BigInt(1)<<BigInt(7),FD_ALLOCATE:BigInt(1)<<BigInt(8),PATH_CREATE_DIRECTORY:BigInt(1)<<BigInt(9),PATH_CREATE_FILE:BigInt(1)<<BigInt(10),PATH_LINK_SOURCE:BigInt(1)<<BigInt(11),PATH_LINK_TARGET:BigInt(1)<<BigInt(12),PATH_OPEN:BigInt(1)<<BigInt(13),FD_READDIR:BigInt(1)<<BigInt(14),PATH_READLINK:BigInt(1)<<BigInt(15),PATH_RENAME_SOURCE:BigInt(1)<<BigInt(16),PATH_RENAME_TARGET:BigInt(1)<<BigInt(17),PATH_FILESTAT_GET:BigInt(1)<<BigInt(18),PATH_FILESTAT_SET_SIZE:BigInt(1)<<BigInt(19),PATH_FILESTAT_SET_TIMES:BigInt(1)<<BigInt(20),FD_FILESTAT_GET:BigInt(1)<<BigInt(21),FD_FILESTAT_SET_SIZE:BigInt(1)<<BigInt(22),FD_FILESTAT_SET_TIMES:BigInt(1)<<BigInt(23),PATH_SYMLINK:BigInt(1)<<BigInt(24),PATH_REMOVE_DIRECTORY:BigInt(1)<<BigInt(25),PATH_UNLINK_FILE:BigInt(1)<<BigInt(26),POLL_FD_READWRITE:BigInt(1)<<BigInt(27),SOCK_SHUTDOWN:BigInt(1)<<BigInt(28),SOCK_ACCEPT:BigInt(1)<<BigInt(29)},l={ATIM:1<<0,ATIM_NOW:1<<1,MTIM:1<<2,MTIM_NOW:1<<3},m={SUBSCRIPTION_CLOCK_ABSTIME:1<<0},n={FD_READWRITE_HANGUP:1<<0},o=64,p=48,q=32;f.RESULT=a;f.Clock=d;f.Whence=e;f.FileType=b;f.PreopenType=g;f.EventType=c;f.LookupFlags=h;f.OpenFlags=i;f.FileDescriptorFlags=j;f.RightsFlags=k;f.FileStatTimestampFlags=l;f.SubscriptionClockFlags=m;f.EventReadWriteFlags=n;f.FILESTAT_SIZE=o;f.SUBSCRIPTION_SIZE=p;f.EVENT_SIZE=q}),66);
__d("WATextEncoding",[],(function(a,b,c,d,e,f){"use strict";e=TextEncoder;var g=TextDecoder,h=e,i=g;function a(){return new h()}function b(){return new i()}function c(a){h=a}function d(a){i=a}f.newTextEncoder=a;f.newTextDecoder=b;f.setTextEncoderClass=c;f.setTextDecoderClass=d}),66);
__d("WASIDrive",["WASISnapshotPreview1","WATextEncoding"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){this.nextFD=10,this.openMap=new Map(),this.fs=babelHelpers["extends"]({},a),this.openMap.set(3,new j(this.fs,"/"))}var b=a.prototype;b.$1=function(a,b,c){a=new h(a,c);b&&(a.buffer=new Uint8Array(new ArrayBuffer(1024),0,0));c=this.nextFD;this.openMap.set(c,a);this.nextFD++;return[d("WASISnapshotPreview1").RESULT.SUCCESS,c]};b.$2=function(a,b){a=new j(a,b);b=this.nextFD;this.openMap.set(b,a);this.nextFD++;return[d("WASISnapshotPreview1").RESULT.SUCCESS,b]};b.$3=function(a,b){return b==="."?!0:a.containsDirectory(b)};b.open=function(a,b,c,e){var f,g=!!(c&(f=d("WASISnapshotPreview1")).OpenFlags.CREAT),h=!!(c&f.OpenFlags.DIRECTORY),i=!!(c&f.OpenFlags.EXCL);c=!!(c&f.OpenFlags.TRUNC);f=this.openMap.get(a);if(!(f instanceof j))return[d("WASISnapshotPreview1").RESULT.EBADF];if(f.containsFile(b)){if(h)return[d("WASISnapshotPreview1").RESULT.ENOTDIR];if(i)return[d("WASISnapshotPreview1").RESULT.EEXIST];a=f.get(b);return this.$1(a,c,e)}else if(this.$3(f,b)){if(b===".")return this.$2(this.fs,"/");var k="/"+b+"/";h=Object.entries(this.fs).filter(function(a){a=a[0];return a.startsWith(k)});return this.$2(Object.fromEntries(h),k)}else{if(g){i=f.fullPath(b);this.fs[i]={path:i,mode:"binary",content:new Uint8Array(0),timestamps:{access:new Date(),modification:new Date(),change:new Date()}};return this.$1(this.fs[i],c,e)}return[d("WASISnapshotPreview1").RESULT.ENOTCAPABLE]}};b.close=function(a){if(!this.openMap.has(a))return d("WASISnapshotPreview1").RESULT.EBADF;var b=this.openMap.get(a);b instanceof h&&b.sync();this.openMap["delete"](a);return d("WASISnapshotPreview1").RESULT.SUCCESS};b.read=function(a,b){a=this.openMap.get(a);return!a||a instanceof j?[d("WASISnapshotPreview1").RESULT.EBADF]:[d("WASISnapshotPreview1").RESULT.SUCCESS,a.read(b)]};b.pread=function(a,b,c){a=this.openMap.get(a);return!a||a instanceof j?[d("WASISnapshotPreview1").RESULT.EBADF]:[d("WASISnapshotPreview1").RESULT.SUCCESS,a.pread(b,c)]};b.write=function(a,b){a=this.openMap.get(a);if(!a||a instanceof j)return d("WASISnapshotPreview1").RESULT.EBADF;a.write(b);return d("WASISnapshotPreview1").RESULT.SUCCESS};b.pwrite=function(a,b,c){a=this.openMap.get(a);if(!a||a instanceof j)return d("WASISnapshotPreview1").RESULT.EBADF;a.pwrite(b,c);return d("WASISnapshotPreview1").RESULT.SUCCESS};b.sync=function(a){a=this.openMap.get(a);if(!a||a instanceof j)return d("WASISnapshotPreview1").RESULT.EBADF;a.sync();return d("WASISnapshotPreview1").RESULT.SUCCESS};b.seek=function(a,b,c){a=this.openMap.get(a);return!a||a instanceof j?[d("WASISnapshotPreview1").RESULT.EBADF]:[d("WASISnapshotPreview1").RESULT.SUCCESS,a.seek(b,c)]};b.tell=function(a){a=this.openMap.get(a);return!a||a instanceof j?[d("WASISnapshotPreview1").RESULT.EBADF]:[d("WASISnapshotPreview1").RESULT.SUCCESS,a.tell()]};b.renumber=function(a,b){if(!this.exists(a)||!this.exists(b))return d("WASISnapshotPreview1").RESULT.EBADF;if(a===b)return d("WASISnapshotPreview1").RESULT.SUCCESS;this.close(b);a=this.openMap.get(a);this.openMap.set(b,a);return d("WASISnapshotPreview1").RESULT.SUCCESS};b.unlink=function(a,b){a=this.openMap.get(a);if(!(a instanceof j))return d("WASISnapshotPreview1").RESULT.EBADF;if(!a.contains(b))return d("WASISnapshotPreview1").RESULT.ENOENT;for(var c of Object.keys(this.fs))(c===a.fullPath(b)||c.startsWith(a.fullPath(b)+"/"))&&delete this.fs[c];return d("WASISnapshotPreview1").RESULT.SUCCESS};b.rename=function(a,b,c,e){a=this.openMap.get(a);c=this.openMap.get(c);if(!(a instanceof j)||!(c instanceof j))return d("WASISnapshotPreview1").RESULT.EBADF;if(!a.contains(b))return d("WASISnapshotPreview1").RESULT.ENOENT;if(c.contains(e))return d("WASISnapshotPreview1").RESULT.EEXIST;a=a.fullPath(b);b=c.fullPath(e);for(c of Object.keys(this.fs))if(c.startsWith(a)){e=c.replace(a,b);this.fs[e]=this.fs[c];this.fs[e].path=e;delete this.fs[c]}return d("WASISnapshotPreview1").RESULT.SUCCESS};b.list=function(a){a=this.openMap.get(a);return!(a instanceof j)?[d("WASISnapshotPreview1").RESULT.EBADF]:[d("WASISnapshotPreview1").RESULT.SUCCESS,a.list()]};b.stat=function(a){a=this.openMap.get(a);return!(a instanceof h)?[d("WASISnapshotPreview1").RESULT.EBADF]:[d("WASISnapshotPreview1").RESULT.SUCCESS,a.stat()]};b.pathStat=function(a,b){a=this.openMap.get(a);if(!(a instanceof j))return[d("WASISnapshotPreview1").RESULT.EBADF];if(a.containsFile(b)){var c=a.fullPath(b);c=new h(this.fs[c],0).stat();return[d("WASISnapshotPreview1").RESULT.SUCCESS,c]}else if(this.$3(a,b)){if(b===".")return[d("WASISnapshotPreview1").RESULT.SUCCESS,new j(this.fs,"/").stat()];var e="/"+b+"/";c=Object.entries(this.fs).filter(function(a){a=a[0];return a.startsWith(e)});a=new j(Object.fromEntries(c),e).stat();return[d("WASISnapshotPreview1").RESULT.SUCCESS,a]}else return[d("WASISnapshotPreview1").RESULT.ENOTCAPABLE]};b.setFlags=function(a,b){a=this.openMap.get(a);if(a instanceof h){a.setFlags(b);return d("WASISnapshotPreview1").RESULT.SUCCESS}else return d("WASISnapshotPreview1").RESULT.EBADF};b.setSize=function(a,b){a=this.openMap.get(a);if(a instanceof h){a.setSize(Number(b));return d("WASISnapshotPreview1").RESULT.SUCCESS}else return d("WASISnapshotPreview1").RESULT.EBADF};b.setAccessTime=function(a,b){a=this.openMap.get(a);if(a instanceof h){a.setAccessTime(b);return d("WASISnapshotPreview1").RESULT.SUCCESS}else return d("WASISnapshotPreview1").RESULT.EBADF};b.setModificationTime=function(a,b){a=this.openMap.get(a);if(a instanceof h){a.setModificationTime(b);return d("WASISnapshotPreview1").RESULT.SUCCESS}else return d("WASISnapshotPreview1").RESULT.EBADF};b.pathSetAccessTime=function(a,b,c){a=this.openMap.get(a);if(!(a instanceof j))return d("WASISnapshotPreview1").RESULT.EBADF;a=a.get(b);if(a==null)return d("WASISnapshotPreview1").RESULT.ENOTCAPABLE;b=new h(a,0);b.setAccessTime(c);b.sync();return d("WASISnapshotPreview1").RESULT.SUCCESS};b.pathSetModificationTime=function(a,b,c){a=this.openMap.get(a);if(!(a instanceof j))return d("WASISnapshotPreview1").RESULT.EBADF;a=a.get(b);if(a==null)return d("WASISnapshotPreview1").RESULT.ENOTCAPABLE;b=new h(a,0);b.setModificationTime(c);b.sync();return d("WASISnapshotPreview1").RESULT.SUCCESS};b.pathCreateDir=function(a,b){a=this.openMap.get(a);if(!(a instanceof j))return d("WASISnapshotPreview1").RESULT.EBADF;if(a.contains(b))return d("WASISnapshotPreview1").RESULT.ENOTCAPABLE;a=a.fullPath(b)+"/.runno";this.fs[a]={path:a,timestamps:{access:new Date(),modification:new Date(),change:new Date()},mode:"string",content:""};return d("WASISnapshotPreview1").RESULT.SUCCESS};b.exists=function(a){return this.openMap.has(a)};b.fileType=function(a){a=this.openMap.get(a);if(!a)return d("WASISnapshotPreview1").FileType.UNKNOWN;else if(a instanceof h)return d("WASISnapshotPreview1").FileType.REGULAR_FILE;else return d("WASISnapshotPreview1").FileType.DIRECTORY};b.fileFdflags=function(a){a=this.openMap.get(a);if(a instanceof h)return a.fdflags;else return 0};return a}();var h=function(){var b=a.prototype;b.getOffset=function(){return Number(this.$1)};function a(a,b){this.$1=BigInt(0);this.isDirty=!1;this.file=a;if(this.file.mode==="string"){a=this.file.content;var c=d("WATextEncoding").newTextEncoder();this.buffer=c.encode(a)}else this.buffer=this.file.content;this.fdflags=b;this.flagAppend=!!(b&d("WASISnapshotPreview1").FileDescriptorFlags.APPEND);this.flagDSync=!!(b&d("WASISnapshotPreview1").FileDescriptorFlags.DSYNC);this.flagNonBlock=!!(b&d("WASISnapshotPreview1").FileDescriptorFlags.NONBLOCK);this.flagRSync=!!(b&d("WASISnapshotPreview1").FileDescriptorFlags.RSYNC);this.flagSync=!!(b&d("WASISnapshotPreview1").FileDescriptorFlags.SYNC)}b.read=function(a){a=this.buffer.subarray(this.getOffset(),this.getOffset()+a);this.$1+=BigInt(a.length);return a};b.pread=function(a,b){return this.buffer.subarray(b,b+a)};b.write=function(a){this.isDirty=!0;if(this.flagAppend){var b=this.buffer.length;this.$2(b+a.byteLength);this.buffer.set(a,b)}else{b=Math.max(this.getOffset()+a.byteLength,this.buffer.byteLength);this.$2(b);this.buffer.set(a,this.getOffset());this.$1+=BigInt(a.byteLength)}(this.flagDSync||this.flagSync)&&this.sync()};b.pwrite=function(a,b){this.isDirty=!0;if(this.flagAppend){var c=this.buffer.length;this.$2(c+a.byteLength);this.buffer.set(a,c)}else{c=Math.max(b+a.byteLength,this.buffer.byteLength);this.$2(c);this.buffer.set(a,b)}(this.flagDSync||this.flagSync)&&this.sync()};b.sync=function(){if(!this.isDirty)return;this.isDirty=!1;if(this.file.mode==="binary"){this.file.content=new Uint8Array(this.buffer);return}var a=d("WATextEncoding").newTextDecoder();this.file.content=a.decode(this.buffer);return};b.seek=function(a,b){switch(b){case d("WASISnapshotPreview1").Whence.SET:this.$1=a;break;case d("WASISnapshotPreview1").Whence.CUR:this.$1+=a;break;case d("WASISnapshotPreview1").Whence.END:this.$1=BigInt(this.buffer.length)+a;break}return this.$1};b.tell=function(){return this.$1};b.stat=function(){return{path:this.file.path,timestamps:this.file.timestamps,type:d("WASISnapshotPreview1").FileType.REGULAR_FILE,byteLength:this.buffer.length}};b.setFlags=function(a){this.fdflags=a};b.setSize=function(a){this.$2(a)};b.setAccessTime=function(a){this.file.timestamps.access=a};b.setModificationTime=function(a){this.file.timestamps.modification=a};b.$2=function(a){if(a<=this.buffer.buffer.byteLength){this.buffer=new Uint8Array(this.buffer.buffer,0,a);return}var b;this.buffer.buffer.byteLength===0?b=new ArrayBuffer(a<1024?1024:a*2):a>this.buffer.buffer.byteLength*2?b=new ArrayBuffer(a*2):b=new ArrayBuffer(this.buffer.buffer.byteLength*2);b=new Uint8Array(b,0,a);b.set(this.buffer);this.buffer=b};return a}();function i(a,b){b=b.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&");b=new RegExp("^"+b);return a.replace(b,"")}var j=function(){function a(a,b){this.dir=a,this.prefix=b}var b=a.prototype;b.containsFile=function(a){for(var b of Object.keys(this.dir)){var c=i(b,this.prefix);if(c===a)return!0}return!1};b.containsDirectory=function(a){for(var b of Object.keys(this.dir)){var c=i(b,this.prefix);if(c.startsWith(a+"/"))return!0}return!1};b.contains=function(a){for(var b of Object.keys(this.dir)){var c=i(b,this.prefix);if(c===a||c.startsWith(a+"/"))return!0}return!1};b.get=function(a){return this.dir[this.fullPath(a)]};b.fullPath=function(a){return""+this.prefix+a};b.list=function(){var a=[],b=new Set();for(var c of Object.keys(this.dir)){var e=i(c,this.prefix);if(e.includes("/")){var f=e.split("/")[0];if(b.has(f))continue;b.add(f);a.push({name:f,type:d("WASISnapshotPreview1").FileType.DIRECTORY})}else a.push({name:e,type:d("WASISnapshotPreview1").FileType.REGULAR_FILE})}return a};b.stat=function(){return{path:this.prefix,timestamps:{access:new Date(),modification:new Date(),change:new Date()},type:d("WASISnapshotPreview1").FileType.DIRECTORY,byteLength:0}};return a}();g.WASIDrive=a}),98);
__d("WASI",["WACryptoDependencies","WASIContext","WASIDrive","WASISnapshotPreview1","WATextEncoding","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b,e=new(d("WASIContext").WASIContext)(a),f=new(d("WASIDrive").WASIDrive)(e.fs);function g(){return Object.entries(e.env).map(function(a){var b=a[0];a=a[1];return b+"="+a})}var o={args_get:function(a,c){a=a;c=c;var f=new DataView(b.buffer);for(var g of e.args){f.setUint32(a,c,!0);a+=4;var h=d("WATextEncoding").newTextEncoder().encode(g+"\0"),i=new Uint8Array(b.buffer,c,h.byteLength);i.set(h);c+=h.byteLength}return d("WASISnapshotPreview1").RESULT.SUCCESS},args_sizes_get:function(a,c){var f=e.args,g=f.reduce(function(a,b){return a+d("WATextEncoding").newTextEncoder().encode(b+"\0").byteLength},0),h=new DataView(b.buffer);h.setUint32(a,f.length,!0);h.setUint32(c,g,!0);return d("WASISnapshotPreview1").RESULT.SUCCESS},clock_res_get:function(){throw c("err")("clock_res_get is not implemented")},clock_time_get:function(a,c,e){c=d("WASISnapshotPreview1").Clock.cast(a);if(c==null)return d("WASISnapshotPreview1").RESULT.EINVAL;switch(c){case d("WASISnapshotPreview1").Clock.REALTIME:case d("WASISnapshotPreview1").Clock.MONOTONIC:case d("WASISnapshotPreview1").Clock.PROCESS_CPUTIME_ID:case d("WASISnapshotPreview1").Clock.THREAD_CPUTIME_ID:a=new DataView(b.buffer);a.setBigUint64(e,n(new Date()),!0);return d("WASISnapshotPreview1").RESULT.SUCCESS}},environ_get:function(a,c){a=a;c=c;var e=new DataView(b.buffer);for(var f of g()){e.setUint32(a,c,!0);a+=4;var h=d("WATextEncoding").newTextEncoder().encode(f+"\0"),i=new Uint8Array(b.buffer,c,h.byteLength);i.set(h);c+=h.byteLength}return d("WASISnapshotPreview1").RESULT.SUCCESS},environ_sizes_get:function(a,c){var e=g().reduce(function(a,b){return a+d("WATextEncoding").newTextEncoder().encode(b+"\0").byteLength},0),f=new DataView(b.buffer);f.setUint32(a,g().length,!0);f.setUint32(c,e,!0);return d("WASISnapshotPreview1").RESULT.SUCCESS},fd_advise:function(){throw c("err")("fd_advise is not implemented")},fd_allocate:function(){throw c("err")("fd_allocate is not implemented")},fd_close:function(a){return f.close(a)},fd_datasync:function(){throw c("err")("fd_datasync is not implemented")},fd_fdstat_get:function(a,c){if(a<3){if(e.isTTY){var g=i^d("WASISnapshotPreview1").RightsFlags.FD_SEEK^d("WASISnapshotPreview1").RightsFlags.FD_TELL;g=l(d("WASISnapshotPreview1").FileType.CHARACTER_DEVICE,0,g)}else g=l(d("WASISnapshotPreview1").FileType.CHARACTER_DEVICE,0);var h=new Uint8Array(b.buffer,c,g.byteLength);h.set(g);return d("WASISnapshotPreview1").RESULT.SUCCESS}if(!f.exists(a))return d("WASISnapshotPreview1").RESULT.EBADF;h=f.fileType(a);g=f.fileFdflags(a);a=l(h,g);h=new Uint8Array(b.buffer,c,a.byteLength);h.set(a);return d("WASISnapshotPreview1").RESULT.SUCCESS},fd_fdstat_set_flags:function(a,b){return f.setFlags(a,b)},fd_fdstat_set_rights:function(){return d("WASISnapshotPreview1").RESULT.SUCCESS},fd_filestat_get:function(a,c){if(a<3){var e;switch(a){case 0:e="/dev/stdin";break;case 1:e="/dev/stdout";break;case 2:e="/dev/stderr";break;default:e="/dev/undefined";break}var g=k({path:e,byteLength:0,timestamps:{access:new Date(),modification:new Date(),change:new Date()},type:d("WASISnapshotPreview1").FileType.CHARACTER_DEVICE}),h=new Uint8Array(b.buffer,c,g.byteLength);h.set(g);return d("WASISnapshotPreview1").RESULT.SUCCESS}h=f.stat(a);if(h.length===1)return h[0];g=h[1];a=k(g);h=new Uint8Array(b.buffer,c,a.byteLength);h.set(a);return d("WASISnapshotPreview1").RESULT.SUCCESS},fd_filestat_set_size:function(){throw c("err")("fd_filestat_set_size is not implemented")},fd_filestat_set_times:function(){throw c("err")("fd_filestat_set_times is not implemented")},fd_pread:function(){throw c("err")("fd_pread is not implemented")},fd_prestat_dir_name:function(a,c,e){if(a!==3)return d("WASISnapshotPreview1").RESULT.EBADF;a=d("WATextEncoding").newTextEncoder().encode("/");c=new Uint8Array(b.buffer,c,e);c.set(a.subarray(0,e));return d("WASISnapshotPreview1").RESULT.SUCCESS},fd_prestat_get:function(a,c){if(a!==3)return d("WASISnapshotPreview1").RESULT.EBADF;a=d("WATextEncoding").newTextEncoder().encode(".");c=new DataView(b.buffer,c);c.setUint8(0,d("WASISnapshotPreview1").PreopenType.DIR);c.setUint32(4,a.byteLength,!0);return d("WASISnapshotPreview1").RESULT.SUCCESS},fd_pwrite:function(){throw c("err")("fd_pwrite is not implemented")},fd_read:function(a,c,g,h){if(a===1||a===2)return d("WASISnapshotPreview1").RESULT.ENOTSUP;var i=new DataView(b.buffer);c=j(i,c,g);g=d("WATextEncoding").newTextEncoder();var k=0,l=d("WASISnapshotPreview1").RESULT.SUCCESS;for(c of c){var m=void 0;if(a===0){var n=e.stdin(c.byteLength);if(n==null)break;m=g.encode(n)}else{n=f.read(a,c.byteLength);if(n.length===1){l=n[0];break}else m=n[1]}n=Math.min(c.byteLength,m.byteLength);c.set(m.subarray(0,n));k+=n}i.setUint32(h,k,!0);return l},fd_readdir:function(){throw c("err")("fd_readdir is not implemented")},fd_renumber:function(){throw c("err")("fd_renumber is not implemented")},fd_seek:function(a,e,g,h){g=d("WASISnapshotPreview1").Whence.cast(g);if(g==null)throw c("err")("fd_seek: invalid whence");a=f.seek(a,e,g);if(a.length===1)return a[0];e=a[0];g=a[1];a=new DataView(b.buffer);a.setBigUint64(h,g,!0);return e},fd_sync:function(){throw c("err")("fd_sync is not implemented")},fd_tell:function(a,c){a=f.tell(a);if(a.length===1)return a[0];var d=a[0];a=a[1];var e=new DataView(b.buffer);e.setBigUint64(c,a,!0);return d},fd_write:function(a,c,g,h){if(a===0)return d("WASISnapshotPreview1").RESULT.ENOTSUP;var i=new DataView(b.buffer);c=j(i,c,g);g=d("WATextEncoding").newTextDecoder();var k=0,l=d("WASISnapshotPreview1").RESULT.SUCCESS;for(c of c){if(c.byteLength===0)continue;if(a===1||a===2){var m=a===1?e.stdout:e.stderr,n=g.decode(c);m(n)}else{l=f.write(a,c);if(l!==d("WASISnapshotPreview1").RESULT.SUCCESS)break}k+=c.byteLength}i.setUint32(h,k,!0);return l},path_create_directory:function(){throw c("err")("path_create_directory is not implemented")},path_filestat_get:function(){throw c("err")("path_filestat_get is not implemented")},path_filestat_set_times:function(){throw c("err")("path_filestat_set_times is not implemented")},path_link:function(){throw c("err")("path_link is not implemented")},path_open:function(a,c,d,e,g,h,i,j,k){c=new DataView(b.buffer);h=m(b,d,e);i=f.open(a,h,g,j);if(i.length===1)return i[0];d=i[0];e=i[1];c.setUint32(k,e,!0);return d},path_readlink:function(){throw c("err")("path_readlink is not implemented")},path_remove_directory:function(){throw c("err")("path_remove_directory is not implemented")},path_rename:function(){throw c("err")("path_rename is not implemented")},path_symlink:function(){throw c("err")("path_symlink is not implemented")},path_unlink_file:function(){throw c("err")("path_unlink_file is not implemented")},poll_oneoff:function(){throw c("err")("poll_oneoff is not implemented")},proc_exit:function(a){throw new h(a)},proc_raise:function(){throw c("err")("proc_raise is not implemented")},random_get:function(a,c){a=new Uint8Array(b.buffer,a,c);d("WACryptoDependencies").getCrypto().getRandomValues(a);return d("WASISnapshotPreview1").RESULT.SUCCESS},sched_yield:function(){throw c("err")("sched_yield is not implemented")},sock_accept:function(){throw c("err")("sock_accept is not implemented")},sock_recv:function(){throw c("err")("sock_recv is not implemented")},sock_send:function(){throw c("err")("sock_send is not implemented")},sock_shutdown:function(){throw c("err")("sock_shutdown is not implemented")}};return{getImportObject:function(){return{wasi_snapshot_preview1:o}},start:function(a){var d=a.exports.memory;if(d instanceof WebAssembly.Memory)b=d;else throw c("err")("Expected memory object");d=a.exports._start;try{d()}catch(a){if(a instanceof h)return{exitCode:a.code,fs:f.fs};else if(a instanceof WebAssembly.RuntimeError)return{exitCode:134,fs:f.fs};else throw a}return{exitCode:0,fs:f.fs}}}}var h=function(b){babelHelpers.inheritsLoose(a,b);function a(a){var c;c=b.call(this)||this;c.code=a;return c}return a}(babelHelpers.wrapNativeSuper(Error)),i=(b=d("WASISnapshotPreview1")).RightsFlags.FD_DATASYNC|b.RightsFlags.FD_READ|b.RightsFlags.FD_SEEK|b.RightsFlags.FD_FDSTAT_SET_FLAGS|b.RightsFlags.FD_SYNC|b.RightsFlags.FD_TELL|b.RightsFlags.FD_WRITE|b.RightsFlags.FD_ADVISE|b.RightsFlags.FD_ALLOCATE|b.RightsFlags.PATH_CREATE_DIRECTORY|b.RightsFlags.PATH_CREATE_FILE|b.RightsFlags.PATH_LINK_SOURCE|b.RightsFlags.PATH_LINK_TARGET|b.RightsFlags.PATH_OPEN|b.RightsFlags.FD_READDIR|b.RightsFlags.PATH_READLINK|b.RightsFlags.PATH_RENAME_SOURCE|b.RightsFlags.PATH_RENAME_TARGET|b.RightsFlags.PATH_FILESTAT_GET|b.RightsFlags.PATH_FILESTAT_SET_SIZE|b.RightsFlags.PATH_FILESTAT_SET_TIMES|b.RightsFlags.FD_FILESTAT_GET|b.RightsFlags.FD_FILESTAT_SET_SIZE|b.RightsFlags.FD_FILESTAT_SET_TIMES|b.RightsFlags.PATH_SYMLINK|b.RightsFlags.PATH_REMOVE_DIRECTORY|b.RightsFlags.PATH_UNLINK_FILE|b.RightsFlags.POLL_FD_READWRITE|b.RightsFlags.SOCK_SHUTDOWN|b.RightsFlags.SOCK_ACCEPT;function j(a,b,c){var d=new Array(c);b=b;for(var e=0;e<c;e++){var f=a.getUint32(b,!0);b+=4;var g=a.getUint32(b,!0);b+=4;d[e]=new Uint8Array(a.buffer,f,g)}return d}function k(a){var b=new Uint8Array(d("WASISnapshotPreview1").FILESTAT_SIZE),c=new DataView(b.buffer);c.setBigUint64(0,BigInt(0),!0);c.setBigUint64(8,BigInt(o(a.path)),!0);c.setUint8(16,a.type);c.setBigUint64(24,BigInt(1),!0);c.setBigUint64(32,BigInt(a.byteLength),!0);c.setBigUint64(40,n(a.timestamps.access),!0);c.setBigUint64(48,n(a.timestamps.modification),!0);c.setBigUint64(56,n(a.timestamps.change),!0);return b}function l(a,b,c){var d=c!=null?c:i;c=c!=null?c:i;var e=new Uint8Array(24),f=new DataView(e.buffer,0,24);f.setUint8(0,a);f.setUint32(2,b,!0);f.setBigUint64(8,d,!0);f.setBigUint64(16,c,!0);return e}function m(a,b,c){return d("WATextEncoding").newTextDecoder().decode(new Uint8Array(a.buffer,b,c))}function n(a){return BigInt(a.getTime())*BigInt(1e6)}function o(a,b){b===void 0&&(b=0);var c=3735928559^b;b=1103547991^b;for(var d=0,e;d<a.length;d++)e=a.charCodeAt(d),c=Math.imul(c^e,2654435761),b=Math.imul(b^e,1597334677);c=Math.imul(c^c>>>16,2246822507)^Math.imul(b^b>>>13,3266489909);b=Math.imul(b^b>>>16,2246822507)^Math.imul(c^c>>>13,3266489909);return 4294967296*(2097151&b)+(c>>>0)}g.createWasi=a}),98);
__d("WACreateWasmFunction",["WAErrorMessage","WAResultOrError","WASI","decodeProtobuf","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unexpected runtime error: ",", for cli: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["invalid result type"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["non-zero-exit-code: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);l=function(){return a};return a}var m="input",n="output",o="/"+m,p="/"+n;function q(a){var b=a.command,c=a.input,d=a.stderr,e=a.stdout;a=a.cli;var f=new Date();return{args:[a,b,"-i="+m,"-o="+n],fs:(a={},a[o]={content:new Uint8Array(c),mode:"binary",path:o,timestamps:{access:f,change:f,modification:f}},a),stderr:d,stdout:e}}function a(a){var b=a.InputSpec,c=a.ResultSpec,e=a.command,f=a.getWasmModule,g=a.logger,m=a.validateResult,n=a.cli,o=g.TAGS(["WasmFunc"]),r=function(a){o.ERROR(l(),a)},s=function(a){o.LOG(k(),a)};return async function(a){try{a=d("encodeProtobuf").encodeProtobuf(b,a).readBuffer();a=d("WASI").createWasi(q({cli:n,command:e,input:a,stderr:r,stdout:s}));var g=a.getImportObject;a=a.start;var k=await f();k=await WebAssembly.instantiate(k,g());g=a(k);a=g.exitCode;k=g.fs;k=(g=k[p])==null?void 0:g.content;if(a!==0){o.ERROR(j(),a);return d("WAResultOrError").makeError("wasm-internal-non-zero-exit-code")}if(!(k instanceof Uint8Array)){o.ERROR(i());return d("WAResultOrError").makeError("wasm-internal-invalid-result-type")}g=d("decodeProtobuf").decodeProtobuf(c,k);return m(g)}catch(a){o.ERROR(h(),d("WAErrorMessage").maybeGetMessageFromError(a),n);return a instanceof Error?d("WAResultOrError").DEPRECATED_makeError("wasm-internal-runtime-error",a):d("WAResultOrError").makeError("wasm-internal-runtime-error")}}}g.createWasmFunction=a}),98);